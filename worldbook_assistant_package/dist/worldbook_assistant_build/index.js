import{diffLines as e}from'https://testingcf.jsdelivr.net/npm/diff/+esm';import{klona as n}from'https://testingcf.jsdelivr.net/npm/klona/+esm';var t={159(e,n,t){t.r(n),t.d(n,{default:()=>l});var a=t(781),o=t.n(a),r=t(11),i=t.n(r)()(o());i.push([e.id,'.wb-assistant-root[data-v-2f8c74d2]{height:auto;width:100%;box-sizing:border-box;display:flex;flex-direction:column;padding:10px;gap:10px;background:linear-gradient(145deg,#0f172a 0%,#111827 45%,#1e293b 100%);color:#e2e8f0;font-size:13px;line-height:1.35;border-radius:10px}.wb-settings-wrapper[data-v-2f8c74d2]{width:100%}.wb-header[data-v-2f8c74d2]{display:flex;justify-content:space-between;align-items:center;border:1px solid #334155;border-radius:10px;padding:8px 10px;background:rgba(15,23,42,0.6)}.wb-title[data-v-2f8c74d2]{display:flex;flex-direction:column;gap:2px}.wb-title strong[data-v-2f8c74d2]{font-size:16px}.wb-title span[data-v-2f8c74d2]{color:#94a3b8}.wb-header-actions[data-v-2f8c74d2],.list-actions[data-v-2f8c74d2],.tool-line[data-v-2f8c74d2]{display:flex;gap:6px;flex-wrap:wrap}.wb-toolbar[data-v-2f8c74d2]{display:flex;gap:6px;flex-wrap:wrap;align-items:center;border:1px solid #334155;border-radius:10px;padding:8px;background:rgba(15,23,42,0.55)}.toolbar-label[data-v-2f8c74d2]{display:inline-flex;align-items:center;gap:6px;color:#cbd5e1}.toolbar-select[data-v-2f8c74d2]{min-width:200px}.toolbar-select.small[data-v-2f8c74d2]{min-width:160px}.wb-bindings[data-v-2f8c74d2]{border:1px solid #334155;border-radius:10px;padding:8px;display:grid;gap:8px;background:rgba(15,23,42,0.5)}.wb-history-shortcuts[data-v-2f8c74d2]{display:flex;justify-content:flex-start;gap:8px;flex-wrap:wrap;align-items:center}.global-mode-panel[data-v-2f8c74d2]{border:1px solid #334155;border-radius:9px;background:rgba(15,23,42,0.58);padding:8px;display:grid;gap:8px}.global-mode-head[data-v-2f8c74d2]{display:flex;justify-content:space-between;align-items:center;gap:8px}.global-mode-title[data-v-2f8c74d2]{color:#93c5fd;font-weight:700;letter-spacing:0.02em}.global-mode-grid[data-v-2f8c74d2]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}.global-mode-column[data-v-2f8c74d2]{border:1px solid #334155;border-radius:8px;padding:8px;background:rgba(2,6,23,0.42);display:grid;gap:6px;min-height:168px}.global-mode-list[data-v-2f8c74d2]{border:1px solid #334155;border-radius:8px;background:rgba(15,23,42,0.6);max-height:176px;min-height:88px;overflow:auto;display:flex;flex-direction:column}.global-mode-item[data-v-2f8c74d2]{width:100%;border:none;border-bottom:1px solid rgba(51,65,85,0.6);background:transparent;color:#e2e8f0;padding:7px 8px;display:flex;justify-content:space-between;align-items:center;gap:10px;cursor:pointer;text-align:left}.global-mode-item[data-v-2f8c74d2]:last-child{border-bottom:none}.global-mode-item[data-v-2f8c74d2]:hover{background:rgba(56,189,248,0.14)}.global-mode-item.add .global-mode-item-action[data-v-2f8c74d2]{color:#86efac}.global-mode-item.active .global-mode-item-action[data-v-2f8c74d2]{color:#fca5a5}.global-mode-item-name[data-v-2f8c74d2]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.global-mode-item-action[data-v-2f8c74d2]{font-size:12px;flex-shrink:0}.global-mode-actions[data-v-2f8c74d2]{display:flex;gap:6px;flex-wrap:wrap}.history-btn[data-v-2f8c74d2]{border-color:#3b82f6;background:rgba(30,58,138,0.25)}.utility-btn[data-v-2f8c74d2]{border-color:#0ea5e9;background:rgba(6,78,118,0.25)}.utility-btn.active[data-v-2f8c74d2]{border-color:#22d3ee;background:rgba(34,211,238,0.16);color:#67e8f9}.wb-main-layout[data-v-2f8c74d2]{min-height:460px;max-height:70vh;display:grid;grid-template-columns:320px 10px minmax(0,1fr);gap:0}.wb-entry-list[data-v-2f8c74d2],.wb-editor[data-v-2f8c74d2]{border:1px solid #334155;border-radius:10px;padding:8px;display:flex;flex-direction:column;gap:8px;background:rgba(15,23,42,0.55);min-height:0}.list-search[data-v-2f8c74d2]{display:grid;gap:6px}.list-summary[data-v-2f8c74d2]{color:#94a3b8;font-size:12px}.list-scroll[data-v-2f8c74d2]{flex:1 1 auto;min-height:210px;max-height:calc(70vh - 210px);overflow:auto;display:flex;flex-direction:column;gap:6px}.entry-item[data-v-2f8c74d2]{width:100%;text-align:left;border:1px solid #334155;background:linear-gradient(145deg,rgba(15,23,42,0.88),rgba(2,6,23,0.9));color:#e2e8f0;border-radius:8px;padding:8px 8px 7px 10px;cursor:pointer;display:grid;gap:6px;position:relative;transition:border-color 0.16s ease,transform 0.16s ease,box-shadow 0.16s ease}.entry-item[data-v-2f8c74d2]::before{content:\'\';position:absolute;left:0;top:0;bottom:0;width:4px;border-radius:8px 0 0 8px;background:linear-gradient(to bottom,#64748b,rgba(100,116,139,0.05))}.entry-item[data-status=\'constant\'][data-v-2f8c74d2]::before{background:linear-gradient(to bottom,#3b82f6,rgba(59,130,246,0))}.entry-item[data-status=\'vector\'][data-v-2f8c74d2]::before{background:linear-gradient(to bottom,#a855f7,rgba(168,85,247,0))}.entry-item[data-status=\'normal\'][data-v-2f8c74d2]::before{background:linear-gradient(to bottom,#22c55e,rgba(34,197,94,0))}.entry-item[data-status=\'disabled\'][data-v-2f8c74d2]::before{background:linear-gradient(to bottom,#6b7280,rgba(107,114,128,0))}.entry-item[data-v-2f8c74d2]:hover{border-color:#475569;transform:translateY(-1px)}.entry-item.selected[data-v-2f8c74d2]{border-color:#38bdf8;box-shadow:0 0 0 1px rgba(56,189,248,0.5) inset,0 6px 16px rgba(14,116,144,0.3)}.entry-item.disabled[data-v-2f8c74d2]{opacity:0.74}.entry-item-head[data-v-2f8c74d2]{display:flex;align-items:center;gap:7px;min-width:0}.entry-status-dot[data-v-2f8c74d2]{width:9px;height:9px;border-radius:999px;background:#64748b;flex-shrink:0;box-shadow:0 0 0 2px rgba(15,23,42,0.85)}.entry-status-dot[data-status=\'constant\'][data-v-2f8c74d2]{background:#3b82f6}.entry-status-dot[data-status=\'vector\'][data-v-2f8c74d2]{background:#a855f7}.entry-status-dot[data-status=\'normal\'][data-v-2f8c74d2]{background:#22c55e}.entry-status-dot[data-status=\'disabled\'][data-v-2f8c74d2]{background:#6b7280}.entry-item-title[data-v-2f8c74d2]{font-weight:700;flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.entry-item-tags[data-v-2f8c74d2]{display:flex;gap:6px;flex-wrap:wrap}.entry-chip[data-v-2f8c74d2]{display:inline-flex;align-items:center;gap:4px;border:1px solid #334155;border-radius:999px;padding:1px 8px;color:#cbd5e1;font-size:11px;background:rgba(15,23,42,0.55)}.entry-chip.uid[data-v-2f8c74d2]{color:#93c5fd;font-size:10px;padding:1px 7px}.entry-chip.mono[data-v-2f8c74d2]{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,\'Liberation Mono\',\'Courier New\',monospace;font-size:10px}.entry-chip.status[data-status=\'constant\'][data-v-2f8c74d2]{border-color:rgba(59,130,246,0.65);color:#93c5fd;background:rgba(59,130,246,0.16)}.entry-chip.status[data-status=\'vector\'][data-v-2f8c74d2]{border-color:rgba(168,85,247,0.65);color:#d8b4fe;background:rgba(168,85,247,0.16)}.entry-chip.status[data-status=\'normal\'][data-v-2f8c74d2]{border-color:rgba(34,197,94,0.65);color:#86efac;background:rgba(34,197,94,0.16)}.entry-chip.status[data-status=\'disabled\'][data-v-2f8c74d2]{border-color:rgba(107,114,128,0.7);color:#cbd5e1;background:rgba(100,116,139,0.15)}.entry-item-preview[data-v-2f8c74d2]{color:#94a3b8;font-size:11px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-left:16px;opacity:0.85}.entry-item-preview[data-v-2f8c74d2]::before{content:\'Keys: \';color:#64748b;margin-right:4px}.wb-editor[data-v-2f8c74d2]{max-height:70vh;overflow:hidden}.wb-editor-shell[data-v-2f8c74d2]{height:100%;min-height:0;display:grid;grid-template-columns:minmax(0,1fr) 10px 360px;gap:0}.wb-resize-handle[data-v-2f8c74d2]{position:relative;width:10px;cursor:col-resize;-webkit-user-select:none;user-select:none;touch-action:none}.wb-resize-handle[data-v-2f8c74d2]::before{content:\'\';position:absolute;left:4px;top:12px;bottom:12px;width:2px;border-radius:999px;background:rgba(100,116,139,0.5);transition:background-color 0.15s ease}.wb-resize-handle[data-v-2f8c74d2]:hover::before,.wb-resize-handle.dragging[data-v-2f8c74d2]::before{background:rgba(56,189,248,0.95)}.editor-center[data-v-2f8c74d2]{border:1px solid #1e293b;border-radius:10px;background:rgba(2,6,23,0.7);padding:10px;display:flex;flex-direction:column;gap:10px;min-height:0;overflow:auto}.editor-head[data-v-2f8c74d2]{display:flex;justify-content:space-between;gap:10px;align-items:flex-end;border-bottom:1px solid #1e293b;padding-bottom:8px}.editor-comment[data-v-2f8c74d2]{flex:1}.editor-badges[data-v-2f8c74d2]{display:flex;gap:6px;flex-wrap:wrap;justify-content:flex-end}.editor-badge[data-v-2f8c74d2]{font-size:10px;border:1px solid #334155;border-radius:999px;padding:2px 8px;color:#94a3b8;background:rgba(15,23,42,0.72);white-space:nowrap}.editor-badge.mono[data-v-2f8c74d2]{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,\'Liberation Mono\',\'Courier New\',monospace}.editor-badge.on[data-v-2f8c74d2]{border-color:rgba(34,197,94,0.65);color:#86efac}.editor-badge.off[data-v-2f8c74d2]{border-color:rgba(107,114,128,0.75);color:#cbd5e1}.editor-badge.strategy[data-status=\'constant\'][data-v-2f8c74d2]{border-color:rgba(59,130,246,0.65);color:#93c5fd}.editor-badge.strategy[data-status=\'vector\'][data-v-2f8c74d2]{border-color:rgba(168,85,247,0.65);color:#d8b4fe}.editor-badge.strategy[data-status=\'normal\'][data-v-2f8c74d2]{border-color:rgba(34,197,94,0.65);color:#86efac}.editor-badge.strategy[data-status=\'disabled\'][data-v-2f8c74d2]{border-color:rgba(107,114,128,0.75);color:#cbd5e1}.editor-keyword-grid .text-area.compact[data-v-2f8c74d2]{min-height:36px;height:36px;line-height:1.35}.editor-content-block[data-v-2f8c74d2]{min-height:0;display:flex;flex-direction:column;gap:6px;flex:1}.editor-content-title[data-v-2f8c74d2]{font-size:12px;color:#93c5fd;letter-spacing:0.01em}.editor-content-area[data-v-2f8c74d2]{min-height:320px;flex:1;resize:none;line-height:1.5}.editor-advanced[data-v-2f8c74d2]{border:1px solid #334155;border-radius:8px;padding:7px;background:rgba(15,23,42,0.4)}.editor-advanced>summary[data-v-2f8c74d2]{cursor:pointer;font-size:12px;color:#cbd5e1}.editor-advanced[open]>summary[data-v-2f8c74d2]{margin-bottom:7px}.editor-side[data-v-2f8c74d2]{display:flex;flex-direction:column;gap:8px;min-height:0;overflow:auto}.editor-card[data-v-2f8c74d2]{border:1px solid #334155;border-radius:10px;padding:8px;background:rgba(15,23,42,0.7);display:grid;gap:7px}.editor-card h4[data-v-2f8c74d2]{margin:0;font-size:12px;color:#f59e0b}.strategy-switch[data-v-2f8c74d2]{display:grid;gap:6px}.strategy-pill[data-v-2f8c74d2]{border:1px solid #334155;border-radius:8px;background:rgba(15,23,42,0.7);color:#cbd5e1;padding:6px 8px;font-size:12px;cursor:pointer;text-align:left}.strategy-pill[data-v-2f8c74d2]:hover{border-color:#475569}.strategy-pill.active.constant[data-v-2f8c74d2]{border-color:rgba(59,130,246,0.8);background:rgba(59,130,246,0.16);color:#93c5fd}.strategy-pill.active.vector[data-v-2f8c74d2]{border-color:rgba(168,85,247,0.8);background:rgba(168,85,247,0.16);color:#d8b4fe}.strategy-pill.active.selective[data-v-2f8c74d2]{border-color:rgba(34,197,94,0.8);background:rgba(34,197,94,0.16);color:#86efac}.editor-grid[data-v-2f8c74d2]{display:grid;gap:8px}.editor-grid.two-cols[data-v-2f8c74d2]{grid-template-columns:1fr 1fr}.editor-grid.three-cols[data-v-2f8c74d2]{grid-template-columns:repeat(3,minmax(0,1fr))}.field[data-v-2f8c74d2]{display:flex;flex-direction:column;gap:4px}.field>span[data-v-2f8c74d2]{color:#93c5fd}.field.disabled[data-v-2f8c74d2]{opacity:0.56}.field-end[data-v-2f8c74d2]{align-self:end}.field-actions[data-v-2f8c74d2]{display:flex;gap:6px;flex-wrap:wrap}.text-input[data-v-2f8c74d2],.text-area[data-v-2f8c74d2],.toolbar-select[data-v-2f8c74d2]{width:100%;box-sizing:border-box;border:1px solid #334155;border-radius:7px;padding:6px 8px;color:#f8fafc;background:#0f172a}.text-area[data-v-2f8c74d2]{min-height:96px;resize:vertical}.text-area.compact[data-v-2f8c74d2]{min-height:84px}.text-area.large[data-v-2f8c74d2]{min-height:190px}.checkbox-inline[data-v-2f8c74d2]{display:inline-flex;align-items:center;gap:6px}.wb-tools-grid[data-v-2f8c74d2]{display:grid;gap:8px;grid-template-columns:repeat(2,minmax(0,1fr))}.tool-card[data-v-2f8c74d2]{border:1px solid #334155;border-radius:10px;padding:8px;display:flex;flex-direction:column;gap:8px;min-height:170px;background:rgba(15,23,42,0.45)}.tool-card h4[data-v-2f8c74d2]{margin:0;font-size:13px;color:#93c5fd}.tool-line.stacked[data-v-2f8c74d2]{display:grid;gap:6px}.find-flags[data-v-2f8c74d2]{display:flex;flex-wrap:wrap;gap:8px}.batch-exclude-note[data-v-2f8c74d2]{color:#94a3b8;font-size:11px}.batch-exclude-chips[data-v-2f8c74d2]{display:flex;gap:6px;flex-wrap:wrap}.exclude-chip[data-v-2f8c74d2]{border:1px solid #475569;border-radius:999px;padding:1px 8px;font-size:11px;color:#cbd5e1;background:rgba(15,23,42,0.6)}.tool-details[data-v-2f8c74d2]{border:1px solid #334155;border-radius:8px;padding:6px;background:rgba(15,23,42,0.35)}.tool-details>summary[data-v-2f8c74d2]{cursor:pointer;color:#cbd5e1;font-size:12px}.tool-details[open]>summary[data-v-2f8c74d2]{margin-bottom:6px}.history-compare[data-v-2f8c74d2]{display:grid;gap:6px}.history-preview-grid[data-v-2f8c74d2]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:6px}.history-preview-card[data-v-2f8c74d2]{border:1px solid #334155;border-radius:8px;padding:6px;display:grid;gap:3px;background:rgba(2,6,23,0.48)}.history-preview-card strong[data-v-2f8c74d2]{color:#93c5fd;font-size:11px}.history-preview-card span[data-v-2f8c74d2]{color:#94a3b8;font-size:11px;line-height:1.35}.history-note[data-v-2f8c74d2]{border:1px dashed #334155;border-radius:8px;padding:6px;color:#94a3b8;font-size:11px;background:rgba(15,23,42,0.32)}.tool-scroll[data-v-2f8c74d2]{overflow:auto;display:flex;flex-direction:column;gap:6px}.tool-list-item[data-v-2f8c74d2]{border:1px solid #334155;border-radius:8px;padding:6px;display:flex;justify-content:space-between;gap:8px;align-items:center}.item-main[data-v-2f8c74d2]{display:flex;flex-direction:column;gap:2px;min-width:0}.item-main strong[data-v-2f8c74d2],.activation-main strong[data-v-2f8c74d2]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.item-main span[data-v-2f8c74d2]{color:#94a3b8;font-size:12px}.item-actions[data-v-2f8c74d2]{display:flex;gap:6px}.activation-item[data-v-2f8c74d2]{border:1px solid #334155;border-radius:8px;padding:6px;display:grid;gap:3px}.activation-main[data-v-2f8c74d2],.activation-sub[data-v-2f8c74d2]{display:flex;justify-content:space-between;gap:6px}.activation-main span[data-v-2f8c74d2],.activation-sub[data-v-2f8c74d2]{color:#94a3b8;font-size:12px}.activation-sub span[data-v-2f8c74d2]:last-child{flex:1;text-align:right;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.wb-floating-window[data-v-2f8c74d2]{position:fixed;max-width:calc(100vw - 16px);max-height:min(74vh,760px);border:1px solid #334155;border-radius:10px;background:linear-gradient(155deg,rgba(2,6,23,0.95),rgba(15,23,42,0.95));box-shadow:0 14px 36px rgba(2,6,23,0.7);display:flex;flex-direction:column;overflow:hidden}.wb-floating-header[data-v-2f8c74d2]{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:8px 10px;border-bottom:1px solid #334155;background:rgba(15,23,42,0.9);cursor:move;-webkit-user-select:none;user-select:none;touch-action:none}.wb-floating-header strong[data-v-2f8c74d2]{font-size:12px;color:#cbd5e1}.wb-floating-header-actions[data-v-2f8c74d2]{display:flex;gap:6px;flex-wrap:wrap}.wb-floating-body[data-v-2f8c74d2]{min-height:0;padding:8px;display:grid;gap:8px;overflow:auto}.find-window .wb-floating-body[data-v-2f8c74d2]{gap:10px}.clipboard-window .tool-scroll[data-v-2f8c74d2],.activation-window .tool-scroll[data-v-2f8c74d2]{max-height:min(58vh,520px)}.wb-status[data-v-2f8c74d2]{border:1px solid #334155;border-radius:10px;background:rgba(15,23,42,0.52);padding:8px;display:flex;justify-content:space-between;gap:8px;color:#cbd5e1;flex-wrap:wrap}.btn[data-v-2f8c74d2]{border:1px solid #475569;background:#1e293b;color:#f8fafc;border-radius:7px;padding:5px 10px;cursor:pointer}.btn[data-v-2f8c74d2]:hover:not(:disabled){border-color:#38bdf8}.btn[data-v-2f8c74d2]:disabled{opacity:0.5;cursor:default}.btn.primary[data-v-2f8c74d2]{background:#0c4a6e;border-color:#0284c7}.btn.danger[data-v-2f8c74d2]{background:#4c0519;border-color:#e11d48}.btn.mini[data-v-2f8c74d2]{padding:4px 8px;font-size:12px}.empty-note[data-v-2f8c74d2],.empty-block[data-v-2f8c74d2]{color:#94a3b8;font-size:12px}.empty-block[data-v-2f8c74d2]{padding:14px;border:1px dashed #475569;border-radius:8px}.hidden-input[data-v-2f8c74d2]{display:none}.wb-modal-backdrop[data-v-2f8c74d2]{position:fixed;inset:0;background:rgba(2,6,23,0.72);display:flex;align-items:center;justify-content:center;z-index:10020;padding:14px}.wb-history-modal[data-v-2f8c74d2]{width:min(1260px,100%);height:min(88vh,940px);border:1px solid #334155;border-radius:12px;background:linear-gradient(155deg,#0b1325,#020617);box-shadow:0 20px 48px rgba(0,0,0,0.55);display:flex;flex-direction:column;overflow:hidden}.wb-history-modal-header[data-v-2f8c74d2]{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:10px 12px;border-bottom:1px solid #334155;background:rgba(15,23,42,0.85)}.wb-history-modal-header strong[data-v-2f8c74d2]{display:block;font-size:14px}.wb-history-modal-header span[data-v-2f8c74d2]{color:#94a3b8;font-size:11px}.wb-history-modal-actions[data-v-2f8c74d2]{display:flex;gap:6px;flex-wrap:wrap}.wb-history-modal-main[data-v-2f8c74d2]{min-height:0;flex:1;display:grid;grid-template-columns:300px 1fr;overflow:hidden}.wb-history-versions[data-v-2f8c74d2]{border-right:1px solid #334155;background:rgba(15,23,42,0.8);display:flex;flex-direction:column;min-height:0}.wb-history-versions-title[data-v-2f8c74d2]{padding:8px 10px;font-size:11px;color:#94a3b8;border-bottom:1px solid #334155}.wb-history-versions-scroll[data-v-2f8c74d2]{flex:1;min-height:0;overflow:auto;padding:8px;display:flex;flex-direction:column;gap:7px}.wb-history-version-item[data-v-2f8c74d2]{border:1px solid #334155;border-radius:8px;padding:6px;display:grid;gap:4px;background:rgba(15,23,42,0.56)}.wb-history-version-line[data-v-2f8c74d2]{display:flex;justify-content:space-between;gap:6px;align-items:center}.wb-history-version-line strong[data-v-2f8c74d2]{font-size:11px;color:#cbd5e1}.wb-history-version-item span[data-v-2f8c74d2]{font-size:11px;color:#94a3b8;word-break:break-all}.wb-history-lr[data-v-2f8c74d2]{display:inline-flex;gap:4px}.mini-lr[data-v-2f8c74d2]{border:1px solid #475569;background:#0f172a;color:#94a3b8;border-radius:6px;min-width:24px;font-size:10px;cursor:pointer}.mini-lr.active[data-v-2f8c74d2]{border-color:#22d3ee;color:#67e8f9}.wb-history-diff-wrap[data-v-2f8c74d2]{min-height:0;display:flex;flex-direction:column}.wb-history-diff-head[data-v-2f8c74d2]{border-bottom:1px solid #334155;background:rgba(15,23,42,0.58);padding:8px 10px;display:flex;justify-content:space-between;gap:8px;align-items:center;font-size:11px;color:#94a3b8}.wb-history-diff-grid[data-v-2f8c74d2]{min-height:0;flex:1;display:grid;grid-template-columns:1fr 1fr}.wb-history-diff-grid>div[data-v-2f8c74d2]{min-height:0;display:flex;flex-direction:column}.wb-history-diff-grid>div+div[data-v-2f8c74d2]{border-left:1px solid #334155}.wb-history-diff-title[data-v-2f8c74d2]{padding:8px 10px;border-bottom:1px solid #334155;font-size:11px;color:#93c5fd}.wb-history-diff-body[data-v-2f8c74d2]{min-height:0;flex:1;overflow:auto;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,\'Liberation Mono\',\'Courier New\',monospace;font-size:11px;background:rgba(2,6,23,0.9)}.diff-row[data-v-2f8c74d2]{display:grid;grid-template-columns:54px 1fr;align-items:start;border-bottom:1px solid rgba(51,65,85,0.25)}.line-no[data-v-2f8c74d2]{color:#64748b;padding:2px 8px;border-right:1px solid rgba(51,65,85,0.35);-webkit-user-select:none;user-select:none}.line-text[data-v-2f8c74d2]{white-space:pre-wrap;word-break:break-word;padding:2px 8px;color:#cbd5e1}.diff-row.add[data-v-2f8c74d2]{background:rgba(34,197,94,0.18)}.diff-row.del[data-v-2f8c74d2]{background:rgba(239,68,68,0.18)}.diff-row.empty[data-v-2f8c74d2]{background:rgba(100,116,139,0.08)}@media (max-width:1380px){.wb-editor-shell[data-v-2f8c74d2]{grid-template-columns:1fr}.editor-side[data-v-2f8c74d2]{overflow:visible;max-height:none}.wb-history-modal-main[data-v-2f8c74d2]{grid-template-columns:1fr}.wb-history-versions[data-v-2f8c74d2]{border-right:none;border-bottom:1px solid #334155;max-height:240px}}@media (max-width:1100px){.global-mode-grid[data-v-2f8c74d2]{grid-template-columns:1fr}.wb-resize-handle[data-v-2f8c74d2]{display:none}.wb-main-layout[data-v-2f8c74d2]{grid-template-columns:1fr}.wb-tools-grid[data-v-2f8c74d2]{grid-template-columns:1fr}.editor-grid.two-cols[data-v-2f8c74d2],.editor-grid.three-cols[data-v-2f8c74d2]{grid-template-columns:1fr}.editor-head[data-v-2f8c74d2]{flex-direction:column;align-items:stretch}.editor-badges[data-v-2f8c74d2]{justify-content:flex-start}.history-preview-grid[data-v-2f8c74d2]{grid-template-columns:1fr}.wb-history-diff-grid[data-v-2f8c74d2]{grid-template-columns:1fr}.wb-history-diff-grid>div+div[data-v-2f8c74d2]{border-left:none;border-top:1px solid #334155}.wb-status[data-v-2f8c74d2]{flex-direction:column}.wb-floating-window[data-v-2f8c74d2]{width:calc(100vw - 16px) !important;left:8px !important;right:8px}}\n','',{version:3,sources:['webpack://./src/worldbook_assistant_build/App.vue'],names:[],mappings:'AA60GA,oCACE,WAAY,CACZ,UAAW,CACX,qBAAsB,CACtB,YAAa,CACb,qBAAsB,CACtB,YAAa,CACb,QAAS,CACT,sEAA0E,CAC1E,aAAc,CACd,cAAe,CACf,gBAAiB,CACjB,kBACF,CAEA,sCACE,UACF,CAEA,4BACE,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,wBAAyB,CACzB,kBAAmB,CACnB,gBAAiB,CACjB,6BACF,CAEA,2BACE,YAAa,CACb,qBAAsB,CACtB,OACF,CAEA,kCACE,cACF,CAEA,gCACE,aACF,CAEA,+FAGE,YAAa,CACb,OAAQ,CACR,cACF,CAEA,6BACE,YAAa,CACb,OAAQ,CACR,cAAe,CACf,kBAAmB,CACnB,wBAAyB,CACzB,kBAAmB,CACnB,WAAY,CACZ,8BACF,CAEA,gCACE,mBAAoB,CACpB,kBAAmB,CACnB,OAAQ,CACR,aACF,CAEA,iCACE,eACF,CAEA,uCACE,eACF,CAEA,8BACE,wBAAyB,CACzB,kBAAmB,CACnB,WAAY,CACZ,YAAa,CACb,OAAQ,CACR,6BACF,CAEA,uCACE,YAAa,CACb,0BAA2B,CAC3B,OAAQ,CACR,cAAe,CACf,kBACF,CAEA,oCACE,wBAAyB,CACzB,iBAAkB,CAClB,8BAAkC,CAClC,WAAY,CACZ,YAAa,CACb,OACF,CAEA,mCACE,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,OACF,CAEA,oCACE,aAAc,CACd,eAAgB,CAChB,qBACF,CAEA,mCACE,YAAa,CACb,6CAAgD,CAChD,OACF,CAEA,qCACE,wBAAyB,CACzB,iBAAkB,CAClB,WAAY,CACZ,4BAAgC,CAChC,YAAa,CACb,OAAQ,CACR,gBACF,CAEA,mCACE,wBAAyB,CACzB,iBAAkB,CAClB,6BAAiC,CACjC,gBAAiB,CACjB,eAAgB,CAChB,aAAc,CACd,YAAa,CACb,qBACF,CAEA,mCACE,UAAW,CACX,WAAY,CACZ,0CAA8C,CAC9C,sBAAuB,CACvB,aAAc,CACd,eAAgB,CAChB,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,QAAS,CACT,cAAe,CACf,eACF,CAEA,8CACE,kBACF,CAEA,yCACE,gCACF,CAEA,gEACE,aACF,CAEA,mEACE,aACF,CAEA,wCACE,eAAgB,CAChB,sBAAuB,CACvB,kBACF,CAEA,0CACE,cAAe,CACf,aACF,CAEA,sCACE,YAAa,CACb,OAAQ,CACR,cACF,CAEA,8BACE,oBAAqB,CACrB,+BACF,CAEA,8BACE,oBAAqB,CACrB,8BACF,CAEA,qCACE,oBAAqB,CACrB,gCAAoC,CACpC,aACF,CAEA,iCACE,gBAAiB,CACjB,eAAgB,CAChB,YAAa,CACb,8CAAgD,CAChD,KACF,CAEA,4DAEE,wBAAyB,CACzB,kBAAmB,CACnB,WAAY,CACZ,YAAa,CACb,qBAAsB,CACtB,OAAQ,CACR,8BAAkC,CAClC,YACF,CAEA,8BACE,YAAa,CACb,OACF,CAEA,+BACE,aAAc,CACd,cACF,CAEA,8BACE,aAAc,CACd,gBAAiB,CACjB,6BAA8B,CAC9B,aAAc,CACd,YAAa,CACb,qBAAsB,CACtB,OACF,CAEA,6BACE,UAAW,CACX,eAAgB,CAChB,wBAAyB,CACzB,uEAAgF,CAChF,aAAc,CACd,iBAAkB,CAClB,wBAAyB,CACzB,cAAe,CACf,YAAa,CACb,OAAQ,CACR,iBAAkB,CAClB,6EACF,CAEA,qCACE,UAAW,CACX,iBAAkB,CAClB,MAAO,CACP,KAAM,CACN,QAAS,CACT,SAAU,CACV,yBAA0B,CAC1B,oEACF,CAEA,6DACE,gEACF,CAEA,2DACE,gEACF,CAEA,2DACE,+DACF,CAEA,6DACE,iEACF,CAEA,mCACE,oBAAqB,CACrB,0BACF,CAEA,sCACE,oBAAqB,CACrB,+EACF,CAEA,sCACE,YACF,CAEA,kCACE,YAAa,CACb,kBAAmB,CACnB,OAAQ,CACR,WACF,CAEA,mCACE,SAAU,CACV,UAAW,CACX,mBAAoB,CACpB,kBAAmB,CACnB,aAAc,CACd,wCACF,CAEA,2DACE,kBACF,CAEA,yDACE,kBACF,CAEA,yDACE,kBACF,CAEA,2DACE,kBACF,CAEA,mCACE,eAAgB,CAChB,MAAO,CACP,WAAY,CACZ,kBAAmB,CACnB,eAAgB,CAChB,sBACF,CAEA,kCACE,YAAa,CACb,OAAQ,CACR,cACF,CAEA,6BACE,mBAAoB,CACpB,kBAAmB,CACnB,OAAQ,CACR,wBAAyB,CACzB,mBAAoB,CACpB,eAAgB,CAChB,aAAc,CACd,cAAe,CACf,8BACF,CAEA,iCACE,aAAc,CACd,cAAe,CACf,eACF,CAEA,kCACE,uGAA+G,CAC/G,cACF,CAEA,4DACE,kCAAsC,CACtC,aAAc,CACd,gCACF,CAEA,0DACE,kCAAsC,CACtC,aAAc,CACd,gCACF,CAEA,0DACE,iCAAqC,CACrC,aAAc,CACd,+BACF,CAEA,4DACE,kCAAsC,CACtC,aAAc,CACd,iCACF,CAEA,qCACE,aAAc,CACd,cAAe,CACf,kBAAmB,CACnB,eAAgB,CAChB,sBAAuB,CACvB,iBAAkB,CAClB,YACF,CAEA,6CACE,gBAAiB,CACjB,aAAc,CACd,gBACF,CAEA,4BACE,eAAgB,CAChB,eACF,CAEA,kCACE,WAAY,CACZ,YAAa,CACb,YAAa,CACb,8CAAgD,CAChD,KACF,CAEA,mCACE,iBAAkB,CAClB,UAAW,CACX,iBAAkB,CAClB,wBAAiB,CAAjB,gBAAiB,CACjB,iBACF,CAEA,2CACE,UAAW,CACX,iBAAkB,CAClB,QAAS,CACT,QAAS,CACT,WAAY,CACZ,SAAU,CACV,mBAAoB,CACpB,gCAAoC,CACpC,sCACF,CAEA,qGAEE,gCACF,CAEA,gCACE,wBAAyB,CACzB,kBAAmB,CACnB,2BAA+B,CAC/B,YAAa,CACb,YAAa,CACb,qBAAsB,CACtB,QAAS,CACT,YAAa,CACb,aACF,CAEA,8BACE,YAAa,CACb,6BAA8B,CAC9B,QAAS,CACT,oBAAqB,CACrB,+BAAgC,CAChC,kBACF,CAEA,iCACE,MACF,CAEA,gCACE,YAAa,CACb,OAAQ,CACR,cAAe,CACf,wBACF,CAEA,+BACE,cAAe,CACf,wBAAyB,CACzB,mBAAoB,CACpB,eAAgB,CAChB,aAAc,CACd,8BAAkC,CAClC,kBACF,CAEA,oCACE,uGACF,CAEA,kCACE,iCAAqC,CACrC,aACF,CAEA,mCACE,mCAAuC,CACvC,aACF,CAEA,gEACE,kCAAsC,CACtC,aACF,CAEA,8DACE,kCAAsC,CACtC,aACF,CAEA,8DACE,iCAAqC,CACrC,aACF,CAEA,gEACE,mCAAuC,CACvC,aACF,CAEA,yDACE,eAAgB,CAChB,WAAY,CACZ,gBACF,CAEA,uCACE,YAAa,CACb,YAAa,CACb,qBAAsB,CACtB,OAAQ,CACR,MACF,CAEA,uCACE,cAAe,CACf,aAAc,CACd,qBACF,CAEA,sCACE,gBAAiB,CACjB,MAAO,CACP,WAAY,CACZ,eACF,CAEA,kCACE,wBAAyB,CACzB,iBAAkB,CAClB,WAAY,CACZ,6BACF,CAEA,0CACE,cAAe,CACf,cAAe,CACf,aACF,CAEA,gDACE,iBACF,CAEA,8BACE,YAAa,CACb,qBAAsB,CACtB,OAAQ,CACR,YAAa,CACb,aACF,CAEA,8BACE,wBAAyB,CACzB,kBAAmB,CACnB,WAAY,CACZ,6BAAiC,CACjC,YAAa,CACb,OACF,CAEA,iCACE,QAAS,CACT,cAAe,CACf,aACF,CAEA,kCACE,YAAa,CACb,OACF,CAEA,gCACE,wBAAyB,CACzB,iBAAkB,CAClB,6BAAiC,CACjC,aAAc,CACd,eAAgB,CAChB,cAAe,CACf,cAAe,CACf,eACF,CAEA,sCACE,oBACF,CAEA,gDACE,iCAAqC,CACrC,gCAAoC,CACpC,aACF,CAEA,8CACE,iCAAqC,CACrC,gCAAoC,CACpC,aACF,CAEA,iDACE,gCAAoC,CACpC,+BAAmC,CACnC,aACF,CAEA,8BACE,YAAa,CACb,OACF,CAEA,uCACE,6BACF,CAEA,yCACE,6CACF,CAEA,wBACE,YAAa,CACb,qBAAsB,CACtB,OACF,CAEA,6BACE,aACF,CAEA,iCACE,YACF,CAEA,4BACE,cACF,CAEA,gCACE,YAAa,CACb,OAAQ,CACR,cACF,CAEA,0FAGE,UAAW,CACX,qBAAsB,CACtB,wBAAyB,CACzB,iBAAkB,CAClB,eAAgB,CAChB,aAAc,CACd,kBACF,CAEA,4BACE,eAAgB,CAChB,eACF,CAEA,oCACE,eACF,CAEA,kCACE,gBACF,CAEA,kCACE,mBAAoB,CACpB,kBAAmB,CACnB,OACF,CAEA,gCACE,YAAa,CACb,OAAQ,CACR,6CACF,CAEA,4BACE,wBAAyB,CACzB,kBAAmB,CACnB,WAAY,CACZ,YAAa,CACb,qBAAsB,CACtB,OAAQ,CACR,gBAAiB,CACjB,8BACF,CAEA,+BACE,QAAS,CACT,cAAe,CACf,aACF,CAEA,oCACE,YAAa,CACb,OACF,CAEA,6BACE,YAAa,CACb,cAAe,CACf,OACF,CAEA,qCACE,aAAc,CACd,cACF,CAEA,sCACE,YAAa,CACb,OAAQ,CACR,cACF,CAEA,+BACE,wBAAyB,CACzB,mBAAoB,CACpB,eAAgB,CAChB,cAAe,CACf,aAAc,CACd,6BACF,CAEA,+BACE,wBAAyB,CACzB,iBAAkB,CAClB,WAAY,CACZ,8BACF,CAEA,uCACE,cAAe,CACf,aAAc,CACd,cACF,CAEA,6CACE,iBACF,CAEA,kCACE,YAAa,CACb,OACF,CAEA,uCACE,YAAa,CACb,6CAAgD,CAChD,OACF,CAEA,uCACE,wBAAyB,CACzB,iBAAkB,CAClB,WAAY,CACZ,YAAa,CACb,OAAQ,CACR,4BACF,CAEA,8CACE,aAAc,CACd,cACF,CAEA,4CACE,aAAc,CACd,cAAe,CACf,gBACF,CAEA,+BACE,yBAA0B,CAC1B,iBAAkB,CAClB,WAAY,CACZ,aAAc,CACd,cAAe,CACf,8BACF,CAEA,8BACE,aAAc,CACd,YAAa,CACb,qBAAsB,CACtB,OACF,CAEA,iCACE,wBAAyB,CACzB,iBAAkB,CAClB,WAAY,CACZ,YAAa,CACb,6BAA8B,CAC9B,OAAQ,CACR,kBACF,CAEA,4BACE,YAAa,CACb,qBAAsB,CACtB,OAAQ,CACR,WACF,CAEA,4EAEE,kBAAmB,CACnB,eAAgB,CAChB,sBACF,CAEA,iCACE,aAAc,CACd,cACF,CAEA,+BACE,YAAa,CACb,OACF,CAEA,kCACE,wBAAyB,CACzB,iBAAkB,CAClB,WAAY,CACZ,YAAa,CACb,OACF,CAEA,mEAEE,YAAa,CACb,6BAA8B,CAC9B,OACF,CAEA,wEAEE,aAAc,CACd,cACF,CAEA,iDACE,MAAO,CACP,gBAAiB,CACjB,kBAAmB,CACnB,eAAgB,CAChB,sBACF,CAEA,qCACE,cAAe,CACf,4BAA6B,CAC7B,0BAA4B,CAC5B,wBAAyB,CACzB,kBAAmB,CACnB,wEAAiF,CACjF,uCAA2C,CAC3C,YAAa,CACb,qBAAsB,CACtB,eACF,CAEA,qCACE,YAAa,CACb,6BAA8B,CAC9B,OAAQ,CACR,kBAAmB,CACnB,gBAAiB,CACjB,+BAAgC,CAChC,6BAAiC,CACjC,WAAY,CACZ,wBAAiB,CAAjB,gBAAiB,CACjB,iBACF,CAEA,4CACE,cAAe,CACf,aACF,CAEA,6CACE,YAAa,CACb,OAAQ,CACR,cACF,CAEA,mCACE,YAAa,CACb,WAAY,CACZ,YAAa,CACb,OAAQ,CACR,aACF,CAEA,gDACE,QACF,CAEA,iGAEE,0BACF,CAEA,4BACE,wBAAyB,CACzB,kBAAmB,CACnB,8BAAkC,CAClC,WAAY,CACZ,YAAa,CACb,6BAA8B,CAC9B,OAAQ,CACR,aAAc,CACd,cACF,CAEA,sBACE,wBAAyB,CACzB,kBAAmB,CACnB,aAAc,CACd,iBAAkB,CAClB,gBAAiB,CACjB,cACF,CAEA,2CACE,oBACF,CAEA,+BACE,WAAY,CACZ,cACF,CAEA,8BACE,kBAAmB,CACnB,oBACF,CAEA,6BACE,kBAAmB,CACnB,oBACF,CAEA,2BACE,eAAgB,CAChB,cACF,CAEA,2DAEE,aAAc,CACd,cACF,CAEA,8BACE,YAAa,CACb,yBAA0B,CAC1B,iBACF,CAEA,+BACE,YACF,CAEA,oCACE,cAAe,CACf,OAAQ,CACR,4BAAgC,CAChC,YAAa,CACb,kBAAmB,CACnB,sBAAuB,CACvB,aAAc,CACd,YACF,CAEA,mCACE,sBAAwB,CACxB,sBAAwB,CACxB,wBAAyB,CACzB,kBAAmB,CACnB,kDAAqD,CACrD,uCAA2C,CAC3C,YAAa,CACb,qBAAsB,CACtB,eACF,CAEA,0CACE,YAAa,CACb,6BAA8B,CAC9B,OAAQ,CACR,kBAAmB,CACnB,iBAAkB,CAClB,+BAAgC,CAChC,8BACF,CAEA,iDACE,aAAc,CACd,cACF,CAEA,+CACE,aAAc,CACd,cACF,CAEA,2CACE,YAAa,CACb,OAAQ,CACR,cACF,CAEA,wCACE,YAAa,CACb,MAAO,CACP,YAAa,CACb,+BAAgC,CAChC,eACF,CAEA,sCACE,8BAA+B,CAC/B,6BAAiC,CACjC,YAAa,CACb,qBAAsB,CACtB,YACF,CAEA,4CACE,gBAAiB,CACjB,cAAe,CACf,aAAc,CACd,+BACF,CAEA,6CACE,MAAO,CACP,YAAa,CACb,aAAc,CACd,WAAY,CACZ,YAAa,CACb,qBAAsB,CACtB,OACF,CAEA,0CACE,wBAAyB,CACzB,iBAAkB,CAClB,WAAY,CACZ,YAAa,CACb,OAAQ,CACR,8BACF,CAEA,0CACE,YAAa,CACb,6BAA8B,CAC9B,OAAQ,CACR,kBACF,CAEA,iDACE,cAAe,CACf,aACF,CAEA,+CACE,cAAe,CACf,aAAc,CACd,oBACF,CAEA,gCACE,mBAAoB,CACpB,OACF,CAEA,0BACE,wBAAyB,CACzB,kBAAmB,CACnB,aAAc,CACd,iBAAkB,CAClB,cAAe,CACf,cAAe,CACf,cACF,CAEA,iCACE,oBAAqB,CACrB,aACF,CAEA,uCACE,YAAa,CACb,YAAa,CACb,qBACF,CAEA,uCACE,+BAAgC,CAChC,8BAAkC,CAClC,gBAAiB,CACjB,YAAa,CACb,6BAA8B,CAC9B,OAAQ,CACR,kBAAmB,CACnB,cAAe,CACf,aACF,CAEA,uCACE,YAAa,CACb,MAAO,CACP,YAAa,CACb,6BACF,CAEA,2CACE,YAAa,CACb,YAAa,CACb,qBACF,CAEA,+CACE,6BACF,CAEA,wCACE,gBAAiB,CACjB,+BAAgC,CAChC,cAAe,CACf,aACF,CAEA,uCACE,YAAa,CACb,MAAO,CACP,aAAc,CACd,uGAA+G,CAC/G,cAAe,CACf,2BACF,CAEA,2BACE,YAAa,CACb,8BAA+B,CAC/B,iBAAkB,CAClB,2CACF,CAEA,0BACE,aAAc,CACd,eAAgB,CAChB,0CAA8C,CAC9C,wBAAiB,CAAjB,gBACF,CAEA,4BACE,oBAAqB,CACrB,qBAAsB,CACtB,eAAgB,CAChB,aACF,CAEA,+BACE,+BACF,CAEA,+BACE,+BACF,CAEA,iCACE,iCACF,CAEA,0BACE,kCACE,yBACF,CAEA,8BACE,gBAAiB,CACjB,eACF,CAEA,wCACE,yBACF,CAEA,sCACE,iBAAkB,CAClB,+BAAgC,CAChC,gBACF,CACF,CAEA,0BACE,mCACE,yBACF,CAEA,mCACE,YACF,CAEA,iCACE,yBACF,CAEA,gCACE,yBACF,CAEA,gFAEE,yBACF,CAEA,8BACE,qBAAsB,CACtB,mBACF,CAEA,gCACE,0BACF,CAEA,uCACE,yBACF,CAEA,uCACE,yBACF,CAEA,+CACE,gBAAiB,CACjB,4BACF,CAEA,4BACE,qBACF,CAEA,qCACE,mCAAoC,CACpC,mBAAoB,CACpB,SACF,CACF',sourcesContent:['<template>\n  <div class="wb-assistant-root">\n          <section class="wb-toolbar">\n            <label class="toolbar-label">\n              ‰∏ñÁïå‰π¶\n              <select v-model="selectedWorldbookName" class="toolbar-select">\n                <option v-for="name in selectableWorldbookNames" :key="name" :value="name">\n                  {{ name }}\n                </option>\n              </select>\n            </label>\n            <button class="btn" type="button" @click="createNewWorldbook">Êñ∞Âª∫</button>\n            <button class="btn" type="button" :disabled="!selectedWorldbookName" @click="duplicateWorldbook">\n              Âè¶Â≠ò‰∏∫\n            </button>\n            <button class="btn danger" type="button" :disabled="!selectedWorldbookName" @click="deleteCurrentWorldbook">\n              Âà†Èô§\n            </button>\n            <button class="btn" type="button" :disabled="!selectedWorldbookName" @click="exportCurrentWorldbook">\n              ÂØºÂá∫\n            </button>\n            <button class="btn" type="button" @click="triggerImport">ÂØºÂÖ•</button>\n            <input\n              ref="importFileInput"\n              class="hidden-input"\n              type="file"\n              accept=".json,application/json"\n              @change="onImportChange"\n            />\n          </section>\n\n          <section class="wb-bindings">\n            <div class="wb-history-shortcuts">\n              <button\n                class="btn history-btn utility-btn"\n                type="button"\n                :class="{ active: globalWorldbookMode }"\n                @click="toggleGlobalMode"\n              >\n                üåê ÂÖ®Â±ÄÊ®°Âºè\n              </button>\n              <button class="btn history-btn" type="button" :disabled="!selectedEntry" @click="openEntryHistoryModal">\n                üï∞Ô∏è Êù°ÁõÆÊó∂ÂÖâÊú∫\n              </button>\n              <button\n                class="btn history-btn"\n                type="button"\n                :disabled="!selectedWorldbookName"\n                @click="openWorldbookHistoryModal"\n              >\n                ‚è™ Êï¥Êú¨Êó∂ÂÖâÊú∫\n              </button>\n              <button\n                class="btn history-btn utility-btn"\n                type="button"\n                :class="{ active: floatingPanels.find.visible }"\n                :disabled="!draftEntries.length"\n                @click="toggleFloatingPanel(\'find\')"\n              >\n                üîé Êü•Êâæ‰∏éÊõøÊç¢\n              </button>\n              <button\n                class="btn history-btn utility-btn"\n                type="button"\n                :class="{ active: floatingPanels.clipboard.visible }"\n                @click="toggleFloatingPanel(\'clipboard\')"\n              >\n                üìã Ââ™Ë¥¥Êùø\n              </button>\n              <button\n                class="btn history-btn utility-btn"\n                type="button"\n                :class="{ active: floatingPanels.activation.visible }"\n                @click="toggleFloatingPanel(\'activation\')"\n              >\n                üì° ÊøÄÊ¥ªÁõëÊéß\n              </button>\n            </div>\n            <div v-if="globalWorldbookMode" class="global-mode-panel">\n              <div class="global-mode-head">\n                <span class="global-mode-title">ÂÖ®Â±Ä‰∏ñÁïå‰π¶Ôºà{{ bindings.global.length }}Ôºâ</span>\n                <button class="btn mini danger" type="button" :disabled="!bindings.global.length" @click="clearGlobalWorldbooks">\n                  Ê∏ÖÁ©∫ÂÖ®Â±Ä\n                </button>\n              </div>\n              <div class="global-mode-grid">\n                <div class="global-mode-column">\n                  <label class="field">\n                    <span>ÊêúÁ¥¢Âπ∂Ê∑ªÂä†Â∏∏È©ª‰∏ñÁïå‰π¶</span>\n                    <input\n                      v-model="globalAddSearchText"\n                      type="text"\n                      class="text-input"\n                      placeholder="ÊêúÁ¥¢Âπ∂Ê∑ªÂä†Â∏∏È©ª‰∏ñÁïå‰π¶..."\n                      @keydown.enter.prevent="addFirstGlobalCandidate"\n                    />\n                  </label>\n                  <div class="global-mode-list">\n                    <button\n                      v-for="name in globalAddCandidates"\n                      :key="`add-${name}`"\n                      class="global-mode-item add"\n                      type="button"\n                      @click="addGlobalWorldbook(name)"\n                    >\n                      <span class="global-mode-item-name">{{ name }}</span>\n                      <span class="global-mode-item-action">Ê∑ªÂä†</span>\n                    </button>\n                    <div v-if="!globalAddCandidates.length" class="empty-note">Ê≤°ÊúâÂèØÊ∑ªÂä†ÁöÑ‰∏ñÁïå‰π¶</div>\n                  </div>\n                </div>\n                <div class="global-mode-column">\n                  <label class="field">\n                    <span>Á≠õÈÄâÂ∏∏È©ª‰∏ñÁïå‰π¶</span>\n                    <input\n                      v-model="globalFilterText"\n                      type="text"\n                      class="text-input"\n                      placeholder="Á≠õÈÄâÂ∏∏È©ª‰∏ñÁïå‰π¶..."\n                    />\n                  </label>\n                  <div class="global-mode-list">\n                    <button\n                      v-for="name in filteredGlobalWorldbooks"\n                      :key="`global-${name}`"\n                      class="global-mode-item active"\n                      type="button"\n                      @click="removeGlobalWorldbook(name)"\n                    >\n                      <span class="global-mode-item-name">{{ name }}</span>\n                      <span class="global-mode-item-action">ÁßªÈô§</span>\n                    </button>\n                    <div v-if="!filteredGlobalWorldbooks.length" class="empty-note">\n                      {{ bindings.global.length ? \'Ê≤°ÊúâÂåπÈÖçÁªìÊûú\' : \'ÊöÇÊó†Â∏∏È©ª‰∏ñÁïå‰π¶\' }}\n                    </div>\n                  </div>\n                </div>\n              </div>\n              <div class="global-mode-actions">\n                <button class="btn" type="button" :disabled="!selectedWorldbookName" @click="toggleGlobalBinding">\n                  {{ isGlobalBound ? \'ÁßªÂá∫ÂÖ®Â±Ä\' : \'Âä†ÂÖ•ÂÖ®Â±Ä\' }}\n                </button>\n              </div>\n            </div>\n          </section>\n\n          <section ref="mainLayoutRef" class="wb-main-layout" :style="mainLayoutStyle">\n            <aside class="wb-entry-list">\n              <div class="list-search">\n                <input v-model="searchText" type="text" class="text-input" placeholder="ÊêúÁ¥¢ÂêçÁß∞ / ÂÜÖÂÆπ / ÂÖ≥ÈîÆËØç" />\n                <label class="checkbox-inline">\n                  <input v-model="onlyEnabled" type="checkbox" />\n                  <span>‰ªÖÂêØÁî®</span>\n                </label>\n              </div>\n              <div class="list-summary">\n                Êù°ÁõÆ {{ filteredEntries.length }} / {{ draftEntries.length }} | ÂêØÁî® {{ enabledEntryCount }}\n              </div>\n              <div class="list-scroll">\n                <button\n                  v-for="entry in filteredEntries"\n                  :key="entry.uid"\n                  type="button"\n                  class="entry-item"\n                  :data-status="getEntryVisualStatus(entry)"\n                  :class="{\n                    selected: entry.uid === selectedEntryUid,\n                    disabled: !entry.enabled,\n                  }"\n                  @click="selectEntry(entry.uid)"\n                >\n                  <div class="entry-item-head">\n                    <span class="entry-status-dot" :data-status="getEntryVisualStatus(entry)"></span>\n                    <div class="entry-item-title">{{ entry.name || `Êù°ÁõÆ ${entry.uid}` }}</div>\n                    <span class="entry-chip uid">#{{ entry.uid }}</span>\n                  </div>\n                  <div class="entry-item-tags">\n                    <span class="entry-chip status" :data-status="getEntryVisualStatus(entry)">\n                      {{ getEntryStatusLabel(entry) }}\n                    </span>\n                    <span class="entry-chip">üîë {{ entry.strategy.keys.length }}</span>\n                    <span class="entry-chip">üéØ {{ entry.probability }}</span>\n                    <span class="entry-chip mono">#{{ entry.position.order }}</span>\n                  </div>\n                  <div class="entry-item-preview">{{ getEntryKeyPreview(entry) }}</div>\n                </button>\n              </div>\n              <div class="list-actions">\n                <button class="btn" type="button" :disabled="!selectedWorldbookName" @click="addEntry">Êñ∞Â¢û</button>\n                <button class="btn" type="button" :disabled="!selectedEntry" @click="duplicateSelectedEntry">\n                  Â§çÂà∂\n                </button>\n                <button class="btn danger" type="button" :disabled="!selectedEntry" @click="removeSelectedEntry">\n                  Âà†Èô§\n                </button>\n                <button class="btn" type="button" :disabled="!selectedEntry" @click="moveSelectedEntry(-1)">\n                  ‰∏äÁßª\n                </button>\n                <button class="btn" type="button" :disabled="!selectedEntry" @click="moveSelectedEntry(1)">‰∏ãÁßª</button>\n              </div>\n            </aside>\n            <div\n              class="wb-resize-handle main"\n              :class="{ dragging: paneResizeState?.key === \'main\' }"\n              @pointerdown="startPaneResize(\'main\', $event)"\n            ></div>\n\n            <main class="wb-editor">\n              <template v-if="selectedEntry">\n                <div ref="editorShellRef" class="wb-editor-shell" :style="editorShellStyle">\n                  <section class="editor-center">\n                    <header class="editor-head">\n                      <label class="field editor-comment">\n                        <span>Â§áÊ≥® (COMMENT)</span>\n                        <input v-model="selectedEntry.name" type="text" class="text-input" />\n                      </label>\n                      <div class="editor-badges">\n                        <span class="editor-badge" :class="selectedEntry.enabled ? \'on\' : \'off\'">\n                          {{ selectedEntry.enabled ? \'EN\' : \'OFF\' }}\n                        </span>\n                        <span class="editor-badge strategy" :data-status="getEntryVisualStatus(selectedEntry)">\n                          {{ getEntryStatusLabel(selectedEntry) }}\n                        </span>\n                        <span class="editor-badge mono">#{{ selectedEntry.uid }}</span>\n                        <span class="editor-badge mono">Chars {{ selectedContentChars }}</span>\n                        <span class="editor-badge mono">~{{ selectedTokenEstimate }}T</span>\n                      </div>\n                    </header>\n\n                    <section class="editor-grid two-cols editor-keyword-grid">\n                      <label class="field">\n                        <span>‰∏ªË¶ÅÂÖ≥ÈîÆËØç (KEYS)</span>\n                        <textarea v-model="selectedKeysText" class="text-area compact"></textarea>\n                      </label>\n                      <label class="field">\n                        <span>Ê¨°Ë¶ÅÂÖ≥ÈîÆËØç (SECONDARY)</span>\n                        <textarea v-model="selectedSecondaryKeysText" class="text-area compact"></textarea>\n                      </label>\n                    </section>\n\n                    <section class="editor-content-block">\n                      <div class="editor-content-title">‰∏ñÁïåËßÇËÆæÂÆö / ÂÜÖÂÆπ (CONTENT)</div>\n                      <textarea v-model="selectedEntry.content" class="text-area large editor-content-area"></textarea>\n                    </section>\n\n                    <details class="editor-advanced">\n                      <summary>È´òÁ∫ßÂ≠óÊÆµ / extra JSON</summary>\n                      <label class="field">\n                        <span>extra JSONÔºàÊú™Áü•Â≠óÊÆµÔºâ</span>\n                        <textarea v-model="selectedExtraText" class="text-area compact" placeholder="{ ... }"></textarea>\n                      </label>\n                      <div class="field-actions">\n                        <button class="btn" type="button" @click="applyExtraJson">Â∫îÁî® extra</button>\n                        <button class="btn" type="button" @click="clearExtra">Ê∏ÖÁ©∫ extra</button>\n                        <button class="btn" type="button" @click="copySelectedEntryToClipboard">Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø</button>\n                      </div>\n                    </details>\n                  </section>\n                  <div\n                    class="wb-resize-handle editor"\n                    :class="{ dragging: paneResizeState?.key === \'editor\' }"\n                    @pointerdown="startPaneResize(\'editor\', $event)"\n                  ></div>\n\n                  <aside class="editor-side">\n                    <article class="editor-card">\n                      <h4>Ëß¶ÂèëÁ≠ñÁï• (STRATEGY)</h4>\n                      <label class="field checkbox-inline">\n                        <input v-model="selectedEntry.enabled" type="checkbox" />\n                        <span>ÂêØÁî®Êù°ÁõÆ</span>\n                      </label>\n                      <div class="strategy-switch">\n                        <button\n                          type="button"\n                          class="strategy-pill constant"\n                          :class="{ active: selectedEntry.strategy.type === \'constant\' }"\n                          @click="selectedEntry.strategy.type = \'constant\'"\n                        >\n                          üîµ Â∏∏È©ª (Constant)\n                        </button>\n                        <button\n                          type="button"\n                          class="strategy-pill vector"\n                          :class="{ active: selectedEntry.strategy.type === \'vectorized\' }"\n                          @click="selectedEntry.strategy.type = \'vectorized\'"\n                        >\n                          üìé ÂêëÈáèÂåñ (Vector)\n                        </button>\n                        <button\n                          type="button"\n                          class="strategy-pill selective"\n                          :class="{ active: selectedEntry.strategy.type === \'selective\' }"\n                          @click="selectedEntry.strategy.type = \'selective\'"\n                        >\n                          üü¢ ÂÖ≥ÈîÆËØç (Selective)\n                        </button>\n                      </div>\n                      <details class="editor-advanced">\n                        <summary>È´òÁ∫ßËÆæÁΩÆ</summary>\n                        <label class="field">\n                          <span>Ê¨°Ë¶ÅÈÄªËæë (LOGIC)</span>\n                          <select v-model="selectedEntry.strategy.keys_secondary.logic" class="text-input">\n                            <option v-for="item in secondaryLogicOptions" :key="item" :value="item">\n                              {{ getSecondaryLogicLabel(item) }}\n                            </option>\n                          </select>\n                        </label>\n                        <label class="field">\n                          <span>Êâ´ÊèèÊ∑±Â∫¶</span>\n                          <input\n                            v-model="selectedScanDepthText"\n                            type="text"\n                            class="text-input"\n                            placeholder="ÁïôÁ©∫Êàñ same_as_global"\n                          />\n                        </label>\n                        <label class="field">\n                          <span>Ê¶ÇÁéá(0-100)</span>\n                          <input\n                            v-model.number="selectedEntry.probability"\n                            type="number"\n                            class="text-input"\n                            min="0"\n                            max="100"\n                            step="1"\n                          />\n                        </label>\n                      </details>\n                    </article>\n\n                    <article class="editor-card">\n                      <h4>ÊèíÂÖ•ËÆæÁΩÆ (INSERTION)</h4>\n                      <label class="field">\n                        <span>‰ΩçÁΩÆ (Position)</span>\n                        <select\n                          v-model="selectedEntry.position.type"\n                          class="text-input"\n                          @change="handleSelectedPositionTypeChanged"\n                        >\n                          <option v-for="item in positionTypeOptions" :key="item" :value="item">\n                            {{ getPositionTypeLabel(item) }}\n                          </option>\n                        </select>\n                      </label>\n                      <label class="field">\n                        <span>ÊùÉÈáç (Order)</span>\n                        <input v-model.number="selectedEntry.position.order" type="number" class="text-input" step="1" />\n                      </label>\n                      <div class="editor-grid two-cols">\n                        <label class="field" :class="{ disabled: selectedEntry.position.type !== \'at_depth\' }">\n                          <span>at_depth role</span>\n                          <select\n                            v-model="selectedEntry.position.role"\n                            class="text-input"\n                            :disabled="selectedEntry.position.type !== \'at_depth\'"\n                          >\n                            <option value="system">system</option>\n                            <option value="assistant">assistant</option>\n                            <option value="user">user</option>\n                          </select>\n                        </label>\n                        <label class="field" :class="{ disabled: selectedEntry.position.type !== \'at_depth\' }">\n                          <span>at_depth depth</span>\n                          <input\n                            v-model.number="selectedEntry.position.depth"\n                            type="number"\n                            class="text-input"\n                            min="1"\n                            step="1"\n                            :disabled="selectedEntry.position.type !== \'at_depth\'"\n                          />\n                        </label>\n                      </div>\n                    </article>\n\n                    <article class="editor-card">\n                      <h4>ÈÄíÂΩí‰∏éÊïàÊûú (RECURSION)</h4>\n                      <label class="field checkbox-inline">\n                        <input v-model="selectedEntry.recursion.prevent_incoming" type="checkbox" />\n                        <span>‰∏çÂèØÈÄíÂΩíÂëΩ‰∏≠ (Exclude Incoming)</span>\n                      </label>\n                      <label class="field checkbox-inline">\n                        <input v-model="selectedEntry.recursion.prevent_outgoing" type="checkbox" />\n                        <span>ÈòªÊ≠¢ÂêéÁª≠ÈÄíÂΩí (Prevent Outgoing)</span>\n                      </label>\n                      <label class="field">\n                        <span>ÈÄíÂΩíÂª∂ËøüÂ±ÇÁ∫ß</span>\n                        <input\n                          v-model="selectedRecursionDelayText"\n                          type="text"\n                          class="text-input"\n                          placeholder="ÁïôÁ©∫Ë°®Á§∫ null"\n                        />\n                      </label>\n                      <div class="editor-grid two-cols">\n                        <label class="field">\n                          <span>sticky</span>\n                          <input\n                            v-model="selectedStickyText"\n                            type="text"\n                            class="text-input"\n                            placeholder="ÁïôÁ©∫Ë°®Á§∫ null"\n                          />\n                        </label>\n                        <label class="field">\n                          <span>cooldown</span>\n                          <input\n                            v-model="selectedCooldownText"\n                            type="text"\n                            class="text-input"\n                            placeholder="ÁïôÁ©∫Ë°®Á§∫ null"\n                          />\n                        </label>\n                      </div>\n                      <label class="field">\n                        <span>delay</span>\n                        <input\n                          v-model="selectedEffectDelayText"\n                          type="text"\n                          class="text-input"\n                          placeholder="ÁïôÁ©∫Ë°®Á§∫ null"\n                        />\n                      </label>\n                    </article>\n                  </aside>\n                </div>\n              </template>\n              <template v-else>\n                <div class="empty-block">ËØ∑ÈÄâÊã©ÊàñÊñ∞Â¢û‰∏Ä‰∏™Êù°ÁõÆÂêéÂºÄÂßãÁºñËæë„ÄÇ</div>\n              </template>\n            </main>\n          </section>\n\n          <footer class="wb-status">\n            <span>{{ isBusy ? \'Âä†ËΩΩ‰∏≠...\' : statusMessage }}</span>\n            <span>\n              ÂΩìÂâçÊù°ÁõÆ: {{ draftEntries.length }} | ÂÜÖÂÆπÂ≠óÁ¨¶: {{ totalContentChars }} |\n              {{ hasUnsavedChanges ? \'Â≠òÂú®Êú™‰øùÂ≠ò‰øÆÊîπ\' : \'Â∑≤ÂêåÊ≠•\' }}\n            </span>\n          </footer>\n\n          <div v-if="showEntryHistoryModal" class="wb-modal-backdrop" @click.self="showEntryHistoryModal = false">\n            <div class="wb-history-modal">\n              <div class="wb-history-modal-header">\n                <div>\n                  <strong>üï∞Ô∏è Êù°ÁõÆÊó∂ÂÖâÊú∫</strong>\n                  <span>{{ entryHistorySummary }}</span>\n                </div>\n                <div class="wb-history-modal-actions">\n                  <button class="btn mini" type="button" :disabled="!selectedEntry" @click="createManualEntrySnapshot">\n                    ËÆ∞ÂΩïÊù°ÁõÆ\n                  </button>\n                  <button\n                    class="btn mini danger"\n                    type="button"\n                    :disabled="!entrySnapshotsForSelected.length"\n                    @click="clearCurrentEntrySnapshots"\n                  >\n                    Ê∏ÖÁ©∫Êù°ÁõÆÂéÜÂè≤\n                  </button>\n                  <button class="btn mini" type="button" @click="showEntryHistoryModal = false">ÂÖ≥Èó≠</button>\n                </div>\n              </div>\n\n              <div class="wb-history-modal-main">\n                <aside class="wb-history-versions">\n                  <div class="wb-history-versions-title">ÁâàÊú¨ÂàóË°®ÔºàL/RÔºâ</div>\n                  <div class="wb-history-versions-scroll">\n                    <div v-for="ver in entryVersionViews" :key="ver.id" class="wb-history-version-item">\n                      <div class="wb-history-version-line">\n                        <strong>{{ formatHistoryOptionLabel(ver.label, ver.ts, ver.isCurrent) }}</strong>\n                        <div class="wb-history-lr">\n                          <button class="mini-lr" :class="{ active: entryHistoryLeftId === ver.id }" @click="entryHistoryLeftId = ver.id">L</button>\n                          <button class="mini-lr" :class="{ active: entryHistoryRightId === ver.id }" @click="entryHistoryRightId = ver.id">R</button>\n                        </div>\n                      </div>\n                      <span>{{ ver.name }}</span>\n                    </div>\n                    <div v-if="entryVersionViews.length <= 1" class="empty-note">ÊöÇÊó†ÂéÜÂè≤Êù°ÁõÆÁâàÊú¨</div>\n                  </div>\n                </aside>\n\n                <section class="wb-history-diff-wrap">\n                  <div class="wb-history-diff-head">\n                    <div>\n                      Left: {{ selectedEntryHistoryLeft ? formatHistoryOptionLabel(selectedEntryHistoryLeft.label, selectedEntryHistoryLeft.ts, selectedEntryHistoryLeft.isCurrent) : \'-\' }}\n                      |\n                      Right: {{ selectedEntryHistoryRight ? formatHistoryOptionLabel(selectedEntryHistoryRight.label, selectedEntryHistoryRight.ts, selectedEntryHistoryRight.isCurrent) : \'-\' }}\n                    </div>\n                    <button class="btn mini" type="button" :disabled="!canRestoreEntryFromLeft" @click="restoreEntryFromLeftHistory">\n                      ÊÅ¢Â§çÂà∞ Left\n                    </button>\n                  </div>\n                  <div class="wb-history-diff-grid">\n                    <div>\n                      <div class="wb-history-diff-title">Left</div>\n                      <div class="wb-history-diff-body" v-html="entryHistoryDiff.leftHtml"></div>\n                    </div>\n                    <div>\n                      <div class="wb-history-diff-title">Right</div>\n                      <div class="wb-history-diff-body" v-html="entryHistoryDiff.rightHtml"></div>\n                    </div>\n                  </div>\n                </section>\n              </div>\n            </div>\n          </div>\n\n          <div v-if="showWorldbookHistoryModal" class="wb-modal-backdrop" @click.self="showWorldbookHistoryModal = false">\n            <div class="wb-history-modal">\n              <div class="wb-history-modal-header">\n                <div>\n                  <strong>‚è™ Êó∂ÂÖâÊú∫ÔºàÊï¥Êú¨ÂõûÊªöÔºâ</strong>\n                  <span>{{ getWorldbookVersionDiffSummary(selectedWorldbookHistoryLeft, selectedWorldbookHistoryRight) }}</span>\n                </div>\n                <div class="wb-history-modal-actions">\n                  <button class="btn mini" type="button" :disabled="!selectedWorldbookName" @click="createManualSnapshot">\n                    ÂàõÂª∫Êï¥Êú¨Âø´ÁÖß\n                  </button>\n                  <button\n                    class="btn mini danger"\n                    type="button"\n                    :disabled="!snapshotsForCurrent.length"\n                    @click="clearCurrentSnapshots"\n                  >\n                    Ê∏ÖÁ©∫Êï¥Êú¨Âø´ÁÖß\n                  </button>\n                  <button class="btn mini" type="button" @click="showWorldbookHistoryModal = false">ÂÖ≥Èó≠</button>\n                </div>\n              </div>\n\n              <div class="wb-history-modal-main">\n                <aside class="wb-history-versions">\n                  <div class="wb-history-versions-title">ÁâàÊú¨ÂàóË°®ÔºàL/RÔºâ</div>\n                  <div class="wb-history-versions-scroll">\n                    <div v-for="ver in worldbookVersionViews" :key="ver.id" class="wb-history-version-item">\n                      <div class="wb-history-version-line">\n                        <strong>{{ formatHistoryOptionLabel(ver.label, ver.ts, ver.isCurrent) }}</strong>\n                        <div class="wb-history-lr">\n                          <button class="mini-lr" :class="{ active: worldbookHistoryLeftId === ver.id }" @click="worldbookHistoryLeftId = ver.id">L</button>\n                          <button class="mini-lr" :class="{ active: worldbookHistoryRightId === ver.id }" @click="worldbookHistoryRightId = ver.id">R</button>\n                        </div>\n                      </div>\n                      <span>entries: {{ ver.entries.length }}</span>\n                    </div>\n                  </div>\n                </aside>\n\n                <section class="wb-history-diff-wrap">\n                  <div class="wb-history-diff-head">\n                    <div>\n                      Left: {{ selectedWorldbookHistoryLeft ? formatHistoryOptionLabel(selectedWorldbookHistoryLeft.label, selectedWorldbookHistoryLeft.ts, selectedWorldbookHistoryLeft.isCurrent) : \'-\' }}\n                      |\n                      Right: {{ selectedWorldbookHistoryRight ? formatHistoryOptionLabel(selectedWorldbookHistoryRight.label, selectedWorldbookHistoryRight.ts, selectedWorldbookHistoryRight.isCurrent) : \'-\' }}\n                    </div>\n                    <button\n                      class="btn mini"\n                      type="button"\n                      :disabled="!canRestoreWorldbookFromLeft"\n                      @click="restoreWorldbookFromLeftHistory"\n                    >\n                      ÊÅ¢Â§çÂà∞ Left\n                    </button>\n                  </div>\n                  <div class="wb-history-diff-grid">\n                    <div>\n                      <div class="wb-history-diff-title">Left</div>\n                      <div class="wb-history-diff-body" v-html="worldbookHistoryDiff.leftHtml"></div>\n                    </div>\n                    <div>\n                      <div class="wb-history-diff-title">Right</div>\n                      <div class="wb-history-diff-body" v-html="worldbookHistoryDiff.rightHtml"></div>\n                    </div>\n                  </div>\n                </section>\n              </div>\n            </div>\n          </div>\n\n          <div\n            v-if="floatingPanels.find.visible"\n            class="wb-floating-window find-window"\n            :style="getFloatingPanelStyle(\'find\')"\n            @pointerdown="bringFloatingToFront(\'find\')"\n          >\n            <div class="wb-floating-header" @pointerdown="startFloatingDrag(\'find\', $event)">\n              <strong>üîé Êü•Êâæ‰∏éÊõøÊç¢</strong>\n              <div class="wb-floating-header-actions">\n                <button\n                  class="btn mini"\n                  type="button"\n                  :disabled="!draftEntries.length"\n                  @pointerdown.stop\n                  @click="applyBatchReplace"\n                >\n                  ÊâßË°å\n                </button>\n                <button class="btn mini danger" type="button" @pointerdown.stop @click="closeFloatingPanel(\'find\')">\n                  ÂÖ≥Èó≠\n                </button>\n              </div>\n            </div>\n            <div class="wb-floating-body">\n              <div class="tool-line stacked">\n                <input v-model="batchFindText" type="text" class="text-input" placeholder="Êü•ÊâæÊñáÊú¨ / Ê≠£Âàô" />\n                <input v-model="batchReplaceText" type="text" class="text-input" placeholder="ÊõøÊç¢‰∏∫" />\n                <input\n                  v-model="batchExcludeText"\n                  type="text"\n                  class="text-input"\n                  placeholder="ÊéíÈô§È°πÔºöÊù°ÁõÆÂêçÂÖ≥ÈîÆËØç / #UIDÔºàÈÄóÂè∑ÊàñÊç¢Ë°åÔºâ"\n                />\n                <div class="batch-exclude-note">Á§∫‰æã: `#12, name:‰∏ñÁïåËßÇ, Âê∏Ë°ÄÈ¨º`ÔºàÂëΩ‰∏≠ÂêçÁß∞ÊàñÂÖ≥ÈîÆËØçÂç≥ÊéíÈô§Ôºâ</div>\n                <div v-if="batchExcludeTokensPreview.length" class="batch-exclude-chips">\n                  <span v-for="token in batchExcludeTokensPreview" :key="token" class="exclude-chip">{{ token }}</span>\n                </div>\n                <div class="find-flags">\n                  <label class="checkbox-inline">\n                    <input v-model="batchUseRegex" type="checkbox" />\n                    <span>Ê≠£ÂàôÊ®°Âºè</span>\n                  </label>\n                  <label class="checkbox-inline">\n                    <input v-model="batchInName" type="checkbox" />\n                    <span>ÂêçÁß∞</span>\n                  </label>\n                  <label class="checkbox-inline">\n                    <input v-model="batchInContent" type="checkbox" />\n                    <span>ÂÜÖÂÆπ</span>\n                  </label>\n                  <label class="checkbox-inline">\n                    <input v-model="batchInKeys" type="checkbox" />\n                    <span>ÂÖ≥ÈîÆËØç</span>\n                  </label>\n                </div>\n              </div>\n              <details class="tool-details">\n                <summary>ÈôÑÂä†ÊâπÂ§ÑÁêÜÂ∑•ÂÖ∑</summary>\n                <div class="tool-line">\n                  <button class="btn" type="button" :disabled="!draftEntries.length" @click="normalizeAllEntries">\n                    Ê†áÂáÜÂåñÂÖ®ÈÉ®\n                  </button>\n                  <button class="btn" type="button" :disabled="!draftEntries.length" @click="sortEntriesByOrderDesc">\n                    Êåâ order ÊéíÂ∫è\n                  </button>\n                </div>\n                <div class="tool-line">\n                  <button class="btn" type="button" :disabled="!draftEntries.length" @click="setEnabledForAll(true)">\n                    ÂÖ®ÈÉ®ÂêØÁî®\n                  </button>\n                  <button class="btn" type="button" :disabled="!draftEntries.length" @click="setEnabledForAll(false)">\n                    ÂÖ®ÈÉ®Á¶ÅÁî®\n                  </button>\n                </div>\n              </details>\n            </div>\n          </div>\n\n          <div\n            v-if="floatingPanels.clipboard.visible"\n            class="wb-floating-window clipboard-window"\n            :style="getFloatingPanelStyle(\'clipboard\')"\n            @pointerdown="bringFloatingToFront(\'clipboard\')"\n          >\n            <div class="wb-floating-header" @pointerdown="startFloatingDrag(\'clipboard\', $event)">\n              <strong>üìã Ââ™Ë¥¥ÊùøÔºàËÑöÊú¨ÂèòÈáèÊåÅ‰πÖÂåñÔºâ</strong>\n              <div class="wb-floating-header-actions">\n                <button\n                  class="btn mini danger"\n                  type="button"\n                  :disabled="!clipboardItems.length"\n                  @pointerdown.stop\n                  @click="clearClipboard"\n                >\n                  Ê∏ÖÁ©∫\n                </button>\n                <button\n                  class="btn mini danger"\n                  type="button"\n                  @pointerdown.stop\n                  @click="closeFloatingPanel(\'clipboard\')"\n                >\n                  ÂÖ≥Èó≠\n                </button>\n              </div>\n            </div>\n            <div class="wb-floating-body">\n              <div class="tool-scroll">\n                <div v-for="item in clipboardItems" :key="item.id" class="tool-list-item">\n                  <div class="item-main">\n                    <strong>{{ item.name || \'Êú™ÂëΩÂêçÊù°ÁõÆ\' }}</strong>\n                    <span>{{ formatDateTime(item.copied_at) }}</span>\n                  </div>\n                  <div class="item-actions">\n                    <button\n                      class="btn mini"\n                      type="button"\n                      :disabled="!selectedWorldbookName"\n                      @click="pasteClipboardItem(item.id)"\n                    >\n                      Á≤òË¥¥\n                    </button>\n                    <button class="btn mini danger" type="button" @click="deleteClipboardItem(item.id)">Âà†Èô§</button>\n                  </div>\n                </div>\n                <div v-if="!clipboardItems.length" class="empty-note">ÊöÇÊó†Ââ™Ë¥¥ÊùøÊù°ÁõÆ</div>\n              </div>\n            </div>\n          </div>\n\n          <div\n            v-if="floatingPanels.activation.visible"\n            class="wb-floating-window activation-window"\n            :style="getFloatingPanelStyle(\'activation\')"\n            @pointerdown="bringFloatingToFront(\'activation\')"\n          >\n            <div class="wb-floating-header" @pointerdown="startFloatingDrag(\'activation\', $event)">\n              <strong>üì° ÊøÄÊ¥ªÁõëÊéßÔºàWORLD_INFO_ACTIVATEDÔºâ</strong>\n              <div class="wb-floating-header-actions">\n                <button\n                  class="btn mini danger"\n                  type="button"\n                  :disabled="!activationLogs.length"\n                  @pointerdown.stop\n                  @click="clearActivationLogs"\n                >\n                  Ê∏ÖÁ©∫\n                </button>\n                <button\n                  class="btn mini danger"\n                  type="button"\n                  @pointerdown.stop\n                  @click="closeFloatingPanel(\'activation\')"\n                >\n                  ÂÖ≥Èó≠\n                </button>\n              </div>\n            </div>\n            <div class="wb-floating-body">\n              <div class="tool-scroll">\n                <div v-for="log in activationLogs" :key="log.id" class="activation-item">\n                  <div class="activation-main">\n                    <strong>{{ log.world }}</strong>\n                    <span>#{{ log.uid }} ¬∑ {{ log.name }}</span>\n                  </div>\n                  <div class="activation-sub">\n                    <span>{{ formatDateTime(log.time) }}</span>\n                    <span>{{ log.contentPreview }}</span>\n                  </div>\n                </div>\n                <div v-if="!activationLogs.length" class="empty-note">ÊöÇÊó†ÊøÄÊ¥ªËÆ∞ÂΩï</div>\n              </div>\n            </div>\n          </div>\n  </div>\n</template>\n\n<script setup lang="ts">\nimport { diffLines } from \'https://testingcf.jsdelivr.net/npm/diff/+esm\';\nimport { klona } from \'klona\';\n\ntype StrategyType = WorldbookEntry[\'strategy\'][\'type\'];\ntype SecondaryLogic = WorldbookEntry[\'strategy\'][\'keys_secondary\'][\'logic\'];\ntype PositionType = WorldbookEntry[\'position\'][\'type\'];\ntype RoleType = WorldbookEntry[\'position\'][\'role\'];\ntype EntryVisualStatus = \'constant\' | \'vector\' | \'normal\' | \'disabled\';\ntype FloatingPanelKey = \'find\' | \'clipboard\' | \'activation\';\ntype PaneResizeKey = \'main\' | \'editor\';\n\ninterface FloatingPanelState {\n  visible: boolean;\n  x: number;\n  y: number;\n  z: number;\n  width: number;\n}\n\ninterface PaneResizeState {\n  key: PaneResizeKey;\n  pointerId: number;\n  doc: Document;\n  win: Window;\n}\n\ninterface ClipboardItem {\n  id: string;\n  copied_at: number;\n  name: string;\n  entry: WorldbookEntry;\n}\n\ninterface WorldbookSnapshot {\n  id: string;\n  label: string;\n  ts: number;\n  entries: WorldbookEntry[];\n}\n\ninterface EntrySnapshot {\n  id: string;\n  label: string;\n  ts: number;\n  uid: number;\n  name: string;\n  entry: WorldbookEntry;\n}\n\ninterface EntryVersionView {\n  id: string;\n  label: string;\n  ts: number;\n  name: string;\n  entry: WorldbookEntry;\n  isCurrent: boolean;\n}\n\ninterface WorldbookVersionView {\n  id: string;\n  label: string;\n  ts: number;\n  entries: WorldbookEntry[];\n  isCurrent: boolean;\n}\n\ninterface PersistedState {\n  last_worldbook: string;\n  clipboard: ClipboardItem[];\n  history: Record<string, WorldbookSnapshot[]>;\n  entry_history: Record<string, Record<string, EntrySnapshot[]>>;\n}\n\ninterface ActivationLog {\n  id: string;\n  time: number;\n  world: string;\n  uid: number | string;\n  name: string;\n  contentPreview: string;\n}\n\ninterface ImportedPayload {\n  name: string;\n  entries: WorldbookEntry[];\n}\n\ninterface EventSubscription {\n  stop: () => void;\n}\n\nconst STORAGE_KEY = \'worldbook_assistant_state_v1\';\nconst DIRTY_STATE_KEY = \'__WB_ASSISTANT_HAS_UNSAVED_CHANGES__\';\nconst HISTORY_LIMIT = 12;\nconst ENTRY_HISTORY_LIMIT = 7;\nconst CLIPBOARD_LIMIT = 40;\nconst ACTIVATION_LOG_LIMIT = 120;\nconst RESIZE_HANDLE_SIZE = 10;\nconst MAIN_PANE_MIN = 220;\nconst MAIN_EDITOR_MIN = 540;\nconst EDITOR_SIDE_MIN = 280;\nconst EDITOR_CENTER_MIN = 420;\n\nconst strategyTypeOptions: StrategyType[] = [\'constant\', \'selective\', \'vectorized\'];\nconst secondaryLogicOptions: SecondaryLogic[] = [\'and_any\', \'and_all\', \'not_all\', \'not_any\'];\nconst positionTypeOptions: PositionType[] = [\n  \'before_character_definition\',\n  \'after_character_definition\',\n  \'before_example_messages\',\n  \'after_example_messages\',\n  \'before_author_note\',\n  \'after_author_note\',\n  \'at_depth\',\n];\n\nconst worldbookNames = ref<string[]>([]);\nconst selectedWorldbookName = ref(\'\');\nconst globalWorldbookMode = ref(false);\nconst originalEntries = ref<WorldbookEntry[]>([]);\nconst draftEntries = ref<WorldbookEntry[]>([]);\nconst selectedEntryUid = ref<number | null>(null);\n\nconst searchText = ref(\'\');\nconst onlyEnabled = ref(false);\nconst importFileInput = ref<HTMLInputElement | null>(null);\nconst selectedExtraText = ref(\'\');\nconst globalAddSearchText = ref(\'\');\nconst globalFilterText = ref(\'\');\n\nconst batchFindText = ref(\'\');\nconst batchReplaceText = ref(\'\');\nconst batchExcludeText = ref(\'\');\nconst batchUseRegex = ref(false);\nconst batchInName = ref(true);\nconst batchInContent = ref(true);\nconst batchInKeys = ref(false);\n\nconst statusMessage = ref(\'Â∞±Áª™\');\nconst isBusy = ref(false);\nconst isSaving = ref(false);\nconst showEntryHistoryModal = ref(false);\nconst showWorldbookHistoryModal = ref(false);\nconst entryHistoryLeftId = ref(\'\');\nconst entryHistoryRightId = ref(\'\');\nconst worldbookHistoryLeftId = ref(\'\');\nconst worldbookHistoryRightId = ref(\'\');\nconst floatingZCounter = ref(10005);\nconst floatingPanels = reactive<Record<FloatingPanelKey, FloatingPanelState>>({\n  find: { visible: false, x: 420, y: 170, z: 10006, width: 500 },\n  clipboard: { visible: false, x: 700, y: 190, z: 10007, width: 430 },\n  activation: { visible: false, x: 760, y: 230, z: 10008, width: 480 },\n});\nconst activeFloatingDrag = ref<{\n  key: FloatingPanelKey;\n  pointerId: number;\n  offsetX: number;\n  offsetY: number;\n  doc: Document;\n  win: Window;\n} | null>(null);\nconst floatingPanelKeys: FloatingPanelKey[] = [\'find\', \'clipboard\', \'activation\'];\nconst viewportWidth = ref(typeof window !== \'undefined\' ? window.innerWidth : 1440);\nconst mainLayoutRef = ref<HTMLElement | null>(null);\nconst editorShellRef = ref<HTMLElement | null>(null);\nconst mainPaneWidth = ref(320);\nconst editorSideWidth = ref(360);\nconst paneResizeState = ref<PaneResizeState | null>(null);\nconst hostResizeWindow = ref<Window | null>(null);\n\nconst bindings = reactive({\n  global: [] as string[],\n  charPrimary: null as string | null,\n  charAdditional: [] as string[],\n  chat: null as string | null,\n});\n\nconst activationLogs = ref<ActivationLog[]>([]);\nconst persistedState = ref<PersistedState>(createDefaultPersistedState());\n\nconst subscriptions: EventSubscription[] = [];\n\nconst selectedEntry = computed(() => {\n  if (selectedEntryUid.value === null) {\n    return null;\n  }\n  return draftEntries.value.find(entry => entry.uid === selectedEntryUid.value) ?? null;\n});\n\nconst selectedEntryIndex = computed(() => {\n  if (!selectedEntry.value) {\n    return -1;\n  }\n  return draftEntries.value.findIndex(entry => entry.uid === selectedEntry.value?.uid);\n});\n\nconst filteredEntries = computed(() => {\n  const keyword = searchText.value.trim().toLowerCase();\n  return draftEntries.value.filter(entry => {\n    if (onlyEnabled.value && !entry.enabled) {\n      return false;\n    }\n    if (!keyword) {\n      return true;\n    }\n    const keysJoined = entry.strategy.keys.map(stringifyKeyword).join(\' \').toLowerCase();\n    return (\n      entry.name.toLowerCase().includes(keyword) ||\n      entry.content.toLowerCase().includes(keyword) ||\n      keysJoined.includes(keyword)\n    );\n  });\n});\n\nconst enabledEntryCount = computed(() => draftEntries.value.filter(entry => entry.enabled).length);\n\nconst totalContentChars = computed(() =>\n  draftEntries.value.reduce((sum, entry) => {\n    return sum + entry.content.length;\n  }, 0),\n);\n\nconst hasUnsavedChanges = computed(() => JSON.stringify(draftEntries.value) !== JSON.stringify(originalEntries.value));\nconst isCompactLayout = computed(() => viewportWidth.value <= 1100);\n\nconst mainLayoutStyle = computed<Record<string, string> | undefined>(() => {\n  if (isCompactLayout.value) {\n    return undefined;\n  }\n  return {\n    gridTemplateColumns: `minmax(${MAIN_PANE_MIN}px, min(${mainPaneWidth.value}px, calc(100% - ${MAIN_EDITOR_MIN + RESIZE_HANDLE_SIZE}px))) ${RESIZE_HANDLE_SIZE}px minmax(0, 1fr)`,\n  };\n});\n\nconst editorShellStyle = computed<Record<string, string> | undefined>(() => {\n  if (isCompactLayout.value) {\n    return undefined;\n  }\n  return {\n    gridTemplateColumns: `minmax(0, 1fr) ${RESIZE_HANDLE_SIZE}px minmax(${EDITOR_SIDE_MIN}px, min(${editorSideWidth.value}px, calc(100% - ${EDITOR_CENTER_MIN + RESIZE_HANDLE_SIZE}px)))`,\n  };\n});\n\nconst selectableWorldbookNames = computed(() => {\n  if (!globalWorldbookMode.value) {\n    return worldbookNames.value;\n  }\n  return bindings.global.filter(name => worldbookNames.value.includes(name));\n});\n\nconst globalAddCandidates = computed(() => {\n  const keyword = globalAddSearchText.value.trim().toLowerCase();\n  return worldbookNames.value.filter(name => {\n    if (bindings.global.includes(name)) {\n      return false;\n    }\n    if (!keyword) {\n      return true;\n    }\n    return name.toLowerCase().includes(keyword);\n  });\n});\n\nconst filteredGlobalWorldbooks = computed(() => {\n  const keyword = globalFilterText.value.trim().toLowerCase();\n  if (!keyword) {\n    return bindings.global;\n  }\n  return bindings.global.filter(name => name.toLowerCase().includes(keyword));\n});\n\nconst isGlobalBound = computed(() => {\n  if (!selectedWorldbookName.value) {\n    return false;\n  }\n  return bindings.global.includes(selectedWorldbookName.value);\n});\n\nconst clipboardItems = computed(() => persistedState.value.clipboard);\n\nconst snapshotsForCurrent = computed(() => {\n  if (!selectedWorldbookName.value) {\n    return [];\n  }\n  return persistedState.value.history[selectedWorldbookName.value] ?? [];\n});\n\nconst entrySnapshotsForSelected = computed(() => {\n  if (!selectedWorldbookName.value || !selectedEntry.value) {\n    return [];\n  }\n  const byWorldbook = persistedState.value.entry_history[selectedWorldbookName.value] ?? {};\n  return byWorldbook[String(selectedEntry.value.uid)] ?? [];\n});\n\nconst entryVersionViews = computed<EntryVersionView[]>(() => {\n  if (!selectedEntry.value) {\n    return [];\n  }\n  const baselineEntry = originalEntries.value.find(item => item.uid === selectedEntry.value?.uid) ?? null;\n  const current: EntryVersionView = {\n    id: \'__current__\',\n    label: \'ÂΩìÂâçÁâàÊú¨\',\n    ts: Date.now(),\n    name: selectedEntry.value.name,\n    entry: selectedEntry.value,\n    isCurrent: true,\n  };\n  const baseline = baselineEntry\n    ? ({\n        id: \'__baseline__\',\n        label: \'Âä†ËΩΩÂü∫Á∫ø\',\n        ts: 0,\n        name: baselineEntry.name,\n        entry: baselineEntry,\n        isCurrent: false,\n      } satisfies EntryVersionView)\n    : null;\n  const history = entrySnapshotsForSelected.value.map(item => ({\n    id: item.id,\n    label: item.label,\n    ts: item.ts,\n    name: item.name,\n    entry: item.entry,\n    isCurrent: false,\n  }));\n  return [current, ...(baseline ? [baseline] : []), ...history];\n});\n\nconst selectedEntryHistoryLeft = computed(() => {\n  return entryVersionViews.value.find(item => item.id === entryHistoryLeftId.value) ?? null;\n});\n\nconst selectedEntryHistoryRight = computed(() => {\n  return entryVersionViews.value.find(item => item.id === entryHistoryRightId.value) ?? null;\n});\n\nconst canRestoreEntryFromLeft = computed(() => {\n  return Boolean(selectedEntry.value && selectedEntryHistoryLeft.value && !selectedEntryHistoryLeft.value.isCurrent);\n});\n\nconst worldbookVersionViews = computed<WorldbookVersionView[]>(() => {\n  if (!selectedWorldbookName.value) {\n    return [];\n  }\n  const current: WorldbookVersionView = {\n    id: \'__current__\',\n    label: \'ÂΩìÂâçËçâÁ®ø\',\n    ts: Date.now(),\n    entries: draftEntries.value,\n    isCurrent: true,\n  };\n  const baseline: WorldbookVersionView | null = {\n    id: \'__baseline__\',\n    label: \'Âä†ËΩΩÂü∫Á∫ø\',\n    ts: 0,\n    entries: originalEntries.value,\n    isCurrent: false,\n  };\n  const history = snapshotsForCurrent.value.map(item => ({\n    id: item.id,\n    label: item.label,\n    ts: item.ts,\n    entries: item.entries,\n    isCurrent: false,\n  }));\n  return [current, ...(originalEntries.value.length ? [baseline] : []), ...history];\n});\n\nconst selectedWorldbookHistoryLeft = computed(() => {\n  return worldbookVersionViews.value.find(item => item.id === worldbookHistoryLeftId.value) ?? null;\n});\n\nconst selectedWorldbookHistoryRight = computed(() => {\n  return worldbookVersionViews.value.find(item => item.id === worldbookHistoryRightId.value) ?? null;\n});\n\nconst canRestoreWorldbookFromLeft = computed(() => {\n  return Boolean(selectedWorldbookHistoryLeft.value && !selectedWorldbookHistoryLeft.value.isCurrent);\n});\n\nconst batchExcludeTokensPreview = computed(() => parseBatchExcludeTokens(batchExcludeText.value));\n\nconst entryHistoryDiff = computed(() => {\n  return buildDiffHtml(\n    serializeEntryVersionForDiff(selectedEntryHistoryLeft.value),\n    serializeEntryVersionForDiff(selectedEntryHistoryRight.value),\n  );\n});\n\nconst entryHistorySummary = computed(() => {\n  return getEntryVersionDiffSummary(selectedEntryHistoryLeft.value, selectedEntryHistoryRight.value);\n});\n\nconst worldbookHistoryDiff = computed(() => {\n  return buildDiffHtml(\n    serializeWorldbookVersionForDiff(selectedWorldbookHistoryLeft.value),\n    serializeWorldbookVersionForDiff(selectedWorldbookHistoryRight.value),\n  );\n});\n\nconst selectedKeysText = computed({\n  get: () => {\n    if (!selectedEntry.value) {\n      return \'\';\n    }\n    return selectedEntry.value.strategy.keys.map(stringifyKeyword).join(\', \');\n  },\n  set: (value: string) => {\n    if (!selectedEntry.value) {\n      return;\n    }\n    selectedEntry.value.strategy.keys = parseKeywordsFromText(value);\n  },\n});\n\nconst selectedSecondaryKeysText = computed({\n  get: () => {\n    if (!selectedEntry.value) {\n      return \'\';\n    }\n    return selectedEntry.value.strategy.keys_secondary.keys.map(stringifyKeyword).join(\', \');\n  },\n  set: (value: string) => {\n    if (!selectedEntry.value) {\n      return;\n    }\n    selectedEntry.value.strategy.keys_secondary.keys = parseKeywordsFromText(value);\n  },\n});\n\nconst selectedScanDepthText = computed({\n  get: () => {\n    if (!selectedEntry.value) {\n      return \'\';\n    }\n    const depth = selectedEntry.value.strategy.scan_depth;\n    return typeof depth === \'number\' ? String(depth) : \'same_as_global\';\n  },\n  set: (value: string) => {\n    if (!selectedEntry.value) {\n      return;\n    }\n    selectedEntry.value.strategy.scan_depth = normalizeScanDepth(value);\n  },\n});\n\nconst selectedRecursionDelayText = computed({\n  get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.recursion.delay_until) : \'\'),\n  set: (value: string) => {\n    if (!selectedEntry.value) {\n      return;\n    }\n    selectedEntry.value.recursion.delay_until = parseNullableInteger(value);\n  },\n});\n\nconst selectedStickyText = computed({\n  get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.effect.sticky) : \'\'),\n  set: (value: string) => {\n    if (!selectedEntry.value) {\n      return;\n    }\n    selectedEntry.value.effect.sticky = parseNullableInteger(value);\n  },\n});\n\nconst selectedCooldownText = computed({\n  get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.effect.cooldown) : \'\'),\n  set: (value: string) => {\n    if (!selectedEntry.value) {\n      return;\n    }\n    selectedEntry.value.effect.cooldown = parseNullableInteger(value);\n  },\n});\n\nconst selectedEffectDelayText = computed({\n  get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.effect.delay) : \'\'),\n  set: (value: string) => {\n    if (!selectedEntry.value) {\n      return;\n    }\n    selectedEntry.value.effect.delay = parseNullableInteger(value);\n  },\n});\n\nconst selectedContentChars = computed(() => {\n  return selectedEntry.value?.content.length ?? 0;\n});\n\nconst selectedTokenEstimate = computed(() => {\n  const chars = selectedContentChars.value;\n  if (chars <= 0) {\n    return 0;\n  }\n  return Math.max(1, Math.round(chars / 3.6));\n});\n\nwatch(selectedWorldbookName, name => {\n  if (!name) {\n    draftEntries.value = [];\n    originalEntries.value = [];\n    selectedEntryUid.value = null;\n    return;\n  }\n  updatePersistedState(state => {\n    state.last_worldbook = name;\n  });\n  void loadWorldbook(name);\n});\n\nwatch(\n  () => selectedEntryUid.value,\n  () => {\n    syncExtraTextWithSelection();\n  },\n);\n\nwatch(\n  entryVersionViews,\n  views => {\n    if (!views.length) {\n      entryHistoryLeftId.value = \'\';\n      entryHistoryRightId.value = \'\';\n      return;\n    }\n\n    const ids = new Set(views.map(item => item.id));\n    if (!ids.has(entryHistoryRightId.value)) {\n      entryHistoryRightId.value = \'__current__\';\n    }\n    if (!ids.has(entryHistoryLeftId.value)) {\n      const fallback = views.find(item => !item.isCurrent) ?? views[0];\n      entryHistoryLeftId.value = fallback.id;\n    }\n    if (entryHistoryLeftId.value === entryHistoryRightId.value && views.length > 1) {\n      const fallback = views.find(item => item.id !== entryHistoryRightId.value);\n      if (fallback) {\n        entryHistoryLeftId.value = fallback.id;\n      }\n    }\n  },\n  { immediate: true },\n);\n\nwatch(\n  worldbookVersionViews,\n  views => {\n    if (!views.length) {\n      worldbookHistoryLeftId.value = \'\';\n      worldbookHistoryRightId.value = \'\';\n      return;\n    }\n\n    const ids = new Set(views.map(item => item.id));\n    if (!ids.has(worldbookHistoryRightId.value)) {\n      worldbookHistoryRightId.value = \'__current__\';\n    }\n    if (!ids.has(worldbookHistoryLeftId.value)) {\n      const fallback = views.find(item => !item.isCurrent) ?? views[0];\n      worldbookHistoryLeftId.value = fallback.id;\n    }\n    if (worldbookHistoryLeftId.value === worldbookHistoryRightId.value && views.length > 1) {\n      const fallback = views.find(item => item.id !== worldbookHistoryRightId.value);\n      if (fallback) {\n        worldbookHistoryLeftId.value = fallback.id;\n      }\n    }\n  },\n  { immediate: true },\n);\n\nwatch(\n  () => selectedEntry.value?.position.type,\n  () => {\n    if (!selectedEntry.value) {\n      return;\n    }\n    if (selectedEntry.value.position.type !== \'at_depth\') {\n      selectedEntry.value.position.role = \'system\';\n      selectedEntry.value.position.depth = 4;\n    }\n  },\n);\n\nwatch(\n  hasUnsavedChanges,\n  dirty => {\n    const target = window as unknown as Record<string, unknown>;\n    target[DIRTY_STATE_KEY] = dirty;\n  },\n  { immediate: true },\n);\n\nfunction createId(prefix: string): string {\n  return `${prefix}-${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 9)}`;\n}\n\nfunction asRecord(value: unknown): Record<string, unknown> | null {\n  if (value && typeof value === \'object\' && !Array.isArray(value)) {\n    return value as Record<string, unknown>;\n  }\n  return null;\n}\n\nfunction toStringSafe(value: unknown, fallback = \'\'): string {\n  if (typeof value === \'string\') {\n    return value;\n  }\n  if (value === null || value === undefined) {\n    return fallback;\n  }\n  return String(value);\n}\n\nfunction toNumberSafe(value: unknown, fallback: number): number {\n  if (typeof value === \'number\' && Number.isFinite(value)) {\n    return value;\n  }\n  if (typeof value === \'string\' && value.trim()) {\n    const parsed = Number(value);\n    if (Number.isFinite(parsed)) {\n      return parsed;\n    }\n  }\n  return fallback;\n}\n\nfunction clampNumber(value: number, min: number, max: number): number {\n  return Math.min(max, Math.max(min, value));\n}\n\nfunction parseNullableInteger(value: unknown): number | null {\n  if (value === null || value === undefined) {\n    return null;\n  }\n  if (typeof value === \'string\' && !value.trim()) {\n    return null;\n  }\n  const parsed = Number(value);\n  if (!Number.isFinite(parsed)) {\n    return null;\n  }\n  return Math.max(0, Math.floor(parsed));\n}\n\nfunction nullableNumberToText(value: number | null): string {\n  return value === null ? \'\' : String(value);\n}\n\nfunction stringifyKeyword(value: string | RegExp): string {\n  return value instanceof RegExp ? value.toString() : value;\n}\n\nfunction parseKeywordToken(token: string): string | RegExp {\n  const trimmed = token.trim();\n  if (!trimmed) {\n    return \'\';\n  }\n  const regexMatch = trimmed.match(/^\\/(.+)\\/([dgimsuy]*)$/);\n  if (!regexMatch) {\n    return trimmed;\n  }\n  try {\n    return new RegExp(regexMatch[1], regexMatch[2]);\n  } catch {\n    return trimmed;\n  }\n}\n\nfunction normalizeKeywordList(value: unknown): (string | RegExp)[] {\n  const sourceList = Array.isArray(value) ? value : typeof value === \'string\' ? value.split(/[\\n,]/g) : [];\n  const normalized: (string | RegExp)[] = [];\n  const seen = new Set<string>();\n\n  for (const item of sourceList) {\n    const token = item instanceof RegExp ? item : parseKeywordToken(toStringSafe(item).trim());\n    const tokenString = stringifyKeyword(token);\n    if (!tokenString) {\n      continue;\n    }\n    const dedupeKey = tokenString.toLowerCase();\n    if (seen.has(dedupeKey)) {\n      continue;\n    }\n    seen.add(dedupeKey);\n    normalized.push(token);\n  }\n\n  return normalized;\n}\n\nfunction parseKeywordsFromText(value: string): (string | RegExp)[] {\n  return normalizeKeywordList(value.split(/[\\n,]/g));\n}\n\nfunction getStrategyTypeLabel(type: StrategyType): string {\n  if (type === \'constant\') {\n    return \'üîµ Â∏∏È©ª (constant)\';\n  }\n  if (type === \'vectorized\') {\n    return \'üìé ÂêëÈáèÂåñ (vectorized)\';\n  }\n  return \'üü¢ ÂÖ≥ÈîÆËØç (selective)\';\n}\n\nfunction getSecondaryLogicLabel(logic: SecondaryLogic): string {\n  const map: Record<SecondaryLogic, string> = {\n    and_any: \'‰ªª‰∏ÄÂëΩ‰∏≠ (and_any)\',\n    and_all: \'ÂÖ®ÈÉ®ÂëΩ‰∏≠ (and_all)\',\n    not_all: \'‰∏çÂÖ®ÂëΩ‰∏≠ (not_all)\',\n    not_any: \'ÂÖ®ÈÉ®‰∏çÂëΩ‰∏≠ (not_any)\',\n  };\n  return map[logic];\n}\n\nfunction getPositionTypeLabel(type: PositionType): string {\n  const map: Record<PositionType, string> = {\n    before_character_definition: \'ËßíËâ≤ËÆæÂÆöÂâç\',\n    after_character_definition: \'ËßíËâ≤ËÆæÂÆöÂêé\',\n    before_example_messages: \'Á§∫‰æãÊ∂àÊÅØÂâç\',\n    after_example_messages: \'Á§∫‰æãÊ∂àÊÅØÂêé\',\n    before_author_note: \'‰ΩúËÄÖÊ≥®ÈáäÂâç\',\n    after_author_note: \'‰ΩúËÄÖÊ≥®ÈáäÂêé\',\n    at_depth: \'ÊåáÂÆöÊ∑±Â∫¶ÊèíÂÖ•\',\n  };\n  return map[type];\n}\n\nfunction getEntryVisualStatus(entry: WorldbookEntry): EntryVisualStatus {\n  if (!entry.enabled) {\n    return \'disabled\';\n  }\n  if (entry.strategy.type === \'constant\') {\n    return \'constant\';\n  }\n  if (entry.strategy.type === \'vectorized\') {\n    return \'vector\';\n  }\n  return \'normal\';\n}\n\nfunction getEntryStatusLabel(entry: WorldbookEntry): string {\n  const status = getEntryVisualStatus(entry);\n  if (status === \'disabled\') {\n    return \'‚ö´ Á¶ÅÁî®\';\n  }\n  if (status === \'constant\') {\n    return \'üîµ Â∏∏È©ª\';\n  }\n  if (status === \'vector\') {\n    return \'üìé ÂêëÈáèÂåñ\';\n  }\n  return \'üü¢ ÂÖ≥ÈîÆËØç\';\n}\n\nfunction getEntryKeyPreview(entry: WorldbookEntry): string {\n  const rendered = entry.strategy.keys\n    .slice(0, 3)\n    .map(key => stringifyKeyword(key))\n    .join(\' / \');\n  if (!rendered) {\n    return \'Êó†ÂÖ≥ÈîÆËØç\';\n  }\n  if (entry.strategy.keys.length > 3) {\n    return `${rendered} ...`;\n  }\n  return rendered;\n}\n\nfunction normalizeSecondaryLogic(value: unknown): SecondaryLogic {\n  if (typeof value === \'string\' && secondaryLogicOptions.includes(value as SecondaryLogic)) {\n    return value as SecondaryLogic;\n  }\n  if (typeof value === \'number\') {\n    const map: SecondaryLogic[] = [\'and_any\', \'and_all\', \'not_all\', \'not_any\'];\n    return map[value] ?? \'and_any\';\n  }\n  return \'and_any\';\n}\n\nfunction normalizeStrategyType(\n  raw: Record<string, unknown>,\n  strategyRecord: Record<string, unknown> | null,\n): StrategyType {\n  const directType = strategyRecord?.type;\n  if (typeof directType === \'string\' && strategyTypeOptions.includes(directType as StrategyType)) {\n    return directType as StrategyType;\n  }\n  if (raw.constant) {\n    return \'constant\';\n  }\n  if (raw.vectorized) {\n    return \'vectorized\';\n  }\n  return \'selective\';\n}\n\nfunction normalizePositionType(value: unknown): PositionType {\n  if (typeof value === \'string\') {\n    if (positionTypeOptions.includes(value as PositionType)) {\n      return value as PositionType;\n    }\n    const depthMatch = value.match(/^at_depth_as_(system|assistant|user)$/);\n    if (depthMatch) {\n      return \'at_depth\';\n    }\n  }\n  if (typeof value === \'number\') {\n    const map: Record<number, PositionType> = {\n      0: \'before_character_definition\',\n      1: \'after_character_definition\',\n      2: \'before_example_messages\',\n      3: \'after_example_messages\',\n      4: \'before_author_note\',\n      5: \'after_author_note\',\n      6: \'at_depth\',\n    };\n    return map[value] ?? \'after_character_definition\';\n  }\n  return \'after_character_definition\';\n}\n\nfunction normalizeRole(value: unknown): RoleType {\n  if (value === \'assistant\' || value === \'user\' || value === \'system\') {\n    return value;\n  }\n  if (typeof value === \'number\') {\n    const map: Record<number, RoleType> = {\n      0: \'system\',\n      1: \'assistant\',\n      2: \'user\',\n    };\n    return map[value] ?? \'system\';\n  }\n  if (typeof value === \'string\') {\n    if (value.includes(\'assistant\')) {\n      return \'assistant\';\n    }\n    if (value.includes(\'user\')) {\n      return \'user\';\n    }\n  }\n  return \'system\';\n}\n\nfunction normalizeScanDepth(value: unknown): \'same_as_global\' | number {\n  if (value === \'same_as_global\') {\n    return \'same_as_global\';\n  }\n  const numeric = Math.floor(toNumberSafe(value, NaN));\n  if (Number.isFinite(numeric) && numeric > 0) {\n    return numeric;\n  }\n  return \'same_as_global\';\n}\n\nfunction createDefaultEntry(uid: number): WorldbookEntry {\n  return {\n    uid,\n    name: `Êù°ÁõÆ ${uid}`,\n    enabled: true,\n    strategy: {\n      type: \'selective\',\n      keys: [],\n      keys_secondary: {\n        logic: \'and_any\',\n        keys: [],\n      },\n      scan_depth: \'same_as_global\',\n    },\n    position: {\n      type: \'after_character_definition\',\n      role: \'system\',\n      depth: 4,\n      order: 100,\n    },\n    content: \'\',\n    probability: 100,\n    recursion: {\n      prevent_incoming: false,\n      prevent_outgoing: false,\n      delay_until: null,\n    },\n    effect: {\n      sticky: null,\n      cooldown: null,\n      delay: null,\n    },\n  };\n}\n\nfunction collectExtraFields(raw: Record<string, unknown>): Record<string, unknown> | undefined {\n  const known = new Set([\n    \'uid\',\n    \'id\',\n    \'name\',\n    \'comment\',\n    \'enabled\',\n    \'disable\',\n    \'strategy\',\n    \'position\',\n    \'content\',\n    \'probability\',\n    \'recursion\',\n    \'effect\',\n    \'extra\',\n    \'keys\',\n    \'key\',\n    \'secondary_keys\',\n    \'keysecondary\',\n    \'filters\',\n    \'logic\',\n    \'selectiveLogic\',\n    \'scan_depth\',\n    \'constant\',\n    \'vectorized\',\n    \'selective\',\n    \'insertion_order\',\n    \'order\',\n    \'role\',\n    \'depth\',\n    \'preventRecursion\',\n    \'excludeRecursion\',\n    \'delayUntilRecursion\',\n    \'sticky\',\n    \'cooldown\',\n    \'delay\',\n    \'useProbability\',\n  ]);\n\n  const extra: Record<string, unknown> = {};\n  for (const [key, value] of Object.entries(raw)) {\n    if (!known.has(key)) {\n      extra[key] = value;\n    }\n  }\n  if (Object.keys(extra).length === 0) {\n    return undefined;\n  }\n  return extra;\n}\n\nfunction normalizeEntry(rawInput: unknown, fallbackUid: number): WorldbookEntry {\n  const raw = asRecord(rawInput) ?? {};\n  const base = createDefaultEntry(fallbackUid);\n  const strategyRecord = asRecord(raw.strategy);\n  const positionRecord = asRecord(raw.position);\n  const recursionRecord = asRecord(raw.recursion);\n  const effectRecord = asRecord(raw.effect);\n  const secondaryRecord = asRecord(strategyRecord?.keys_secondary);\n\n  const uid = Math.max(0, Math.floor(toNumberSafe(raw.uid ?? raw.id, fallbackUid)));\n  const name = toStringSafe(raw.name ?? raw.comment, `Êù°ÁõÆ ${uid}`).trim() || `Êù°ÁõÆ ${uid}`;\n  const strategyType = normalizeStrategyType(raw, strategyRecord);\n  const keys = normalizeKeywordList(strategyRecord?.keys ?? raw.keys ?? raw.key);\n  const secondaryKeys = normalizeKeywordList(\n    secondaryRecord?.keys ?? raw.secondary_keys ?? raw.keysecondary ?? raw.filters,\n  );\n  const secondaryLogic = normalizeSecondaryLogic(secondaryRecord?.logic ?? raw.logic ?? raw.selectiveLogic);\n  const positionType = normalizePositionType(positionRecord?.type ?? raw.position);\n  const role = normalizeRole(positionRecord?.role ?? raw.role);\n  const depth = Math.max(1, Math.floor(toNumberSafe(positionRecord?.depth ?? raw.depth, 4)));\n  const order = Math.floor(toNumberSafe(positionRecord?.order ?? raw.insertion_order ?? raw.order, 100));\n  const probability = clampNumber(toNumberSafe(raw.probability, 100), 0, 100);\n\n  const preventIncoming = recursionRecord?.prevent_incoming ?? raw.preventRecursion;\n  const preventOutgoing = recursionRecord?.prevent_outgoing ?? raw.excludeRecursion;\n\n  const entry: WorldbookEntry = {\n    ...base,\n    uid,\n    name,\n    enabled: raw.enabled === undefined ? !Boolean(raw.disable) : Boolean(raw.enabled),\n    strategy: {\n      type: strategyType,\n      keys,\n      keys_secondary: {\n        logic: secondaryLogic,\n        keys: secondaryKeys,\n      },\n      scan_depth: normalizeScanDepth(strategyRecord?.scan_depth ?? raw.scan_depth),\n    },\n    position: {\n      type: positionType,\n      role: positionType === \'at_depth\' ? role : \'system\',\n      depth: positionType === \'at_depth\' ? depth : 4,\n      order,\n    },\n    content: toStringSafe(raw.content),\n    probability,\n    recursion: {\n      prevent_incoming: Boolean(preventIncoming),\n      prevent_outgoing: Boolean(preventOutgoing),\n      delay_until: parseNullableInteger(recursionRecord?.delay_until ?? raw.delayUntilRecursion),\n    },\n    effect: {\n      sticky: parseNullableInteger(effectRecord?.sticky ?? raw.sticky),\n      cooldown: parseNullableInteger(effectRecord?.cooldown ?? raw.cooldown),\n      delay: parseNullableInteger(effectRecord?.delay ?? raw.delay),\n    },\n  };\n\n  const directExtra = asRecord(raw.extra);\n  if (directExtra && Object.keys(directExtra).length > 0) {\n    entry.extra = klona(directExtra);\n  } else {\n    const extras = collectExtraFields(raw);\n    if (extras) {\n      entry.extra = klona(extras);\n    }\n  }\n\n  return entry;\n}\n\nfunction normalizeEntryList(rawEntries: unknown[]): WorldbookEntry[] {\n  const result: WorldbookEntry[] = [];\n  const uidSet = new Set<number>();\n\n  for (let index = 0; index < rawEntries.length; index += 1) {\n    const rawRecord = asRecord(rawEntries[index]);\n    let uid = Math.max(0, Math.floor(toNumberSafe(rawRecord?.uid ?? rawRecord?.id, index)));\n    while (uidSet.has(uid)) {\n      uid += 1;\n    }\n    uidSet.add(uid);\n    result.push(normalizeEntry(rawEntries[index], uid));\n  }\n\n  return result;\n}\n\nfunction getNextUid(entries: WorldbookEntry[]): number {\n  if (entries.length === 0) {\n    return 0;\n  }\n  return Math.max(...entries.map(entry => entry.uid)) + 1;\n}\n\nfunction createDefaultPersistedState(): PersistedState {\n  return {\n    last_worldbook: \'\',\n    clipboard: [],\n    history: {},\n    entry_history: {},\n  };\n}\n\nfunction normalizePersistedState(input: unknown): PersistedState {\n  const root = asRecord(input);\n  if (!root) {\n    return createDefaultPersistedState();\n  }\n\n  const historyRoot = asRecord(root.history) ?? {};\n  const history: Record<string, WorldbookSnapshot[]> = {};\n  for (const [name, rawSnapshots] of Object.entries(historyRoot)) {\n    if (!Array.isArray(rawSnapshots)) {\n      continue;\n    }\n    history[name] = rawSnapshots\n      .map(item => {\n        const record = asRecord(item);\n        if (!record) {\n          return null;\n        }\n        const entriesRaw = Array.isArray(record.entries) ? record.entries : [];\n        return {\n          id: toStringSafe(record.id, createId(\'snapshot\')),\n          label: toStringSafe(record.label, \'Âø´ÁÖß\'),\n          ts: toNumberSafe(record.ts, Date.now()),\n          entries: normalizeEntryList(entriesRaw),\n        } satisfies WorldbookSnapshot;\n      })\n      .filter((item): item is WorldbookSnapshot => item !== null)\n      .slice(0, HISTORY_LIMIT);\n  }\n\n  const entryHistoryRoot = asRecord(root.entry_history) ?? {};\n  const entryHistory: Record<string, Record<string, EntrySnapshot[]>> = {};\n  for (const [worldbookName, rawByUid] of Object.entries(entryHistoryRoot)) {\n    const uidRecord = asRecord(rawByUid);\n    if (!uidRecord) {\n      continue;\n    }\n    const normalizedByUid: Record<string, EntrySnapshot[]> = {};\n    for (const [uidKey, rawItems] of Object.entries(uidRecord)) {\n      if (!Array.isArray(rawItems)) {\n        continue;\n      }\n      const uidNumber = Math.max(0, Math.floor(toNumberSafe(uidKey, 0)));\n      normalizedByUid[uidKey] = rawItems\n        .map(item => {\n          const record = asRecord(item);\n          if (!record) {\n            return null;\n          }\n          return {\n            id: toStringSafe(record.id, createId(\'entry-snapshot\')),\n            label: toStringSafe(record.label, \'Êù°ÁõÆÂø´ÁÖß\'),\n            ts: toNumberSafe(record.ts, Date.now()),\n            uid: uidNumber,\n            name: toStringSafe(record.name, `Êù°ÁõÆ ${uidNumber}`),\n            entry: normalizeEntry(record.entry, uidNumber),\n          } satisfies EntrySnapshot;\n        })\n        .filter((item): item is EntrySnapshot => item !== null)\n        .slice(0, ENTRY_HISTORY_LIMIT);\n    }\n    if (Object.keys(normalizedByUid).length > 0) {\n      entryHistory[worldbookName] = normalizedByUid;\n    }\n  }\n\n  const clipboardRaw = Array.isArray(root.clipboard) ? root.clipboard : [];\n  const clipboard = clipboardRaw\n    .map(item => {\n      const record = asRecord(item);\n      if (!record) {\n        return null;\n      }\n      return {\n        id: toStringSafe(record.id, createId(\'clip\')),\n        copied_at: toNumberSafe(record.copied_at, Date.now()),\n        name: toStringSafe(record.name, \'Êú™ÂëΩÂêçÊù°ÁõÆ\'),\n        entry: normalizeEntry(record.entry, 0),\n      } satisfies ClipboardItem;\n    })\n    .filter((item): item is ClipboardItem => item !== null)\n    .slice(0, CLIPBOARD_LIMIT);\n\n  return {\n    last_worldbook: toStringSafe(root.last_worldbook),\n    history,\n    entry_history: entryHistory,\n    clipboard,\n  };\n}\n\nfunction readPersistedState(): PersistedState {\n  const vars = getVariables({ type: \'script\', script_id: getScriptId() });\n  return normalizePersistedState(vars[STORAGE_KEY]);\n}\n\nfunction writePersistedState(state: PersistedState): void {\n  const vars = getVariables({ type: \'script\', script_id: getScriptId() });\n  vars[STORAGE_KEY] = state;\n  replaceVariables(vars, { type: \'script\', script_id: getScriptId() });\n  persistedState.value = state;\n}\n\nfunction updatePersistedState(mutator: (state: PersistedState) => void): void {\n  const state = readPersistedState();\n  mutator(state);\n  writePersistedState(state);\n}\n\nfunction setStatus(message: string): void {\n  statusMessage.value = message;\n}\n\nfunction syncExtraTextWithSelection(): void {\n  if (!selectedEntry.value || !selectedEntry.value.extra) {\n    selectedExtraText.value = \'\';\n    return;\n  }\n  selectedExtraText.value = JSON.stringify(selectedEntry.value.extra, null, 2);\n}\n\nfunction formatDateTime(timestamp: number): string {\n  try {\n    return new Date(timestamp).toLocaleString(\'zh-CN\', { hour12: false });\n  } catch {\n    return String(timestamp);\n  }\n}\n\nfunction formatHistoryOptionLabel(label: string, ts: number, isCurrent: boolean): string {\n  if (isCurrent) {\n    return \'CurrentÔºàÂΩìÂâçÔºâ\';\n  }\n  if (label === \'Âä†ËΩΩÂü∫Á∫ø\' || ts <= 0) {\n    return label;\n  }\n  return `${label} ¬∑ ${formatDateTime(ts)}`;\n}\n\nfunction getEntryVersionPreview(view: EntryVersionView | null): string {\n  if (!view) {\n    return \'\';\n  }\n  const content = toStringSafe(view.entry.content).replace(/\\s+/g, \' \').trim();\n  if (!content) {\n    return \'(Á©∫ÂÜÖÂÆπ)\';\n  }\n  return content.slice(0, 160);\n}\n\nfunction getWorldbookVersionDiffSummary(\n  left: WorldbookVersionView | null,\n  right: WorldbookVersionView | null,\n): string {\n  if (!left || !right) {\n    return \'ËØ∑ÈÄâÊã©Â∑¶Âè≥ÁâàÊú¨ËøõË°åÂØπÊØî\';\n  }\n  const leftMap = new Map<number, WorldbookEntry>();\n  const rightMap = new Map<number, WorldbookEntry>();\n  left.entries.forEach(entry => leftMap.set(entry.uid, entry));\n  right.entries.forEach(entry => rightMap.set(entry.uid, entry));\n\n  let added = 0;\n  let removed = 0;\n  let changed = 0;\n\n  for (const [uid, rightEntry] of rightMap) {\n    const leftEntry = leftMap.get(uid);\n    if (!leftEntry) {\n      added += 1;\n      continue;\n    }\n    if (JSON.stringify(leftEntry) !== JSON.stringify(rightEntry)) {\n      changed += 1;\n    }\n  }\n  for (const uid of leftMap.keys()) {\n    if (!rightMap.has(uid)) {\n      removed += 1;\n    }\n  }\n\n  return `Êñ∞Â¢û ${added} / ‰øÆÊîπ ${changed} / Âà†Èô§ ${removed}`;\n}\n\nfunction getEntryVersionDiffSummary(left: EntryVersionView | null, right: EntryVersionView | null): string {\n  if (!left || !right) {\n    return \'ËØ∑Âú®Â∑¶‰æßÈÄâÊã©‰∏§‰∏™ÁâàÊú¨ËøõË°åÊØîÂØπ\';\n  }\n  const leftText = serializeEntryVersionForDiff(left);\n  const rightText = serializeEntryVersionForDiff(right);\n  const parts = diffLines(leftText, rightText) as Array<{ value: string; added?: boolean; removed?: boolean }>;\n  let addLines = 0;\n  let delLines = 0;\n  for (const part of parts) {\n    const lines = part.value.split(\'\\n\');\n    if (lines.length && lines[lines.length - 1] === \'\') {\n      lines.pop();\n    }\n    if (part.added) {\n      addLines += lines.length;\n    } else if (part.removed) {\n      delLines += lines.length;\n    }\n  }\n  const changed = Math.min(addLines, delLines);\n  const added = Math.max(0, addLines - changed);\n  const removed = Math.max(0, delLines - changed);\n  return `Êñ∞Â¢ûË°å ${added} / ‰øÆÊîπË°å ${changed} / Âà†Èô§Ë°å ${removed}`;\n}\n\nfunction escapeHtml(text: string): string {\n  return text\n    .replaceAll(\'&\', \'&amp;\')\n    .replaceAll(\'<\', \'&lt;\')\n    .replaceAll(\'>\', \'&gt;\')\n    .replaceAll(\'"\', \'&quot;\')\n    .replaceAll("\'", \'&#39;\');\n}\n\nfunction serializeEntryVersionForDiff(view: EntryVersionView | null): string {\n  if (!view) {\n    return \'\';\n  }\n  const entry = view.entry;\n  const payload = {\n    uid: entry.uid,\n    name: entry.name,\n    enabled: entry.enabled,\n    strategy: entry.strategy,\n    position: entry.position,\n    probability: entry.probability,\n    recursion: entry.recursion,\n    effect: entry.effect,\n    content: entry.content,\n    extra: entry.extra ?? null,\n  };\n  return JSON.stringify(payload, null, 2);\n}\n\nfunction serializeWorldbookVersionForDiff(view: WorldbookVersionView | null): string {\n  if (!view) {\n    return \'\';\n  }\n  const entries = view.entries\n    .map(entry => ({\n      uid: entry.uid,\n      name: entry.name,\n      enabled: entry.enabled,\n      type: entry.strategy.type,\n      keys: entry.strategy.keys.map(stringifyKeyword),\n      position: entry.position,\n      probability: entry.probability,\n      content: entry.content,\n    }))\n    .sort((left, right) => left.uid - right.uid);\n  return JSON.stringify({ entries }, null, 2);\n}\n\nfunction buildDiffHtml(leftText: string, rightText: string): { leftHtml: string; rightHtml: string } {\n  const leftRendered: string[] = [];\n  const rightRendered: string[] = [];\n  let leftLineNo = 1;\n  let rightLineNo = 1;\n  const parts = diffLines(leftText, rightText);\n\n  for (const part of parts as Array<{ value: string; added?: boolean; removed?: boolean }>) {\n    const lines = part.value.split(\'\\n\');\n    if (lines.length && lines[lines.length - 1] === \'\') {\n      lines.pop();\n    }\n    if (!lines.length) {\n      continue;\n    }\n\n    if (part.added) {\n      for (const line of lines) {\n        leftRendered.push(`<div class="diff-row empty"><span class="line-no"></span><span class="line-text">&nbsp;</span></div>`);\n        rightRendered.push(\n          `<div class="diff-row add"><span class="line-no">${rightLineNo}</span><span class="line-text">${escapeHtml(line) || \'&nbsp;\'}</span></div>`,\n        );\n        rightLineNo += 1;\n      }\n      continue;\n    }\n\n    if (part.removed) {\n      for (const line of lines) {\n        leftRendered.push(\n          `<div class="diff-row del"><span class="line-no">${leftLineNo}</span><span class="line-text">${escapeHtml(line) || \'&nbsp;\'}</span></div>`,\n        );\n        rightRendered.push(`<div class="diff-row empty"><span class="line-no"></span><span class="line-text">&nbsp;</span></div>`);\n        leftLineNo += 1;\n      }\n      continue;\n    }\n\n    for (const line of lines) {\n      const safe = escapeHtml(line) || \'&nbsp;\';\n      leftRendered.push(`<div class="diff-row"><span class="line-no">${leftLineNo}</span><span class="line-text">${safe}</span></div>`);\n      rightRendered.push(`<div class="diff-row"><span class="line-no">${rightLineNo}</span><span class="line-text">${safe}</span></div>`);\n      leftLineNo += 1;\n      rightLineNo += 1;\n    }\n  }\n\n  return {\n    leftHtml: leftRendered.join(\'\'),\n    rightHtml: rightRendered.join(\'\'),\n  };\n}\n\nfunction parseBatchExcludeTokens(value: string): string[] {\n  const seen = new Set<string>();\n  const tokens: string[] = [];\n  for (const raw of value.split(/[\\n,]/g)) {\n    const token = raw.trim().toLowerCase();\n    if (!token || seen.has(token)) {\n      continue;\n    }\n    seen.add(token);\n    tokens.push(token);\n  }\n  return tokens;\n}\n\nfunction shouldExcludeEntryForBatch(entry: WorldbookEntry, tokens: string[]): boolean {\n  if (!tokens.length) {\n    return false;\n  }\n  const name = entry.name.toLowerCase();\n  const keys = entry.strategy.keys.map(key => stringifyKeyword(key).toLowerCase()).join(\' \');\n\n  for (const token of tokens) {\n    const uidMatch = token.match(/^(?:#|uid:)?(\\d+)$/);\n    if (uidMatch && Number(uidMatch[1]) === entry.uid) {\n      return true;\n    }\n\n    const plain = token.replace(/^name:/, \'\').trim();\n    if (plain && (name.includes(plain) || keys.includes(plain))) {\n      return true;\n    }\n  }\n  return false;\n}\n\nfunction ensureSelectedEntryExists(): void {\n  if (!draftEntries.value.length) {\n    selectedEntryUid.value = null;\n    return;\n  }\n  if (selectedEntryUid.value === null) {\n    selectedEntryUid.value = draftEntries.value[0].uid;\n    return;\n  }\n  const exists = draftEntries.value.some(entry => entry.uid === selectedEntryUid.value);\n  if (!exists) {\n    selectedEntryUid.value = draftEntries.value[0].uid;\n  }\n}\n\nfunction selectEntry(uid: number): void {\n  selectedEntryUid.value = uid;\n}\n\nfunction createEntrySnapshotRecord(\n  label: string,\n  uid: number,\n  name: string,\n  entry: WorldbookEntry,\n): EntrySnapshot {\n  return {\n    id: createId(\'entry-snapshot\'),\n    label,\n    ts: Date.now(),\n    uid,\n    name: name || `Êù°ÁõÆ ${uid}`,\n    entry: normalizeEntry(klona(entry), uid),\n  };\n}\n\nfunction pushEntrySnapshotsBulk(\n  items: Array<{\n    label: string;\n    uid: number;\n    name: string;\n    entry: WorldbookEntry;\n  }>,\n): number {\n  if (!selectedWorldbookName.value || !items.length) {\n    return 0;\n  }\n\n  let added = 0;\n  const worldbookName = selectedWorldbookName.value;\n\n  updatePersistedState(state => {\n    const byWorldbook = state.entry_history[worldbookName] ?? {};\n\n    for (const item of items) {\n      const uidKey = String(item.uid);\n      const incoming = createEntrySnapshotRecord(item.label, item.uid, item.name, item.entry);\n      const list = byWorldbook[uidKey] ?? [];\n\n      if (list[0] && JSON.stringify(list[0].entry) === JSON.stringify(incoming.entry)) {\n        continue;\n      }\n\n      list.unshift(incoming);\n      if (list.length > ENTRY_HISTORY_LIMIT) {\n        list.length = ENTRY_HISTORY_LIMIT;\n      }\n      byWorldbook[uidKey] = list;\n      added += 1;\n    }\n\n    state.entry_history[worldbookName] = byWorldbook;\n  });\n\n  return added;\n}\n\nfunction pushEntrySnapshot(label: string, entry: WorldbookEntry): boolean {\n  const added = pushEntrySnapshotsBulk([\n    {\n      label,\n      uid: entry.uid,\n      name: entry.name,\n      entry,\n    },\n  ]);\n  return added > 0;\n}\n\nfunction collectEntrySnapshotsBeforeSave(): Array<{\n  label: string;\n  uid: number;\n  name: string;\n  entry: WorldbookEntry;\n}> {\n  const result: Array<{\n    label: string;\n    uid: number;\n    name: string;\n    entry: WorldbookEntry;\n  }> = [];\n  const draftByUid = new Map<number, WorldbookEntry>();\n  draftEntries.value.forEach(entry => {\n    draftByUid.set(entry.uid, entry);\n  });\n\n  for (const previous of originalEntries.value) {\n    const current = draftByUid.get(previous.uid);\n    if (!current) {\n      result.push({\n        label: \'‰øùÂ≠òÂâçÔºàÂà†Èô§ÂâçÔºâ\',\n        uid: previous.uid,\n        name: previous.name,\n        entry: previous,\n      });\n      continue;\n    }\n    if (JSON.stringify(previous) !== JSON.stringify(current)) {\n      result.push({\n        label: \'‰øùÂ≠òÂâç\',\n        uid: previous.uid,\n        name: previous.name,\n        entry: previous,\n      });\n    }\n  }\n\n  return result;\n}\n\nfunction pushSnapshot(label: string): void {\n  if (!selectedWorldbookName.value) {\n    return;\n  }\n  const worldbookName = selectedWorldbookName.value;\n  const snapshot: WorldbookSnapshot = {\n    id: createId(\'snapshot\'),\n    label,\n    ts: Date.now(),\n    entries: klona(draftEntries.value),\n  };\n\n  updatePersistedState(state => {\n    const list = state.history[worldbookName] ?? [];\n    list.unshift(snapshot);\n    if (list.length > HISTORY_LIMIT) {\n      list.length = HISTORY_LIMIT;\n    }\n    state.history[worldbookName] = list;\n  });\n}\n\nfunction createManualSnapshot(): void {\n  if (!selectedWorldbookName.value) {\n    toastr.warning(\'ËØ∑ÂÖàÈÄâÊã©‰∏ñÁïå‰π¶\');\n    return;\n  }\n  pushSnapshot(\'ÊâãÂä®Âø´ÁÖß\');\n  toastr.success(\'Â∑≤ÂàõÂª∫Âø´ÁÖß\');\n}\n\nfunction openEntryHistoryModal(): void {\n  if (!selectedEntry.value) {\n    toastr.warning(\'ËØ∑ÂÖàÈÄâÊã©Êù°ÁõÆ\');\n    return;\n  }\n  const nonCurrent = entryVersionViews.value.find(item => !item.isCurrent) ?? null;\n  entryHistoryRightId.value = \'__current__\';\n  entryHistoryLeftId.value = nonCurrent?.id ?? \'__current__\';\n  showEntryHistoryModal.value = true;\n}\n\nfunction openWorldbookHistoryModal(): void {\n  if (!selectedWorldbookName.value) {\n    toastr.warning(\'ËØ∑ÂÖàÈÄâÊã©‰∏ñÁïå‰π¶\');\n    return;\n  }\n  const nonCurrent = worldbookVersionViews.value.find(item => !item.isCurrent) ?? null;\n  worldbookHistoryRightId.value = \'__current__\';\n  worldbookHistoryLeftId.value = nonCurrent?.id ?? \'__current__\';\n  showWorldbookHistoryModal.value = true;\n}\n\nfunction createManualEntrySnapshot(): void {\n  if (!selectedEntry.value) {\n    toastr.warning(\'ËØ∑ÂÖàÈÄâÊã©Êù°ÁõÆ\');\n    return;\n  }\n  const added = pushEntrySnapshot(\'ÊâãÂä®Êù°ÁõÆÂø´ÁÖß\', selectedEntry.value);\n  if (added) {\n    toastr.success(\'Â∑≤ËÆ∞ÂΩïÂΩìÂâçÊù°ÁõÆÂø´ÁÖß\');\n  } else {\n    toastr.info(\'ÂΩìÂâçÊù°ÁõÆ‰∏éÊúÄËøëÂø´ÁÖß‰∏ÄËá¥ÔºåÊú™ÈáçÂ§çËÆ∞ÂΩï\');\n  }\n}\n\nfunction restoreSnapshot(snapshotId: string): void {\n  const snapshot = snapshotsForCurrent.value.find(item => item.id === snapshotId);\n  if (!snapshot) {\n    return;\n  }\n  if (!confirm(`ÂõûÊªöÂà∞Âø´ÁÖß "${snapshot.label}" ? ÂΩìÂâçÊú™‰øùÂ≠ò‰øÆÊîπ‰ºöË¢´Ë¶ÜÁõñ„ÄÇ`)) {\n    return;\n  }\n  draftEntries.value = normalizeEntryList(snapshot.entries);\n  ensureSelectedEntryExists();\n  setStatus(`Â∑≤ÂõûÊªöÂà∞Âø´ÁÖßÔºö${snapshot.label}`);\n}\n\nfunction restoreWorldbookFromLeftHistory(): void {\n  const target = selectedWorldbookHistoryLeft.value;\n  if (!target || target.isCurrent) {\n    return;\n  }\n  if (!confirm(`ÊÅ¢Â§çÂà∞ Left ÁâàÊú¨ "${target.label}" ? ÂΩìÂâçÊú™‰øùÂ≠ò‰øÆÊîπ‰ºöË¢´Ë¶ÜÁõñ„ÄÇ`)) {\n    return;\n  }\n  draftEntries.value = normalizeEntryList(klona(target.entries));\n  ensureSelectedEntryExists();\n  setStatus(`Â∑≤‰ªéÊó∂ÂÖâÊú∫ÊÅ¢Â§çÔºö${target.label}`);\n  toastr.success(\'Â∑≤ÊÅ¢Â§çÊï¥Êú¨‰∏ñÁïå‰π¶Âà∞ Left ÁâàÊú¨\');\n}\n\nfunction deleteSnapshot(snapshotId: string): void {\n  if (!selectedWorldbookName.value) {\n    return;\n  }\n  updatePersistedState(state => {\n    const list = state.history[selectedWorldbookName.value] ?? [];\n    state.history[selectedWorldbookName.value] = list.filter(item => item.id !== snapshotId);\n  });\n}\n\nfunction clearCurrentSnapshots(): void {\n  if (!selectedWorldbookName.value || !snapshotsForCurrent.value.length) {\n    return;\n  }\n  if (!confirm(`Ê∏ÖÁ©∫ "${selectedWorldbookName.value}" ÁöÑÂÖ®ÈÉ®Âø´ÁÖßÔºü`)) {\n    return;\n  }\n  updatePersistedState(state => {\n    delete state.history[selectedWorldbookName.value];\n  });\n}\n\nfunction restoreEntrySnapshot(snapshotId: string): void {\n  if (!selectedEntry.value || selectedEntryIndex.value < 0) {\n    return;\n  }\n  const snapshot = entrySnapshotsForSelected.value.find(item => item.id === snapshotId);\n  if (!snapshot) {\n    return;\n  }\n  if (!confirm(`ÂõûÊªöÂΩìÂâçÊù°ÁõÆÂà∞Âø´ÁÖß "${snapshot.label}" ?`)) {\n    return;\n  }\n\n  // ÂõûÊªöÂâçËá™Âä®Áïô‰∏Ä‰ªΩÔºå‰æø‰∫éÊí§Âõû\n  pushEntrySnapshot(\'ÂõûÊªöÂâçËá™Âä®Âø´ÁÖß\', selectedEntry.value);\n\n  const restored = normalizeEntry(klona(snapshot.entry), selectedEntry.value.uid);\n  restored.uid = selectedEntry.value.uid;\n  draftEntries.value.splice(selectedEntryIndex.value, 1, restored);\n  selectedEntryUid.value = restored.uid;\n  setStatus(`Â∑≤ÂõûÊªöÊù°ÁõÆÂà∞Âø´ÁÖßÔºö${snapshot.label}`);\n  toastr.success(\'Â∑≤ÊÅ¢Â§çÊù°ÁõÆÂø´ÁÖß\');\n}\n\nfunction restoreEntryFromLeftHistory(): void {\n  const target = selectedEntryHistoryLeft.value;\n  if (!target || target.isCurrent) {\n    return;\n  }\n  if (!selectedEntry.value || selectedEntryIndex.value < 0) {\n    return;\n  }\n  if (!confirm(`ÂõûÊªöÂΩìÂâçÊù°ÁõÆÂà∞ "${target.label}" ?`)) {\n    return;\n  }\n  pushEntrySnapshot(\'ÂõûÊªöÂâçËá™Âä®Âø´ÁÖß\', selectedEntry.value);\n  const restored = normalizeEntry(klona(target.entry), selectedEntry.value.uid);\n  restored.uid = selectedEntry.value.uid;\n  draftEntries.value.splice(selectedEntryIndex.value, 1, restored);\n  selectedEntryUid.value = restored.uid;\n  setStatus(`Â∑≤‰ªéÊù°ÁõÆÊó∂ÂÖâÊú∫ÊÅ¢Â§çÔºö${target.label}`);\n  toastr.success(\'Â∑≤ÊÅ¢Â§çÊù°ÁõÆÂà∞ Left ÁâàÊú¨\');\n}\n\nfunction deleteEntrySnapshot(snapshotId: string): void {\n  if (!selectedWorldbookName.value || !selectedEntry.value) {\n    return;\n  }\n  const worldbookName = selectedWorldbookName.value;\n  const uidKey = String(selectedEntry.value.uid);\n  updatePersistedState(state => {\n    const byWorldbook = state.entry_history[worldbookName] ?? {};\n    const list = byWorldbook[uidKey] ?? [];\n    byWorldbook[uidKey] = list.filter(item => item.id !== snapshotId);\n    state.entry_history[worldbookName] = byWorldbook;\n  });\n}\n\nfunction clearCurrentEntrySnapshots(): void {\n  if (!selectedWorldbookName.value || !selectedEntry.value || !entrySnapshotsForSelected.value.length) {\n    return;\n  }\n  if (!confirm(`Ê∏ÖÁ©∫Êù°ÁõÆ #${selectedEntry.value.uid} ÁöÑÂéÜÂè≤Âø´ÁÖßÔºü`)) {\n    return;\n  }\n  const worldbookName = selectedWorldbookName.value;\n  const uidKey = String(selectedEntry.value.uid);\n  updatePersistedState(state => {\n    const byWorldbook = state.entry_history[worldbookName] ?? {};\n    delete byWorldbook[uidKey];\n    state.entry_history[worldbookName] = byWorldbook;\n  });\n}\n\nfunction copySelectedEntryToClipboard(): void {\n  if (!selectedEntry.value) {\n    return;\n  }\n  const item: ClipboardItem = {\n    id: createId(\'clip\'),\n    copied_at: Date.now(),\n    name: selectedEntry.value.name,\n    entry: normalizeEntry(klona(selectedEntry.value), selectedEntry.value.uid),\n  };\n  updatePersistedState(state => {\n    state.clipboard.unshift(item);\n    if (state.clipboard.length > CLIPBOARD_LIMIT) {\n      state.clipboard.length = CLIPBOARD_LIMIT;\n    }\n  });\n  toastr.success(\'Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø\');\n}\n\nfunction pasteClipboardItem(itemId: string): void {\n  const item = clipboardItems.value.find(entry => entry.id === itemId);\n  if (!item) {\n    return;\n  }\n  const insertIndex = selectedEntryIndex.value >= 0 ? selectedEntryIndex.value + 1 : draftEntries.value.length;\n  const uid = getNextUid(draftEntries.value);\n  const cloned = normalizeEntry(klona(item.entry), uid);\n  cloned.uid = uid;\n  draftEntries.value.splice(insertIndex, 0, cloned);\n  selectedEntryUid.value = cloned.uid;\n  setStatus(`Â∑≤Á≤òË¥¥Êù°ÁõÆ "${cloned.name}"`);\n}\n\nfunction deleteClipboardItem(itemId: string): void {\n  updatePersistedState(state => {\n    state.clipboard = state.clipboard.filter(entry => entry.id !== itemId);\n  });\n}\n\nfunction clearClipboard(): void {\n  if (!clipboardItems.value.length) {\n    return;\n  }\n  if (!confirm(\'Á°ÆÂÆöÊ∏ÖÁ©∫Ââ™Ë¥¥ÊùøÔºü\')) {\n    return;\n  }\n  updatePersistedState(state => {\n    state.clipboard = [];\n  });\n}\n\nfunction handleSelectedPositionTypeChanged(): void {\n  if (!selectedEntry.value) {\n    return;\n  }\n  if (selectedEntry.value.position.type !== \'at_depth\') {\n    selectedEntry.value.position.role = \'system\';\n    selectedEntry.value.position.depth = 4;\n  }\n}\n\nfunction applyExtraJson(): void {\n  if (!selectedEntry.value) {\n    return;\n  }\n  const text = selectedExtraText.value.trim();\n  if (!text) {\n    selectedEntry.value.extra = undefined;\n    return;\n  }\n  try {\n    const parsed = JSON.parse(text);\n    const parsedRecord = asRecord(parsed);\n    if (!parsedRecord) {\n      throw new Error(\'extra ÂøÖÈ°ªÊòØ JSON ÂØπË±°\');\n    }\n    selectedEntry.value.extra = klona(parsedRecord);\n    toastr.success(\'extra Â∑≤Â∫îÁî®\');\n  } catch (error) {\n    toastr.error(`extra JSON Ëß£ÊûêÂ§±Ë¥•: ${error instanceof Error ? error.message : String(error)}`);\n  }\n}\n\nfunction clearExtra(): void {\n  if (!selectedEntry.value) {\n    return;\n  }\n  selectedEntry.value.extra = undefined;\n  selectedExtraText.value = \'\';\n}\n\nfunction addEntry(): void {\n  const uid = getNextUid(draftEntries.value);\n  const entry = createDefaultEntry(uid);\n  draftEntries.value.push(entry);\n  selectedEntryUid.value = uid;\n  setStatus(`Â∑≤Êñ∞Â¢ûÊù°ÁõÆ #${uid}`);\n}\n\nfunction duplicateSelectedEntry(): void {\n  if (!selectedEntry.value || selectedEntryIndex.value < 0) {\n    return;\n  }\n  const uid = getNextUid(draftEntries.value);\n  const duplicated = normalizeEntry(klona(selectedEntry.value), uid);\n  duplicated.uid = uid;\n  duplicated.name = `${duplicated.name} (ÂâØÊú¨)`;\n  draftEntries.value.splice(selectedEntryIndex.value + 1, 0, duplicated);\n  selectedEntryUid.value = uid;\n  setStatus(`Â∑≤Â§çÂà∂Êù°ÁõÆ #${selectedEntry.value.uid}`);\n}\n\nfunction removeSelectedEntry(): void {\n  if (!selectedEntry.value || selectedEntryIndex.value < 0) {\n    return;\n  }\n  if (!confirm(`Á°ÆÂÆöÂà†Èô§Êù°ÁõÆ "${selectedEntry.value.name}" ?`)) {\n    return;\n  }\n  pushEntrySnapshot(\'Âà†Èô§ÂâçÂø´ÁÖß\', selectedEntry.value);\n  draftEntries.value.splice(selectedEntryIndex.value, 1);\n  ensureSelectedEntryExists();\n  setStatus(\'Â∑≤Âà†Èô§Êù°ÁõÆ\');\n}\n\nfunction moveSelectedEntry(direction: -1 | 1): void {\n  if (selectedEntryIndex.value < 0) {\n    return;\n  }\n  const target = selectedEntryIndex.value + direction;\n  if (target < 0 || target >= draftEntries.value.length) {\n    return;\n  }\n  const [entry] = draftEntries.value.splice(selectedEntryIndex.value, 1);\n  draftEntries.value.splice(target, 0, entry);\n  selectedEntryUid.value = entry.uid;\n}\n\nfunction normalizeAllEntries(): void {\n  draftEntries.value = normalizeEntryList(draftEntries.value.map(entry => klona(entry)));\n  ensureSelectedEntryExists();\n  setStatus(\'Â∑≤ÂÆåÊàêÊù°ÁõÆÊ†áÂáÜÂåñ\');\n}\n\nfunction sortEntriesByOrderDesc(): void {\n  draftEntries.value.sort((left, right) => right.position.order - left.position.order);\n  ensureSelectedEntryExists();\n  setStatus(\'Â∑≤Êåâ order ÈôçÂ∫èÊéíÂàó\');\n}\n\nfunction setEnabledForAll(enabled: boolean): void {\n  draftEntries.value.forEach(entry => {\n    entry.enabled = enabled;\n  });\n  setStatus(enabled ? \'Â∑≤ÂêØÁî®ÂÖ®ÈÉ®Êù°ÁõÆ\' : \'Â∑≤Á¶ÅÁî®ÂÖ®ÈÉ®Êù°ÁõÆ\');\n}\n\nfunction applyBatchReplace(): void {\n  const findText = batchFindText.value;\n  if (!findText) {\n    toastr.warning(\'ËØ∑ÂÖàËæìÂÖ•Êü•ÊâæÊñáÊú¨\');\n    return;\n  }\n  const excludeTokens = parseBatchExcludeTokens(batchExcludeText.value);\n\n  let regex: RegExp | null = null;\n  if (batchUseRegex.value) {\n    try {\n      regex = new RegExp(findText, \'g\');\n    } catch (error) {\n      toastr.error(`Ê≠£ÂàôË°®ËææÂºèÊó†Êïà: ${error instanceof Error ? error.message : String(error)}`);\n      return;\n    }\n  }\n\n  let touched = 0;\n  let skipped = 0;\n  for (const entry of draftEntries.value) {\n    if (shouldExcludeEntryForBatch(entry, excludeTokens)) {\n      skipped += 1;\n      continue;\n    }\n\n    let changed = false;\n\n    if (batchInName.value) {\n      const next = regex\n        ? entry.name.replace(regex, batchReplaceText.value)\n        : entry.name.split(findText).join(batchReplaceText.value);\n      if (next !== entry.name) {\n        entry.name = next;\n        changed = true;\n      }\n    }\n\n    if (batchInContent.value) {\n      const next = regex\n        ? entry.content.replace(regex, batchReplaceText.value)\n        : entry.content.split(findText).join(batchReplaceText.value);\n      if (next !== entry.content) {\n        entry.content = next;\n        changed = true;\n      }\n    }\n\n    if (batchInKeys.value) {\n      const nextKeys = entry.strategy.keys.map(key => {\n        const text = stringifyKeyword(key);\n        return regex ? text.replace(regex, batchReplaceText.value) : text.split(findText).join(batchReplaceText.value);\n      });\n      const normalized = normalizeKeywordList(nextKeys);\n      if (\n        JSON.stringify(normalized.map(stringifyKeyword)) !== JSON.stringify(entry.strategy.keys.map(stringifyKeyword))\n      ) {\n        entry.strategy.keys = normalized;\n        changed = true;\n      }\n    }\n\n    if (changed) {\n      touched += 1;\n    }\n  }\n\n  setStatus(`Êü•ÊâæÊõøÊç¢ÂÆåÊàêÔºå‰øÆÊîπ ${touched} Êù°ÔºåÊéíÈô§ ${skipped} Êù°`);\n}\n\nfunction downloadJson(filename: string, payload: unknown): void {\n  const text = JSON.stringify(payload, null, 2);\n  const blob = new Blob([text], { type: \'application/json\' });\n  const url = URL.createObjectURL(blob);\n  const anchor = document.createElement(\'a\');\n  anchor.href = url;\n  anchor.download = filename;\n  document.body.appendChild(anchor);\n  anchor.click();\n  document.body.removeChild(anchor);\n  URL.revokeObjectURL(url);\n}\n\nfunction exportCurrentWorldbook(): void {\n  if (!selectedWorldbookName.value) {\n    return;\n  }\n  const payload = {\n    format: \'worldbook_assistant_v1\',\n    name: selectedWorldbookName.value,\n    exported_at: new Date().toISOString(),\n    entries: draftEntries.value,\n  };\n  const filename = `${selectedWorldbookName.value.replace(/[\\\\/:*?"<>|]/g, \'_\')}.json`;\n  downloadJson(filename, payload);\n}\n\nfunction collectRawEntries(root: Record<string, unknown>): unknown[] {\n  if (Array.isArray(root.entries)) {\n    return root.entries;\n  }\n  const entriesMap = asRecord(root.entries);\n  if (entriesMap) {\n    return Object.values(entriesMap);\n  }\n  const dataRoot = asRecord(root.data);\n  if (dataRoot) {\n    if (Array.isArray(dataRoot.entries)) {\n      return dataRoot.entries;\n    }\n    const dataEntriesMap = asRecord(dataRoot.entries);\n    if (dataEntriesMap) {\n      return Object.values(dataEntriesMap);\n    }\n  }\n  return [];\n}\n\nfunction parseImportedPayload(fileName: string, text: string): ImportedPayload {\n  const parsed = JSON.parse(text) as unknown;\n  const fallbackName = fileName.replace(/\\.[^/.]+$/, \'\') || \'ÂØºÂÖ•‰∏ñÁïå‰π¶\';\n\n  if (Array.isArray(parsed)) {\n    return {\n      name: fallbackName,\n      entries: normalizeEntryList(parsed),\n    };\n  }\n\n  const root = asRecord(parsed);\n  if (!root) {\n    throw new Error(\'ÂØºÂÖ•ÂÜÖÂÆπÂøÖÈ°ªÊòØ JSON ÂØπË±°ÊàñÊï∞ÁªÑ\');\n  }\n\n  const entries = collectRawEntries(root);\n  if (!entries.length) {\n    throw new Error(\'Êú™ËØÜÂà´Âà∞ÊúâÊïàÁöÑ entries\');\n  }\n\n  const dataRoot = asRecord(root.data);\n  const nameCandidate = toStringSafe(root.name ?? dataRoot?.name, fallbackName).trim();\n\n  return {\n    name: nameCandidate || fallbackName,\n    entries: normalizeEntryList(entries),\n  };\n}\n\nfunction triggerImport(): void {\n  importFileInput.value?.click();\n}\n\nasync function onImportChange(event: Event): Promise<void> {\n  const target = event.target as HTMLInputElement | null;\n  const file = target?.files?.[0];\n  if (!file) {\n    return;\n  }\n\n  const fileText = await file.text();\n  try {\n    const payload = parseImportedPayload(file.name, fileText);\n    const suggested = payload.name || file.name.replace(/\\.[^/.]+$/, \'\');\n    const newNameRaw = prompt(\'ËØ∑ËæìÂÖ•Êñ∞‰∏ñÁïå‰π¶ÂêçÁß∞\', suggested);\n    const newName = toStringSafe(newNameRaw).trim();\n    if (!newName) {\n      return;\n    }\n    await createOrReplaceWorldbook(newName, payload.entries, { render: \'immediate\' });\n    await reloadWorldbookNames(newName);\n    await refreshBindings();\n    toastr.success(`Â∑≤ÂØºÂÖ•‰∏∫Êñ∞‰∏ñÁïå‰π¶: ${newName}`);\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    const shouldFallback = confirm(`Ëß£ÊûêÂØºÂÖ•Êñá‰ª∂Â§±Ë¥•: ${message}\\nÊòØÂê¶Â∞ùËØïÊåâÈÖíÈ¶ÜÂéüÁîüÊñπÂºèÂØºÂÖ•Ôºü`);\n    if (!shouldFallback) {\n      return;\n    }\n    const response = await importRawWorldbook(file.name, fileText);\n    if (!response.ok) {\n      throw new Error(`ÂéüÁîüÂØºÂÖ•Â§±Ë¥•: HTTP ${response.status}`);\n    }\n    await hardRefresh();\n    toastr.success(\'Â∑≤ÊåâÈÖíÈ¶ÜÂéüÁîüÊñπÂºèÂØºÂÖ•\');\n  } finally {\n    if (target) {\n      target.value = \'\';\n    }\n  }\n}\n\nasync function refreshBindings(): Promise<void> {\n  bindings.global = [...getGlobalWorldbookNames()];\n  try {\n    const charBindings = getCharWorldbookNames(\'current\');\n    bindings.charPrimary = charBindings.primary;\n    bindings.charAdditional = [...charBindings.additional];\n  } catch {\n    bindings.charPrimary = null;\n    bindings.charAdditional = [];\n  }\n\n  try {\n    bindings.chat = getChatWorldbookName(\'current\');\n  } catch {\n    bindings.chat = null;\n  }\n  if (globalWorldbookMode.value) {\n    ensureSelectionForGlobalMode();\n  }\n}\n\nfunction resolveContextWorldbookCandidate(): string | null {\n  const available = worldbookNames.value;\n  if (!available.length) {\n    return null;\n  }\n  const chatBound = toStringSafe(bindings.chat).trim();\n  if (chatBound && available.includes(chatBound)) {\n    return chatBound;\n  }\n  const charPrimary = toStringSafe(bindings.charPrimary).trim();\n  if (charPrimary && available.includes(charPrimary)) {\n    return charPrimary;\n  }\n  const charAdditional = bindings.charAdditional.find(name => available.includes(name));\n  return charAdditional ?? null;\n}\n\nfunction ensureSelectionForGlobalMode(): void {\n  if (!globalWorldbookMode.value) {\n    return;\n  }\n  const globals = selectableWorldbookNames.value;\n  if (!globals.length) {\n    selectedWorldbookName.value = \'\';\n    return;\n  }\n  if (!globals.includes(selectedWorldbookName.value)) {\n    selectedWorldbookName.value = globals[0];\n  }\n}\n\nfunction trySelectWorldbookByContext(options: { preferWhenEmptyOnly?: boolean; force?: boolean } = {}): boolean {\n  if (globalWorldbookMode.value) {\n    return false;\n  }\n  if (options.preferWhenEmptyOnly && selectedWorldbookName.value) {\n    return false;\n  }\n  const candidate = resolveContextWorldbookCandidate();\n  if (!candidate || candidate === selectedWorldbookName.value) {\n    return false;\n  }\n  if (!options.force && hasUnsavedChanges.value) {\n    setStatus(\'Ê£ÄÊµãÂà∞ËÅäÂ§©/ËßíËâ≤‰∏ñÁïå‰π¶ÂèòÊõ¥Ôºå‰ΩÜÂΩìÂâçÊúâÊú™‰øùÂ≠ò‰øÆÊîπÔºåÂ∑≤Ë∑≥ËøáËá™Âä®ÂàáÊç¢\');\n    return false;\n  }\n  selectedWorldbookName.value = candidate;\n  setStatus(`Â∑≤Ëá™Âä®ÂÆö‰ΩçÂà∞‰∏ä‰∏ãÊñá‰∏ñÁïå‰π¶: ${candidate}`);\n  return true;\n}\n\nfunction toggleGlobalMode(): void {\n  globalWorldbookMode.value = !globalWorldbookMode.value;\n  if (globalWorldbookMode.value) {\n    ensureSelectionForGlobalMode();\n    setStatus(\'Â∑≤ÂàáÊç¢Âà∞ÂÖ®Â±Ä‰∏ñÁïå‰π¶Ê®°Âºè\');\n    return;\n  }\n  if (!selectedWorldbookName.value) {\n    trySelectWorldbookByContext({ force: true });\n  }\n  setStatus(\'Â∑≤ÂàáÊç¢Âà∞‰∏ä‰∏ãÊñá‰∏ñÁïå‰π¶Ê®°Âºè\');\n}\n\nasync function applyGlobalWorldbooks(nextGlobal: string[], statusLabel = \'Â∑≤Êõ¥Êñ∞ÂÖ®Â±Ä‰∏ñÁïå‰π¶\'): Promise<boolean> {\n  const normalized = [...new Set(nextGlobal.map(name => name.trim()).filter(Boolean))].filter(name =>\n    worldbookNames.value.includes(name),\n  );\n  try {\n    await rebindGlobalWorldbooks(normalized);\n    await refreshBindings();\n    ensureSelectionForGlobalMode();\n    setStatus(`${statusLabel}Ôºà${normalized.length} Êú¨Ôºâ`);\n    return true;\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    toastr.error(`Êõ¥Êñ∞ÂÖ®Â±Ä‰∏ñÁïå‰π¶Â§±Ë¥•: ${message}`);\n    return false;\n  }\n}\n\nfunction addFirstGlobalCandidate(): void {\n  const first = globalAddCandidates.value[0];\n  if (!first) {\n    return;\n  }\n  void addGlobalWorldbook(first);\n}\n\nasync function addGlobalWorldbook(name: string): Promise<void> {\n  if (!name || bindings.global.includes(name)) {\n    return;\n  }\n  const success = await applyGlobalWorldbooks([...bindings.global, name], `Â∑≤Ê∑ªÂä†Âà∞ÂÖ®Â±Ä: ${name}`);\n  if (success) {\n    globalAddSearchText.value = \'\';\n  }\n}\n\nasync function removeGlobalWorldbook(name: string): Promise<void> {\n  if (!name || !bindings.global.includes(name)) {\n    return;\n  }\n  await applyGlobalWorldbooks(\n    bindings.global.filter(item => item !== name),\n    `Â∑≤ÁßªÂá∫ÂÖ®Â±Ä: ${name}`,\n  );\n}\n\nasync function clearGlobalWorldbooks(): Promise<void> {\n  if (!bindings.global.length) {\n    return;\n  }\n  if (!confirm(\'Á°ÆÂÆöÊ∏ÖÁ©∫ÊâÄÊúâÂÖ®Â±Ä‰∏ñÁïå‰π¶ÂêóÔºü\')) {\n    return;\n  }\n  await applyGlobalWorldbooks([], \'Â∑≤Ê∏ÖÁ©∫ÂÖ®Â±Ä‰∏ñÁïå‰π¶\');\n}\n\nasync function loadWorldbook(name: string): Promise<void> {\n  if (!name) {\n    return;\n  }\n  isBusy.value = true;\n  try {\n    const rawEntries = await getWorldbook(name);\n    const normalized = normalizeEntryList(rawEntries);\n    draftEntries.value = klona(normalized);\n    originalEntries.value = klona(normalized);\n    ensureSelectedEntryExists();\n    setStatus(`Â∑≤Âä†ËΩΩ "${name}"ÔºåÊù°ÁõÆ ${normalized.length}`);\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    toastr.error(`ËØªÂèñ‰∏ñÁïå‰π¶Â§±Ë¥•: ${message}`);\n    setStatus(`ËØªÂèñÂ§±Ë¥•: ${message}`);\n  } finally {\n    isBusy.value = false;\n  }\n}\n\nasync function reloadWorldbookNames(preferred?: string): Promise<void> {\n  const names = [...getWorldbookNames()].sort((left, right) => left.localeCompare(right, \'zh-Hans-CN\'));\n  worldbookNames.value = names;\n\n  if (!names.length) {\n    selectedWorldbookName.value = \'\';\n    draftEntries.value = [];\n    originalEntries.value = [];\n    selectedEntryUid.value = null;\n    return;\n  }\n\n  const fallbackName = persistedState.value.last_worldbook;\n  const candidate =\n    (preferred && names.includes(preferred) && preferred) ||\n    (fallbackName && names.includes(fallbackName) && fallbackName) ||\n    selectedWorldbookName.value ||\n    names[0];\n\n  if (candidate && selectedWorldbookName.value !== candidate) {\n    selectedWorldbookName.value = candidate;\n    return;\n  }\n\n  if (selectedWorldbookName.value && !draftEntries.value.length) {\n    await loadWorldbook(selectedWorldbookName.value);\n  }\n}\n\nasync function hardRefresh(): Promise<void> {\n  persistedState.value = readPersistedState();\n  await reloadWorldbookNames(selectedWorldbookName.value || undefined);\n  await refreshBindings();\n  if (globalWorldbookMode.value) {\n    ensureSelectionForGlobalMode();\n  } else {\n    trySelectWorldbookByContext({ preferWhenEmptyOnly: true });\n  }\n  setStatus(\'Â∑≤Âà∑Êñ∞‰∏ñÁïå‰π¶ÂíåÁªëÂÆö‰ø°ÊÅØ\');\n}\n\nasync function saveCurrentWorldbook(): Promise<void> {\n  if (!selectedWorldbookName.value) {\n    toastr.warning(\'ËØ∑ÂÖàÈÄâÊã©‰∏ñÁïå‰π¶\');\n    return;\n  }\n  if (!hasUnsavedChanges.value) {\n    setStatus(\'ÂΩìÂâçÊ≤°ÊúâÈúÄË¶Å‰øùÂ≠òÁöÑ‰øÆÊîπ\');\n    return;\n  }\n  isSaving.value = true;\n  try {\n    draftEntries.value = normalizeEntryList(draftEntries.value.map(entry => klona(entry)));\n    const pendingEntrySnapshots = collectEntrySnapshotsBeforeSave();\n    const savedEntrySnapshotCount = pushEntrySnapshotsBulk(pendingEntrySnapshots);\n    await replaceWorldbook(selectedWorldbookName.value, klona(draftEntries.value), { render: \'immediate\' });\n    originalEntries.value = klona(draftEntries.value);\n    pushSnapshot(\'‰øùÂ≠òÂêéÂø´ÁÖß\');\n    await refreshBindings();\n    toastr.success(`Â∑≤‰øùÂ≠ò: ${selectedWorldbookName.value}`);\n    setStatus(`‰øùÂ≠òÊàêÂäü: ${selectedWorldbookName.value}ÔºàÊù°ÁõÆÂéÜÂè≤ +${savedEntrySnapshotCount}Ôºâ`);\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    toastr.error(`‰øùÂ≠òÂ§±Ë¥•: ${message}`);\n    setStatus(`‰øùÂ≠òÂ§±Ë¥•: ${message}`);\n  } finally {\n    isSaving.value = false;\n  }\n}\n\nasync function createNewWorldbook(): Promise<void> {\n  const nameRaw = prompt(\'ËØ∑ËæìÂÖ•Êñ∞‰∏ñÁïå‰π¶ÂêçÁß∞\');\n  const name = toStringSafe(nameRaw).trim();\n  if (!name) {\n    return;\n  }\n  try {\n    await createOrReplaceWorldbook(name, [], { render: \'immediate\' });\n    await reloadWorldbookNames(name);\n    await refreshBindings();\n    toastr.success(`Â∑≤ÂàõÂª∫‰∏ñÁïå‰π¶: ${name}`);\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    toastr.error(`ÂàõÂª∫Â§±Ë¥•: ${message}`);\n  }\n}\n\nasync function duplicateWorldbook(): Promise<void> {\n  if (!selectedWorldbookName.value) {\n    return;\n  }\n  const suggested = `${selectedWorldbookName.value}_copy`;\n  const newNameRaw = prompt(\'ËØ∑ËæìÂÖ•Â§çÂà∂ÂêéÁöÑÂêçÁß∞\', suggested);\n  const newName = toStringSafe(newNameRaw).trim();\n  if (!newName) {\n    return;\n  }\n  try {\n    await createOrReplaceWorldbook(newName, klona(draftEntries.value), { render: \'immediate\' });\n    await reloadWorldbookNames(newName);\n    await refreshBindings();\n    toastr.success(`Â∑≤Â§çÂà∂‰∏∫: ${newName}`);\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    toastr.error(`Â§çÂà∂Â§±Ë¥•: ${message}`);\n  }\n}\n\nasync function deleteCurrentWorldbook(): Promise<void> {\n  if (!selectedWorldbookName.value) {\n    return;\n  }\n  const current = selectedWorldbookName.value;\n  if (!confirm(`Á°ÆÂÆöÂà†Èô§‰∏ñÁïå‰π¶ "${current}" ?`)) {\n    return;\n  }\n  try {\n    const success = await deleteWorldbook(current);\n    if (!success) {\n      throw new Error(\'ËøîÂõû false\');\n    }\n    updatePersistedState(state => {\n      delete state.history[current];\n      delete state.entry_history[current];\n    });\n    toastr.success(`Â∑≤Âà†Èô§: ${current}`);\n    await reloadWorldbookNames();\n    await refreshBindings();\n  } catch (error) {\n    const message = error instanceof Error ? error.message : String(error);\n    toastr.error(`Âà†Èô§Â§±Ë¥•: ${message}`);\n  }\n}\n\nasync function toggleGlobalBinding(): Promise<void> {\n  if (!selectedWorldbookName.value) {\n    return;\n  }\n  const next = new Set(getGlobalWorldbookNames());\n  if (next.has(selectedWorldbookName.value)) {\n    next.delete(selectedWorldbookName.value);\n  } else {\n    next.add(selectedWorldbookName.value);\n  }\n  await applyGlobalWorldbooks([...next], \'Â∑≤Êõ¥Êñ∞ÂÖ®Â±ÄÁªëÂÆö\');\n}\n\nfunction pushActivationLogs(entries: Array<{ world: string } & Record<string, unknown>>): void {\n  const logs = entries.map(item => {\n    const uid = item.uid ?? item.displayIndex ?? \'?\';\n    const name = toStringSafe(item.name ?? item.comment, `UID ${uid}`);\n    const content = toStringSafe(item.content).replace(/\\s+/g, \' \').trim().slice(0, 80);\n    return {\n      id: createId(\'activation\'),\n      time: Date.now(),\n      world: toStringSafe(item.world, \'unknown\'),\n      uid: typeof uid === \'number\' || typeof uid === \'string\' ? uid : \'?\',\n      name,\n      contentPreview: content || \'(Á©∫ÂÜÖÂÆπ)\',\n    } satisfies ActivationLog;\n  });\n  activationLogs.value.unshift(...logs);\n  if (activationLogs.value.length > ACTIVATION_LOG_LIMIT) {\n    activationLogs.value.length = ACTIVATION_LOG_LIMIT;\n  }\n}\n\nfunction clearActivationLogs(): void {\n  activationLogs.value = [];\n}\n\nfunction resolveHostWindow(): Window {\n  return mainLayoutRef.value?.ownerDocument?.defaultView ?? editorShellRef.value?.ownerDocument?.defaultView ?? window;\n}\n\nfunction clampFloatingPanelToViewport(panel: FloatingPanelState): void {\n  const hostWin = resolveHostWindow();\n  const viewportWidth = hostWin.innerWidth;\n  const viewportHeight = hostWin.innerHeight;\n  const maxX = Math.max(8, viewportWidth - panel.width - 8);\n  const maxY = Math.max(8, viewportHeight - 68);\n  panel.x = clampNumber(panel.x, 8, maxX);\n  panel.y = clampNumber(panel.y, 8, maxY);\n}\n\nfunction handleFloatingWindowResize(): void {\n  viewportWidth.value = resolveHostWindow().innerWidth;\n  clampPaneWidths();\n  for (const key of floatingPanelKeys) {\n    if (!floatingPanels[key].visible) {\n      continue;\n    }\n    clampFloatingPanelToViewport(floatingPanels[key]);\n  }\n}\n\nfunction bringFloatingToFront(key: FloatingPanelKey): void {\n  floatingZCounter.value += 1;\n  floatingPanels[key].z = floatingZCounter.value;\n}\n\nfunction openFloatingPanel(key: FloatingPanelKey): void {\n  const panel = floatingPanels[key];\n  panel.visible = true;\n  clampFloatingPanelToViewport(panel);\n  bringFloatingToFront(key);\n}\n\nfunction closeFloatingPanel(key: FloatingPanelKey): void {\n  floatingPanels[key].visible = false;\n  if (activeFloatingDrag.value?.key === key) {\n    stopFloatingDrag();\n  }\n}\n\nfunction toggleFloatingPanel(key: FloatingPanelKey): void {\n  if (floatingPanels[key].visible) {\n    closeFloatingPanel(key);\n    return;\n  }\n  openFloatingPanel(key);\n}\n\nfunction getFloatingPanelStyle(key: FloatingPanelKey): Record<string, string> {\n  const panel = floatingPanels[key];\n  return {\n    left: `${panel.x}px`,\n    top: `${panel.y}px`,\n    zIndex: String(panel.z),\n    width: `${panel.width}px`,\n  };\n}\n\nfunction startFloatingDrag(key: FloatingPanelKey, event: PointerEvent): void {\n  if (event.pointerType === \'mouse\' && event.button !== 0) {\n    return;\n  }\n  const panel = floatingPanels[key];\n  const target = event.currentTarget as HTMLElement | null;\n  if (!target) {\n    return;\n  }\n  const hostDoc = target.ownerDocument ?? document;\n  const hostWin = hostDoc.defaultView ?? window;\n  const rect = target.getBoundingClientRect();\n  bringFloatingToFront(key);\n  const dragState = {\n    key,\n    pointerId: event.pointerId,\n    offsetX: event.clientX - panel.x,\n    offsetY: event.clientY - panel.y,\n    doc: hostDoc,\n    win: hostWin,\n  };\n  activeFloatingDrag.value = dragState;\n  target.setPointerCapture?.(event.pointerId);\n  hostDoc.addEventListener(\'pointermove\', onFloatingDragMove);\n  hostDoc.addEventListener(\'pointerup\', stopFloatingDrag);\n  hostDoc.addEventListener(\'pointercancel\', stopFloatingDrag);\n  hostWin.addEventListener(\'blur\', stopFloatingDrag);\n  panel.x = clampNumber(event.clientX - dragState.offsetX, 8, Math.max(8, hostWin.innerWidth - panel.width - 8));\n  panel.y = clampNumber(event.clientY - dragState.offsetY, 8, Math.max(8, hostWin.innerHeight - rect.height - 8));\n  event.preventDefault();\n}\n\nfunction onFloatingDragMove(event: PointerEvent): void {\n  const drag = activeFloatingDrag.value;\n  if (!drag) {\n    return;\n  }\n  if (event.pointerId !== drag.pointerId) {\n    return;\n  }\n  const panel = floatingPanels[drag.key];\n  panel.x = clampNumber(event.clientX - drag.offsetX, 8, Math.max(8, drag.win.innerWidth - panel.width - 8));\n  panel.y = clampNumber(event.clientY - drag.offsetY, 8, Math.max(8, drag.win.innerHeight - 68));\n}\n\nfunction stopFloatingDrag(): void {\n  const drag = activeFloatingDrag.value;\n  if (drag) {\n    drag.doc.removeEventListener(\'pointermove\', onFloatingDragMove);\n    drag.doc.removeEventListener(\'pointerup\', stopFloatingDrag);\n    drag.doc.removeEventListener(\'pointercancel\', stopFloatingDrag);\n    drag.win.removeEventListener(\'blur\', stopFloatingDrag);\n  }\n  activeFloatingDrag.value = null;\n}\n\nfunction clampPaneWidths(): void {\n  if (isCompactLayout.value) {\n    return;\n  }\n\n  const mainRect = mainLayoutRef.value?.getBoundingClientRect();\n  if (mainRect) {\n    const maxLeft = Math.max(MAIN_PANE_MIN, Math.floor(mainRect.width - MAIN_EDITOR_MIN - RESIZE_HANDLE_SIZE));\n    mainPaneWidth.value = clampNumber(mainPaneWidth.value, MAIN_PANE_MIN, maxLeft);\n  }\n\n  const editorRect = editorShellRef.value?.getBoundingClientRect();\n  if (editorRect) {\n    const maxSide = Math.max(EDITOR_SIDE_MIN, Math.floor(editorRect.width - EDITOR_CENTER_MIN - RESIZE_HANDLE_SIZE));\n    editorSideWidth.value = clampNumber(editorSideWidth.value, EDITOR_SIDE_MIN, maxSide);\n  }\n}\n\nfunction startPaneResize(key: PaneResizeKey, event: PointerEvent): void {\n  if (isCompactLayout.value) {\n    return;\n  }\n  if (event.pointerType === \'mouse\' && event.button !== 0) {\n    return;\n  }\n  const target = event.currentTarget as HTMLElement | null;\n  const hostDoc = target?.ownerDocument ?? document;\n  const hostWin = hostDoc.defaultView ?? window;\n  paneResizeState.value = {\n    key,\n    pointerId: event.pointerId,\n    doc: hostDoc,\n    win: hostWin,\n  };\n  target?.setPointerCapture?.(event.pointerId);\n  hostDoc.addEventListener(\'pointermove\', onPaneResizeMove);\n  hostDoc.addEventListener(\'pointerup\', stopPaneResize);\n  hostDoc.addEventListener(\'pointercancel\', stopPaneResize);\n  hostWin.addEventListener(\'blur\', stopPaneResize);\n  event.preventDefault();\n}\n\nfunction onPaneResizeMove(event: PointerEvent): void {\n  const state = paneResizeState.value;\n  if (!state || event.pointerId !== state.pointerId) {\n    return;\n  }\n  if (state.key === \'main\') {\n    const rect = mainLayoutRef.value?.getBoundingClientRect();\n    if (!rect) {\n      return;\n    }\n    const left = Math.floor(event.clientX - rect.left);\n    const maxLeft = Math.max(MAIN_PANE_MIN, Math.floor(rect.width - MAIN_EDITOR_MIN - RESIZE_HANDLE_SIZE));\n    mainPaneWidth.value = clampNumber(left, MAIN_PANE_MIN, maxLeft);\n    return;\n  }\n\n  const rect = editorShellRef.value?.getBoundingClientRect();\n  if (!rect) {\n    return;\n  }\n  const side = Math.floor(rect.right - event.clientX);\n  const maxSide = Math.max(EDITOR_SIDE_MIN, Math.floor(rect.width - EDITOR_CENTER_MIN - RESIZE_HANDLE_SIZE));\n  editorSideWidth.value = clampNumber(side, EDITOR_SIDE_MIN, maxSide);\n}\n\nfunction stopPaneResize(): void {\n  const state = paneResizeState.value;\n  if (state) {\n    state.doc.removeEventListener(\'pointermove\', onPaneResizeMove);\n    state.doc.removeEventListener(\'pointerup\', stopPaneResize);\n    state.doc.removeEventListener(\'pointercancel\', stopPaneResize);\n    state.win.removeEventListener(\'blur\', stopPaneResize);\n  }\n  paneResizeState.value = null;\n}\n\nfunction onPanelRefresh(): void {\n  void hardRefresh();\n}\n\nfunction onPanelSave(): void {\n  void saveCurrentWorldbook();\n}\n\nonMounted(() => {\n  persistedState.value = readPersistedState();\n\n  subscriptions.push(\n    eventOn(tavern_events.WORLD_INFO_ACTIVATED, entries => {\n      pushActivationLogs(entries as Array<{ world: string } & Record<string, unknown>>);\n    }),\n  );\n  subscriptions.push(\n    eventOn(tavern_events.WORLDINFO_UPDATED, () => {\n      void hardRefresh();\n    }),\n  );\n  subscriptions.push(\n    eventOn(tavern_events.CHAT_CHANGED, () => {\n      void (async () => {\n        await refreshBindings();\n        if (globalWorldbookMode.value) {\n          ensureSelectionForGlobalMode();\n          return;\n        }\n        trySelectWorldbookByContext();\n      })();\n    }),\n  );\n\n  window.addEventListener(\'wb-helper:refresh\', onPanelRefresh);\n  window.addEventListener(\'wb-helper:save\', onPanelSave);\n  hostResizeWindow.value = resolveHostWindow();\n  hostResizeWindow.value.addEventListener(\'resize\', handleFloatingWindowResize);\n\n  handleFloatingWindowResize();\n  void hardRefresh();\n});\n\nonUnmounted(() => {\n  const target = window as unknown as Record<string, unknown>;\n  target[DIRTY_STATE_KEY] = false;\n  subscriptions.forEach(subscription => {\n    subscription.stop();\n  });\n  stopFloatingDrag();\n  stopPaneResize();\n  window.removeEventListener(\'wb-helper:refresh\', onPanelRefresh);\n  window.removeEventListener(\'wb-helper:save\', onPanelSave);\n  hostResizeWindow.value?.removeEventListener(\'resize\', handleFloatingWindowResize);\n  hostResizeWindow.value = null;\n});\n<\/script>\n\n<style scoped>\n.wb-assistant-root {\n  height: auto;\n  width: 100%;\n  box-sizing: border-box;\n  display: flex;\n  flex-direction: column;\n  padding: 10px;\n  gap: 10px;\n  background: linear-gradient(145deg, #0f172a 0%, #111827 45%, #1e293b 100%);\n  color: #e2e8f0;\n  font-size: 13px;\n  line-height: 1.35;\n  border-radius: 10px;\n}\n\n.wb-settings-wrapper {\n  width: 100%;\n}\n\n.wb-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  border: 1px solid #334155;\n  border-radius: 10px;\n  padding: 8px 10px;\n  background: rgba(15, 23, 42, 0.6);\n}\n\n.wb-title {\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n}\n\n.wb-title strong {\n  font-size: 16px;\n}\n\n.wb-title span {\n  color: #94a3b8;\n}\n\n.wb-header-actions,\n.list-actions,\n.tool-line {\n  display: flex;\n  gap: 6px;\n  flex-wrap: wrap;\n}\n\n.wb-toolbar {\n  display: flex;\n  gap: 6px;\n  flex-wrap: wrap;\n  align-items: center;\n  border: 1px solid #334155;\n  border-radius: 10px;\n  padding: 8px;\n  background: rgba(15, 23, 42, 0.55);\n}\n\n.toolbar-label {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n  color: #cbd5e1;\n}\n\n.toolbar-select {\n  min-width: 200px;\n}\n\n.toolbar-select.small {\n  min-width: 160px;\n}\n\n.wb-bindings {\n  border: 1px solid #334155;\n  border-radius: 10px;\n  padding: 8px;\n  display: grid;\n  gap: 8px;\n  background: rgba(15, 23, 42, 0.5);\n}\n\n.wb-history-shortcuts {\n  display: flex;\n  justify-content: flex-start;\n  gap: 8px;\n  flex-wrap: wrap;\n  align-items: center;\n}\n\n.global-mode-panel {\n  border: 1px solid #334155;\n  border-radius: 9px;\n  background: rgba(15, 23, 42, 0.58);\n  padding: 8px;\n  display: grid;\n  gap: 8px;\n}\n\n.global-mode-head {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 8px;\n}\n\n.global-mode-title {\n  color: #93c5fd;\n  font-weight: 700;\n  letter-spacing: 0.02em;\n}\n\n.global-mode-grid {\n  display: grid;\n  grid-template-columns: repeat(2, minmax(0, 1fr));\n  gap: 8px;\n}\n\n.global-mode-column {\n  border: 1px solid #334155;\n  border-radius: 8px;\n  padding: 8px;\n  background: rgba(2, 6, 23, 0.42);\n  display: grid;\n  gap: 6px;\n  min-height: 168px;\n}\n\n.global-mode-list {\n  border: 1px solid #334155;\n  border-radius: 8px;\n  background: rgba(15, 23, 42, 0.6);\n  max-height: 176px;\n  min-height: 88px;\n  overflow: auto;\n  display: flex;\n  flex-direction: column;\n}\n\n.global-mode-item {\n  width: 100%;\n  border: none;\n  border-bottom: 1px solid rgba(51, 65, 85, 0.6);\n  background: transparent;\n  color: #e2e8f0;\n  padding: 7px 8px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 10px;\n  cursor: pointer;\n  text-align: left;\n}\n\n.global-mode-item:last-child {\n  border-bottom: none;\n}\n\n.global-mode-item:hover {\n  background: rgba(56, 189, 248, 0.14);\n}\n\n.global-mode-item.add .global-mode-item-action {\n  color: #86efac;\n}\n\n.global-mode-item.active .global-mode-item-action {\n  color: #fca5a5;\n}\n\n.global-mode-item-name {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.global-mode-item-action {\n  font-size: 12px;\n  flex-shrink: 0;\n}\n\n.global-mode-actions {\n  display: flex;\n  gap: 6px;\n  flex-wrap: wrap;\n}\n\n.history-btn {\n  border-color: #3b82f6;\n  background: rgba(30, 58, 138, 0.25);\n}\n\n.utility-btn {\n  border-color: #0ea5e9;\n  background: rgba(6, 78, 118, 0.25);\n}\n\n.utility-btn.active {\n  border-color: #22d3ee;\n  background: rgba(34, 211, 238, 0.16);\n  color: #67e8f9;\n}\n\n.wb-main-layout {\n  min-height: 460px;\n  max-height: 70vh;\n  display: grid;\n  grid-template-columns: 320px 10px minmax(0, 1fr);\n  gap: 0;\n}\n\n.wb-entry-list,\n.wb-editor {\n  border: 1px solid #334155;\n  border-radius: 10px;\n  padding: 8px;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  background: rgba(15, 23, 42, 0.55);\n  min-height: 0;\n}\n\n.list-search {\n  display: grid;\n  gap: 6px;\n}\n\n.list-summary {\n  color: #94a3b8;\n  font-size: 12px;\n}\n\n.list-scroll {\n  flex: 1 1 auto;\n  min-height: 210px;\n  max-height: calc(70vh - 210px);\n  overflow: auto;\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n\n.entry-item {\n  width: 100%;\n  text-align: left;\n  border: 1px solid #334155;\n  background: linear-gradient(145deg, rgba(15, 23, 42, 0.88), rgba(2, 6, 23, 0.9));\n  color: #e2e8f0;\n  border-radius: 8px;\n  padding: 8px 8px 7px 10px;\n  cursor: pointer;\n  display: grid;\n  gap: 6px;\n  position: relative;\n  transition: border-color 0.16s ease, transform 0.16s ease, box-shadow 0.16s ease;\n}\n\n.entry-item::before {\n  content: \'\';\n  position: absolute;\n  left: 0;\n  top: 0;\n  bottom: 0;\n  width: 4px;\n  border-radius: 8px 0 0 8px;\n  background: linear-gradient(to bottom, #64748b, rgba(100, 116, 139, 0.05));\n}\n\n.entry-item[data-status=\'constant\']::before {\n  background: linear-gradient(to bottom, #3b82f6, rgba(59, 130, 246, 0));\n}\n\n.entry-item[data-status=\'vector\']::before {\n  background: linear-gradient(to bottom, #a855f7, rgba(168, 85, 247, 0));\n}\n\n.entry-item[data-status=\'normal\']::before {\n  background: linear-gradient(to bottom, #22c55e, rgba(34, 197, 94, 0));\n}\n\n.entry-item[data-status=\'disabled\']::before {\n  background: linear-gradient(to bottom, #6b7280, rgba(107, 114, 128, 0));\n}\n\n.entry-item:hover {\n  border-color: #475569;\n  transform: translateY(-1px);\n}\n\n.entry-item.selected {\n  border-color: #38bdf8;\n  box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.5) inset, 0 6px 16px rgba(14, 116, 144, 0.3);\n}\n\n.entry-item.disabled {\n  opacity: 0.74;\n}\n\n.entry-item-head {\n  display: flex;\n  align-items: center;\n  gap: 7px;\n  min-width: 0;\n}\n\n.entry-status-dot {\n  width: 9px;\n  height: 9px;\n  border-radius: 999px;\n  background: #64748b;\n  flex-shrink: 0;\n  box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.85);\n}\n\n.entry-status-dot[data-status=\'constant\'] {\n  background: #3b82f6;\n}\n\n.entry-status-dot[data-status=\'vector\'] {\n  background: #a855f7;\n}\n\n.entry-status-dot[data-status=\'normal\'] {\n  background: #22c55e;\n}\n\n.entry-status-dot[data-status=\'disabled\'] {\n  background: #6b7280;\n}\n\n.entry-item-title {\n  font-weight: 700;\n  flex: 1;\n  min-width: 0;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.entry-item-tags {\n  display: flex;\n  gap: 6px;\n  flex-wrap: wrap;\n}\n\n.entry-chip {\n  display: inline-flex;\n  align-items: center;\n  gap: 4px;\n  border: 1px solid #334155;\n  border-radius: 999px;\n  padding: 1px 8px;\n  color: #cbd5e1;\n  font-size: 11px;\n  background: rgba(15, 23, 42, 0.55);\n}\n\n.entry-chip.uid {\n  color: #93c5fd;\n  font-size: 10px;\n  padding: 1px 7px;\n}\n\n.entry-chip.mono {\n  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \'Liberation Mono\', \'Courier New\', monospace;\n  font-size: 10px;\n}\n\n.entry-chip.status[data-status=\'constant\'] {\n  border-color: rgba(59, 130, 246, 0.65);\n  color: #93c5fd;\n  background: rgba(59, 130, 246, 0.16);\n}\n\n.entry-chip.status[data-status=\'vector\'] {\n  border-color: rgba(168, 85, 247, 0.65);\n  color: #d8b4fe;\n  background: rgba(168, 85, 247, 0.16);\n}\n\n.entry-chip.status[data-status=\'normal\'] {\n  border-color: rgba(34, 197, 94, 0.65);\n  color: #86efac;\n  background: rgba(34, 197, 94, 0.16);\n}\n\n.entry-chip.status[data-status=\'disabled\'] {\n  border-color: rgba(107, 114, 128, 0.7);\n  color: #cbd5e1;\n  background: rgba(100, 116, 139, 0.15);\n}\n\n.entry-item-preview {\n  color: #94a3b8;\n  font-size: 11px;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-left: 16px;\n  opacity: 0.85;\n}\n\n.entry-item-preview::before {\n  content: \'Keys: \';\n  color: #64748b;\n  margin-right: 4px;\n}\n\n.wb-editor {\n  max-height: 70vh;\n  overflow: hidden;\n}\n\n.wb-editor-shell {\n  height: 100%;\n  min-height: 0;\n  display: grid;\n  grid-template-columns: minmax(0, 1fr) 10px 360px;\n  gap: 0;\n}\n\n.wb-resize-handle {\n  position: relative;\n  width: 10px;\n  cursor: col-resize;\n  user-select: none;\n  touch-action: none;\n}\n\n.wb-resize-handle::before {\n  content: \'\';\n  position: absolute;\n  left: 4px;\n  top: 12px;\n  bottom: 12px;\n  width: 2px;\n  border-radius: 999px;\n  background: rgba(100, 116, 139, 0.5);\n  transition: background-color 0.15s ease;\n}\n\n.wb-resize-handle:hover::before,\n.wb-resize-handle.dragging::before {\n  background: rgba(56, 189, 248, 0.95);\n}\n\n.editor-center {\n  border: 1px solid #1e293b;\n  border-radius: 10px;\n  background: rgba(2, 6, 23, 0.7);\n  padding: 10px;\n  display: flex;\n  flex-direction: column;\n  gap: 10px;\n  min-height: 0;\n  overflow: auto;\n}\n\n.editor-head {\n  display: flex;\n  justify-content: space-between;\n  gap: 10px;\n  align-items: flex-end;\n  border-bottom: 1px solid #1e293b;\n  padding-bottom: 8px;\n}\n\n.editor-comment {\n  flex: 1;\n}\n\n.editor-badges {\n  display: flex;\n  gap: 6px;\n  flex-wrap: wrap;\n  justify-content: flex-end;\n}\n\n.editor-badge {\n  font-size: 10px;\n  border: 1px solid #334155;\n  border-radius: 999px;\n  padding: 2px 8px;\n  color: #94a3b8;\n  background: rgba(15, 23, 42, 0.72);\n  white-space: nowrap;\n}\n\n.editor-badge.mono {\n  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \'Liberation Mono\', \'Courier New\', monospace;\n}\n\n.editor-badge.on {\n  border-color: rgba(34, 197, 94, 0.65);\n  color: #86efac;\n}\n\n.editor-badge.off {\n  border-color: rgba(107, 114, 128, 0.75);\n  color: #cbd5e1;\n}\n\n.editor-badge.strategy[data-status=\'constant\'] {\n  border-color: rgba(59, 130, 246, 0.65);\n  color: #93c5fd;\n}\n\n.editor-badge.strategy[data-status=\'vector\'] {\n  border-color: rgba(168, 85, 247, 0.65);\n  color: #d8b4fe;\n}\n\n.editor-badge.strategy[data-status=\'normal\'] {\n  border-color: rgba(34, 197, 94, 0.65);\n  color: #86efac;\n}\n\n.editor-badge.strategy[data-status=\'disabled\'] {\n  border-color: rgba(107, 114, 128, 0.75);\n  color: #cbd5e1;\n}\n\n.editor-keyword-grid .text-area.compact {\n  min-height: 36px;\n  height: 36px;\n  line-height: 1.35;\n}\n\n.editor-content-block {\n  min-height: 0;\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  flex: 1;\n}\n\n.editor-content-title {\n  font-size: 12px;\n  color: #93c5fd;\n  letter-spacing: 0.01em;\n}\n\n.editor-content-area {\n  min-height: 320px;\n  flex: 1;\n  resize: none;\n  line-height: 1.5;\n}\n\n.editor-advanced {\n  border: 1px solid #334155;\n  border-radius: 8px;\n  padding: 7px;\n  background: rgba(15, 23, 42, 0.4);\n}\n\n.editor-advanced > summary {\n  cursor: pointer;\n  font-size: 12px;\n  color: #cbd5e1;\n}\n\n.editor-advanced[open] > summary {\n  margin-bottom: 7px;\n}\n\n.editor-side {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  min-height: 0;\n  overflow: auto;\n}\n\n.editor-card {\n  border: 1px solid #334155;\n  border-radius: 10px;\n  padding: 8px;\n  background: rgba(15, 23, 42, 0.7);\n  display: grid;\n  gap: 7px;\n}\n\n.editor-card h4 {\n  margin: 0;\n  font-size: 12px;\n  color: #f59e0b;\n}\n\n.strategy-switch {\n  display: grid;\n  gap: 6px;\n}\n\n.strategy-pill {\n  border: 1px solid #334155;\n  border-radius: 8px;\n  background: rgba(15, 23, 42, 0.7);\n  color: #cbd5e1;\n  padding: 6px 8px;\n  font-size: 12px;\n  cursor: pointer;\n  text-align: left;\n}\n\n.strategy-pill:hover {\n  border-color: #475569;\n}\n\n.strategy-pill.active.constant {\n  border-color: rgba(59, 130, 246, 0.8);\n  background: rgba(59, 130, 246, 0.16);\n  color: #93c5fd;\n}\n\n.strategy-pill.active.vector {\n  border-color: rgba(168, 85, 247, 0.8);\n  background: rgba(168, 85, 247, 0.16);\n  color: #d8b4fe;\n}\n\n.strategy-pill.active.selective {\n  border-color: rgba(34, 197, 94, 0.8);\n  background: rgba(34, 197, 94, 0.16);\n  color: #86efac;\n}\n\n.editor-grid {\n  display: grid;\n  gap: 8px;\n}\n\n.editor-grid.two-cols {\n  grid-template-columns: 1fr 1fr;\n}\n\n.editor-grid.three-cols {\n  grid-template-columns: repeat(3, minmax(0, 1fr));\n}\n\n.field {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n\n.field > span {\n  color: #93c5fd;\n}\n\n.field.disabled {\n  opacity: 0.56;\n}\n\n.field-end {\n  align-self: end;\n}\n\n.field-actions {\n  display: flex;\n  gap: 6px;\n  flex-wrap: wrap;\n}\n\n.text-input,\n.text-area,\n.toolbar-select {\n  width: 100%;\n  box-sizing: border-box;\n  border: 1px solid #334155;\n  border-radius: 7px;\n  padding: 6px 8px;\n  color: #f8fafc;\n  background: #0f172a;\n}\n\n.text-area {\n  min-height: 96px;\n  resize: vertical;\n}\n\n.text-area.compact {\n  min-height: 84px;\n}\n\n.text-area.large {\n  min-height: 190px;\n}\n\n.checkbox-inline {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n}\n\n.wb-tools-grid {\n  display: grid;\n  gap: 8px;\n  grid-template-columns: repeat(2, minmax(0, 1fr));\n}\n\n.tool-card {\n  border: 1px solid #334155;\n  border-radius: 10px;\n  padding: 8px;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n  min-height: 170px;\n  background: rgba(15, 23, 42, 0.45);\n}\n\n.tool-card h4 {\n  margin: 0;\n  font-size: 13px;\n  color: #93c5fd;\n}\n\n.tool-line.stacked {\n  display: grid;\n  gap: 6px;\n}\n\n.find-flags {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 8px;\n}\n\n.batch-exclude-note {\n  color: #94a3b8;\n  font-size: 11px;\n}\n\n.batch-exclude-chips {\n  display: flex;\n  gap: 6px;\n  flex-wrap: wrap;\n}\n\n.exclude-chip {\n  border: 1px solid #475569;\n  border-radius: 999px;\n  padding: 1px 8px;\n  font-size: 11px;\n  color: #cbd5e1;\n  background: rgba(15, 23, 42, 0.6);\n}\n\n.tool-details {\n  border: 1px solid #334155;\n  border-radius: 8px;\n  padding: 6px;\n  background: rgba(15, 23, 42, 0.35);\n}\n\n.tool-details > summary {\n  cursor: pointer;\n  color: #cbd5e1;\n  font-size: 12px;\n}\n\n.tool-details[open] > summary {\n  margin-bottom: 6px;\n}\n\n.history-compare {\n  display: grid;\n  gap: 6px;\n}\n\n.history-preview-grid {\n  display: grid;\n  grid-template-columns: repeat(2, minmax(0, 1fr));\n  gap: 6px;\n}\n\n.history-preview-card {\n  border: 1px solid #334155;\n  border-radius: 8px;\n  padding: 6px;\n  display: grid;\n  gap: 3px;\n  background: rgba(2, 6, 23, 0.48);\n}\n\n.history-preview-card strong {\n  color: #93c5fd;\n  font-size: 11px;\n}\n\n.history-preview-card span {\n  color: #94a3b8;\n  font-size: 11px;\n  line-height: 1.35;\n}\n\n.history-note {\n  border: 1px dashed #334155;\n  border-radius: 8px;\n  padding: 6px;\n  color: #94a3b8;\n  font-size: 11px;\n  background: rgba(15, 23, 42, 0.32);\n}\n\n.tool-scroll {\n  overflow: auto;\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n\n.tool-list-item {\n  border: 1px solid #334155;\n  border-radius: 8px;\n  padding: 6px;\n  display: flex;\n  justify-content: space-between;\n  gap: 8px;\n  align-items: center;\n}\n\n.item-main {\n  display: flex;\n  flex-direction: column;\n  gap: 2px;\n  min-width: 0;\n}\n\n.item-main strong,\n.activation-main strong {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.item-main span {\n  color: #94a3b8;\n  font-size: 12px;\n}\n\n.item-actions {\n  display: flex;\n  gap: 6px;\n}\n\n.activation-item {\n  border: 1px solid #334155;\n  border-radius: 8px;\n  padding: 6px;\n  display: grid;\n  gap: 3px;\n}\n\n.activation-main,\n.activation-sub {\n  display: flex;\n  justify-content: space-between;\n  gap: 6px;\n}\n\n.activation-main span,\n.activation-sub {\n  color: #94a3b8;\n  font-size: 12px;\n}\n\n.activation-sub span:last-child {\n  flex: 1;\n  text-align: right;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n.wb-floating-window {\n  position: fixed;\n  max-width: calc(100vw - 16px);\n  max-height: min(74vh, 760px);\n  border: 1px solid #334155;\n  border-radius: 10px;\n  background: linear-gradient(155deg, rgba(2, 6, 23, 0.95), rgba(15, 23, 42, 0.95));\n  box-shadow: 0 14px 36px rgba(2, 6, 23, 0.7);\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n\n.wb-floating-header {\n  display: flex;\n  justify-content: space-between;\n  gap: 8px;\n  align-items: center;\n  padding: 8px 10px;\n  border-bottom: 1px solid #334155;\n  background: rgba(15, 23, 42, 0.9);\n  cursor: move;\n  user-select: none;\n  touch-action: none;\n}\n\n.wb-floating-header strong {\n  font-size: 12px;\n  color: #cbd5e1;\n}\n\n.wb-floating-header-actions {\n  display: flex;\n  gap: 6px;\n  flex-wrap: wrap;\n}\n\n.wb-floating-body {\n  min-height: 0;\n  padding: 8px;\n  display: grid;\n  gap: 8px;\n  overflow: auto;\n}\n\n.find-window .wb-floating-body {\n  gap: 10px;\n}\n\n.clipboard-window .tool-scroll,\n.activation-window .tool-scroll {\n  max-height: min(58vh, 520px);\n}\n\n.wb-status {\n  border: 1px solid #334155;\n  border-radius: 10px;\n  background: rgba(15, 23, 42, 0.52);\n  padding: 8px;\n  display: flex;\n  justify-content: space-between;\n  gap: 8px;\n  color: #cbd5e1;\n  flex-wrap: wrap;\n}\n\n.btn {\n  border: 1px solid #475569;\n  background: #1e293b;\n  color: #f8fafc;\n  border-radius: 7px;\n  padding: 5px 10px;\n  cursor: pointer;\n}\n\n.btn:hover:not(:disabled) {\n  border-color: #38bdf8;\n}\n\n.btn:disabled {\n  opacity: 0.5;\n  cursor: default;\n}\n\n.btn.primary {\n  background: #0c4a6e;\n  border-color: #0284c7;\n}\n\n.btn.danger {\n  background: #4c0519;\n  border-color: #e11d48;\n}\n\n.btn.mini {\n  padding: 4px 8px;\n  font-size: 12px;\n}\n\n.empty-note,\n.empty-block {\n  color: #94a3b8;\n  font-size: 12px;\n}\n\n.empty-block {\n  padding: 14px;\n  border: 1px dashed #475569;\n  border-radius: 8px;\n}\n\n.hidden-input {\n  display: none;\n}\n\n.wb-modal-backdrop {\n  position: fixed;\n  inset: 0;\n  background: rgba(2, 6, 23, 0.72);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 10020;\n  padding: 14px;\n}\n\n.wb-history-modal {\n  width: min(1260px, 100%);\n  height: min(88vh, 940px);\n  border: 1px solid #334155;\n  border-radius: 12px;\n  background: linear-gradient(155deg, #0b1325, #020617);\n  box-shadow: 0 20px 48px rgba(0, 0, 0, 0.55);\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n\n.wb-history-modal-header {\n  display: flex;\n  justify-content: space-between;\n  gap: 8px;\n  align-items: center;\n  padding: 10px 12px;\n  border-bottom: 1px solid #334155;\n  background: rgba(15, 23, 42, 0.85);\n}\n\n.wb-history-modal-header strong {\n  display: block;\n  font-size: 14px;\n}\n\n.wb-history-modal-header span {\n  color: #94a3b8;\n  font-size: 11px;\n}\n\n.wb-history-modal-actions {\n  display: flex;\n  gap: 6px;\n  flex-wrap: wrap;\n}\n\n.wb-history-modal-main {\n  min-height: 0;\n  flex: 1;\n  display: grid;\n  grid-template-columns: 300px 1fr;\n  overflow: hidden;\n}\n\n.wb-history-versions {\n  border-right: 1px solid #334155;\n  background: rgba(15, 23, 42, 0.8);\n  display: flex;\n  flex-direction: column;\n  min-height: 0;\n}\n\n.wb-history-versions-title {\n  padding: 8px 10px;\n  font-size: 11px;\n  color: #94a3b8;\n  border-bottom: 1px solid #334155;\n}\n\n.wb-history-versions-scroll {\n  flex: 1;\n  min-height: 0;\n  overflow: auto;\n  padding: 8px;\n  display: flex;\n  flex-direction: column;\n  gap: 7px;\n}\n\n.wb-history-version-item {\n  border: 1px solid #334155;\n  border-radius: 8px;\n  padding: 6px;\n  display: grid;\n  gap: 4px;\n  background: rgba(15, 23, 42, 0.56);\n}\n\n.wb-history-version-line {\n  display: flex;\n  justify-content: space-between;\n  gap: 6px;\n  align-items: center;\n}\n\n.wb-history-version-line strong {\n  font-size: 11px;\n  color: #cbd5e1;\n}\n\n.wb-history-version-item span {\n  font-size: 11px;\n  color: #94a3b8;\n  word-break: break-all;\n}\n\n.wb-history-lr {\n  display: inline-flex;\n  gap: 4px;\n}\n\n.mini-lr {\n  border: 1px solid #475569;\n  background: #0f172a;\n  color: #94a3b8;\n  border-radius: 6px;\n  min-width: 24px;\n  font-size: 10px;\n  cursor: pointer;\n}\n\n.mini-lr.active {\n  border-color: #22d3ee;\n  color: #67e8f9;\n}\n\n.wb-history-diff-wrap {\n  min-height: 0;\n  display: flex;\n  flex-direction: column;\n}\n\n.wb-history-diff-head {\n  border-bottom: 1px solid #334155;\n  background: rgba(15, 23, 42, 0.58);\n  padding: 8px 10px;\n  display: flex;\n  justify-content: space-between;\n  gap: 8px;\n  align-items: center;\n  font-size: 11px;\n  color: #94a3b8;\n}\n\n.wb-history-diff-grid {\n  min-height: 0;\n  flex: 1;\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n}\n\n.wb-history-diff-grid > div {\n  min-height: 0;\n  display: flex;\n  flex-direction: column;\n}\n\n.wb-history-diff-grid > div + div {\n  border-left: 1px solid #334155;\n}\n\n.wb-history-diff-title {\n  padding: 8px 10px;\n  border-bottom: 1px solid #334155;\n  font-size: 11px;\n  color: #93c5fd;\n}\n\n.wb-history-diff-body {\n  min-height: 0;\n  flex: 1;\n  overflow: auto;\n  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, \'Liberation Mono\', \'Courier New\', monospace;\n  font-size: 11px;\n  background: rgba(2, 6, 23, 0.9);\n}\n\n.diff-row {\n  display: grid;\n  grid-template-columns: 54px 1fr;\n  align-items: start;\n  border-bottom: 1px solid rgba(51, 65, 85, 0.25);\n}\n\n.line-no {\n  color: #64748b;\n  padding: 2px 8px;\n  border-right: 1px solid rgba(51, 65, 85, 0.35);\n  user-select: none;\n}\n\n.line-text {\n  white-space: pre-wrap;\n  word-break: break-word;\n  padding: 2px 8px;\n  color: #cbd5e1;\n}\n\n.diff-row.add {\n  background: rgba(34, 197, 94, 0.18);\n}\n\n.diff-row.del {\n  background: rgba(239, 68, 68, 0.18);\n}\n\n.diff-row.empty {\n  background: rgba(100, 116, 139, 0.08);\n}\n\n@media (max-width: 1380px) {\n  .wb-editor-shell {\n    grid-template-columns: 1fr;\n  }\n\n  .editor-side {\n    overflow: visible;\n    max-height: none;\n  }\n\n  .wb-history-modal-main {\n    grid-template-columns: 1fr;\n  }\n\n  .wb-history-versions {\n    border-right: none;\n    border-bottom: 1px solid #334155;\n    max-height: 240px;\n  }\n}\n\n@media (max-width: 1100px) {\n  .global-mode-grid {\n    grid-template-columns: 1fr;\n  }\n\n  .wb-resize-handle {\n    display: none;\n  }\n\n  .wb-main-layout {\n    grid-template-columns: 1fr;\n  }\n\n  .wb-tools-grid {\n    grid-template-columns: 1fr;\n  }\n\n  .editor-grid.two-cols,\n  .editor-grid.three-cols {\n    grid-template-columns: 1fr;\n  }\n\n  .editor-head {\n    flex-direction: column;\n    align-items: stretch;\n  }\n\n  .editor-badges {\n    justify-content: flex-start;\n  }\n\n  .history-preview-grid {\n    grid-template-columns: 1fr;\n  }\n\n  .wb-history-diff-grid {\n    grid-template-columns: 1fr;\n  }\n\n  .wb-history-diff-grid > div + div {\n    border-left: none;\n    border-top: 1px solid #334155;\n  }\n\n  .wb-status {\n    flex-direction: column;\n  }\n\n  .wb-floating-window {\n    width: calc(100vw - 16px) !important;\n    left: 8px !important;\n    right: 8px;\n  }\n}\n</style>\n'],sourceRoot:''}]);const l=i},11(e){e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t='',a=void 0!==n[5];return n[4]&&(t+='@supports ('.concat(n[4],') {')),n[2]&&(t+='@media '.concat(n[2],' {')),a&&(t+='@layer'.concat(n[5].length>0?' '.concat(n[5]):'',' {')),t+=e(n),a&&(t+='}'),n[2]&&(t+='}'),n[4]&&(t+='}'),t}).join('')},n.i=function(e,t,a,o,r){'string'==typeof e&&(e=[[null,e,void 0]]);var i={};if(a)for(var l=0;l<this.length;l++){var s=this[l][0];null!=s&&(i[s]=!0)}for(var d=0;d<e.length;d++){var c=[].concat(e[d]);a&&i[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]='@layer'.concat(c[5].length>0?' '.concat(c[5]):'',' {').concat(c[1],'}')),c[5]=r),t&&(c[2]?(c[1]='@media '.concat(c[2],' {').concat(c[1],'}'),c[2]=t):c[2]=t),o&&(c[4]?(c[1]='@supports ('.concat(c[4],') {').concat(c[1],'}'),c[4]=o):c[4]=''.concat(o)),n.push(c))}},n}},781(e){e.exports=function(e){var n=e[1],t=e[3];if(!t)return n;if('function'==typeof btoa){var a=btoa(unescape(encodeURIComponent(JSON.stringify(t)))),o='sourceMappingURL=data:application/json;charset=utf-8;base64,'.concat(a),r='/*# '.concat(o,' */');return[n].concat([r]).join('\n')}return[n].join('\n')}},610(e,n,t){var a=t(159);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('dc973c2c',a,!1,{ssrId:!0})},441(e,n){n.A=(e,n)=>{const t=e.__vccOpts||e;for(const[e,a]of n)t[e]=a;return t}},424(e,n,t){function a(e,n){for(var t=[],a={},o=0;o<n.length;o++){var r=n[o],i=r[0],l={id:e+':'+o,css:r[1],media:r[2],sourceMap:r[3]};a[i]?a[i].parts.push(l):t.push(a[i]={id:i,parts:[l]})}return t}t.d(n,{A:()=>b});var o='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!o)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \'node\' } in your Webpack config to indicate a server-rendering environment.');var r={},i=o&&(document.head||document.getElementsByTagName('head')[0]),l=null,s=0,d=!1,c=function(){},u=null,p='data-vue-ssr-id',f='undefined'!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function b(e,n,t,o){d=t,u=o||{};var i=a(e,n);return m(i),function(n){for(var t=[],o=0;o<i.length;o++){var l=i[o];(s=r[l.id]).refs--,t.push(s)}n?m(i=a(e,n)):i=[];for(o=0;o<t.length;o++){var s;if(0===(s=t[o]).refs){for(var d=0;d<s.parts.length;d++)s.parts[d]();delete r[s.id]}}}}function m(e){for(var n=0;n<e.length;n++){var t=e[n],a=r[t.id];if(a){a.refs++;for(var o=0;o<a.parts.length;o++)a.parts[o](t.parts[o]);for(;o<t.parts.length;o++)a.parts.push(y(t.parts[o]));a.parts.length>t.parts.length&&(a.parts.length=t.parts.length)}else{var i=[];for(o=0;o<t.parts.length;o++)i.push(y(t.parts[o]));r[t.id]={id:t.id,refs:1,parts:i}}}}function g(){var e=document.createElement('style');return e.type='text/css',i.appendChild(e),e}function y(e){var n,t,a=document.querySelector('style['+p+'~="'+e.id+'"]');if(a){if(d)return c;a.parentNode.removeChild(a)}if(f){var o=s++;a=l||(l=g()),n=C.bind(null,a,o,!1),t=C.bind(null,a,o,!0)}else a=g(),n=h.bind(null,a),t=function(){a.parentNode.removeChild(a)};return n(e),function(a){if(a){if(a.css===e.css&&a.media===e.media&&a.sourceMap===e.sourceMap)return;n(e=a)}else t()}}var A,v=(A=[],function(e,n){return A[e]=n,A.filter(Boolean).join('\n')});function C(e,n,t,a){var o=t?'':a.css;if(e.styleSheet)e.styleSheet.cssText=v(n,o);else{var r=document.createTextNode(o),i=e.childNodes;i[n]&&e.removeChild(i[n]),i.length?e.insertBefore(r,i[n]):e.appendChild(r)}}function h(e,n){var t=n.css,a=n.media,o=n.sourceMap;if(a&&e.setAttribute('media',a),u.ssrId&&e.setAttribute(p,n.id),o&&(t+='\n/*# sourceURL='+o.sources[0]+' */',t+='\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+' */'),e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}}},a={};function o(e){var n=a[e];if(void 0!==n)return n.exports;var r=a[e]={id:e,exports:{}};return t[e](r,r.exports,o),r.exports}o.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return o.d(n,{a:n}),n},o.d=(e,n)=>{for(var t in n)o.o(n,t)&&!o.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},o.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),o.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};const r=Vue;const i={class:'wb-assistant-root'},l={class:'wb-toolbar'},s={class:'toolbar-label'},d=['value'],c=['disabled'],u=['disabled'],p=['disabled'],f={class:'wb-bindings'},b={class:'wb-history-shortcuts'},m=['disabled'],g=['disabled'],y=['disabled'],A={key:0,class:'global-mode-panel'},v={class:'global-mode-head'},C={class:'global-mode-title'},h=['disabled'],x={class:'global-mode-grid'},E={class:'global-mode-column'},w={class:'field'},k=['onKeydown'],B={class:'global-mode-list'},N=['onClick'],S={class:'global-mode-item-name'},R={key:0,class:'empty-note'},V={class:'global-mode-column'},F={class:'field'},W={class:'global-mode-list'},L=['onClick'],I={class:'global-mode-item-name'},M={key:0,class:'empty-note'},T={class:'global-mode-actions'},D=['disabled'],O={class:'wb-entry-list'},P={class:'list-search'},H={class:'checkbox-inline'},Y={class:'list-summary'},j={class:'list-scroll'},U=['data-status','onClick'],K={class:'entry-item-head'},G=['data-status'],q={class:'entry-item-title'},J={class:'entry-chip uid'},Z={class:'entry-item-tags'},Q=['data-status'],X={class:'entry-chip'},ee={class:'entry-chip'},ne={class:'entry-chip mono'},te={class:'entry-item-preview'},ae={class:'list-actions'},oe=['disabled'],re=['disabled'],ie=['disabled'],le=['disabled'],se=['disabled'],de={class:'wb-editor'},ce={class:'editor-center'},ue={class:'editor-head'},pe={class:'field editor-comment'},fe={class:'editor-badges'},be=['data-status'],me={class:'editor-badge mono'},ge={class:'editor-badge mono'},ye={class:'editor-badge mono'},Ae={class:'editor-grid two-cols editor-keyword-grid'},ve={class:'field'},Ce={class:'field'},he={class:'editor-content-block'},xe={class:'editor-advanced'},Ee={class:'field'},we={class:'editor-side'},ke={class:'editor-card'},Be={class:'field checkbox-inline'},Ne={class:'strategy-switch'},Se={class:'editor-advanced'},_e={class:'field'},Re=['value'],Ve={class:'field'},Fe={class:'field'},We={class:'editor-card'},Le={class:'field'},Ie=['value'],Me={class:'field'},Te={class:'editor-grid two-cols'},De=['disabled'],ze=['disabled'],Oe={class:'editor-card'},$e={class:'field checkbox-inline'},Pe={class:'field checkbox-inline'},He={class:'field'},Ye={class:'editor-grid two-cols'},je={class:'field'},Ue={class:'field'},Ke={class:'field'},Ge={key:1,class:'empty-block'},qe={class:'wb-status'},Je={class:'wb-history-modal'},Ze={class:'wb-history-modal-header'},Qe={class:'wb-history-modal-actions'},Xe=['disabled'],en=['disabled'],nn={class:'wb-history-modal-main'},tn={class:'wb-history-versions'},an={class:'wb-history-versions-scroll'},on={class:'wb-history-version-line'},rn={class:'wb-history-lr'},ln=['onClick'],sn=['onClick'],dn={key:0,class:'empty-note'},cn={class:'wb-history-diff-wrap'},un={class:'wb-history-diff-head'},pn=['disabled'],fn={class:'wb-history-diff-grid'},bn=['innerHTML'],mn=['innerHTML'],gn={class:'wb-history-modal'},yn={class:'wb-history-modal-header'},An={class:'wb-history-modal-actions'},vn=['disabled'],Cn=['disabled'],hn={class:'wb-history-modal-main'},xn={class:'wb-history-versions'},En={class:'wb-history-versions-scroll'},wn={class:'wb-history-version-line'},kn={class:'wb-history-lr'},Bn=['onClick'],Nn=['onClick'],Sn={class:'wb-history-diff-wrap'},_n={class:'wb-history-diff-head'},Rn=['disabled'],Vn={class:'wb-history-diff-grid'},Fn=['innerHTML'],Wn=['innerHTML'],Ln={class:'wb-floating-header-actions'},In=['disabled'],Mn={class:'wb-floating-body'},Tn={class:'tool-line stacked'},Dn={key:0,class:'batch-exclude-chips'},zn={class:'find-flags'},On={class:'checkbox-inline'},$n={class:'checkbox-inline'},Pn={class:'checkbox-inline'},Hn={class:'checkbox-inline'},Yn={class:'tool-details'},jn={class:'tool-line'},Un=['disabled'],Kn=['disabled'],Gn={class:'tool-line'},qn=['disabled'],Jn=['disabled'],Zn={class:'wb-floating-header-actions'},Qn=['disabled'],Xn={class:'wb-floating-body'},et={class:'tool-scroll'},nt={class:'item-main'},tt={class:'item-actions'},at=['disabled','onClick'],ot=['onClick'],rt={key:0,class:'empty-note'},it={class:'wb-floating-header-actions'},lt=['disabled'],st={class:'wb-floating-body'},dt={class:'tool-scroll'},ct={class:'activation-main'},ut={class:'activation-sub'},pt={key:0,class:'empty-note'},ft='worldbook_assistant_state_v1',bt='__WB_ASSISTANT_HAS_UNSAVED_CHANGES__',mt=10,gt=220,yt=540,At=280,vt=420,Ct=(0,r.defineComponent)({__name:'App',setup(t){const a=['constant','selective','vectorized'],o=['and_any','and_all','not_all','not_any'],Ct=['before_character_definition','after_character_definition','before_example_messages','after_example_messages','before_author_note','after_author_note','at_depth'],ht=(0,r.ref)([]),xt=(0,r.ref)(''),Et=(0,r.ref)(!1),wt=(0,r.ref)([]),kt=(0,r.ref)([]),Bt=(0,r.ref)(null),Nt=(0,r.ref)(''),St=(0,r.ref)(!1),_t=(0,r.ref)(null),Rt=(0,r.ref)(''),Vt=(0,r.ref)(''),Ft=(0,r.ref)(''),Wt=(0,r.ref)(''),Lt=(0,r.ref)(''),It=(0,r.ref)(''),Mt=(0,r.ref)(!1),Tt=(0,r.ref)(!0),Dt=(0,r.ref)(!0),zt=(0,r.ref)(!1),Ot=(0,r.ref)('Â∞±Áª™'),$t=(0,r.ref)(!1),Pt=(0,r.ref)(!1),Ht=(0,r.ref)(!1),Yt=(0,r.ref)(!1),jt=(0,r.ref)(''),Ut=(0,r.ref)(''),Kt=(0,r.ref)(''),Gt=(0,r.ref)(''),qt=(0,r.ref)(10005),Jt=(0,r.reactive)({find:{visible:!1,x:420,y:170,z:10006,width:500},clipboard:{visible:!1,x:700,y:190,z:10007,width:430},activation:{visible:!1,x:760,y:230,z:10008,width:480}}),Zt=(0,r.ref)(null),Qt=['find','clipboard','activation'],Xt=(0,r.ref)('undefined'!=typeof window?window.innerWidth:1440),ea=(0,r.ref)(null),na=(0,r.ref)(null),ta=(0,r.ref)(320),aa=(0,r.ref)(360),oa=(0,r.ref)(null),ra=(0,r.ref)(null),ia=(0,r.reactive)({global:[],charPrimary:null,charAdditional:[],chat:null}),la=(0,r.ref)([]),sa=(0,r.ref)({last_worldbook:'',clipboard:[],history:{},entry_history:{}}),da=[],ca=(0,r.computed)(()=>null===Bt.value?null:kt.value.find(e=>e.uid===Bt.value)??null),ua=(0,r.computed)(()=>ca.value?kt.value.findIndex(e=>e.uid===ca.value?.uid):-1),pa=(0,r.computed)(()=>{const e=Nt.value.trim().toLowerCase();return kt.value.filter(n=>{if(St.value&&!n.enabled)return!1;if(!e)return!0;const t=n.strategy.keys.map(eo).join(' ').toLowerCase();return n.name.toLowerCase().includes(e)||n.content.toLowerCase().includes(e)||t.includes(e)})}),fa=(0,r.computed)(()=>kt.value.filter(e=>e.enabled).length),ba=(0,r.computed)(()=>kt.value.reduce((e,n)=>e+n.content.length,0)),ma=(0,r.computed)(()=>JSON.stringify(kt.value)!==JSON.stringify(wt.value)),ga=(0,r.computed)(()=>Xt.value<=1100),ya=(0,r.computed)(()=>{if(!ga.value)return{gridTemplateColumns:`minmax(220px, min(${ta.value}px, calc(100% - 550px))) 10px minmax(0, 1fr)`}}),Aa=(0,r.computed)(()=>{if(!ga.value)return{gridTemplateColumns:`minmax(0, 1fr) 10px minmax(280px, min(${aa.value}px, calc(100% - 430px)))`}}),va=(0,r.computed)(()=>Et.value?ia.global.filter(e=>ht.value.includes(e)):ht.value),Ca=(0,r.computed)(()=>{const e=Vt.value.trim().toLowerCase();return ht.value.filter(n=>!ia.global.includes(n)&&(!e||n.toLowerCase().includes(e)))}),ha=(0,r.computed)(()=>{const e=Ft.value.trim().toLowerCase();return e?ia.global.filter(n=>n.toLowerCase().includes(e)):ia.global}),xa=(0,r.computed)(()=>!!xt.value&&ia.global.includes(xt.value)),Ea=(0,r.computed)(()=>sa.value.clipboard),wa=(0,r.computed)(()=>xt.value?sa.value.history[xt.value]??[]:[]),ka=(0,r.computed)(()=>{if(!xt.value||!ca.value)return[];return(sa.value.entry_history[xt.value]??{})[String(ca.value.uid)]??[]}),Ba=(0,r.computed)(()=>{if(!ca.value)return[];const e=wt.value.find(e=>e.uid===ca.value?.uid)??null,n={id:'__current__',label:'ÂΩìÂâçÁâàÊú¨',ts:Date.now(),name:ca.value.name,entry:ca.value,isCurrent:!0},t=e?{id:'__baseline__',label:'Âä†ËΩΩÂü∫Á∫ø',ts:0,name:e.name,entry:e,isCurrent:!1}:null;return[n,...t?[t]:[],...ka.value.map(e=>({id:e.id,label:e.label,ts:e.ts,name:e.name,entry:e.entry,isCurrent:!1}))]}),Na=(0,r.computed)(()=>Ba.value.find(e=>e.id===jt.value)??null),Sa=(0,r.computed)(()=>Ba.value.find(e=>e.id===Ut.value)??null),_a=(0,r.computed)(()=>Boolean(ca.value&&Na.value&&!Na.value.isCurrent)),Ra=(0,r.computed)(()=>{if(!xt.value)return[];const e={id:'__current__',label:'ÂΩìÂâçËçâÁ®ø',ts:Date.now(),entries:kt.value,isCurrent:!0},n={id:'__baseline__',label:'Âä†ËΩΩÂü∫Á∫ø',ts:0,entries:wt.value,isCurrent:!1},t=wa.value.map(e=>({id:e.id,label:e.label,ts:e.ts,entries:e.entries,isCurrent:!1}));return[e,...wt.value.length?[n]:[],...t]}),Va=(0,r.computed)(()=>Ra.value.find(e=>e.id===Kt.value)??null),Fa=(0,r.computed)(()=>Ra.value.find(e=>e.id===Gt.value)??null),Wa=(0,r.computed)(()=>Boolean(Va.value&&!Va.value.isCurrent)),La=(0,r.computed)(()=>Eo(It.value)),Ia=(0,r.computed)(()=>xo(Co(Na.value),Co(Sa.value))),Ma=(0,r.computed)(()=>function(n,t){if(!n||!t)return'ËØ∑Âú®Â∑¶‰æßÈÄâÊã©‰∏§‰∏™ÁâàÊú¨ËøõË°åÊØîÂØπ';const a=Co(n),o=Co(t),r=e(a,o);let i=0,l=0;for(const e of r){const n=e.value.split('\n');n.length&&''===n[n.length-1]&&n.pop(),e.added?i+=n.length:e.removed&&(l+=n.length)}const s=Math.min(i,l),d=Math.max(0,i-s),c=Math.max(0,l-s);return`Êñ∞Â¢ûË°å ${d} / ‰øÆÊîπË°å ${s} / Âà†Èô§Ë°å ${c}`}(Na.value,Sa.value)),Ta=(0,r.computed)(()=>xo(ho(Va.value),ho(Fa.value))),Da=(0,r.computed)({get:()=>ca.value?ca.value.strategy.keys.map(eo).join(', '):'',set:e=>{ca.value&&(ca.value.strategy.keys=ao(e))}}),za=(0,r.computed)({get:()=>ca.value?ca.value.strategy.keys_secondary.keys.map(eo).join(', '):'',set:e=>{ca.value&&(ca.value.strategy.keys_secondary.keys=ao(e))}}),Oa=(0,r.computed)({get:()=>{if(!ca.value)return'';const e=ca.value.strategy.scan_depth;return'number'==typeof e?String(e):'same_as_global'},set:e=>{ca.value&&(ca.value.strategy.scan_depth=lo(e))}}),$a=(0,r.computed)({get:()=>ca.value?Xa(ca.value.recursion.delay_until):'',set:e=>{ca.value&&(ca.value.recursion.delay_until=Qa(e))}}),Pa=(0,r.computed)({get:()=>ca.value?Xa(ca.value.effect.sticky):'',set:e=>{ca.value&&(ca.value.effect.sticky=Qa(e))}}),Ha=(0,r.computed)({get:()=>ca.value?Xa(ca.value.effect.cooldown):'',set:e=>{ca.value&&(ca.value.effect.cooldown=Qa(e))}}),Ya=(0,r.computed)({get:()=>ca.value?Xa(ca.value.effect.delay):'',set:e=>{ca.value&&(ca.value.effect.delay=Qa(e))}}),ja=(0,r.computed)(()=>ca.value?.content.length??0),Ua=(0,r.computed)(()=>{const e=ja.value;return e<=0?0:Math.max(1,Math.round(e/3.6))});function Ka(e){return`${e}-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,9)}`}function Ga(e){return e&&'object'==typeof e&&!Array.isArray(e)?e:null}function qa(e,n=''){return'string'==typeof e?e:null==e?n:String(e)}function Ja(e,n){if('number'==typeof e&&Number.isFinite(e))return e;if('string'==typeof e&&e.trim()){const n=Number(e);if(Number.isFinite(n))return n}return n}function Za(e,n,t){return Math.min(t,Math.max(n,e))}function Qa(e){if(null==e)return null;if('string'==typeof e&&!e.trim())return null;const n=Number(e);return Number.isFinite(n)?Math.max(0,Math.floor(n)):null}function Xa(e){return null===e?'':String(e)}function eo(e){return e instanceof RegExp?e.toString():e}function no(e){const n=e.trim();if(!n)return'';const t=n.match(/^\/(.+)\/([dgimsuy]*)$/);if(!t)return n;try{return new RegExp(t[1],t[2])}catch{return n}}function to(e){const n=Array.isArray(e)?e:'string'==typeof e?e.split(/[\n,]/g):[],t=[],a=new Set;for(const e of n){const n=e instanceof RegExp?e:no(qa(e).trim()),o=eo(n);if(!o)continue;const r=o.toLowerCase();a.has(r)||(a.add(r),t.push(n))}return t}function ao(e){return to(e.split(/[\n,]/g))}function oo(e){return e.enabled?'constant'===e.strategy.type?'constant':'vectorized'===e.strategy.type?'vector':'normal':'disabled'}function ro(e){const n=oo(e);return'disabled'===n?'‚ö´ Á¶ÅÁî®':'constant'===n?'üîµ Â∏∏È©ª':'vector'===n?'üìé ÂêëÈáèÂåñ':'üü¢ ÂÖ≥ÈîÆËØç'}function io(e){const n=e.strategy.keys.slice(0,3).map(e=>eo(e)).join(' / ');return n?e.strategy.keys.length>3?`${n} ...`:n:'Êó†ÂÖ≥ÈîÆËØç'}function lo(e){if('same_as_global'===e)return'same_as_global';const n=Math.floor(Ja(e,NaN));return Number.isFinite(n)&&n>0?n:'same_as_global'}function so(e){return{uid:e,name:`Êù°ÁõÆ ${e}`,enabled:!0,strategy:{type:'selective',keys:[],keys_secondary:{logic:'and_any',keys:[]},scan_depth:'same_as_global'},position:{type:'after_character_definition',role:'system',depth:4,order:100},content:'',probability:100,recursion:{prevent_incoming:!1,prevent_outgoing:!1,delay_until:null},effect:{sticky:null,cooldown:null,delay:null}}}function co(e,t){const r=Ga(e)??{},i=so(t),l=Ga(r.strategy),s=Ga(r.position),d=Ga(r.recursion),c=Ga(r.effect),u=Ga(l?.keys_secondary),p=Math.max(0,Math.floor(Ja(r.uid??r.id,t))),f=qa(r.name??r.comment,`Êù°ÁõÆ ${p}`).trim()||`Êù°ÁõÆ ${p}`,b=function(e,n){const t=n?.type;return'string'==typeof t&&a.includes(t)?t:e.constant?'constant':e.vectorized?'vectorized':'selective'}(r,l),m=to(l?.keys??r.keys??r.key),g=to(u?.keys??r.secondary_keys??r.keysecondary??r.filters),y=function(e){if('string'==typeof e&&o.includes(e))return e;if('number'==typeof e)return['and_any','and_all','not_all','not_any'][e]??'and_any';return'and_any'}(u?.logic??r.logic??r.selectiveLogic),A=function(e){if('string'==typeof e){if(Ct.includes(e))return e;if(e.match(/^at_depth_as_(system|assistant|user)$/))return'at_depth'}if('number'==typeof e)return{0:'before_character_definition',1:'after_character_definition',2:'before_example_messages',3:'after_example_messages',4:'before_author_note',5:'after_author_note',6:'at_depth'}[e]??'after_character_definition';return'after_character_definition'}(s?.type??r.position),v=function(e){if('assistant'===e||'user'===e||'system'===e)return e;if('number'==typeof e)return{0:'system',1:'assistant',2:'user'}[e]??'system';if('string'==typeof e){if(e.includes('assistant'))return'assistant';if(e.includes('user'))return'user'}return'system'}(s?.role??r.role),C=Math.max(1,Math.floor(Ja(s?.depth??r.depth,4))),h=Math.floor(Ja(s?.order??r.insertion_order??r.order,100)),x=Za(Ja(r.probability,100),0,100),E=d?.prevent_incoming??r.preventRecursion,w=d?.prevent_outgoing??r.excludeRecursion,k={...i,uid:p,name:f,enabled:void 0===r.enabled?!Boolean(r.disable):Boolean(r.enabled),strategy:{type:b,keys:m,keys_secondary:{logic:y,keys:g},scan_depth:lo(l?.scan_depth??r.scan_depth)},position:{type:A,role:'at_depth'===A?v:'system',depth:'at_depth'===A?C:4,order:h},content:qa(r.content),probability:x,recursion:{prevent_incoming:Boolean(E),prevent_outgoing:Boolean(w),delay_until:Qa(d?.delay_until??r.delayUntilRecursion)},effect:{sticky:Qa(c?.sticky??r.sticky),cooldown:Qa(c?.cooldown??r.cooldown),delay:Qa(c?.delay??r.delay)}},B=Ga(r.extra);if(B&&Object.keys(B).length>0)k.extra=n(B);else{const e=function(e){const n=new Set(['uid','id','name','comment','enabled','disable','strategy','position','content','probability','recursion','effect','extra','keys','key','secondary_keys','keysecondary','filters','logic','selectiveLogic','scan_depth','constant','vectorized','selective','insertion_order','order','role','depth','preventRecursion','excludeRecursion','delayUntilRecursion','sticky','cooldown','delay','useProbability']),t={};for(const[a,o]of Object.entries(e))n.has(a)||(t[a]=o);if(0!==Object.keys(t).length)return t}(r);e&&(k.extra=n(e))}return k}function uo(e){const n=[],t=new Set;for(let a=0;a<e.length;a+=1){const o=Ga(e[a]);let r=Math.max(0,Math.floor(Ja(o?.uid??o?.id,a)));for(;t.has(r);)r+=1;t.add(r),n.push(co(e[a],r))}return n}function po(e){return 0===e.length?0:Math.max(...e.map(e=>e.uid))+1}function fo(){return function(e){const n=Ga(e);if(!n)return{last_worldbook:'',clipboard:[],history:{},entry_history:{}};const t=Ga(n.history)??{},a={};for(const[e,n]of Object.entries(t))Array.isArray(n)&&(a[e]=n.map(e=>{const n=Ga(e);if(!n)return null;const t=Array.isArray(n.entries)?n.entries:[];return{id:qa(n.id,Ka('snapshot')),label:qa(n.label,'Âø´ÁÖß'),ts:Ja(n.ts,Date.now()),entries:uo(t)}}).filter(e=>null!==e).slice(0,12));const o=Ga(n.entry_history)??{},r={};for(const[e,n]of Object.entries(o)){const t=Ga(n);if(!t)continue;const a={};for(const[e,n]of Object.entries(t)){if(!Array.isArray(n))continue;const t=Math.max(0,Math.floor(Ja(e,0)));a[e]=n.map(e=>{const n=Ga(e);return n?{id:qa(n.id,Ka('entry-snapshot')),label:qa(n.label,'Êù°ÁõÆÂø´ÁÖß'),ts:Ja(n.ts,Date.now()),uid:t,name:qa(n.name,`Êù°ÁõÆ ${t}`),entry:co(n.entry,t)}:null}).filter(e=>null!==e).slice(0,7)}Object.keys(a).length>0&&(r[e]=a)}const i=(Array.isArray(n.clipboard)?n.clipboard:[]).map(e=>{const n=Ga(e);return n?{id:qa(n.id,Ka('clip')),copied_at:Ja(n.copied_at,Date.now()),name:qa(n.name,'Êú™ÂëΩÂêçÊù°ÁõÆ'),entry:co(n.entry,0)}:null}).filter(e=>null!==e).slice(0,40);return{last_worldbook:qa(n.last_worldbook),history:a,entry_history:r,clipboard:i}}(getVariables({type:'script',script_id:getScriptId()})[ft])}function bo(e){const n=fo();e(n),function(e){const n=getVariables({type:'script',script_id:getScriptId()});n[ft]=e,replaceVariables(n,{type:'script',script_id:getScriptId()}),sa.value=e}(n)}function mo(e){Ot.value=e}function go(e){try{return new Date(e).toLocaleString('zh-CN',{hour12:!1})}catch{return String(e)}}function yo(e,n,t){return t?'CurrentÔºàÂΩìÂâçÔºâ':'Âä†ËΩΩÂü∫Á∫ø'===e||n<=0?e:`${e} ¬∑ ${go(n)}`}function Ao(e,n){if(!e||!n)return'ËØ∑ÈÄâÊã©Â∑¶Âè≥ÁâàÊú¨ËøõË°åÂØπÊØî';const t=new Map,a=new Map;e.entries.forEach(e=>t.set(e.uid,e)),n.entries.forEach(e=>a.set(e.uid,e));let o=0,r=0,i=0;for(const[e,n]of a){const a=t.get(e);a?JSON.stringify(a)!==JSON.stringify(n)&&(i+=1):o+=1}for(const e of t.keys())a.has(e)||(r+=1);return`Êñ∞Â¢û ${o} / ‰øÆÊîπ ${i} / Âà†Èô§ ${r}`}function vo(e){return e.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll('\'','&#39;')}function Co(e){if(!e)return'';const n=e.entry,t={uid:n.uid,name:n.name,enabled:n.enabled,strategy:n.strategy,position:n.position,probability:n.probability,recursion:n.recursion,effect:n.effect,content:n.content,extra:n.extra??null};return JSON.stringify(t,null,2)}function ho(e){if(!e)return'';const n=e.entries.map(e=>({uid:e.uid,name:e.name,enabled:e.enabled,type:e.strategy.type,keys:e.strategy.keys.map(eo),position:e.position,probability:e.probability,content:e.content})).sort((e,n)=>e.uid-n.uid);return JSON.stringify({entries:n},null,2)}function xo(n,t){const a=[],o=[];let r=1,i=1;const l=e(n,t);for(const e of l){const n=e.value.split('\n');if(n.length&&''===n[n.length-1]&&n.pop(),n.length)if(e.added)for(const e of n)a.push('<div class="diff-row empty"><span class="line-no"></span><span class="line-text">&nbsp;</span></div>'),o.push(`<div class="diff-row add"><span class="line-no">${i}</span><span class="line-text">${vo(e)||'&nbsp;'}</span></div>`),i+=1;else if(e.removed)for(const e of n)a.push(`<div class="diff-row del"><span class="line-no">${r}</span><span class="line-text">${vo(e)||'&nbsp;'}</span></div>`),o.push('<div class="diff-row empty"><span class="line-no"></span><span class="line-text">&nbsp;</span></div>'),r+=1;else for(const e of n){const n=vo(e)||'&nbsp;';a.push(`<div class="diff-row"><span class="line-no">${r}</span><span class="line-text">${n}</span></div>`),o.push(`<div class="diff-row"><span class="line-no">${i}</span><span class="line-text">${n}</span></div>`),r+=1,i+=1}}return{leftHtml:a.join(''),rightHtml:o.join('')}}function Eo(e){const n=new Set,t=[];for(const a of e.split(/[\n,]/g)){const e=a.trim().toLowerCase();e&&!n.has(e)&&(n.add(e),t.push(e))}return t}function wo(e,n){if(!n.length)return!1;const t=e.name.toLowerCase(),a=e.strategy.keys.map(e=>eo(e).toLowerCase()).join(' ');for(const o of n){const n=o.match(/^(?:#|uid:)?(\d+)$/);if(n&&Number(n[1])===e.uid)return!0;const r=o.replace(/^name:/,'').trim();if(r&&(t.includes(r)||a.includes(r)))return!0}return!1}function ko(){if(!kt.value.length)return void(Bt.value=null);if(null===Bt.value)return void(Bt.value=kt.value[0].uid);kt.value.some(e=>e.uid===Bt.value)||(Bt.value=kt.value[0].uid)}function Bo(e,t,a,o){return{id:Ka('entry-snapshot'),label:e,ts:Date.now(),uid:t,name:a||`Êù°ÁõÆ ${t}`,entry:co(n(o),t)}}function No(e){if(!xt.value||!e.length)return 0;let n=0;const t=xt.value;return bo(a=>{const o=a.entry_history[t]??{};for(const t of e){const e=String(t.uid),a=Bo(t.label,t.uid,t.name,t.entry),r=o[e]??[];r[0]&&JSON.stringify(r[0].entry)===JSON.stringify(a.entry)||(r.unshift(a),r.length>7&&(r.length=7),o[e]=r,n+=1)}a.entry_history[t]=o}),n}function So(e,n){return No([{label:e,uid:n.uid,name:n.name,entry:n}])>0}function _o(e){if(!xt.value)return;const t=xt.value,a={id:Ka('snapshot'),label:e,ts:Date.now(),entries:n(kt.value)};bo(e=>{const n=e.history[t]??[];n.unshift(a),n.length>12&&(n.length=12),e.history[t]=n})}function Ro(){xt.value?(_o('ÊâãÂä®Âø´ÁÖß'),toastr.success('Â∑≤ÂàõÂª∫Âø´ÁÖß')):toastr.warning('ËØ∑ÂÖàÈÄâÊã©‰∏ñÁïå‰π¶')}function Vo(){if(!ca.value)return void toastr.warning('ËØ∑ÂÖàÈÄâÊã©Êù°ÁõÆ');const e=Ba.value.find(e=>!e.isCurrent)??null;Ut.value='__current__',jt.value=e?.id??'__current__',Ht.value=!0}function Fo(){if(!xt.value)return void toastr.warning('ËØ∑ÂÖàÈÄâÊã©‰∏ñÁïå‰π¶');const e=Ra.value.find(e=>!e.isCurrent)??null;Gt.value='__current__',Kt.value=e?.id??'__current__',Yt.value=!0}function Wo(){if(!ca.value)return void toastr.warning('ËØ∑ÂÖàÈÄâÊã©Êù°ÁõÆ');So('ÊâãÂä®Êù°ÁõÆÂø´ÁÖß',ca.value)?toastr.success('Â∑≤ËÆ∞ÂΩïÂΩìÂâçÊù°ÁõÆÂø´ÁÖß'):toastr.info('ÂΩìÂâçÊù°ÁõÆ‰∏éÊúÄËøëÂø´ÁÖß‰∏ÄËá¥ÔºåÊú™ÈáçÂ§çËÆ∞ÂΩï')}function Lo(){const e=Va.value;e&&!e.isCurrent&&confirm(`ÊÅ¢Â§çÂà∞ Left ÁâàÊú¨ "${e.label}" ? ÂΩìÂâçÊú™‰øùÂ≠ò‰øÆÊîπ‰ºöË¢´Ë¶ÜÁõñ„ÄÇ`)&&(kt.value=uo(n(e.entries)),ko(),mo(`Â∑≤‰ªéÊó∂ÂÖâÊú∫ÊÅ¢Â§çÔºö${e.label}`),toastr.success('Â∑≤ÊÅ¢Â§çÊï¥Êú¨‰∏ñÁïå‰π¶Âà∞ Left ÁâàÊú¨'))}function Io(){xt.value&&wa.value.length&&confirm(`Ê∏ÖÁ©∫ "${xt.value}" ÁöÑÂÖ®ÈÉ®Âø´ÁÖßÔºü`)&&bo(e=>{delete e.history[xt.value]})}function Mo(){const e=Na.value;if(!e||e.isCurrent)return;if(!ca.value||ua.value<0)return;if(!confirm(`ÂõûÊªöÂΩìÂâçÊù°ÁõÆÂà∞ "${e.label}" ?`))return;So('ÂõûÊªöÂâçËá™Âä®Âø´ÁÖß',ca.value);const t=co(n(e.entry),ca.value.uid);t.uid=ca.value.uid,kt.value.splice(ua.value,1,t),Bt.value=t.uid,mo(`Â∑≤‰ªéÊù°ÁõÆÊó∂ÂÖâÊú∫ÊÅ¢Â§çÔºö${e.label}`),toastr.success('Â∑≤ÊÅ¢Â§çÊù°ÁõÆÂà∞ Left ÁâàÊú¨')}function To(){if(!xt.value||!ca.value||!ka.value.length)return;if(!confirm(`Ê∏ÖÁ©∫Êù°ÁõÆ #${ca.value.uid} ÁöÑÂéÜÂè≤Âø´ÁÖßÔºü`))return;const e=xt.value,n=String(ca.value.uid);bo(t=>{const a=t.entry_history[e]??{};delete a[n],t.entry_history[e]=a})}function Do(){if(!ca.value)return;const e={id:Ka('clip'),copied_at:Date.now(),name:ca.value.name,entry:co(n(ca.value),ca.value.uid)};bo(n=>{n.clipboard.unshift(e),n.clipboard.length>40&&(n.clipboard.length=40)}),toastr.success('Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø')}function zo(){Ea.value.length&&confirm('Á°ÆÂÆöÊ∏ÖÁ©∫Ââ™Ë¥¥ÊùøÔºü')&&bo(e=>{e.clipboard=[]})}function Oo(){ca.value&&'at_depth'!==ca.value.position.type&&(ca.value.position.role='system',ca.value.position.depth=4)}function $o(){if(!ca.value)return;const e=Rt.value.trim();if(e)try{const t=Ga(JSON.parse(e));if(!t)throw new Error('extra ÂøÖÈ°ªÊòØ JSON ÂØπË±°');ca.value.extra=n(t),toastr.success('extra Â∑≤Â∫îÁî®')}catch(e){toastr.error(`extra JSON Ëß£ÊûêÂ§±Ë¥•: ${e instanceof Error?e.message:String(e)}`)}else ca.value.extra=void 0}function Po(){ca.value&&(ca.value.extra=void 0,Rt.value='')}function Ho(){const e=po(kt.value),n=so(e);kt.value.push(n),Bt.value=e,mo(`Â∑≤Êñ∞Â¢ûÊù°ÁõÆ #${e}`)}function Yo(){if(!ca.value||ua.value<0)return;const e=po(kt.value),t=co(n(ca.value),e);t.uid=e,t.name=`${t.name} (ÂâØÊú¨)`,kt.value.splice(ua.value+1,0,t),Bt.value=e,mo(`Â∑≤Â§çÂà∂Êù°ÁõÆ #${ca.value.uid}`)}function jo(){!ca.value||ua.value<0||confirm(`Á°ÆÂÆöÂà†Èô§Êù°ÁõÆ "${ca.value.name}" ?`)&&(So('Âà†Èô§ÂâçÂø´ÁÖß',ca.value),kt.value.splice(ua.value,1),ko(),mo('Â∑≤Âà†Èô§Êù°ÁõÆ'))}function Uo(e){if(ua.value<0)return;const n=ua.value+e;if(n<0||n>=kt.value.length)return;const[t]=kt.value.splice(ua.value,1);kt.value.splice(n,0,t),Bt.value=t.uid}function Ko(){kt.value=uo(kt.value.map(e=>n(e))),ko(),mo('Â∑≤ÂÆåÊàêÊù°ÁõÆÊ†áÂáÜÂåñ')}function Go(){kt.value.sort((e,n)=>n.position.order-e.position.order),ko(),mo('Â∑≤Êåâ order ÈôçÂ∫èÊéíÂàó')}function qo(e){kt.value.forEach(n=>{n.enabled=e}),mo(e?'Â∑≤ÂêØÁî®ÂÖ®ÈÉ®Êù°ÁõÆ':'Â∑≤Á¶ÅÁî®ÂÖ®ÈÉ®Êù°ÁõÆ')}function Jo(){const e=Wt.value;if(!e)return void toastr.warning('ËØ∑ÂÖàËæìÂÖ•Êü•ÊâæÊñáÊú¨');const n=Eo(It.value);let t=null;if(Mt.value)try{t=new RegExp(e,'g')}catch(e){return void toastr.error(`Ê≠£ÂàôË°®ËææÂºèÊó†Êïà: ${e instanceof Error?e.message:String(e)}`)}let a=0,o=0;for(const r of kt.value){if(wo(r,n)){o+=1;continue}let i=!1;if(Tt.value){const n=t?r.name.replace(t,Lt.value):r.name.split(e).join(Lt.value);n!==r.name&&(r.name=n,i=!0)}if(Dt.value){const n=t?r.content.replace(t,Lt.value):r.content.split(e).join(Lt.value);n!==r.content&&(r.content=n,i=!0)}if(zt.value){const n=to(r.strategy.keys.map(n=>{const a=eo(n);return t?a.replace(t,Lt.value):a.split(e).join(Lt.value)}));JSON.stringify(n.map(eo))!==JSON.stringify(r.strategy.keys.map(eo))&&(r.strategy.keys=n,i=!0)}i&&(a+=1)}mo(`Êü•ÊâæÊõøÊç¢ÂÆåÊàêÔºå‰øÆÊîπ ${a} Êù°ÔºåÊéíÈô§ ${o} Êù°`)}function Zo(){if(!xt.value)return;const e={format:'worldbook_assistant_v1',name:xt.value,exported_at:(new Date).toISOString(),entries:kt.value};!function(e,n){const t=JSON.stringify(n,null,2),a=new Blob([t],{type:'application/json'}),o=URL.createObjectURL(a),r=document.createElement('a');r.href=o,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(o)}(`${xt.value.replace(/[\\/:*?"<>|]/g,'_')}.json`,e)}function Qo(e,n){const t=JSON.parse(n),a=e.replace(/\.[^/.]+$/,'')||'ÂØºÂÖ•‰∏ñÁïå‰π¶';if(Array.isArray(t))return{name:a,entries:uo(t)};const o=Ga(t);if(!o)throw new Error('ÂØºÂÖ•ÂÜÖÂÆπÂøÖÈ°ªÊòØ JSON ÂØπË±°ÊàñÊï∞ÁªÑ');const r=function(e){if(Array.isArray(e.entries))return e.entries;const n=Ga(e.entries);if(n)return Object.values(n);const t=Ga(e.data);if(t){if(Array.isArray(t.entries))return t.entries;const e=Ga(t.entries);if(e)return Object.values(e)}return[]}(o);if(!r.length)throw new Error('Êú™ËØÜÂà´Âà∞ÊúâÊïàÁöÑ entries');const i=Ga(o.data);return{name:qa(o.name??i?.name,a).trim()||a,entries:uo(r)}}function Xo(){_t.value?.click()}async function er(e){const n=e.target,t=n?.files?.[0];if(!t)return;const a=await t.text();try{const e=Qo(t.name,a),n=e.name||t.name.replace(/\.[^/.]+$/,''),o=qa(prompt('ËØ∑ËæìÂÖ•Êñ∞‰∏ñÁïå‰π¶ÂêçÁß∞',n)).trim();if(!o)return;await createOrReplaceWorldbook(o,e.entries,{render:'immediate'}),await cr(o),await nr(),toastr.success(`Â∑≤ÂØºÂÖ•‰∏∫Êñ∞‰∏ñÁïå‰π¶: ${o}`)}catch(e){const n=e instanceof Error?e.message:String(e);if(!confirm(`Ëß£ÊûêÂØºÂÖ•Êñá‰ª∂Â§±Ë¥•: ${n}\nÊòØÂê¶Â∞ùËØïÊåâÈÖíÈ¶ÜÂéüÁîüÊñπÂºèÂØºÂÖ•Ôºü`))return;const o=await importRawWorldbook(t.name,a);if(!o.ok)throw new Error(`ÂéüÁîüÂØºÂÖ•Â§±Ë¥•: HTTP ${o.status}`);await ur(),toastr.success('Â∑≤ÊåâÈÖíÈ¶ÜÂéüÁîüÊñπÂºèÂØºÂÖ•')}finally{n&&(n.value='')}}async function nr(){ia.global=[...getGlobalWorldbookNames()];try{const e=getCharWorldbookNames('current');ia.charPrimary=e.primary,ia.charAdditional=[...e.additional]}catch{ia.charPrimary=null,ia.charAdditional=[]}try{ia.chat=getChatWorldbookName('current')}catch{ia.chat=null}Et.value&&tr()}function tr(){if(!Et.value)return;const e=va.value;e.length?e.includes(xt.value)||(xt.value=e[0]):xt.value=''}function ar(e={}){if(Et.value)return!1;if(e.preferWhenEmptyOnly&&xt.value)return!1;const n=function(){const e=ht.value;if(!e.length)return null;const n=qa(ia.chat).trim();if(n&&e.includes(n))return n;const t=qa(ia.charPrimary).trim();return t&&e.includes(t)?t:ia.charAdditional.find(n=>e.includes(n))??null}();return!(!n||n===xt.value)&&(!e.force&&ma.value?(mo('Ê£ÄÊµãÂà∞ËÅäÂ§©/ËßíËâ≤‰∏ñÁïå‰π¶ÂèòÊõ¥Ôºå‰ΩÜÂΩìÂâçÊúâÊú™‰øùÂ≠ò‰øÆÊîπÔºåÂ∑≤Ë∑≥ËøáËá™Âä®ÂàáÊç¢'),!1):(xt.value=n,mo(`Â∑≤Ëá™Âä®ÂÆö‰ΩçÂà∞‰∏ä‰∏ãÊñá‰∏ñÁïå‰π¶: ${n}`),!0))}function or(){if(Et.value=!Et.value,Et.value)return tr(),void mo('Â∑≤ÂàáÊç¢Âà∞ÂÖ®Â±Ä‰∏ñÁïå‰π¶Ê®°Âºè');xt.value||ar({force:!0}),mo('Â∑≤ÂàáÊç¢Âà∞‰∏ä‰∏ãÊñá‰∏ñÁïå‰π¶Ê®°Âºè')}async function rr(e,n='Â∑≤Êõ¥Êñ∞ÂÖ®Â±Ä‰∏ñÁïå‰π¶'){const t=[...new Set(e.map(e=>e.trim()).filter(Boolean))].filter(e=>ht.value.includes(e));try{return await rebindGlobalWorldbooks(t),await nr(),tr(),mo(`${n}Ôºà${t.length} Êú¨Ôºâ`),!0}catch(e){const n=e instanceof Error?e.message:String(e);return toastr.error(`Êõ¥Êñ∞ÂÖ®Â±Ä‰∏ñÁïå‰π¶Â§±Ë¥•: ${n}`),!1}}function ir(){const e=Ca.value[0];e&&lr(e)}async function lr(e){if(!e||ia.global.includes(e))return;await rr([...ia.global,e],`Â∑≤Ê∑ªÂä†Âà∞ÂÖ®Â±Ä: ${e}`)&&(Vt.value='')}async function sr(){ia.global.length&&confirm('Á°ÆÂÆöÊ∏ÖÁ©∫ÊâÄÊúâÂÖ®Â±Ä‰∏ñÁïå‰π¶ÂêóÔºü')&&await rr([],'Â∑≤Ê∏ÖÁ©∫ÂÖ®Â±Ä‰∏ñÁïå‰π¶')}async function dr(e){if(e){$t.value=!0;try{const t=uo(await getWorldbook(e));kt.value=n(t),wt.value=n(t),ko(),mo(`Â∑≤Âä†ËΩΩ "${e}"ÔºåÊù°ÁõÆ ${t.length}`)}catch(e){const n=e instanceof Error?e.message:String(e);toastr.error(`ËØªÂèñ‰∏ñÁïå‰π¶Â§±Ë¥•: ${n}`),mo(`ËØªÂèñÂ§±Ë¥•: ${n}`)}finally{$t.value=!1}}}async function cr(e){const n=[...getWorldbookNames()].sort((e,n)=>e.localeCompare(n,'zh-Hans-CN'));if(ht.value=n,!n.length)return xt.value='',kt.value=[],wt.value=[],void(Bt.value=null);const t=sa.value.last_worldbook,a=e&&n.includes(e)&&e||t&&n.includes(t)&&t||xt.value||n[0];a&&xt.value!==a?xt.value=a:xt.value&&!kt.value.length&&await dr(xt.value)}async function ur(){sa.value=fo(),await cr(xt.value||void 0),await nr(),Et.value?tr():ar({preferWhenEmptyOnly:!0}),mo('Â∑≤Âà∑Êñ∞‰∏ñÁïå‰π¶ÂíåÁªëÂÆö‰ø°ÊÅØ')}async function pr(){if(xt.value)if(ma.value){Pt.value=!0;try{kt.value=uo(kt.value.map(e=>n(e)));const e=No(function(){const e=[],n=new Map;kt.value.forEach(e=>{n.set(e.uid,e)});for(const t of wt.value){const a=n.get(t.uid);a?JSON.stringify(t)!==JSON.stringify(a)&&e.push({label:'‰øùÂ≠òÂâç',uid:t.uid,name:t.name,entry:t}):e.push({label:'‰øùÂ≠òÂâçÔºàÂà†Èô§ÂâçÔºâ',uid:t.uid,name:t.name,entry:t})}return e}());await replaceWorldbook(xt.value,n(kt.value),{render:'immediate'}),wt.value=n(kt.value),_o('‰øùÂ≠òÂêéÂø´ÁÖß'),await nr(),toastr.success(`Â∑≤‰øùÂ≠ò: ${xt.value}`),mo(`‰øùÂ≠òÊàêÂäü: ${xt.value}ÔºàÊù°ÁõÆÂéÜÂè≤ +${e}Ôºâ`)}catch(e){const n=e instanceof Error?e.message:String(e);toastr.error(`‰øùÂ≠òÂ§±Ë¥•: ${n}`),mo(`‰øùÂ≠òÂ§±Ë¥•: ${n}`)}finally{Pt.value=!1}}else mo('ÂΩìÂâçÊ≤°ÊúâÈúÄË¶Å‰øùÂ≠òÁöÑ‰øÆÊîπ');else toastr.warning('ËØ∑ÂÖàÈÄâÊã©‰∏ñÁïå‰π¶')}async function fr(){const e=qa(prompt('ËØ∑ËæìÂÖ•Êñ∞‰∏ñÁïå‰π¶ÂêçÁß∞')).trim();if(e)try{await createOrReplaceWorldbook(e,[],{render:'immediate'}),await cr(e),await nr(),toastr.success(`Â∑≤ÂàõÂª∫‰∏ñÁïå‰π¶: ${e}`)}catch(e){const n=e instanceof Error?e.message:String(e);toastr.error(`ÂàõÂª∫Â§±Ë¥•: ${n}`)}}async function br(){if(!xt.value)return;const e=`${xt.value}_copy`,t=qa(prompt('ËØ∑ËæìÂÖ•Â§çÂà∂ÂêéÁöÑÂêçÁß∞',e)).trim();if(t)try{await createOrReplaceWorldbook(t,n(kt.value),{render:'immediate'}),await cr(t),await nr(),toastr.success(`Â∑≤Â§çÂà∂‰∏∫: ${t}`)}catch(e){const n=e instanceof Error?e.message:String(e);toastr.error(`Â§çÂà∂Â§±Ë¥•: ${n}`)}}async function mr(){if(!xt.value)return;const e=xt.value;if(confirm(`Á°ÆÂÆöÂà†Èô§‰∏ñÁïå‰π¶ "${e}" ?`))try{if(!await deleteWorldbook(e))throw new Error('ËøîÂõû false');bo(n=>{delete n.history[e],delete n.entry_history[e]}),toastr.success(`Â∑≤Âà†Èô§: ${e}`),await cr(),await nr()}catch(e){const n=e instanceof Error?e.message:String(e);toastr.error(`Âà†Èô§Â§±Ë¥•: ${n}`)}}async function gr(){if(!xt.value)return;const e=new Set(getGlobalWorldbookNames());e.has(xt.value)?e.delete(xt.value):e.add(xt.value),await rr([...e],'Â∑≤Êõ¥Êñ∞ÂÖ®Â±ÄÁªëÂÆö')}function yr(){la.value=[]}function Ar(){return ea.value?.ownerDocument?.defaultView??na.value?.ownerDocument?.defaultView??window}function vr(e){const n=Ar(),t=n.innerWidth,a=n.innerHeight,o=Math.max(8,t-e.width-8),r=Math.max(8,a-68);e.x=Za(e.x,8,o),e.y=Za(e.y,8,r)}function Cr(){Xt.value=Ar().innerWidth,function(){if(ga.value)return;const e=ea.value?.getBoundingClientRect();if(e){const n=Math.max(gt,Math.floor(e.width-yt-mt));ta.value=Za(ta.value,gt,n)}const n=na.value?.getBoundingClientRect();if(n){const e=Math.max(At,Math.floor(n.width-vt-mt));aa.value=Za(aa.value,At,e)}}();for(const e of Qt)Jt[e].visible&&vr(Jt[e])}function hr(e){qt.value+=1,Jt[e].z=qt.value}function xr(e){Jt[e].visible=!1,Zt.value?.key===e&&Nr()}function Er(e){Jt[e].visible?xr(e):function(e){const n=Jt[e];n.visible=!0,vr(n),hr(e)}(e)}function wr(e){const n=Jt[e];return{left:`${n.x}px`,top:`${n.y}px`,zIndex:String(n.z),width:`${n.width}px`}}function kr(e,n){if('mouse'===n.pointerType&&0!==n.button)return;const t=Jt[e],a=n.currentTarget;if(!a)return;const o=a.ownerDocument??document,r=o.defaultView??window,i=a.getBoundingClientRect();hr(e);const l={key:e,pointerId:n.pointerId,offsetX:n.clientX-t.x,offsetY:n.clientY-t.y,doc:o,win:r};Zt.value=l,a.setPointerCapture?.(n.pointerId),o.addEventListener('pointermove',Br),o.addEventListener('pointerup',Nr),o.addEventListener('pointercancel',Nr),r.addEventListener('blur',Nr),t.x=Za(n.clientX-l.offsetX,8,Math.max(8,r.innerWidth-t.width-8)),t.y=Za(n.clientY-l.offsetY,8,Math.max(8,r.innerHeight-i.height-8)),n.preventDefault()}function Br(e){const n=Zt.value;if(!n)return;if(e.pointerId!==n.pointerId)return;const t=Jt[n.key];t.x=Za(e.clientX-n.offsetX,8,Math.max(8,n.win.innerWidth-t.width-8)),t.y=Za(e.clientY-n.offsetY,8,Math.max(8,n.win.innerHeight-68))}function Nr(){const e=Zt.value;e&&(e.doc.removeEventListener('pointermove',Br),e.doc.removeEventListener('pointerup',Nr),e.doc.removeEventListener('pointercancel',Nr),e.win.removeEventListener('blur',Nr)),Zt.value=null}function Sr(e,n){if(ga.value)return;if('mouse'===n.pointerType&&0!==n.button)return;const t=n.currentTarget,a=t?.ownerDocument??document,o=a.defaultView??window;oa.value={key:e,pointerId:n.pointerId,doc:a,win:o},t?.setPointerCapture?.(n.pointerId),a.addEventListener('pointermove',_r),a.addEventListener('pointerup',Rr),a.addEventListener('pointercancel',Rr),o.addEventListener('blur',Rr),n.preventDefault()}function _r(e){const n=oa.value;if(!n||e.pointerId!==n.pointerId)return;if('main'===n.key){const n=ea.value?.getBoundingClientRect();if(!n)return;const t=Math.floor(e.clientX-n.left),a=Math.max(gt,Math.floor(n.width-yt-mt));return void(ta.value=Za(t,gt,a))}const t=na.value?.getBoundingClientRect();if(!t)return;const a=Math.floor(t.right-e.clientX),o=Math.max(At,Math.floor(t.width-vt-mt));aa.value=Za(a,At,o)}function Rr(){const e=oa.value;e&&(e.doc.removeEventListener('pointermove',_r),e.doc.removeEventListener('pointerup',Rr),e.doc.removeEventListener('pointercancel',Rr),e.win.removeEventListener('blur',Rr)),oa.value=null}function Vr(){ur()}function Fr(){pr()}return(0,r.watch)(xt,e=>{if(!e)return kt.value=[],wt.value=[],void(Bt.value=null);bo(n=>{n.last_worldbook=e}),dr(e)}),(0,r.watch)(()=>Bt.value,()=>{!function(){if(!ca.value||!ca.value.extra)return void(Rt.value='');Rt.value=JSON.stringify(ca.value.extra,null,2)}()}),(0,r.watch)(Ba,e=>{if(!e.length)return jt.value='',void(Ut.value='');const n=new Set(e.map(e=>e.id));if(n.has(Ut.value)||(Ut.value='__current__'),!n.has(jt.value)){const n=e.find(e=>!e.isCurrent)??e[0];jt.value=n.id}if(jt.value===Ut.value&&e.length>1){const n=e.find(e=>e.id!==Ut.value);n&&(jt.value=n.id)}},{immediate:!0}),(0,r.watch)(Ra,e=>{if(!e.length)return Kt.value='',void(Gt.value='');const n=new Set(e.map(e=>e.id));if(n.has(Gt.value)||(Gt.value='__current__'),!n.has(Kt.value)){const n=e.find(e=>!e.isCurrent)??e[0];Kt.value=n.id}if(Kt.value===Gt.value&&e.length>1){const n=e.find(e=>e.id!==Gt.value);n&&(Kt.value=n.id)}},{immediate:!0}),(0,r.watch)(()=>ca.value?.position.type,()=>{ca.value&&'at_depth'!==ca.value.position.type&&(ca.value.position.role='system',ca.value.position.depth=4)}),(0,r.watch)(ma,e=>{window[bt]=e},{immediate:!0}),(0,r.onMounted)(()=>{sa.value=fo(),da.push(eventOn(tavern_events.WORLD_INFO_ACTIVATED,e=>{!function(e){const n=e.map(e=>{const n=e.uid??e.displayIndex??'?',t=qa(e.name??e.comment,`UID ${n}`),a=qa(e.content).replace(/\s+/g,' ').trim().slice(0,80);return{id:Ka('activation'),time:Date.now(),world:qa(e.world,'unknown'),uid:'number'==typeof n||'string'==typeof n?n:'?',name:t,contentPreview:a||'(Á©∫ÂÜÖÂÆπ)'}});la.value.unshift(...n),la.value.length>120&&(la.value.length=120)}(e)})),da.push(eventOn(tavern_events.WORLDINFO_UPDATED,()=>{ur()})),da.push(eventOn(tavern_events.CHAT_CHANGED,()=>{(async()=>{await nr(),Et.value?tr():ar()})()})),window.addEventListener('wb-helper:refresh',Vr),window.addEventListener('wb-helper:save',Fr),ra.value=Ar(),ra.value.addEventListener('resize',Cr),Cr(),ur()}),(0,r.onUnmounted)(()=>{window[bt]=!1,da.forEach(e=>{e.stop()}),Nr(),Rr(),window.removeEventListener('wb-helper:refresh',Vr),window.removeEventListener('wb-helper:save',Fr),ra.value?.removeEventListener('resize',Cr),ra.value=null}),(e,t)=>((0,r.openBlock)(),(0,r.createElementBlock)('div',i,[(0,r.createElementVNode)('section',l,[(0,r.createElementVNode)('label',s,[t[62]||(t[62]=(0,r.createTextVNode)(' ‰∏ñÁïå‰π¶ ',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[0]||(t[0]=e=>(0,r.isRef)(xt)?xt.value=e:null),class:'toolbar-select'},[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)((0,r.unref)(va),e=>((0,r.openBlock)(),(0,r.createElementBlock)('option',{key:e,value:e},(0,r.toDisplayString)(e),9,d))),128))],512),[[r.vModelSelect,(0,r.unref)(xt)]])]),(0,r.createElementVNode)('button',{class:'btn',type:'button',onClick:fr},'Êñ∞Âª∫'),(0,r.createElementVNode)('button',{class:'btn',type:'button',disabled:!(0,r.unref)(xt),onClick:br},' Âè¶Â≠ò‰∏∫ ',8,c),(0,r.createElementVNode)('button',{class:'btn danger',type:'button',disabled:!(0,r.unref)(xt),onClick:mr},' Âà†Èô§ ',8,u),(0,r.createElementVNode)('button',{class:'btn',type:'button',disabled:!(0,r.unref)(xt),onClick:Zo},' ÂØºÂá∫ ',8,p),(0,r.createElementVNode)('button',{class:'btn',type:'button',onClick:Xo},'ÂØºÂÖ•'),(0,r.createElementVNode)('input',{ref_key:'importFileInput',ref:_t,class:'hidden-input',type:'file',accept:'.json,application/json',onChange:er},null,544)]),(0,r.createElementVNode)('section',f,[(0,r.createElementVNode)('div',b,[(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['btn history-btn utility-btn',{active:(0,r.unref)(Et)}]),type:'button',onClick:or},' üåê ÂÖ®Â±ÄÊ®°Âºè ',2),(0,r.createElementVNode)('button',{class:'btn history-btn',type:'button',disabled:!(0,r.unref)(ca),onClick:Vo},' üï∞Ô∏è Êù°ÁõÆÊó∂ÂÖâÊú∫ ',8,m),(0,r.createElementVNode)('button',{class:'btn history-btn',type:'button',disabled:!(0,r.unref)(xt),onClick:Fo},' ‚è™ Êï¥Êú¨Êó∂ÂÖâÊú∫ ',8,g),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['btn history-btn utility-btn',{active:(0,r.unref)(Jt).find.visible}]),type:'button',disabled:!(0,r.unref)(kt).length,onClick:t[1]||(t[1]=e=>Er('find'))},' üîé Êü•Êâæ‰∏éÊõøÊç¢ ',10,y),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['btn history-btn utility-btn',{active:(0,r.unref)(Jt).clipboard.visible}]),type:'button',onClick:t[2]||(t[2]=e=>Er('clipboard'))},' üìã Ââ™Ë¥¥Êùø ',2),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['btn history-btn utility-btn',{active:(0,r.unref)(Jt).activation.visible}]),type:'button',onClick:t[3]||(t[3]=e=>Er('activation'))},' üì° ÊøÄÊ¥ªÁõëÊéß ',2)]),(0,r.unref)(Et)?((0,r.openBlock)(),(0,r.createElementBlock)('div',A,[(0,r.createElementVNode)('div',v,[(0,r.createElementVNode)('span',C,'ÂÖ®Â±Ä‰∏ñÁïå‰π¶Ôºà'+(0,r.toDisplayString)((0,r.unref)(ia).global.length)+'Ôºâ',1),(0,r.createElementVNode)('button',{class:'btn mini danger',type:'button',disabled:!(0,r.unref)(ia).global.length,onClick:sr},' Ê∏ÖÁ©∫ÂÖ®Â±Ä ',8,h)]),(0,r.createElementVNode)('div',x,[(0,r.createElementVNode)('div',E,[(0,r.createElementVNode)('label',w,[t[63]||(t[63]=(0,r.createElementVNode)('span',null,'ÊêúÁ¥¢Âπ∂Ê∑ªÂä†Â∏∏È©ª‰∏ñÁïå‰π¶',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[4]||(t[4]=e=>(0,r.isRef)(Vt)?Vt.value=e:null),type:'text',class:'text-input',placeholder:'ÊêúÁ¥¢Âπ∂Ê∑ªÂä†Â∏∏È©ª‰∏ñÁïå‰π¶...',onKeydown:(0,r.withKeys)((0,r.withModifiers)(ir,['prevent']),['enter'])},null,40,k),[[r.vModelText,(0,r.unref)(Vt)]])]),(0,r.createElementVNode)('div',B,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)((0,r.unref)(Ca),e=>((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:`add-${e}`,class:'global-mode-item add',type:'button',onClick:n=>lr(e)},[(0,r.createElementVNode)('span',S,(0,r.toDisplayString)(e),1),t[64]||(t[64]=(0,r.createElementVNode)('span',{class:'global-mode-item-action'},'Ê∑ªÂä†',-1))],8,N))),128)),(0,r.unref)(Ca).length?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',R,'Ê≤°ÊúâÂèØÊ∑ªÂä†ÁöÑ‰∏ñÁïå‰π¶'))])]),(0,r.createElementVNode)('div',V,[(0,r.createElementVNode)('label',F,[t[65]||(t[65]=(0,r.createElementVNode)('span',null,'Á≠õÈÄâÂ∏∏È©ª‰∏ñÁïå‰π¶',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[5]||(t[5]=e=>(0,r.isRef)(Ft)?Ft.value=e:null),type:'text',class:'text-input',placeholder:'Á≠õÈÄâÂ∏∏È©ª‰∏ñÁïå‰π¶...'},null,512),[[r.vModelText,(0,r.unref)(Ft)]])]),(0,r.createElementVNode)('div',W,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)((0,r.unref)(ha),e=>((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:`global-${e}`,class:'global-mode-item active',type:'button',onClick:n=>async function(e){e&&ia.global.includes(e)&&await rr(ia.global.filter(n=>n!==e),`Â∑≤ÁßªÂá∫ÂÖ®Â±Ä: ${e}`)}(e)},[(0,r.createElementVNode)('span',I,(0,r.toDisplayString)(e),1),t[66]||(t[66]=(0,r.createElementVNode)('span',{class:'global-mode-item-action'},'ÁßªÈô§',-1))],8,L))),128)),(0,r.unref)(ha).length?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',M,(0,r.toDisplayString)((0,r.unref)(ia).global.length?'Ê≤°ÊúâÂåπÈÖçÁªìÊûú':'ÊöÇÊó†Â∏∏È©ª‰∏ñÁïå‰π¶'),1))])])]),(0,r.createElementVNode)('div',T,[(0,r.createElementVNode)('button',{class:'btn',type:'button',disabled:!(0,r.unref)(xt),onClick:gr},(0,r.toDisplayString)((0,r.unref)(xa)?'ÁßªÂá∫ÂÖ®Â±Ä':'Âä†ÂÖ•ÂÖ®Â±Ä'),9,D)])])):(0,r.createCommentVNode)('v-if',!0)]),(0,r.createElementVNode)('section',{ref_key:'mainLayoutRef',ref:ea,class:'wb-main-layout',style:(0,r.normalizeStyle)((0,r.unref)(ya))},[(0,r.createElementVNode)('aside',O,[(0,r.createElementVNode)('div',P,[(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[6]||(t[6]=e=>(0,r.isRef)(Nt)?Nt.value=e:null),type:'text',class:'text-input',placeholder:'ÊêúÁ¥¢ÂêçÁß∞ / ÂÜÖÂÆπ / ÂÖ≥ÈîÆËØç'},null,512),[[r.vModelText,(0,r.unref)(Nt)]]),(0,r.createElementVNode)('label',H,[(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[7]||(t[7]=e=>(0,r.isRef)(St)?St.value=e:null),type:'checkbox'},null,512),[[r.vModelCheckbox,(0,r.unref)(St)]]),t[67]||(t[67]=(0,r.createElementVNode)('span',null,'‰ªÖÂêØÁî®',-1))])]),(0,r.createElementVNode)('div',Y,' Êù°ÁõÆ '+(0,r.toDisplayString)((0,r.unref)(pa).length)+' / '+(0,r.toDisplayString)((0,r.unref)(kt).length)+' | ÂêØÁî® '+(0,r.toDisplayString)((0,r.unref)(fa)),1),(0,r.createElementVNode)('div',j,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)((0,r.unref)(pa),e=>((0,r.openBlock)(),(0,r.createElementBlock)('button',{key:e.uid,type:'button',class:(0,r.normalizeClass)(['entry-item',{selected:e.uid===(0,r.unref)(Bt),disabled:!e.enabled}]),'data-status':oo(e),onClick:n=>{return t=e.uid,void(Bt.value=t);var t}},[(0,r.createElementVNode)('div',K,[(0,r.createElementVNode)('span',{class:'entry-status-dot','data-status':oo(e)},null,8,G),(0,r.createElementVNode)('div',q,(0,r.toDisplayString)(e.name||`Êù°ÁõÆ ${e.uid}`),1),(0,r.createElementVNode)('span',J,'#'+(0,r.toDisplayString)(e.uid),1)]),(0,r.createElementVNode)('div',Z,[(0,r.createElementVNode)('span',{class:'entry-chip status','data-status':oo(e)},(0,r.toDisplayString)(ro(e)),9,Q),(0,r.createElementVNode)('span',X,'üîë '+(0,r.toDisplayString)(e.strategy.keys.length),1),(0,r.createElementVNode)('span',ee,'üéØ '+(0,r.toDisplayString)(e.probability),1),(0,r.createElementVNode)('span',ne,'#'+(0,r.toDisplayString)(e.position.order),1)]),(0,r.createElementVNode)('div',te,(0,r.toDisplayString)(io(e)),1)],10,U))),128))]),(0,r.createElementVNode)('div',ae,[(0,r.createElementVNode)('button',{class:'btn',type:'button',disabled:!(0,r.unref)(xt),onClick:Ho},'Êñ∞Â¢û',8,oe),(0,r.createElementVNode)('button',{class:'btn',type:'button',disabled:!(0,r.unref)(ca),onClick:Yo},' Â§çÂà∂ ',8,re),(0,r.createElementVNode)('button',{class:'btn danger',type:'button',disabled:!(0,r.unref)(ca),onClick:jo},' Âà†Èô§ ',8,ie),(0,r.createElementVNode)('button',{class:'btn',type:'button',disabled:!(0,r.unref)(ca),onClick:t[8]||(t[8]=e=>Uo(-1))},' ‰∏äÁßª ',8,le),(0,r.createElementVNode)('button',{class:'btn',type:'button',disabled:!(0,r.unref)(ca),onClick:t[9]||(t[9]=e=>Uo(1))},'‰∏ãÁßª',8,se)])]),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['wb-resize-handle main',{dragging:'main'===(0,r.unref)(oa)?.key}]),onPointerdown:t[10]||(t[10]=e=>Sr('main',e))},null,34),(0,r.createElementVNode)('main',de,[(0,r.unref)(ca)?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,ref_key:'editorShellRef',ref:na,class:'wb-editor-shell',style:(0,r.normalizeStyle)((0,r.unref)(Aa))},[(0,r.createElementVNode)('section',ce,[(0,r.createElementVNode)('header',ue,[(0,r.createElementVNode)('label',pe,[t[68]||(t[68]=(0,r.createElementVNode)('span',null,'Â§áÊ≥® (COMMENT)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[11]||(t[11]=e=>(0,r.unref)(ca).name=e),type:'text',class:'text-input'},null,512),[[r.vModelText,(0,r.unref)(ca).name]])]),(0,r.createElementVNode)('div',fe,[(0,r.createElementVNode)('span',{class:(0,r.normalizeClass)(['editor-badge',(0,r.unref)(ca).enabled?'on':'off'])},(0,r.toDisplayString)((0,r.unref)(ca).enabled?'EN':'OFF'),3),(0,r.createElementVNode)('span',{class:'editor-badge strategy','data-status':oo((0,r.unref)(ca))},(0,r.toDisplayString)(ro((0,r.unref)(ca))),9,be),(0,r.createElementVNode)('span',me,'#'+(0,r.toDisplayString)((0,r.unref)(ca).uid),1),(0,r.createElementVNode)('span',ge,'Chars '+(0,r.toDisplayString)((0,r.unref)(ja)),1),(0,r.createElementVNode)('span',ye,'~'+(0,r.toDisplayString)((0,r.unref)(Ua))+'T',1)])]),(0,r.createElementVNode)('section',Ae,[(0,r.createElementVNode)('label',ve,[t[69]||(t[69]=(0,r.createElementVNode)('span',null,'‰∏ªË¶ÅÂÖ≥ÈîÆËØç (KEYS)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[12]||(t[12]=e=>(0,r.isRef)(Da)?Da.value=e:null),class:'text-area compact'},null,512),[[r.vModelText,(0,r.unref)(Da)]])]),(0,r.createElementVNode)('label',Ce,[t[70]||(t[70]=(0,r.createElementVNode)('span',null,'Ê¨°Ë¶ÅÂÖ≥ÈîÆËØç (SECONDARY)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[13]||(t[13]=e=>(0,r.isRef)(za)?za.value=e:null),class:'text-area compact'},null,512),[[r.vModelText,(0,r.unref)(za)]])])]),(0,r.createElementVNode)('section',he,[t[71]||(t[71]=(0,r.createElementVNode)('div',{class:'editor-content-title'},'‰∏ñÁïåËßÇËÆæÂÆö / ÂÜÖÂÆπ (CONTENT)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[14]||(t[14]=e=>(0,r.unref)(ca).content=e),class:'text-area large editor-content-area'},null,512),[[r.vModelText,(0,r.unref)(ca).content]])]),(0,r.createElementVNode)('details',xe,[t[73]||(t[73]=(0,r.createElementVNode)('summary',null,'È´òÁ∫ßÂ≠óÊÆµ / extra JSON',-1)),(0,r.createElementVNode)('label',Ee,[t[72]||(t[72]=(0,r.createElementVNode)('span',null,'extra JSONÔºàÊú™Áü•Â≠óÊÆµÔºâ',-1)),(0,r.withDirectives)((0,r.createElementVNode)('textarea',{'onUpdate:modelValue':t[15]||(t[15]=e=>(0,r.isRef)(Rt)?Rt.value=e:null),class:'text-area compact',placeholder:'{ ... }'},null,512),[[r.vModelText,(0,r.unref)(Rt)]])]),(0,r.createElementVNode)('div',{class:'field-actions'},[(0,r.createElementVNode)('button',{class:'btn',type:'button',onClick:$o},'Â∫îÁî® extra'),(0,r.createElementVNode)('button',{class:'btn',type:'button',onClick:Po},'Ê∏ÖÁ©∫ extra'),(0,r.createElementVNode)('button',{class:'btn',type:'button',onClick:Do},'Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø')])])]),(0,r.createElementVNode)('div',{class:(0,r.normalizeClass)(['wb-resize-handle editor',{dragging:'editor'===(0,r.unref)(oa)?.key}]),onPointerdown:t[16]||(t[16]=e=>Sr('editor',e))},null,34),(0,r.createElementVNode)('aside',we,[(0,r.createElementVNode)('article',ke,[t[79]||(t[79]=(0,r.createElementVNode)('h4',null,'Ëß¶ÂèëÁ≠ñÁï• (STRATEGY)',-1)),(0,r.createElementVNode)('label',Be,[(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[17]||(t[17]=e=>(0,r.unref)(ca).enabled=e),type:'checkbox'},null,512),[[r.vModelCheckbox,(0,r.unref)(ca).enabled]]),t[74]||(t[74]=(0,r.createElementVNode)('span',null,'ÂêØÁî®Êù°ÁõÆ',-1))]),(0,r.createElementVNode)('div',Ne,[(0,r.createElementVNode)('button',{type:'button',class:(0,r.normalizeClass)(['strategy-pill constant',{active:'constant'===(0,r.unref)(ca).strategy.type}]),onClick:t[18]||(t[18]=e=>(0,r.unref)(ca).strategy.type='constant')},' üîµ Â∏∏È©ª (Constant) ',2),(0,r.createElementVNode)('button',{type:'button',class:(0,r.normalizeClass)(['strategy-pill vector',{active:'vectorized'===(0,r.unref)(ca).strategy.type}]),onClick:t[19]||(t[19]=e=>(0,r.unref)(ca).strategy.type='vectorized')},' üìé ÂêëÈáèÂåñ (Vector) ',2),(0,r.createElementVNode)('button',{type:'button',class:(0,r.normalizeClass)(['strategy-pill selective',{active:'selective'===(0,r.unref)(ca).strategy.type}]),onClick:t[20]||(t[20]=e=>(0,r.unref)(ca).strategy.type='selective')},' üü¢ ÂÖ≥ÈîÆËØç (Selective) ',2)]),(0,r.createElementVNode)('details',Se,[t[78]||(t[78]=(0,r.createElementVNode)('summary',null,'È´òÁ∫ßËÆæÁΩÆ',-1)),(0,r.createElementVNode)('label',_e,[t[75]||(t[75]=(0,r.createElementVNode)('span',null,'Ê¨°Ë¶ÅÈÄªËæë (LOGIC)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[21]||(t[21]=e=>(0,r.unref)(ca).strategy.keys_secondary.logic=e),class:'text-input'},[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(o,e=>(0,r.createElementVNode)('option',{key:e,value:e},(0,r.toDisplayString)({and_any:'‰ªª‰∏ÄÂëΩ‰∏≠ (and_any)',and_all:'ÂÖ®ÈÉ®ÂëΩ‰∏≠ (and_all)',not_all:'‰∏çÂÖ®ÂëΩ‰∏≠ (not_all)',not_any:'ÂÖ®ÈÉ®‰∏çÂëΩ‰∏≠ (not_any)'}[e]),9,Re)),64))],512),[[r.vModelSelect,(0,r.unref)(ca).strategy.keys_secondary.logic]])]),(0,r.createElementVNode)('label',Ve,[t[76]||(t[76]=(0,r.createElementVNode)('span',null,'Êâ´ÊèèÊ∑±Â∫¶',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[22]||(t[22]=e=>(0,r.isRef)(Oa)?Oa.value=e:null),type:'text',class:'text-input',placeholder:'ÁïôÁ©∫Êàñ same_as_global'},null,512),[[r.vModelText,(0,r.unref)(Oa)]])]),(0,r.createElementVNode)('label',Fe,[t[77]||(t[77]=(0,r.createElementVNode)('span',null,'Ê¶ÇÁéá(0-100)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[23]||(t[23]=e=>(0,r.unref)(ca).probability=e),type:'number',class:'text-input',min:'0',max:'100',step:'1'},null,512),[[r.vModelText,(0,r.unref)(ca).probability,void 0,{number:!0}]])])])]),(0,r.createElementVNode)('article',We,[t[85]||(t[85]=(0,r.createElementVNode)('h4',null,'ÊèíÂÖ•ËÆæÁΩÆ (INSERTION)',-1)),(0,r.createElementVNode)('label',Le,[t[80]||(t[80]=(0,r.createElementVNode)('span',null,'‰ΩçÁΩÆ (Position)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[24]||(t[24]=e=>(0,r.unref)(ca).position.type=e),class:'text-input',onChange:Oo},[((0,r.openBlock)(),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)(Ct,e=>(0,r.createElementVNode)('option',{key:e,value:e},(0,r.toDisplayString)({before_character_definition:'ËßíËâ≤ËÆæÂÆöÂâç',after_character_definition:'ËßíËâ≤ËÆæÂÆöÂêé',before_example_messages:'Á§∫‰æãÊ∂àÊÅØÂâç',after_example_messages:'Á§∫‰æãÊ∂àÊÅØÂêé',before_author_note:'‰ΩúËÄÖÊ≥®ÈáäÂâç',after_author_note:'‰ΩúËÄÖÊ≥®ÈáäÂêé',at_depth:'ÊåáÂÆöÊ∑±Â∫¶ÊèíÂÖ•'}[e]),9,Ie)),64))],544),[[r.vModelSelect,(0,r.unref)(ca).position.type]])]),(0,r.createElementVNode)('label',Me,[t[81]||(t[81]=(0,r.createElementVNode)('span',null,'ÊùÉÈáç (Order)',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[25]||(t[25]=e=>(0,r.unref)(ca).position.order=e),type:'number',class:'text-input',step:'1'},null,512),[[r.vModelText,(0,r.unref)(ca).position.order,void 0,{number:!0}]])]),(0,r.createElementVNode)('div',Te,[(0,r.createElementVNode)('label',{class:(0,r.normalizeClass)(['field',{disabled:'at_depth'!==(0,r.unref)(ca).position.type}])},[t[83]||(t[83]=(0,r.createElementVNode)('span',null,'at_depth role',-1)),(0,r.withDirectives)((0,r.createElementVNode)('select',{'onUpdate:modelValue':t[26]||(t[26]=e=>(0,r.unref)(ca).position.role=e),class:'text-input',disabled:'at_depth'!==(0,r.unref)(ca).position.type},[...t[82]||(t[82]=[(0,r.createElementVNode)('option',{value:'system'},'system',-1),(0,r.createElementVNode)('option',{value:'assistant'},'assistant',-1),(0,r.createElementVNode)('option',{value:'user'},'user',-1)])],8,De),[[r.vModelSelect,(0,r.unref)(ca).position.role]])],2),(0,r.createElementVNode)('label',{class:(0,r.normalizeClass)(['field',{disabled:'at_depth'!==(0,r.unref)(ca).position.type}])},[t[84]||(t[84]=(0,r.createElementVNode)('span',null,'at_depth depth',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[27]||(t[27]=e=>(0,r.unref)(ca).position.depth=e),type:'number',class:'text-input',min:'1',step:'1',disabled:'at_depth'!==(0,r.unref)(ca).position.type},null,8,ze),[[r.vModelText,(0,r.unref)(ca).position.depth,void 0,{number:!0}]])],2)])]),(0,r.createElementVNode)('article',Oe,[t[92]||(t[92]=(0,r.createElementVNode)('h4',null,'ÈÄíÂΩí‰∏éÊïàÊûú (RECURSION)',-1)),(0,r.createElementVNode)('label',$e,[(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[28]||(t[28]=e=>(0,r.unref)(ca).recursion.prevent_incoming=e),type:'checkbox'},null,512),[[r.vModelCheckbox,(0,r.unref)(ca).recursion.prevent_incoming]]),t[86]||(t[86]=(0,r.createElementVNode)('span',null,'‰∏çÂèØÈÄíÂΩíÂëΩ‰∏≠ (Exclude Incoming)',-1))]),(0,r.createElementVNode)('label',Pe,[(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[29]||(t[29]=e=>(0,r.unref)(ca).recursion.prevent_outgoing=e),type:'checkbox'},null,512),[[r.vModelCheckbox,(0,r.unref)(ca).recursion.prevent_outgoing]]),t[87]||(t[87]=(0,r.createElementVNode)('span',null,'ÈòªÊ≠¢ÂêéÁª≠ÈÄíÂΩí (Prevent Outgoing)',-1))]),(0,r.createElementVNode)('label',He,[t[88]||(t[88]=(0,r.createElementVNode)('span',null,'ÈÄíÂΩíÂª∂ËøüÂ±ÇÁ∫ß',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[30]||(t[30]=e=>(0,r.isRef)($a)?$a.value=e:null),type:'text',class:'text-input',placeholder:'ÁïôÁ©∫Ë°®Á§∫ null'},null,512),[[r.vModelText,(0,r.unref)($a)]])]),(0,r.createElementVNode)('div',Ye,[(0,r.createElementVNode)('label',je,[t[89]||(t[89]=(0,r.createElementVNode)('span',null,'sticky',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[31]||(t[31]=e=>(0,r.isRef)(Pa)?Pa.value=e:null),type:'text',class:'text-input',placeholder:'ÁïôÁ©∫Ë°®Á§∫ null'},null,512),[[r.vModelText,(0,r.unref)(Pa)]])]),(0,r.createElementVNode)('label',Ue,[t[90]||(t[90]=(0,r.createElementVNode)('span',null,'cooldown',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[32]||(t[32]=e=>(0,r.isRef)(Ha)?Ha.value=e:null),type:'text',class:'text-input',placeholder:'ÁïôÁ©∫Ë°®Á§∫ null'},null,512),[[r.vModelText,(0,r.unref)(Ha)]])])]),(0,r.createElementVNode)('label',Ke,[t[91]||(t[91]=(0,r.createElementVNode)('span',null,'delay',-1)),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[33]||(t[33]=e=>(0,r.isRef)(Ya)?Ya.value=e:null),type:'text',class:'text-input',placeholder:'ÁïôÁ©∫Ë°®Á§∫ null'},null,512),[[r.vModelText,(0,r.unref)(Ya)]])])])])],4)):((0,r.openBlock)(),(0,r.createElementBlock)('div',Ge,'ËØ∑ÈÄâÊã©ÊàñÊñ∞Â¢û‰∏Ä‰∏™Êù°ÁõÆÂêéÂºÄÂßãÁºñËæë„ÄÇ'))])],4),(0,r.createElementVNode)('footer',qe,[(0,r.createElementVNode)('span',null,(0,r.toDisplayString)((0,r.unref)($t)?'Âä†ËΩΩ‰∏≠...':(0,r.unref)(Ot)),1),(0,r.createElementVNode)('span',null,' ÂΩìÂâçÊù°ÁõÆ: '+(0,r.toDisplayString)((0,r.unref)(kt).length)+' | ÂÜÖÂÆπÂ≠óÁ¨¶: '+(0,r.toDisplayString)((0,r.unref)(ba))+' | '+(0,r.toDisplayString)((0,r.unref)(ma)?'Â≠òÂú®Êú™‰øùÂ≠ò‰øÆÊîπ':'Â∑≤ÂêåÊ≠•'),1)]),(0,r.unref)(Ht)?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:0,class:'wb-modal-backdrop',onClick:t[35]||(t[35]=(0,r.withModifiers)(e=>Ht.value=!1,['self']))},[(0,r.createElementVNode)('div',Je,[(0,r.createElementVNode)('div',Ze,[(0,r.createElementVNode)('div',null,[t[93]||(t[93]=(0,r.createElementVNode)('strong',null,'üï∞Ô∏è Êù°ÁõÆÊó∂ÂÖâÊú∫',-1)),(0,r.createElementVNode)('span',null,(0,r.toDisplayString)((0,r.unref)(Ma)),1)]),(0,r.createElementVNode)('div',Qe,[(0,r.createElementVNode)('button',{class:'btn mini',type:'button',disabled:!(0,r.unref)(ca),onClick:Wo},' ËÆ∞ÂΩïÊù°ÁõÆ ',8,Xe),(0,r.createElementVNode)('button',{class:'btn mini danger',type:'button',disabled:!(0,r.unref)(ka).length,onClick:To},' Ê∏ÖÁ©∫Êù°ÁõÆÂéÜÂè≤ ',8,en),(0,r.createElementVNode)('button',{class:'btn mini',type:'button',onClick:t[34]||(t[34]=e=>Ht.value=!1)},'ÂÖ≥Èó≠')])]),(0,r.createElementVNode)('div',nn,[(0,r.createElementVNode)('aside',tn,[t[94]||(t[94]=(0,r.createElementVNode)('div',{class:'wb-history-versions-title'},'ÁâàÊú¨ÂàóË°®ÔºàL/RÔºâ',-1)),(0,r.createElementVNode)('div',an,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)((0,r.unref)(Ba),e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'wb-history-version-item'},[(0,r.createElementVNode)('div',on,[(0,r.createElementVNode)('strong',null,(0,r.toDisplayString)(yo(e.label,e.ts,e.isCurrent)),1),(0,r.createElementVNode)('div',rn,[(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['mini-lr',{active:(0,r.unref)(jt)===e.id}]),onClick:n=>jt.value=e.id},'L',10,ln),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['mini-lr',{active:(0,r.unref)(Ut)===e.id}]),onClick:n=>Ut.value=e.id},'R',10,sn)])]),(0,r.createElementVNode)('span',null,(0,r.toDisplayString)(e.name),1)]))),128)),(0,r.unref)(Ba).length<=1?((0,r.openBlock)(),(0,r.createElementBlock)('div',dn,'ÊöÇÊó†ÂéÜÂè≤Êù°ÁõÆÁâàÊú¨')):(0,r.createCommentVNode)('v-if',!0)])]),(0,r.createElementVNode)('section',cn,[(0,r.createElementVNode)('div',un,[(0,r.createElementVNode)('div',null,' Left: '+(0,r.toDisplayString)((0,r.unref)(Na)?yo((0,r.unref)(Na).label,(0,r.unref)(Na).ts,(0,r.unref)(Na).isCurrent):'-')+' | Right: '+(0,r.toDisplayString)((0,r.unref)(Sa)?yo((0,r.unref)(Sa).label,(0,r.unref)(Sa).ts,(0,r.unref)(Sa).isCurrent):'-'),1),(0,r.createElementVNode)('button',{class:'btn mini',type:'button',disabled:!(0,r.unref)(_a),onClick:Mo},' ÊÅ¢Â§çÂà∞ Left ',8,pn)]),(0,r.createElementVNode)('div',fn,[(0,r.createElementVNode)('div',null,[t[95]||(t[95]=(0,r.createElementVNode)('div',{class:'wb-history-diff-title'},'Left',-1)),(0,r.createElementVNode)('div',{class:'wb-history-diff-body',innerHTML:(0,r.unref)(Ia).leftHtml},null,8,bn)]),(0,r.createElementVNode)('div',null,[t[96]||(t[96]=(0,r.createElementVNode)('div',{class:'wb-history-diff-title'},'Right',-1)),(0,r.createElementVNode)('div',{class:'wb-history-diff-body',innerHTML:(0,r.unref)(Ia).rightHtml},null,8,mn)])])])])])])):(0,r.createCommentVNode)('v-if',!0),(0,r.unref)(Yt)?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:1,class:'wb-modal-backdrop',onClick:t[37]||(t[37]=(0,r.withModifiers)(e=>Yt.value=!1,['self']))},[(0,r.createElementVNode)('div',gn,[(0,r.createElementVNode)('div',yn,[(0,r.createElementVNode)('div',null,[t[97]||(t[97]=(0,r.createElementVNode)('strong',null,'‚è™ Êó∂ÂÖâÊú∫ÔºàÊï¥Êú¨ÂõûÊªöÔºâ',-1)),(0,r.createElementVNode)('span',null,(0,r.toDisplayString)(Ao((0,r.unref)(Va),(0,r.unref)(Fa))),1)]),(0,r.createElementVNode)('div',An,[(0,r.createElementVNode)('button',{class:'btn mini',type:'button',disabled:!(0,r.unref)(xt),onClick:Ro},' ÂàõÂª∫Êï¥Êú¨Âø´ÁÖß ',8,vn),(0,r.createElementVNode)('button',{class:'btn mini danger',type:'button',disabled:!(0,r.unref)(wa).length,onClick:Io},' Ê∏ÖÁ©∫Êï¥Êú¨Âø´ÁÖß ',8,Cn),(0,r.createElementVNode)('button',{class:'btn mini',type:'button',onClick:t[36]||(t[36]=e=>Yt.value=!1)},'ÂÖ≥Èó≠')])]),(0,r.createElementVNode)('div',hn,[(0,r.createElementVNode)('aside',xn,[t[98]||(t[98]=(0,r.createElementVNode)('div',{class:'wb-history-versions-title'},'ÁâàÊú¨ÂàóË°®ÔºàL/RÔºâ',-1)),(0,r.createElementVNode)('div',En,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)((0,r.unref)(Ra),e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'wb-history-version-item'},[(0,r.createElementVNode)('div',wn,[(0,r.createElementVNode)('strong',null,(0,r.toDisplayString)(yo(e.label,e.ts,e.isCurrent)),1),(0,r.createElementVNode)('div',kn,[(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['mini-lr',{active:(0,r.unref)(Kt)===e.id}]),onClick:n=>Kt.value=e.id},'L',10,Bn),(0,r.createElementVNode)('button',{class:(0,r.normalizeClass)(['mini-lr',{active:(0,r.unref)(Gt)===e.id}]),onClick:n=>Gt.value=e.id},'R',10,Nn)])]),(0,r.createElementVNode)('span',null,'entries: '+(0,r.toDisplayString)(e.entries.length),1)]))),128))])]),(0,r.createElementVNode)('section',Sn,[(0,r.createElementVNode)('div',_n,[(0,r.createElementVNode)('div',null,' Left: '+(0,r.toDisplayString)((0,r.unref)(Va)?yo((0,r.unref)(Va).label,(0,r.unref)(Va).ts,(0,r.unref)(Va).isCurrent):'-')+' | Right: '+(0,r.toDisplayString)((0,r.unref)(Fa)?yo((0,r.unref)(Fa).label,(0,r.unref)(Fa).ts,(0,r.unref)(Fa).isCurrent):'-'),1),(0,r.createElementVNode)('button',{class:'btn mini',type:'button',disabled:!(0,r.unref)(Wa),onClick:Lo},' ÊÅ¢Â§çÂà∞ Left ',8,Rn)]),(0,r.createElementVNode)('div',Vn,[(0,r.createElementVNode)('div',null,[t[99]||(t[99]=(0,r.createElementVNode)('div',{class:'wb-history-diff-title'},'Left',-1)),(0,r.createElementVNode)('div',{class:'wb-history-diff-body',innerHTML:(0,r.unref)(Ta).leftHtml},null,8,Fn)]),(0,r.createElementVNode)('div',null,[t[100]||(t[100]=(0,r.createElementVNode)('div',{class:'wb-history-diff-title'},'Right',-1)),(0,r.createElementVNode)('div',{class:'wb-history-diff-body',innerHTML:(0,r.unref)(Ta).rightHtml},null,8,Wn)])])])])])])):(0,r.createCommentVNode)('v-if',!0),(0,r.unref)(Jt).find.visible?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:2,class:'wb-floating-window find-window',style:(0,r.normalizeStyle)(wr('find')),onPointerdown:t[51]||(t[51]=e=>hr('find'))},[(0,r.createElementVNode)('div',{class:'wb-floating-header',onPointerdown:t[41]||(t[41]=e=>kr('find',e))},[t[101]||(t[101]=(0,r.createElementVNode)('strong',null,'üîé Êü•Êâæ‰∏éÊõøÊç¢',-1)),(0,r.createElementVNode)('div',Ln,[(0,r.createElementVNode)('button',{class:'btn mini',type:'button',disabled:!(0,r.unref)(kt).length,onPointerdown:t[38]||(t[38]=(0,r.withModifiers)(()=>{},['stop'])),onClick:Jo},' ÊâßË°å ',40,In),(0,r.createElementVNode)('button',{class:'btn mini danger',type:'button',onPointerdown:t[39]||(t[39]=(0,r.withModifiers)(()=>{},['stop'])),onClick:t[40]||(t[40]=e=>xr('find'))},' ÂÖ≥Èó≠ ',32)])],32),(0,r.createElementVNode)('div',Mn,[(0,r.createElementVNode)('div',Tn,[(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[42]||(t[42]=e=>(0,r.isRef)(Wt)?Wt.value=e:null),type:'text',class:'text-input',placeholder:'Êü•ÊâæÊñáÊú¨ / Ê≠£Âàô'},null,512),[[r.vModelText,(0,r.unref)(Wt)]]),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[43]||(t[43]=e=>(0,r.isRef)(Lt)?Lt.value=e:null),type:'text',class:'text-input',placeholder:'ÊõøÊç¢‰∏∫'},null,512),[[r.vModelText,(0,r.unref)(Lt)]]),(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[44]||(t[44]=e=>(0,r.isRef)(It)?It.value=e:null),type:'text',class:'text-input',placeholder:'ÊéíÈô§È°πÔºöÊù°ÁõÆÂêçÂÖ≥ÈîÆËØç / #UIDÔºàÈÄóÂè∑ÊàñÊç¢Ë°åÔºâ'},null,512),[[r.vModelText,(0,r.unref)(It)]]),t[106]||(t[106]=(0,r.createElementVNode)('div',{class:'batch-exclude-note'},'Á§∫‰æã: `#12, name:‰∏ñÁïåËßÇ, Âê∏Ë°ÄÈ¨º`ÔºàÂëΩ‰∏≠ÂêçÁß∞ÊàñÂÖ≥ÈîÆËØçÂç≥ÊéíÈô§Ôºâ',-1)),(0,r.unref)(La).length?((0,r.openBlock)(),(0,r.createElementBlock)('div',Dn,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)((0,r.unref)(La),e=>((0,r.openBlock)(),(0,r.createElementBlock)('span',{key:e,class:'exclude-chip'},(0,r.toDisplayString)(e),1))),128))])):(0,r.createCommentVNode)('v-if',!0),(0,r.createElementVNode)('div',zn,[(0,r.createElementVNode)('label',On,[(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[45]||(t[45]=e=>(0,r.isRef)(Mt)?Mt.value=e:null),type:'checkbox'},null,512),[[r.vModelCheckbox,(0,r.unref)(Mt)]]),t[102]||(t[102]=(0,r.createElementVNode)('span',null,'Ê≠£ÂàôÊ®°Âºè',-1))]),(0,r.createElementVNode)('label',$n,[(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[46]||(t[46]=e=>(0,r.isRef)(Tt)?Tt.value=e:null),type:'checkbox'},null,512),[[r.vModelCheckbox,(0,r.unref)(Tt)]]),t[103]||(t[103]=(0,r.createElementVNode)('span',null,'ÂêçÁß∞',-1))]),(0,r.createElementVNode)('label',Pn,[(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[47]||(t[47]=e=>(0,r.isRef)(Dt)?Dt.value=e:null),type:'checkbox'},null,512),[[r.vModelCheckbox,(0,r.unref)(Dt)]]),t[104]||(t[104]=(0,r.createElementVNode)('span',null,'ÂÜÖÂÆπ',-1))]),(0,r.createElementVNode)('label',Hn,[(0,r.withDirectives)((0,r.createElementVNode)('input',{'onUpdate:modelValue':t[48]||(t[48]=e=>(0,r.isRef)(zt)?zt.value=e:null),type:'checkbox'},null,512),[[r.vModelCheckbox,(0,r.unref)(zt)]]),t[105]||(t[105]=(0,r.createElementVNode)('span',null,'ÂÖ≥ÈîÆËØç',-1))])])]),(0,r.createElementVNode)('details',Yn,[t[107]||(t[107]=(0,r.createElementVNode)('summary',null,'ÈôÑÂä†ÊâπÂ§ÑÁêÜÂ∑•ÂÖ∑',-1)),(0,r.createElementVNode)('div',jn,[(0,r.createElementVNode)('button',{class:'btn',type:'button',disabled:!(0,r.unref)(kt).length,onClick:Ko},' Ê†áÂáÜÂåñÂÖ®ÈÉ® ',8,Un),(0,r.createElementVNode)('button',{class:'btn',type:'button',disabled:!(0,r.unref)(kt).length,onClick:Go},' Êåâ order ÊéíÂ∫è ',8,Kn)]),(0,r.createElementVNode)('div',Gn,[(0,r.createElementVNode)('button',{class:'btn',type:'button',disabled:!(0,r.unref)(kt).length,onClick:t[49]||(t[49]=e=>qo(!0))},' ÂÖ®ÈÉ®ÂêØÁî® ',8,qn),(0,r.createElementVNode)('button',{class:'btn',type:'button',disabled:!(0,r.unref)(kt).length,onClick:t[50]||(t[50]=e=>qo(!1))},' ÂÖ®ÈÉ®Á¶ÅÁî® ',8,Jn)])])])],36)):(0,r.createCommentVNode)('v-if',!0),(0,r.unref)(Jt).clipboard.visible?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:3,class:'wb-floating-window clipboard-window',style:(0,r.normalizeStyle)(wr('clipboard')),onPointerdown:t[56]||(t[56]=e=>hr('clipboard'))},[(0,r.createElementVNode)('div',{class:'wb-floating-header',onPointerdown:t[55]||(t[55]=e=>kr('clipboard',e))},[t[108]||(t[108]=(0,r.createElementVNode)('strong',null,'üìã Ââ™Ë¥¥ÊùøÔºàËÑöÊú¨ÂèòÈáèÊåÅ‰πÖÂåñÔºâ',-1)),(0,r.createElementVNode)('div',Zn,[(0,r.createElementVNode)('button',{class:'btn mini danger',type:'button',disabled:!(0,r.unref)(Ea).length,onPointerdown:t[52]||(t[52]=(0,r.withModifiers)(()=>{},['stop'])),onClick:zo},' Ê∏ÖÁ©∫ ',40,Qn),(0,r.createElementVNode)('button',{class:'btn mini danger',type:'button',onPointerdown:t[53]||(t[53]=(0,r.withModifiers)(()=>{},['stop'])),onClick:t[54]||(t[54]=e=>xr('clipboard'))},' ÂÖ≥Èó≠ ',32)])],32),(0,r.createElementVNode)('div',Xn,[(0,r.createElementVNode)('div',et,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)((0,r.unref)(Ea),e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'tool-list-item'},[(0,r.createElementVNode)('div',nt,[(0,r.createElementVNode)('strong',null,(0,r.toDisplayString)(e.name||'Êú™ÂëΩÂêçÊù°ÁõÆ'),1),(0,r.createElementVNode)('span',null,(0,r.toDisplayString)(go(e.copied_at)),1)]),(0,r.createElementVNode)('div',tt,[(0,r.createElementVNode)('button',{class:'btn mini',type:'button',disabled:!(0,r.unref)(xt),onClick:t=>function(e){const t=Ea.value.find(n=>n.id===e);if(!t)return;const a=ua.value>=0?ua.value+1:kt.value.length,o=po(kt.value),r=co(n(t.entry),o);r.uid=o,kt.value.splice(a,0,r),Bt.value=r.uid,mo(`Â∑≤Á≤òË¥¥Êù°ÁõÆ "${r.name}"`)}(e.id)},' Á≤òË¥¥ ',8,at),(0,r.createElementVNode)('button',{class:'btn mini danger',type:'button',onClick:n=>{return t=e.id,void bo(e=>{e.clipboard=e.clipboard.filter(e=>e.id!==t)});var t}},'Âà†Èô§',8,ot)])]))),128)),(0,r.unref)(Ea).length?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',rt,'ÊöÇÊó†Ââ™Ë¥¥ÊùøÊù°ÁõÆ'))])])],36)):(0,r.createCommentVNode)('v-if',!0),(0,r.unref)(Jt).activation.visible?((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:4,class:'wb-floating-window activation-window',style:(0,r.normalizeStyle)(wr('activation')),onPointerdown:t[61]||(t[61]=e=>hr('activation'))},[(0,r.createElementVNode)('div',{class:'wb-floating-header',onPointerdown:t[60]||(t[60]=e=>kr('activation',e))},[t[109]||(t[109]=(0,r.createElementVNode)('strong',null,'üì° ÊøÄÊ¥ªÁõëÊéßÔºàWORLD_INFO_ACTIVATEDÔºâ',-1)),(0,r.createElementVNode)('div',it,[(0,r.createElementVNode)('button',{class:'btn mini danger',type:'button',disabled:!(0,r.unref)(la).length,onPointerdown:t[57]||(t[57]=(0,r.withModifiers)(()=>{},['stop'])),onClick:yr},' Ê∏ÖÁ©∫ ',40,lt),(0,r.createElementVNode)('button',{class:'btn mini danger',type:'button',onPointerdown:t[58]||(t[58]=(0,r.withModifiers)(()=>{},['stop'])),onClick:t[59]||(t[59]=e=>xr('activation'))},' ÂÖ≥Èó≠ ',32)])],32),(0,r.createElementVNode)('div',st,[(0,r.createElementVNode)('div',dt,[((0,r.openBlock)(!0),(0,r.createElementBlock)(r.Fragment,null,(0,r.renderList)((0,r.unref)(la),e=>((0,r.openBlock)(),(0,r.createElementBlock)('div',{key:e.id,class:'activation-item'},[(0,r.createElementVNode)('div',ct,[(0,r.createElementVNode)('strong',null,(0,r.toDisplayString)(e.world),1),(0,r.createElementVNode)('span',null,'#'+(0,r.toDisplayString)(e.uid)+' ¬∑ '+(0,r.toDisplayString)(e.name),1)]),(0,r.createElementVNode)('div',ut,[(0,r.createElementVNode)('span',null,(0,r.toDisplayString)(go(e.time)),1),(0,r.createElementVNode)('span',null,(0,r.toDisplayString)(e.contentPreview),1)])]))),128)),(0,r.unref)(la).length?(0,r.createCommentVNode)('v-if',!0):((0,r.openBlock)(),(0,r.createElementBlock)('div',pt,'ÊöÇÊó†ÊøÄÊ¥ªËÆ∞ÂΩï'))])])],36)):(0,r.createCommentVNode)('v-if',!0)]))}});o(610);const ht=(0,o(441).A)(Ct,[['__scopeId','data-v-2f8c74d2']]),xt='wb-assistant-menu-item',Et='wb-assistant-panel',wt='wb-assistant-panel-style',kt='wb-assistant-panel-body',Bt='.wbAssistantMenu',Nt='__WB_ASSISTANT_HAS_UNSAVED_CHANGES__';let St=null,_t=null,Rt=null,Vt=null,Ft=null,Wt=!1;function Lt(){return window.parent||window}function It(){return Lt().document}function Mt(){if(_t?.length)return;const e=It().getElementById(kt);e&&(_t=$('<div>').attr('script_id',getScriptId()).appendTo(e),Rt=function(e='head'){const n=$('<div>').attr('script_id',getScriptId()).append($('head > style',document).clone()).appendTo(e);return{destroy:()=>n.remove()}}().destroy,St=(0,r.createApp)(ht),St.mount(_t[0]))}function Tt(){const e=It();let n=$(`#${Et}`,e);if(n.length)return n;!function(){const e=It();if(e.getElementById(wt))return;const n=e.createElement('style');n.id=wt,n.textContent=`\n#${Et} {\n  position: fixed;\n  z-index: 10020;\n  left: 60px;\n  top: 8px;\n  width: min(1280px, calc(100vw - 120px));\n  height: calc(100vh - 16px);\n  min-width: 920px;\n  min-height: 560px;\n  max-width: calc(100vw - 16px);\n  max-height: calc(100vh - 16px);\n  display: none;\n  border: 1px solid #334155;\n  border-radius: 10px;\n  background: #0b1220;\n  box-shadow: 0 16px 48px rgba(0, 0, 0, 0.45);\n  overflow: hidden;\n  resize: both;\n}\n\n#${Et}.active {\n  display: flex;\n  flex-direction: column;\n}\n\n#${Et} .wb-assistant-header {\n  height: 44px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0 10px 0 12px;\n  background: #111827;\n  border-bottom: 1px solid #334155;\n  cursor: move;\n  user-select: none;\n}\n\n#${Et} .wb-assistant-header-title {\n  color: #e2e8f0;\n  font-size: 14px;\n  font-weight: 600;\n}\n\n#${Et} .wb-assistant-header-actions {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n}\n\n#${Et} .wb-assistant-tool {\n  width: 30px;\n  height: 30px;\n  border: 1px solid #475569;\n  border-radius: 6px;\n  background: #1f2937;\n  color: #e2e8f0;\n  cursor: pointer;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 14px;\n}\n\n#${Et} .wb-assistant-tool:hover {\n  border-color: #22d3ee;\n}\n\n#${Et} .wb-assistant-save:hover {\n  border-color: #60a5fa;\n}\n\n#${Et} .wb-assistant-close {\n  width: 30px;\n  height: 30px;\n  border: 1px solid #475569;\n  border-radius: 6px;\n  background: #1f2937;\n  color: #e2e8f0;\n  cursor: pointer;\n}\n\n#${Et} .wb-assistant-close:hover {\n  border-color: #f43f5e;\n}\n\n#${kt} {\n  flex: 1;\n  min-height: 0;\n  overflow: auto;\n}\n\n#${xt}.active {\n  background-color: rgba(56, 189, 248, 0.18) !important;\n}\n`,e.head.append(n)}();const t=`\n<div id="${Et}">\n  <div class="wb-assistant-header">\n    <div class="wb-assistant-header-title">‰∏ñÁïå‰π¶Âä©Êâã</div>\n    <div class="wb-assistant-header-actions">\n      <button type="button" class="wb-assistant-tool wb-assistant-refresh" title="Âà∑Êñ∞">‚Üª</button>\n      <button type="button" class="wb-assistant-tool wb-assistant-save" title="‰øùÂ≠ò">üíæ</button>\n      <button type="button" class="wb-assistant-close" title="ÂÖ≥Èó≠">√ó</button>\n    </div>\n  </div>\n  <div id="${kt}"></div>\n</div>\n`;return $('body',e).append(t),n=$(`#${Et}`,e),function(e){const n=Lt(),t=e.querySelector('.wb-assistant-header');if(!t)return;let a=!1,o=0,r=0;const i=t=>{if(!a)return;const i=e.getBoundingClientRect(),l=Math.max(8,n.innerWidth-i.width-8),s=Math.max(8,n.innerHeight-i.height-8),d=Math.min(l,Math.max(8,t.clientX-o)),c=Math.min(s,Math.max(8,t.clientY-r));e.style.left=`${d}px`,e.style.top=`${c}px`,e.style.right='auto',e.style.bottom='auto'},l=()=>{a&&(a=!1,n.document.removeEventListener('mousemove',i,!0),n.document.removeEventListener('mouseup',l,!0))};t.addEventListener('mousedown',t=>{if(0!==t.button)return;if(t.target.closest('button'))return;const s=e.getBoundingClientRect();o=t.clientX-s.left,r=t.clientY-s.top,a=!0,e.style.left=`${s.left}px`,e.style.top=`${s.top}px`,e.style.right='auto',e.style.bottom='auto',n.document.addEventListener('mousemove',i,!0),n.document.addEventListener('mouseup',l,!0),t.preventDefault()})}(n[0]),n.off(`click${Bt}`,'.wb-assistant-refresh').on(`click${Bt}`,'.wb-assistant-refresh',()=>{window.dispatchEvent(new Event('wb-helper:refresh'))}),n.off(`click${Bt}`,'.wb-assistant-save').on(`click${Bt}`,'.wb-assistant-save',()=>{window.dispatchEvent(new Event('wb-helper:save'))}),n.off(`click${Bt}`,'.wb-assistant-close').on(`click${Bt}`,'.wb-assistant-close',()=>{Ot()}),n}function Dt(e){const n=It(),t=$(`#${xt}`,n);t.length&&t.toggleClass('active',e)}function zt(){return!function(){const e=window,n=Lt();return!0===e[Nt]||!0===n[Nt]}()||confirm('ÂΩìÂâçÊúâÊú™‰øùÂ≠ò‰øÆÊîπÔºåÁ°ÆËÆ§ÂÖ≥Èó≠‰∏ñÁïå‰π¶Âä©ÊâãÂêóÔºü')}function Ot(){if(!zt())return!1;const e=It();return $(`#${Et}`,e).removeClass('active'),Wt=!1,Dt(!1),!0}function $t(){Wt?Ot():function(){const e=It(),n=Tt();Mt(),n.addClass('active'),Wt=!0,Dt(!0),window.dispatchEvent(new Event('wb-helper:refresh')),$(`#${xt}`,e).blur()}()}function Pt(){const e=It(),n=$('#extensionsMenu',e);if(!n.length)return!1;const t=$(`#${xt}`,e);if(t.length&&!t.closest('#extensionsMenu').length&&t.remove(),!$(`#${xt}`,e).length){const e=`\n<div id="${xt}" class="list-group-item flex-container flexGap5 interactable" title="‰∏ñÁïå‰π¶Âä©Êâã" tabIndex="0">\n  <i class="fa-solid fa-book-open"></i>\n  <span>‰∏ñÁïå‰π¶Âä©Êâã</span>\n</div>\n`;n.append(e)}return Dt(Wt),!0}function Ht(){replaceScriptButtons([]);const e=It();$(e).off(`click${Bt}`,`#${xt}`).on(`click${Bt}`,`#${xt}`,e=>{e.preventDefault(),$t()}),Tt(),Pt()||null===Ft&&(Ft=window.setInterval(()=>{Pt()&&(window.clearInterval(Ft),Ft=null)},1e3)),function(){const e=It();Vt||(Vt=new MutationObserver(()=>{Pt()}),Vt.observe(e.body,{childList:!0,subtree:!0}))}(),toastr.success('‰∏ñÁïå‰π¶Âä©ÊâãÂ∑≤ÊåÇËΩΩÂà∞È≠îÊ≥ïÊ£íËèúÂçï','Worldbook Assistant')}function Yt(){const e=It();null!==Ft&&(window.clearInterval(Ft),Ft=null),Vt?.disconnect(),Vt=null,$(e).off(Bt),$(`#${xt}`,e).remove(),$(`#${Et}`,e).remove(),e.getElementById(wt)?.remove(),St?.unmount(),St=null,_t?.remove(),_t=null,Rt?.(),Rt=null}$(()=>{errorCatched(Ht)()}),$(window).on('pagehide',()=>{Yt()});
//# sourceMappingURL=index.js.map