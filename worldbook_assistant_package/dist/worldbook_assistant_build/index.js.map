{"version":3,"file":"index.js","mappings":"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","sources":["webpack://tavern_helper_template/src/worldbook_assistant_build/App.vue?1c12","src://tavern_helper_template/node_modules/.pnpm/css-loader@7.1.3_webpack@5.105.2/node_modules/css-loader/dist/runtime/api.js","src://tavern_helper_template/node_modules/.pnpm/css-loader@7.1.3_webpack@5.105.2/node_modules/css-loader/dist/runtime/sourceMaps.js","webpack://tavern_helper_template/src/worldbook_assistant_build/App.vue?148d","src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_71d7740e7607e74f4d732110d38a3681/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/listToStyles.js","src://tavern_helper_template/node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/webpack/runtime/compat get default export","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/webpack/runtime/make namespace object","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/src/worldbook_assistant_build/App.vue","webpack://tavern_helper_template/src/worldbook_assistant_build/App.vue?dfe0","src://tavern_helper_template/src/worldbook_assistant_build/index.ts","src://tavern_helper_template/util/script.ts"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/.pnpm/css-loader@7.1.3_webpack@5.105.2/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/.pnpm/css-loader@7.1.3_webpack@5.105.2/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.wb-assistant-root[data-v-2f8c74d2]{height:auto;width:100%;box-sizing:border-box;display:flex;flex-direction:column;padding:10px;gap:10px;background:linear-gradient(145deg,#0f172a 0%,#111827 45%,#1e293b 100%);color:#e2e8f0;font-size:13px;line-height:1.35;border-radius:10px}.wb-settings-wrapper[data-v-2f8c74d2]{width:100%}.wb-header[data-v-2f8c74d2]{display:flex;justify-content:space-between;align-items:center;border:1px solid #334155;border-radius:10px;padding:8px 10px;background:rgba(15,23,42,0.6)}.wb-title[data-v-2f8c74d2]{display:flex;flex-direction:column;gap:2px}.wb-title strong[data-v-2f8c74d2]{font-size:16px}.wb-title span[data-v-2f8c74d2]{color:#94a3b8}.wb-header-actions[data-v-2f8c74d2],.list-actions[data-v-2f8c74d2],.tool-line[data-v-2f8c74d2]{display:flex;gap:6px;flex-wrap:wrap}.wb-toolbar[data-v-2f8c74d2]{display:flex;gap:6px;flex-wrap:wrap;align-items:center;border:1px solid #334155;border-radius:10px;padding:8px;background:rgba(15,23,42,0.55)}.toolbar-label[data-v-2f8c74d2]{display:inline-flex;align-items:center;gap:6px;color:#cbd5e1}.toolbar-select[data-v-2f8c74d2]{min-width:200px}.toolbar-select.small[data-v-2f8c74d2]{min-width:160px}.wb-bindings[data-v-2f8c74d2]{border:1px solid #334155;border-radius:10px;padding:8px;display:grid;gap:8px;background:rgba(15,23,42,0.5)}.wb-history-shortcuts[data-v-2f8c74d2]{display:flex;justify-content:flex-start;gap:8px;flex-wrap:wrap;align-items:center}.global-mode-panel[data-v-2f8c74d2]{border:1px solid #334155;border-radius:9px;background:rgba(15,23,42,0.58);padding:8px;display:grid;gap:8px}.global-mode-head[data-v-2f8c74d2]{display:flex;justify-content:space-between;align-items:center;gap:8px}.global-mode-title[data-v-2f8c74d2]{color:#93c5fd;font-weight:700;letter-spacing:0.02em}.global-mode-grid[data-v-2f8c74d2]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}.global-mode-column[data-v-2f8c74d2]{border:1px solid #334155;border-radius:8px;padding:8px;background:rgba(2,6,23,0.42);display:grid;gap:6px;min-height:168px}.global-mode-list[data-v-2f8c74d2]{border:1px solid #334155;border-radius:8px;background:rgba(15,23,42,0.6);max-height:176px;min-height:88px;overflow:auto;display:flex;flex-direction:column}.global-mode-item[data-v-2f8c74d2]{width:100%;border:none;border-bottom:1px solid rgba(51,65,85,0.6);background:transparent;color:#e2e8f0;padding:7px 8px;display:flex;justify-content:space-between;align-items:center;gap:10px;cursor:pointer;text-align:left}.global-mode-item[data-v-2f8c74d2]:last-child{border-bottom:none}.global-mode-item[data-v-2f8c74d2]:hover{background:rgba(56,189,248,0.14)}.global-mode-item.add .global-mode-item-action[data-v-2f8c74d2]{color:#86efac}.global-mode-item.active .global-mode-item-action[data-v-2f8c74d2]{color:#fca5a5}.global-mode-item-name[data-v-2f8c74d2]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.global-mode-item-action[data-v-2f8c74d2]{font-size:12px;flex-shrink:0}.global-mode-actions[data-v-2f8c74d2]{display:flex;gap:6px;flex-wrap:wrap}.history-btn[data-v-2f8c74d2]{border-color:#3b82f6;background:rgba(30,58,138,0.25)}.utility-btn[data-v-2f8c74d2]{border-color:#0ea5e9;background:rgba(6,78,118,0.25)}.utility-btn.active[data-v-2f8c74d2]{border-color:#22d3ee;background:rgba(34,211,238,0.16);color:#67e8f9}.wb-main-layout[data-v-2f8c74d2]{min-height:460px;max-height:70vh;display:grid;grid-template-columns:320px 10px minmax(0,1fr);gap:0}.wb-entry-list[data-v-2f8c74d2],.wb-editor[data-v-2f8c74d2]{border:1px solid #334155;border-radius:10px;padding:8px;display:flex;flex-direction:column;gap:8px;background:rgba(15,23,42,0.55);min-height:0}.list-search[data-v-2f8c74d2]{display:grid;gap:6px}.list-summary[data-v-2f8c74d2]{color:#94a3b8;font-size:12px}.list-scroll[data-v-2f8c74d2]{flex:1 1 auto;min-height:210px;max-height:calc(70vh - 210px);overflow:auto;display:flex;flex-direction:column;gap:6px}.entry-item[data-v-2f8c74d2]{width:100%;text-align:left;border:1px solid #334155;background:linear-gradient(145deg,rgba(15,23,42,0.88),rgba(2,6,23,0.9));color:#e2e8f0;border-radius:8px;padding:8px 8px 7px 10px;cursor:pointer;display:grid;gap:6px;position:relative;transition:border-color 0.16s ease,transform 0.16s ease,box-shadow 0.16s ease}.entry-item[data-v-2f8c74d2]::before{content:'';position:absolute;left:0;top:0;bottom:0;width:4px;border-radius:8px 0 0 8px;background:linear-gradient(to bottom,#64748b,rgba(100,116,139,0.05))}.entry-item[data-status='constant'][data-v-2f8c74d2]::before{background:linear-gradient(to bottom,#3b82f6,rgba(59,130,246,0))}.entry-item[data-status='vector'][data-v-2f8c74d2]::before{background:linear-gradient(to bottom,#a855f7,rgba(168,85,247,0))}.entry-item[data-status='normal'][data-v-2f8c74d2]::before{background:linear-gradient(to bottom,#22c55e,rgba(34,197,94,0))}.entry-item[data-status='disabled'][data-v-2f8c74d2]::before{background:linear-gradient(to bottom,#6b7280,rgba(107,114,128,0))}.entry-item[data-v-2f8c74d2]:hover{border-color:#475569;transform:translateY(-1px)}.entry-item.selected[data-v-2f8c74d2]{border-color:#38bdf8;box-shadow:0 0 0 1px rgba(56,189,248,0.5) inset,0 6px 16px rgba(14,116,144,0.3)}.entry-item.disabled[data-v-2f8c74d2]{opacity:0.74}.entry-item-head[data-v-2f8c74d2]{display:flex;align-items:center;gap:7px;min-width:0}.entry-status-dot[data-v-2f8c74d2]{width:9px;height:9px;border-radius:999px;background:#64748b;flex-shrink:0;box-shadow:0 0 0 2px rgba(15,23,42,0.85)}.entry-status-dot[data-status='constant'][data-v-2f8c74d2]{background:#3b82f6}.entry-status-dot[data-status='vector'][data-v-2f8c74d2]{background:#a855f7}.entry-status-dot[data-status='normal'][data-v-2f8c74d2]{background:#22c55e}.entry-status-dot[data-status='disabled'][data-v-2f8c74d2]{background:#6b7280}.entry-item-title[data-v-2f8c74d2]{font-weight:700;flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.entry-item-tags[data-v-2f8c74d2]{display:flex;gap:6px;flex-wrap:wrap}.entry-chip[data-v-2f8c74d2]{display:inline-flex;align-items:center;gap:4px;border:1px solid #334155;border-radius:999px;padding:1px 8px;color:#cbd5e1;font-size:11px;background:rgba(15,23,42,0.55)}.entry-chip.uid[data-v-2f8c74d2]{color:#93c5fd;font-size:10px;padding:1px 7px}.entry-chip.mono[data-v-2f8c74d2]{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,'Liberation Mono','Courier New',monospace;font-size:10px}.entry-chip.status[data-status='constant'][data-v-2f8c74d2]{border-color:rgba(59,130,246,0.65);color:#93c5fd;background:rgba(59,130,246,0.16)}.entry-chip.status[data-status='vector'][data-v-2f8c74d2]{border-color:rgba(168,85,247,0.65);color:#d8b4fe;background:rgba(168,85,247,0.16)}.entry-chip.status[data-status='normal'][data-v-2f8c74d2]{border-color:rgba(34,197,94,0.65);color:#86efac;background:rgba(34,197,94,0.16)}.entry-chip.status[data-status='disabled'][data-v-2f8c74d2]{border-color:rgba(107,114,128,0.7);color:#cbd5e1;background:rgba(100,116,139,0.15)}.entry-item-preview[data-v-2f8c74d2]{color:#94a3b8;font-size:11px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-left:16px;opacity:0.85}.entry-item-preview[data-v-2f8c74d2]::before{content:'Keys: ';color:#64748b;margin-right:4px}.wb-editor[data-v-2f8c74d2]{max-height:70vh;overflow:hidden}.wb-editor-shell[data-v-2f8c74d2]{height:100%;min-height:0;display:grid;grid-template-columns:minmax(0,1fr) 10px 360px;gap:0}.wb-resize-handle[data-v-2f8c74d2]{position:relative;width:10px;cursor:col-resize;-webkit-user-select:none;user-select:none;touch-action:none}.wb-resize-handle[data-v-2f8c74d2]::before{content:'';position:absolute;left:4px;top:12px;bottom:12px;width:2px;border-radius:999px;background:rgba(100,116,139,0.5);transition:background-color 0.15s ease}.wb-resize-handle[data-v-2f8c74d2]:hover::before,.wb-resize-handle.dragging[data-v-2f8c74d2]::before{background:rgba(56,189,248,0.95)}.editor-center[data-v-2f8c74d2]{border:1px solid #1e293b;border-radius:10px;background:rgba(2,6,23,0.7);padding:10px;display:flex;flex-direction:column;gap:10px;min-height:0;overflow:auto}.editor-head[data-v-2f8c74d2]{display:flex;justify-content:space-between;gap:10px;align-items:flex-end;border-bottom:1px solid #1e293b;padding-bottom:8px}.editor-comment[data-v-2f8c74d2]{flex:1}.editor-badges[data-v-2f8c74d2]{display:flex;gap:6px;flex-wrap:wrap;justify-content:flex-end}.editor-badge[data-v-2f8c74d2]{font-size:10px;border:1px solid #334155;border-radius:999px;padding:2px 8px;color:#94a3b8;background:rgba(15,23,42,0.72);white-space:nowrap}.editor-badge.mono[data-v-2f8c74d2]{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,'Liberation Mono','Courier New',monospace}.editor-badge.on[data-v-2f8c74d2]{border-color:rgba(34,197,94,0.65);color:#86efac}.editor-badge.off[data-v-2f8c74d2]{border-color:rgba(107,114,128,0.75);color:#cbd5e1}.editor-badge.strategy[data-status='constant'][data-v-2f8c74d2]{border-color:rgba(59,130,246,0.65);color:#93c5fd}.editor-badge.strategy[data-status='vector'][data-v-2f8c74d2]{border-color:rgba(168,85,247,0.65);color:#d8b4fe}.editor-badge.strategy[data-status='normal'][data-v-2f8c74d2]{border-color:rgba(34,197,94,0.65);color:#86efac}.editor-badge.strategy[data-status='disabled'][data-v-2f8c74d2]{border-color:rgba(107,114,128,0.75);color:#cbd5e1}.editor-keyword-grid .text-area.compact[data-v-2f8c74d2]{min-height:36px;height:36px;line-height:1.35}.editor-content-block[data-v-2f8c74d2]{min-height:0;display:flex;flex-direction:column;gap:6px;flex:1}.editor-content-title[data-v-2f8c74d2]{font-size:12px;color:#93c5fd;letter-spacing:0.01em}.editor-content-area[data-v-2f8c74d2]{min-height:320px;flex:1;resize:none;line-height:1.5}.editor-advanced[data-v-2f8c74d2]{border:1px solid #334155;border-radius:8px;padding:7px;background:rgba(15,23,42,0.4)}.editor-advanced>summary[data-v-2f8c74d2]{cursor:pointer;font-size:12px;color:#cbd5e1}.editor-advanced[open]>summary[data-v-2f8c74d2]{margin-bottom:7px}.editor-side[data-v-2f8c74d2]{display:flex;flex-direction:column;gap:8px;min-height:0;overflow:auto}.editor-card[data-v-2f8c74d2]{border:1px solid #334155;border-radius:10px;padding:8px;background:rgba(15,23,42,0.7);display:grid;gap:7px}.editor-card h4[data-v-2f8c74d2]{margin:0;font-size:12px;color:#f59e0b}.strategy-switch[data-v-2f8c74d2]{display:grid;gap:6px}.strategy-pill[data-v-2f8c74d2]{border:1px solid #334155;border-radius:8px;background:rgba(15,23,42,0.7);color:#cbd5e1;padding:6px 8px;font-size:12px;cursor:pointer;text-align:left}.strategy-pill[data-v-2f8c74d2]:hover{border-color:#475569}.strategy-pill.active.constant[data-v-2f8c74d2]{border-color:rgba(59,130,246,0.8);background:rgba(59,130,246,0.16);color:#93c5fd}.strategy-pill.active.vector[data-v-2f8c74d2]{border-color:rgba(168,85,247,0.8);background:rgba(168,85,247,0.16);color:#d8b4fe}.strategy-pill.active.selective[data-v-2f8c74d2]{border-color:rgba(34,197,94,0.8);background:rgba(34,197,94,0.16);color:#86efac}.editor-grid[data-v-2f8c74d2]{display:grid;gap:8px}.editor-grid.two-cols[data-v-2f8c74d2]{grid-template-columns:1fr 1fr}.editor-grid.three-cols[data-v-2f8c74d2]{grid-template-columns:repeat(3,minmax(0,1fr))}.field[data-v-2f8c74d2]{display:flex;flex-direction:column;gap:4px}.field>span[data-v-2f8c74d2]{color:#93c5fd}.field.disabled[data-v-2f8c74d2]{opacity:0.56}.field-end[data-v-2f8c74d2]{align-self:end}.field-actions[data-v-2f8c74d2]{display:flex;gap:6px;flex-wrap:wrap}.text-input[data-v-2f8c74d2],.text-area[data-v-2f8c74d2],.toolbar-select[data-v-2f8c74d2]{width:100%;box-sizing:border-box;border:1px solid #334155;border-radius:7px;padding:6px 8px;color:#f8fafc;background:#0f172a}.text-area[data-v-2f8c74d2]{min-height:96px;resize:vertical}.text-area.compact[data-v-2f8c74d2]{min-height:84px}.text-area.large[data-v-2f8c74d2]{min-height:190px}.checkbox-inline[data-v-2f8c74d2]{display:inline-flex;align-items:center;gap:6px}.wb-tools-grid[data-v-2f8c74d2]{display:grid;gap:8px;grid-template-columns:repeat(2,minmax(0,1fr))}.tool-card[data-v-2f8c74d2]{border:1px solid #334155;border-radius:10px;padding:8px;display:flex;flex-direction:column;gap:8px;min-height:170px;background:rgba(15,23,42,0.45)}.tool-card h4[data-v-2f8c74d2]{margin:0;font-size:13px;color:#93c5fd}.tool-line.stacked[data-v-2f8c74d2]{display:grid;gap:6px}.find-flags[data-v-2f8c74d2]{display:flex;flex-wrap:wrap;gap:8px}.batch-exclude-note[data-v-2f8c74d2]{color:#94a3b8;font-size:11px}.batch-exclude-chips[data-v-2f8c74d2]{display:flex;gap:6px;flex-wrap:wrap}.exclude-chip[data-v-2f8c74d2]{border:1px solid #475569;border-radius:999px;padding:1px 8px;font-size:11px;color:#cbd5e1;background:rgba(15,23,42,0.6)}.tool-details[data-v-2f8c74d2]{border:1px solid #334155;border-radius:8px;padding:6px;background:rgba(15,23,42,0.35)}.tool-details>summary[data-v-2f8c74d2]{cursor:pointer;color:#cbd5e1;font-size:12px}.tool-details[open]>summary[data-v-2f8c74d2]{margin-bottom:6px}.history-compare[data-v-2f8c74d2]{display:grid;gap:6px}.history-preview-grid[data-v-2f8c74d2]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:6px}.history-preview-card[data-v-2f8c74d2]{border:1px solid #334155;border-radius:8px;padding:6px;display:grid;gap:3px;background:rgba(2,6,23,0.48)}.history-preview-card strong[data-v-2f8c74d2]{color:#93c5fd;font-size:11px}.history-preview-card span[data-v-2f8c74d2]{color:#94a3b8;font-size:11px;line-height:1.35}.history-note[data-v-2f8c74d2]{border:1px dashed #334155;border-radius:8px;padding:6px;color:#94a3b8;font-size:11px;background:rgba(15,23,42,0.32)}.tool-scroll[data-v-2f8c74d2]{overflow:auto;display:flex;flex-direction:column;gap:6px}.tool-list-item[data-v-2f8c74d2]{border:1px solid #334155;border-radius:8px;padding:6px;display:flex;justify-content:space-between;gap:8px;align-items:center}.item-main[data-v-2f8c74d2]{display:flex;flex-direction:column;gap:2px;min-width:0}.item-main strong[data-v-2f8c74d2],.activation-main strong[data-v-2f8c74d2]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.item-main span[data-v-2f8c74d2]{color:#94a3b8;font-size:12px}.item-actions[data-v-2f8c74d2]{display:flex;gap:6px}.activation-item[data-v-2f8c74d2]{border:1px solid #334155;border-radius:8px;padding:6px;display:grid;gap:3px}.activation-main[data-v-2f8c74d2],.activation-sub[data-v-2f8c74d2]{display:flex;justify-content:space-between;gap:6px}.activation-main span[data-v-2f8c74d2],.activation-sub[data-v-2f8c74d2]{color:#94a3b8;font-size:12px}.activation-sub span[data-v-2f8c74d2]:last-child{flex:1;text-align:right;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.wb-floating-window[data-v-2f8c74d2]{position:fixed;max-width:calc(100vw - 16px);max-height:min(74vh,760px);border:1px solid #334155;border-radius:10px;background:linear-gradient(155deg,rgba(2,6,23,0.95),rgba(15,23,42,0.95));box-shadow:0 14px 36px rgba(2,6,23,0.7);display:flex;flex-direction:column;overflow:hidden}.wb-floating-header[data-v-2f8c74d2]{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:8px 10px;border-bottom:1px solid #334155;background:rgba(15,23,42,0.9);cursor:move;-webkit-user-select:none;user-select:none;touch-action:none}.wb-floating-header strong[data-v-2f8c74d2]{font-size:12px;color:#cbd5e1}.wb-floating-header-actions[data-v-2f8c74d2]{display:flex;gap:6px;flex-wrap:wrap}.wb-floating-body[data-v-2f8c74d2]{min-height:0;padding:8px;display:grid;gap:8px;overflow:auto}.find-window .wb-floating-body[data-v-2f8c74d2]{gap:10px}.clipboard-window .tool-scroll[data-v-2f8c74d2],.activation-window .tool-scroll[data-v-2f8c74d2]{max-height:min(58vh,520px)}.wb-status[data-v-2f8c74d2]{border:1px solid #334155;border-radius:10px;background:rgba(15,23,42,0.52);padding:8px;display:flex;justify-content:space-between;gap:8px;color:#cbd5e1;flex-wrap:wrap}.btn[data-v-2f8c74d2]{border:1px solid #475569;background:#1e293b;color:#f8fafc;border-radius:7px;padding:5px 10px;cursor:pointer}.btn[data-v-2f8c74d2]:hover:not(:disabled){border-color:#38bdf8}.btn[data-v-2f8c74d2]:disabled{opacity:0.5;cursor:default}.btn.primary[data-v-2f8c74d2]{background:#0c4a6e;border-color:#0284c7}.btn.danger[data-v-2f8c74d2]{background:#4c0519;border-color:#e11d48}.btn.mini[data-v-2f8c74d2]{padding:4px 8px;font-size:12px}.empty-note[data-v-2f8c74d2],.empty-block[data-v-2f8c74d2]{color:#94a3b8;font-size:12px}.empty-block[data-v-2f8c74d2]{padding:14px;border:1px dashed #475569;border-radius:8px}.hidden-input[data-v-2f8c74d2]{display:none}.wb-modal-backdrop[data-v-2f8c74d2]{position:fixed;inset:0;background:rgba(2,6,23,0.72);display:flex;align-items:center;justify-content:center;z-index:10020;padding:14px}.wb-history-modal[data-v-2f8c74d2]{width:min(1260px,100%);height:min(88vh,940px);border:1px solid #334155;border-radius:12px;background:linear-gradient(155deg,#0b1325,#020617);box-shadow:0 20px 48px rgba(0,0,0,0.55);display:flex;flex-direction:column;overflow:hidden}.wb-history-modal-header[data-v-2f8c74d2]{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:10px 12px;border-bottom:1px solid #334155;background:rgba(15,23,42,0.85)}.wb-history-modal-header strong[data-v-2f8c74d2]{display:block;font-size:14px}.wb-history-modal-header span[data-v-2f8c74d2]{color:#94a3b8;font-size:11px}.wb-history-modal-actions[data-v-2f8c74d2]{display:flex;gap:6px;flex-wrap:wrap}.wb-history-modal-main[data-v-2f8c74d2]{min-height:0;flex:1;display:grid;grid-template-columns:300px 1fr;overflow:hidden}.wb-history-versions[data-v-2f8c74d2]{border-right:1px solid #334155;background:rgba(15,23,42,0.8);display:flex;flex-direction:column;min-height:0}.wb-history-versions-title[data-v-2f8c74d2]{padding:8px 10px;font-size:11px;color:#94a3b8;border-bottom:1px solid #334155}.wb-history-versions-scroll[data-v-2f8c74d2]{flex:1;min-height:0;overflow:auto;padding:8px;display:flex;flex-direction:column;gap:7px}.wb-history-version-item[data-v-2f8c74d2]{border:1px solid #334155;border-radius:8px;padding:6px;display:grid;gap:4px;background:rgba(15,23,42,0.56)}.wb-history-version-line[data-v-2f8c74d2]{display:flex;justify-content:space-between;gap:6px;align-items:center}.wb-history-version-line strong[data-v-2f8c74d2]{font-size:11px;color:#cbd5e1}.wb-history-version-item span[data-v-2f8c74d2]{font-size:11px;color:#94a3b8;word-break:break-all}.wb-history-lr[data-v-2f8c74d2]{display:inline-flex;gap:4px}.mini-lr[data-v-2f8c74d2]{border:1px solid #475569;background:#0f172a;color:#94a3b8;border-radius:6px;min-width:24px;font-size:10px;cursor:pointer}.mini-lr.active[data-v-2f8c74d2]{border-color:#22d3ee;color:#67e8f9}.wb-history-diff-wrap[data-v-2f8c74d2]{min-height:0;display:flex;flex-direction:column}.wb-history-diff-head[data-v-2f8c74d2]{border-bottom:1px solid #334155;background:rgba(15,23,42,0.58);padding:8px 10px;display:flex;justify-content:space-between;gap:8px;align-items:center;font-size:11px;color:#94a3b8}.wb-history-diff-grid[data-v-2f8c74d2]{min-height:0;flex:1;display:grid;grid-template-columns:1fr 1fr}.wb-history-diff-grid>div[data-v-2f8c74d2]{min-height:0;display:flex;flex-direction:column}.wb-history-diff-grid>div+div[data-v-2f8c74d2]{border-left:1px solid #334155}.wb-history-diff-title[data-v-2f8c74d2]{padding:8px 10px;border-bottom:1px solid #334155;font-size:11px;color:#93c5fd}.wb-history-diff-body[data-v-2f8c74d2]{min-height:0;flex:1;overflow:auto;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,'Liberation Mono','Courier New',monospace;font-size:11px;background:rgba(2,6,23,0.9)}.diff-row[data-v-2f8c74d2]{display:grid;grid-template-columns:54px 1fr;align-items:start;border-bottom:1px solid rgba(51,65,85,0.25)}.line-no[data-v-2f8c74d2]{color:#64748b;padding:2px 8px;border-right:1px solid rgba(51,65,85,0.35);-webkit-user-select:none;user-select:none}.line-text[data-v-2f8c74d2]{white-space:pre-wrap;word-break:break-word;padding:2px 8px;color:#cbd5e1}.diff-row.add[data-v-2f8c74d2]{background:rgba(34,197,94,0.18)}.diff-row.del[data-v-2f8c74d2]{background:rgba(239,68,68,0.18)}.diff-row.empty[data-v-2f8c74d2]{background:rgba(100,116,139,0.08)}@media (max-width:1380px){.wb-editor-shell[data-v-2f8c74d2]{grid-template-columns:1fr}.editor-side[data-v-2f8c74d2]{overflow:visible;max-height:none}.wb-history-modal-main[data-v-2f8c74d2]{grid-template-columns:1fr}.wb-history-versions[data-v-2f8c74d2]{border-right:none;border-bottom:1px solid #334155;max-height:240px}}@media (max-width:1100px){.global-mode-grid[data-v-2f8c74d2]{grid-template-columns:1fr}.wb-resize-handle[data-v-2f8c74d2]{display:none}.wb-main-layout[data-v-2f8c74d2]{grid-template-columns:1fr}.wb-tools-grid[data-v-2f8c74d2]{grid-template-columns:1fr}.editor-grid.two-cols[data-v-2f8c74d2],.editor-grid.three-cols[data-v-2f8c74d2]{grid-template-columns:1fr}.editor-head[data-v-2f8c74d2]{flex-direction:column;align-items:stretch}.editor-badges[data-v-2f8c74d2]{justify-content:flex-start}.history-preview-grid[data-v-2f8c74d2]{grid-template-columns:1fr}.wb-history-diff-grid[data-v-2f8c74d2]{grid-template-columns:1fr}.wb-history-diff-grid>div+div[data-v-2f8c74d2]{border-left:none;border-top:1px solid #334155}.wb-status[data-v-2f8c74d2]{flex-direction:column}.wb-floating-window[data-v-2f8c74d2]{width:calc(100vw - 16px) !important;left:8px !important;right:8px}}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/worldbook_assistant_build/App.vue\"],\"names\":[],\"mappings\":\"AA60GA,oCACE,WAAY,CACZ,UAAW,CACX,qBAAsB,CACtB,YAAa,CACb,qBAAsB,CACtB,YAAa,CACb,QAAS,CACT,sEAA0E,CAC1E,aAAc,CACd,cAAe,CACf,gBAAiB,CACjB,kBACF,CAEA,sCACE,UACF,CAEA,4BACE,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,wBAAyB,CACzB,kBAAmB,CACnB,gBAAiB,CACjB,6BACF,CAEA,2BACE,YAAa,CACb,qBAAsB,CACtB,OACF,CAEA,kCACE,cACF,CAEA,gCACE,aACF,CAEA,+FAGE,YAAa,CACb,OAAQ,CACR,cACF,CAEA,6BACE,YAAa,CACb,OAAQ,CACR,cAAe,CACf,kBAAmB,CACnB,wBAAyB,CACzB,kBAAmB,CACnB,WAAY,CACZ,8BACF,CAEA,gCACE,mBAAoB,CACpB,kBAAmB,CACnB,OAAQ,CACR,aACF,CAEA,iCACE,eACF,CAEA,uCACE,eACF,CAEA,8BACE,wBAAyB,CACzB,kBAAmB,CACnB,WAAY,CACZ,YAAa,CACb,OAAQ,CACR,6BACF,CAEA,uCACE,YAAa,CACb,0BAA2B,CAC3B,OAAQ,CACR,cAAe,CACf,kBACF,CAEA,oCACE,wBAAyB,CACzB,iBAAkB,CAClB,8BAAkC,CAClC,WAAY,CACZ,YAAa,CACb,OACF,CAEA,mCACE,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,OACF,CAEA,oCACE,aAAc,CACd,eAAgB,CAChB,qBACF,CAEA,mCACE,YAAa,CACb,6CAAgD,CAChD,OACF,CAEA,qCACE,wBAAyB,CACzB,iBAAkB,CAClB,WAAY,CACZ,4BAAgC,CAChC,YAAa,CACb,OAAQ,CACR,gBACF,CAEA,mCACE,wBAAyB,CACzB,iBAAkB,CAClB,6BAAiC,CACjC,gBAAiB,CACjB,eAAgB,CAChB,aAAc,CACd,YAAa,CACb,qBACF,CAEA,mCACE,UAAW,CACX,WAAY,CACZ,0CAA8C,CAC9C,sBAAuB,CACvB,aAAc,CACd,eAAgB,CAChB,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,QAAS,CACT,cAAe,CACf,eACF,CAEA,8CACE,kBACF,CAEA,yCACE,gCACF,CAEA,gEACE,aACF,CAEA,mEACE,aACF,CAEA,wCACE,eAAgB,CAChB,sBAAuB,CACvB,kBACF,CAEA,0CACE,cAAe,CACf,aACF,CAEA,sCACE,YAAa,CACb,OAAQ,CACR,cACF,CAEA,8BACE,oBAAqB,CACrB,+BACF,CAEA,8BACE,oBAAqB,CACrB,8BACF,CAEA,qCACE,oBAAqB,CACrB,gCAAoC,CACpC,aACF,CAEA,iCACE,gBAAiB,CACjB,eAAgB,CAChB,YAAa,CACb,8CAAgD,CAChD,KACF,CAEA,4DAEE,wBAAyB,CACzB,kBAAmB,CACnB,WAAY,CACZ,YAAa,CACb,qBAAsB,CACtB,OAAQ,CACR,8BAAkC,CAClC,YACF,CAEA,8BACE,YAAa,CACb,OACF,CAEA,+BACE,aAAc,CACd,cACF,CAEA,8BACE,aAAc,CACd,gBAAiB,CACjB,6BAA8B,CAC9B,aAAc,CACd,YAAa,CACb,qBAAsB,CACtB,OACF,CAEA,6BACE,UAAW,CACX,eAAgB,CAChB,wBAAyB,CACzB,uEAAgF,CAChF,aAAc,CACd,iBAAkB,CAClB,wBAAyB,CACzB,cAAe,CACf,YAAa,CACb,OAAQ,CACR,iBAAkB,CAClB,6EACF,CAEA,qCACE,UAAW,CACX,iBAAkB,CAClB,MAAO,CACP,KAAM,CACN,QAAS,CACT,SAAU,CACV,yBAA0B,CAC1B,oEACF,CAEA,6DACE,gEACF,CAEA,2DACE,gEACF,CAEA,2DACE,+DACF,CAEA,6DACE,iEACF,CAEA,mCACE,oBAAqB,CACrB,0BACF,CAEA,sCACE,oBAAqB,CACrB,+EACF,CAEA,sCACE,YACF,CAEA,kCACE,YAAa,CACb,kBAAmB,CACnB,OAAQ,CACR,WACF,CAEA,mCACE,SAAU,CACV,UAAW,CACX,mBAAoB,CACpB,kBAAmB,CACnB,aAAc,CACd,wCACF,CAEA,2DACE,kBACF,CAEA,yDACE,kBACF,CAEA,yDACE,kBACF,CAEA,2DACE,kBACF,CAEA,mCACE,eAAgB,CAChB,MAAO,CACP,WAAY,CACZ,kBAAmB,CACnB,eAAgB,CAChB,sBACF,CAEA,kCACE,YAAa,CACb,OAAQ,CACR,cACF,CAEA,6BACE,mBAAoB,CACpB,kBAAmB,CACnB,OAAQ,CACR,wBAAyB,CACzB,mBAAoB,CACpB,eAAgB,CAChB,aAAc,CACd,cAAe,CACf,8BACF,CAEA,iCACE,aAAc,CACd,cAAe,CACf,eACF,CAEA,kCACE,uGAA+G,CAC/G,cACF,CAEA,4DACE,kCAAsC,CACtC,aAAc,CACd,gCACF,CAEA,0DACE,kCAAsC,CACtC,aAAc,CACd,gCACF,CAEA,0DACE,iCAAqC,CACrC,aAAc,CACd,+BACF,CAEA,4DACE,kCAAsC,CACtC,aAAc,CACd,iCACF,CAEA,qCACE,aAAc,CACd,cAAe,CACf,kBAAmB,CACnB,eAAgB,CAChB,sBAAuB,CACvB,iBAAkB,CAClB,YACF,CAEA,6CACE,gBAAiB,CACjB,aAAc,CACd,gBACF,CAEA,4BACE,eAAgB,CAChB,eACF,CAEA,kCACE,WAAY,CACZ,YAAa,CACb,YAAa,CACb,8CAAgD,CAChD,KACF,CAEA,mCACE,iBAAkB,CAClB,UAAW,CACX,iBAAkB,CAClB,wBAAiB,CAAjB,gBAAiB,CACjB,iBACF,CAEA,2CACE,UAAW,CACX,iBAAkB,CAClB,QAAS,CACT,QAAS,CACT,WAAY,CACZ,SAAU,CACV,mBAAoB,CACpB,gCAAoC,CACpC,sCACF,CAEA,qGAEE,gCACF,CAEA,gCACE,wBAAyB,CACzB,kBAAmB,CACnB,2BAA+B,CAC/B,YAAa,CACb,YAAa,CACb,qBAAsB,CACtB,QAAS,CACT,YAAa,CACb,aACF,CAEA,8BACE,YAAa,CACb,6BAA8B,CAC9B,QAAS,CACT,oBAAqB,CACrB,+BAAgC,CAChC,kBACF,CAEA,iCACE,MACF,CAEA,gCACE,YAAa,CACb,OAAQ,CACR,cAAe,CACf,wBACF,CAEA,+BACE,cAAe,CACf,wBAAyB,CACzB,mBAAoB,CACpB,eAAgB,CAChB,aAAc,CACd,8BAAkC,CAClC,kBACF,CAEA,oCACE,uGACF,CAEA,kCACE,iCAAqC,CACrC,aACF,CAEA,mCACE,mCAAuC,CACvC,aACF,CAEA,gEACE,kCAAsC,CACtC,aACF,CAEA,8DACE,kCAAsC,CACtC,aACF,CAEA,8DACE,iCAAqC,CACrC,aACF,CAEA,gEACE,mCAAuC,CACvC,aACF,CAEA,yDACE,eAAgB,CAChB,WAAY,CACZ,gBACF,CAEA,uCACE,YAAa,CACb,YAAa,CACb,qBAAsB,CACtB,OAAQ,CACR,MACF,CAEA,uCACE,cAAe,CACf,aAAc,CACd,qBACF,CAEA,sCACE,gBAAiB,CACjB,MAAO,CACP,WAAY,CACZ,eACF,CAEA,kCACE,wBAAyB,CACzB,iBAAkB,CAClB,WAAY,CACZ,6BACF,CAEA,0CACE,cAAe,CACf,cAAe,CACf,aACF,CAEA,gDACE,iBACF,CAEA,8BACE,YAAa,CACb,qBAAsB,CACtB,OAAQ,CACR,YAAa,CACb,aACF,CAEA,8BACE,wBAAyB,CACzB,kBAAmB,CACnB,WAAY,CACZ,6BAAiC,CACjC,YAAa,CACb,OACF,CAEA,iCACE,QAAS,CACT,cAAe,CACf,aACF,CAEA,kCACE,YAAa,CACb,OACF,CAEA,gCACE,wBAAyB,CACzB,iBAAkB,CAClB,6BAAiC,CACjC,aAAc,CACd,eAAgB,CAChB,cAAe,CACf,cAAe,CACf,eACF,CAEA,sCACE,oBACF,CAEA,gDACE,iCAAqC,CACrC,gCAAoC,CACpC,aACF,CAEA,8CACE,iCAAqC,CACrC,gCAAoC,CACpC,aACF,CAEA,iDACE,gCAAoC,CACpC,+BAAmC,CACnC,aACF,CAEA,8BACE,YAAa,CACb,OACF,CAEA,uCACE,6BACF,CAEA,yCACE,6CACF,CAEA,wBACE,YAAa,CACb,qBAAsB,CACtB,OACF,CAEA,6BACE,aACF,CAEA,iCACE,YACF,CAEA,4BACE,cACF,CAEA,gCACE,YAAa,CACb,OAAQ,CACR,cACF,CAEA,0FAGE,UAAW,CACX,qBAAsB,CACtB,wBAAyB,CACzB,iBAAkB,CAClB,eAAgB,CAChB,aAAc,CACd,kBACF,CAEA,4BACE,eAAgB,CAChB,eACF,CAEA,oCACE,eACF,CAEA,kCACE,gBACF,CAEA,kCACE,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CACE,aAAc,CACd,cACF,CAEA,2CACE,YAAa,CACb,OAAQ,CACR,cACF,CAEA,wCACE,YAAa,CACb,MAAO,CACP,YAAa,CACb,+BAAgC,CAChC,eACF,CAEA,sCACE,8BAA+B,CAC/B,6BAAiC,CACjC,YAAa,CACb,qBAAsB,CACtB,YACF,CAEA,4CACE,gBAAiB,CACjB,cAAe,CACf,aAAc,CACd,+BACF,CAEA,6CACE,MAAO,CACP,YAAa,CACb,aAAc,CACd,WAAY,CACZ,YAAa,CACb,qBAAsB,CACtB,OACF,CAEA,0CACE,wBAAyB,CACzB,iBAAkB,CAClB,WAAY,CACZ,YAAa,CACb,OAAQ,CACR,8BACF,CAEA,0CACE,YAAa,CACb,6BAA8B,CAC9B,OAAQ,CACR,kBACF,CAEA,iDACE,cAAe,CACf,aACF,CAEA,+CACE,cAAe,CACf,aAAc,CACd,oBACF,CAEA,gCACE,mBAAoB,CACpB,OACF,CAEA,0BACE,wBAAyB,CACzB,kBAAmB,CACnB,aAAc,CACd,iBAAkB,CAClB,cAAe,CACf,cAAe,CACf,cACF,CAEA,iCACE,oBAAqB,CACrB,aACF,CAEA,uCACE,YAAa,CACb,YAAa,CACb,qBACF,CAEA,uCACE,+BAAgC,CAChC,8BAAkC,CAClC,gBAAiB,CACjB,YAAa,CACb,6BAA8B,CAC9B,OAAQ,CACR,kBAAmB,CACnB,cAAe,CACf,aACF,CAEA,uCACE,YAAa,CACb,MAAO,CACP,YAAa,CACb,6BACF,CAEA,2CACE,YAAa,CACb,YAAa,CACb,qBACF,CAEA,+CACE,6BACF,CAEA,wCACE,gBAAiB,CACjB,+BAAgC,CAChC,cAAe,CACf,aACF,CAEA,uCACE,YAAa,CACb,MAAO,CACP,aAAc,CACd,uGAA+G,CAC/G,cAAe,CACf,2BACF,CAEA,2BACE,YAAa,CACb,8BAA+B,CAC/B,iBAAkB,CAClB,2CACF,CAEA,0BACE,aAAc,CACd,eAAgB,CAChB,0CAA8C,CAC9C,wBAAiB,CAAjB,gBACF,CAEA,4BACE,oBAAqB,CACrB,qBAAsB,CACtB,eAAgB,CAChB,aACF,CAEA,+BACE,+BACF,CAEA,+BACE,+BACF,CAEA,iCACE,iCACF,CAEA,0BACE,kCACE,yBACF,CAEA,8BACE,gBAAiB,CACjB,eACF,CAEA,wCACE,yBACF,CAEA,sCACE,iBAAkB,CAClB,+BAAgC,CAChC,gBACF,CACF,CAEA,0BACE,mCACE,yBACF,CAEA,mCACE,YACF,CAEA,iCACE,yBACF,CAEA,gCACE,yBACF,CAEA,gFAEE,yBACF,CAEA,8BACE,qBAAsB,CACtB,mBACF,CAEA,gCACE,0BACF,CAEA,uCACE,yBACF,CAEA,uCACE,yBACF,CAEA,+CACE,gBAAiB,CACjB,4BACF,CAEA,4BACE,qBACF,CAEA,qCACE,mCAAoC,CACpC,mBAAoB,CACpB,SACF,CACF\",\"sourcesContent\":[\"<template>\\n  <div class=\\\"wb-assistant-root\\\">\\n          <section class=\\\"wb-toolbar\\\">\\n            <label class=\\\"toolbar-label\\\">\\n              \\n              <select v-model=\\\"selectedWorldbookName\\\" class=\\\"toolbar-select\\\">\\n                <option v-for=\\\"name in selectableWorldbookNames\\\" :key=\\\"name\\\" :value=\\\"name\\\">\\n                  {{ name }}\\n                </option>\\n              </select>\\n            </label>\\n            <button class=\\\"btn\\\" type=\\\"button\\\" @click=\\\"createNewWorldbook\\\"></button>\\n            <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!selectedWorldbookName\\\" @click=\\\"duplicateWorldbook\\\">\\n              \\n            </button>\\n            <button class=\\\"btn danger\\\" type=\\\"button\\\" :disabled=\\\"!selectedWorldbookName\\\" @click=\\\"deleteCurrentWorldbook\\\">\\n              \\n            </button>\\n            <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!selectedWorldbookName\\\" @click=\\\"exportCurrentWorldbook\\\">\\n              \\n            </button>\\n            <button class=\\\"btn\\\" type=\\\"button\\\" @click=\\\"triggerImport\\\"></button>\\n            <input\\n              ref=\\\"importFileInput\\\"\\n              class=\\\"hidden-input\\\"\\n              type=\\\"file\\\"\\n              accept=\\\".json,application/json\\\"\\n              @change=\\\"onImportChange\\\"\\n            />\\n          </section>\\n\\n          <section class=\\\"wb-bindings\\\">\\n            <div class=\\\"wb-history-shortcuts\\\">\\n              <button\\n                class=\\\"btn history-btn utility-btn\\\"\\n                type=\\\"button\\\"\\n                :class=\\\"{ active: globalWorldbookMode }\\\"\\n                @click=\\\"toggleGlobalMode\\\"\\n              >\\n                 \\n              </button>\\n              <button class=\\\"btn history-btn\\\" type=\\\"button\\\" :disabled=\\\"!selectedEntry\\\" @click=\\\"openEntryHistoryModal\\\">\\n                 \\n              </button>\\n              <button\\n                class=\\\"btn history-btn\\\"\\n                type=\\\"button\\\"\\n                :disabled=\\\"!selectedWorldbookName\\\"\\n                @click=\\\"openWorldbookHistoryModal\\\"\\n              >\\n                 \\n              </button>\\n              <button\\n                class=\\\"btn history-btn utility-btn\\\"\\n                type=\\\"button\\\"\\n                :class=\\\"{ active: floatingPanels.find.visible }\\\"\\n                :disabled=\\\"!draftEntries.length\\\"\\n                @click=\\\"toggleFloatingPanel('find')\\\"\\n              >\\n                 \\n              </button>\\n              <button\\n                class=\\\"btn history-btn utility-btn\\\"\\n                type=\\\"button\\\"\\n                :class=\\\"{ active: floatingPanels.clipboard.visible }\\\"\\n                @click=\\\"toggleFloatingPanel('clipboard')\\\"\\n              >\\n                 \\n              </button>\\n              <button\\n                class=\\\"btn history-btn utility-btn\\\"\\n                type=\\\"button\\\"\\n                :class=\\\"{ active: floatingPanels.activation.visible }\\\"\\n                @click=\\\"toggleFloatingPanel('activation')\\\"\\n              >\\n                 \\n              </button>\\n            </div>\\n            <div v-if=\\\"globalWorldbookMode\\\" class=\\\"global-mode-panel\\\">\\n              <div class=\\\"global-mode-head\\\">\\n                <span class=\\\"global-mode-title\\\">{{ bindings.global.length }}</span>\\n                <button class=\\\"btn mini danger\\\" type=\\\"button\\\" :disabled=\\\"!bindings.global.length\\\" @click=\\\"clearGlobalWorldbooks\\\">\\n                  \\n                </button>\\n              </div>\\n              <div class=\\\"global-mode-grid\\\">\\n                <div class=\\\"global-mode-column\\\">\\n                  <label class=\\\"field\\\">\\n                    <span></span>\\n                    <input\\n                      v-model=\\\"globalAddSearchText\\\"\\n                      type=\\\"text\\\"\\n                      class=\\\"text-input\\\"\\n                      placeholder=\\\"...\\\"\\n                      @keydown.enter.prevent=\\\"addFirstGlobalCandidate\\\"\\n                    />\\n                  </label>\\n                  <div class=\\\"global-mode-list\\\">\\n                    <button\\n                      v-for=\\\"name in globalAddCandidates\\\"\\n                      :key=\\\"`add-${name}`\\\"\\n                      class=\\\"global-mode-item add\\\"\\n                      type=\\\"button\\\"\\n                      @click=\\\"addGlobalWorldbook(name)\\\"\\n                    >\\n                      <span class=\\\"global-mode-item-name\\\">{{ name }}</span>\\n                      <span class=\\\"global-mode-item-action\\\"></span>\\n                    </button>\\n                    <div v-if=\\\"!globalAddCandidates.length\\\" class=\\\"empty-note\\\"></div>\\n                  </div>\\n                </div>\\n                <div class=\\\"global-mode-column\\\">\\n                  <label class=\\\"field\\\">\\n                    <span></span>\\n                    <input\\n                      v-model=\\\"globalFilterText\\\"\\n                      type=\\\"text\\\"\\n                      class=\\\"text-input\\\"\\n                      placeholder=\\\"...\\\"\\n                    />\\n                  </label>\\n                  <div class=\\\"global-mode-list\\\">\\n                    <button\\n                      v-for=\\\"name in filteredGlobalWorldbooks\\\"\\n                      :key=\\\"`global-${name}`\\\"\\n                      class=\\\"global-mode-item active\\\"\\n                      type=\\\"button\\\"\\n                      @click=\\\"removeGlobalWorldbook(name)\\\"\\n                    >\\n                      <span class=\\\"global-mode-item-name\\\">{{ name }}</span>\\n                      <span class=\\\"global-mode-item-action\\\"></span>\\n                    </button>\\n                    <div v-if=\\\"!filteredGlobalWorldbooks.length\\\" class=\\\"empty-note\\\">\\n                      {{ bindings.global.length ? '' : '' }}\\n                    </div>\\n                  </div>\\n                </div>\\n              </div>\\n              <div class=\\\"global-mode-actions\\\">\\n                <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!selectedWorldbookName\\\" @click=\\\"toggleGlobalBinding\\\">\\n                  {{ isGlobalBound ? '' : '' }}\\n                </button>\\n              </div>\\n            </div>\\n          </section>\\n\\n          <section ref=\\\"mainLayoutRef\\\" class=\\\"wb-main-layout\\\" :style=\\\"mainLayoutStyle\\\">\\n            <aside class=\\\"wb-entry-list\\\">\\n              <div class=\\\"list-search\\\">\\n                <input v-model=\\\"searchText\\\" type=\\\"text\\\" class=\\\"text-input\\\" placeholder=\\\" /  / \\\" />\\n                <label class=\\\"checkbox-inline\\\">\\n                  <input v-model=\\\"onlyEnabled\\\" type=\\\"checkbox\\\" />\\n                  <span></span>\\n                </label>\\n              </div>\\n              <div class=\\\"list-summary\\\">\\n                 {{ filteredEntries.length }} / {{ draftEntries.length }} |  {{ enabledEntryCount }}\\n              </div>\\n              <div class=\\\"list-scroll\\\">\\n                <button\\n                  v-for=\\\"entry in filteredEntries\\\"\\n                  :key=\\\"entry.uid\\\"\\n                  type=\\\"button\\\"\\n                  class=\\\"entry-item\\\"\\n                  :data-status=\\\"getEntryVisualStatus(entry)\\\"\\n                  :class=\\\"{\\n                    selected: entry.uid === selectedEntryUid,\\n                    disabled: !entry.enabled,\\n                  }\\\"\\n                  @click=\\\"selectEntry(entry.uid)\\\"\\n                >\\n                  <div class=\\\"entry-item-head\\\">\\n                    <span class=\\\"entry-status-dot\\\" :data-status=\\\"getEntryVisualStatus(entry)\\\"></span>\\n                    <div class=\\\"entry-item-title\\\">{{ entry.name || ` ${entry.uid}` }}</div>\\n                    <span class=\\\"entry-chip uid\\\">#{{ entry.uid }}</span>\\n                  </div>\\n                  <div class=\\\"entry-item-tags\\\">\\n                    <span class=\\\"entry-chip status\\\" :data-status=\\\"getEntryVisualStatus(entry)\\\">\\n                      {{ getEntryStatusLabel(entry) }}\\n                    </span>\\n                    <span class=\\\"entry-chip\\\"> {{ entry.strategy.keys.length }}</span>\\n                    <span class=\\\"entry-chip\\\"> {{ entry.probability }}</span>\\n                    <span class=\\\"entry-chip mono\\\">#{{ entry.position.order }}</span>\\n                  </div>\\n                  <div class=\\\"entry-item-preview\\\">{{ getEntryKeyPreview(entry) }}</div>\\n                </button>\\n              </div>\\n              <div class=\\\"list-actions\\\">\\n                <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!selectedWorldbookName\\\" @click=\\\"addEntry\\\"></button>\\n                <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!selectedEntry\\\" @click=\\\"duplicateSelectedEntry\\\">\\n                  \\n                </button>\\n                <button class=\\\"btn danger\\\" type=\\\"button\\\" :disabled=\\\"!selectedEntry\\\" @click=\\\"removeSelectedEntry\\\">\\n                  \\n                </button>\\n                <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!selectedEntry\\\" @click=\\\"moveSelectedEntry(-1)\\\">\\n                  \\n                </button>\\n                <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!selectedEntry\\\" @click=\\\"moveSelectedEntry(1)\\\"></button>\\n              </div>\\n            </aside>\\n            <div\\n              class=\\\"wb-resize-handle main\\\"\\n              :class=\\\"{ dragging: paneResizeState?.key === 'main' }\\\"\\n              @pointerdown=\\\"startPaneResize('main', $event)\\\"\\n            ></div>\\n\\n            <main class=\\\"wb-editor\\\">\\n              <template v-if=\\\"selectedEntry\\\">\\n                <div ref=\\\"editorShellRef\\\" class=\\\"wb-editor-shell\\\" :style=\\\"editorShellStyle\\\">\\n                  <section class=\\\"editor-center\\\">\\n                    <header class=\\\"editor-head\\\">\\n                      <label class=\\\"field editor-comment\\\">\\n                        <span> (COMMENT)</span>\\n                        <input v-model=\\\"selectedEntry.name\\\" type=\\\"text\\\" class=\\\"text-input\\\" />\\n                      </label>\\n                      <div class=\\\"editor-badges\\\">\\n                        <span class=\\\"editor-badge\\\" :class=\\\"selectedEntry.enabled ? 'on' : 'off'\\\">\\n                          {{ selectedEntry.enabled ? 'EN' : 'OFF' }}\\n                        </span>\\n                        <span class=\\\"editor-badge strategy\\\" :data-status=\\\"getEntryVisualStatus(selectedEntry)\\\">\\n                          {{ getEntryStatusLabel(selectedEntry) }}\\n                        </span>\\n                        <span class=\\\"editor-badge mono\\\">#{{ selectedEntry.uid }}</span>\\n                        <span class=\\\"editor-badge mono\\\">Chars {{ selectedContentChars }}</span>\\n                        <span class=\\\"editor-badge mono\\\">~{{ selectedTokenEstimate }}T</span>\\n                      </div>\\n                    </header>\\n\\n                    <section class=\\\"editor-grid two-cols editor-keyword-grid\\\">\\n                      <label class=\\\"field\\\">\\n                        <span> (KEYS)</span>\\n                        <textarea v-model=\\\"selectedKeysText\\\" class=\\\"text-area compact\\\"></textarea>\\n                      </label>\\n                      <label class=\\\"field\\\">\\n                        <span> (SECONDARY)</span>\\n                        <textarea v-model=\\\"selectedSecondaryKeysText\\\" class=\\\"text-area compact\\\"></textarea>\\n                      </label>\\n                    </section>\\n\\n                    <section class=\\\"editor-content-block\\\">\\n                      <div class=\\\"editor-content-title\\\"> /  (CONTENT)</div>\\n                      <textarea v-model=\\\"selectedEntry.content\\\" class=\\\"text-area large editor-content-area\\\"></textarea>\\n                    </section>\\n\\n                    <details class=\\\"editor-advanced\\\">\\n                      <summary> / extra JSON</summary>\\n                      <label class=\\\"field\\\">\\n                        <span>extra JSON</span>\\n                        <textarea v-model=\\\"selectedExtraText\\\" class=\\\"text-area compact\\\" placeholder=\\\"{ ... }\\\"></textarea>\\n                      </label>\\n                      <div class=\\\"field-actions\\\">\\n                        <button class=\\\"btn\\\" type=\\\"button\\\" @click=\\\"applyExtraJson\\\"> extra</button>\\n                        <button class=\\\"btn\\\" type=\\\"button\\\" @click=\\\"clearExtra\\\"> extra</button>\\n                        <button class=\\\"btn\\\" type=\\\"button\\\" @click=\\\"copySelectedEntryToClipboard\\\"></button>\\n                      </div>\\n                    </details>\\n                  </section>\\n                  <div\\n                    class=\\\"wb-resize-handle editor\\\"\\n                    :class=\\\"{ dragging: paneResizeState?.key === 'editor' }\\\"\\n                    @pointerdown=\\\"startPaneResize('editor', $event)\\\"\\n                  ></div>\\n\\n                  <aside class=\\\"editor-side\\\">\\n                    <article class=\\\"editor-card\\\">\\n                      <h4> (STRATEGY)</h4>\\n                      <label class=\\\"field checkbox-inline\\\">\\n                        <input v-model=\\\"selectedEntry.enabled\\\" type=\\\"checkbox\\\" />\\n                        <span></span>\\n                      </label>\\n                      <div class=\\\"strategy-switch\\\">\\n                        <button\\n                          type=\\\"button\\\"\\n                          class=\\\"strategy-pill constant\\\"\\n                          :class=\\\"{ active: selectedEntry.strategy.type === 'constant' }\\\"\\n                          @click=\\\"selectedEntry.strategy.type = 'constant'\\\"\\n                        >\\n                            (Constant)\\n                        </button>\\n                        <button\\n                          type=\\\"button\\\"\\n                          class=\\\"strategy-pill vector\\\"\\n                          :class=\\\"{ active: selectedEntry.strategy.type === 'vectorized' }\\\"\\n                          @click=\\\"selectedEntry.strategy.type = 'vectorized'\\\"\\n                        >\\n                            (Vector)\\n                        </button>\\n                        <button\\n                          type=\\\"button\\\"\\n                          class=\\\"strategy-pill selective\\\"\\n                          :class=\\\"{ active: selectedEntry.strategy.type === 'selective' }\\\"\\n                          @click=\\\"selectedEntry.strategy.type = 'selective'\\\"\\n                        >\\n                            (Selective)\\n                        </button>\\n                      </div>\\n                      <details class=\\\"editor-advanced\\\">\\n                        <summary></summary>\\n                        <label class=\\\"field\\\">\\n                          <span> (LOGIC)</span>\\n                          <select v-model=\\\"selectedEntry.strategy.keys_secondary.logic\\\" class=\\\"text-input\\\">\\n                            <option v-for=\\\"item in secondaryLogicOptions\\\" :key=\\\"item\\\" :value=\\\"item\\\">\\n                              {{ getSecondaryLogicLabel(item) }}\\n                            </option>\\n                          </select>\\n                        </label>\\n                        <label class=\\\"field\\\">\\n                          <span></span>\\n                          <input\\n                            v-model=\\\"selectedScanDepthText\\\"\\n                            type=\\\"text\\\"\\n                            class=\\\"text-input\\\"\\n                            placeholder=\\\" same_as_global\\\"\\n                          />\\n                        </label>\\n                        <label class=\\\"field\\\">\\n                          <span>(0-100)</span>\\n                          <input\\n                            v-model.number=\\\"selectedEntry.probability\\\"\\n                            type=\\\"number\\\"\\n                            class=\\\"text-input\\\"\\n                            min=\\\"0\\\"\\n                            max=\\\"100\\\"\\n                            step=\\\"1\\\"\\n                          />\\n                        </label>\\n                      </details>\\n                    </article>\\n\\n                    <article class=\\\"editor-card\\\">\\n                      <h4> (INSERTION)</h4>\\n                      <label class=\\\"field\\\">\\n                        <span> (Position)</span>\\n                        <select\\n                          v-model=\\\"selectedEntry.position.type\\\"\\n                          class=\\\"text-input\\\"\\n                          @change=\\\"handleSelectedPositionTypeChanged\\\"\\n                        >\\n                          <option v-for=\\\"item in positionTypeOptions\\\" :key=\\\"item\\\" :value=\\\"item\\\">\\n                            {{ getPositionTypeLabel(item) }}\\n                          </option>\\n                        </select>\\n                      </label>\\n                      <label class=\\\"field\\\">\\n                        <span> (Order)</span>\\n                        <input v-model.number=\\\"selectedEntry.position.order\\\" type=\\\"number\\\" class=\\\"text-input\\\" step=\\\"1\\\" />\\n                      </label>\\n                      <div class=\\\"editor-grid two-cols\\\">\\n                        <label class=\\\"field\\\" :class=\\\"{ disabled: selectedEntry.position.type !== 'at_depth' }\\\">\\n                          <span>at_depth role</span>\\n                          <select\\n                            v-model=\\\"selectedEntry.position.role\\\"\\n                            class=\\\"text-input\\\"\\n                            :disabled=\\\"selectedEntry.position.type !== 'at_depth'\\\"\\n                          >\\n                            <option value=\\\"system\\\">system</option>\\n                            <option value=\\\"assistant\\\">assistant</option>\\n                            <option value=\\\"user\\\">user</option>\\n                          </select>\\n                        </label>\\n                        <label class=\\\"field\\\" :class=\\\"{ disabled: selectedEntry.position.type !== 'at_depth' }\\\">\\n                          <span>at_depth depth</span>\\n                          <input\\n                            v-model.number=\\\"selectedEntry.position.depth\\\"\\n                            type=\\\"number\\\"\\n                            class=\\\"text-input\\\"\\n                            min=\\\"1\\\"\\n                            step=\\\"1\\\"\\n                            :disabled=\\\"selectedEntry.position.type !== 'at_depth'\\\"\\n                          />\\n                        </label>\\n                      </div>\\n                    </article>\\n\\n                    <article class=\\\"editor-card\\\">\\n                      <h4> (RECURSION)</h4>\\n                      <label class=\\\"field checkbox-inline\\\">\\n                        <input v-model=\\\"selectedEntry.recursion.prevent_incoming\\\" type=\\\"checkbox\\\" />\\n                        <span> (Exclude Incoming)</span>\\n                      </label>\\n                      <label class=\\\"field checkbox-inline\\\">\\n                        <input v-model=\\\"selectedEntry.recursion.prevent_outgoing\\\" type=\\\"checkbox\\\" />\\n                        <span> (Prevent Outgoing)</span>\\n                      </label>\\n                      <label class=\\\"field\\\">\\n                        <span></span>\\n                        <input\\n                          v-model=\\\"selectedRecursionDelayText\\\"\\n                          type=\\\"text\\\"\\n                          class=\\\"text-input\\\"\\n                          placeholder=\\\" null\\\"\\n                        />\\n                      </label>\\n                      <div class=\\\"editor-grid two-cols\\\">\\n                        <label class=\\\"field\\\">\\n                          <span>sticky</span>\\n                          <input\\n                            v-model=\\\"selectedStickyText\\\"\\n                            type=\\\"text\\\"\\n                            class=\\\"text-input\\\"\\n                            placeholder=\\\" null\\\"\\n                          />\\n                        </label>\\n                        <label class=\\\"field\\\">\\n                          <span>cooldown</span>\\n                          <input\\n                            v-model=\\\"selectedCooldownText\\\"\\n                            type=\\\"text\\\"\\n                            class=\\\"text-input\\\"\\n                            placeholder=\\\" null\\\"\\n                          />\\n                        </label>\\n                      </div>\\n                      <label class=\\\"field\\\">\\n                        <span>delay</span>\\n                        <input\\n                          v-model=\\\"selectedEffectDelayText\\\"\\n                          type=\\\"text\\\"\\n                          class=\\\"text-input\\\"\\n                          placeholder=\\\" null\\\"\\n                        />\\n                      </label>\\n                    </article>\\n                  </aside>\\n                </div>\\n              </template>\\n              <template v-else>\\n                <div class=\\\"empty-block\\\"></div>\\n              </template>\\n            </main>\\n          </section>\\n\\n          <footer class=\\\"wb-status\\\">\\n            <span>{{ isBusy ? '...' : statusMessage }}</span>\\n            <span>\\n              : {{ draftEntries.length }} | : {{ totalContentChars }} |\\n              {{ hasUnsavedChanges ? '' : '' }}\\n            </span>\\n          </footer>\\n\\n          <div v-if=\\\"showEntryHistoryModal\\\" class=\\\"wb-modal-backdrop\\\" @click.self=\\\"showEntryHistoryModal = false\\\">\\n            <div class=\\\"wb-history-modal\\\">\\n              <div class=\\\"wb-history-modal-header\\\">\\n                <div>\\n                  <strong> </strong>\\n                  <span>{{ entryHistorySummary }}</span>\\n                </div>\\n                <div class=\\\"wb-history-modal-actions\\\">\\n                  <button class=\\\"btn mini\\\" type=\\\"button\\\" :disabled=\\\"!selectedEntry\\\" @click=\\\"createManualEntrySnapshot\\\">\\n                    \\n                  </button>\\n                  <button\\n                    class=\\\"btn mini danger\\\"\\n                    type=\\\"button\\\"\\n                    :disabled=\\\"!entrySnapshotsForSelected.length\\\"\\n                    @click=\\\"clearCurrentEntrySnapshots\\\"\\n                  >\\n                    \\n                  </button>\\n                  <button class=\\\"btn mini\\\" type=\\\"button\\\" @click=\\\"showEntryHistoryModal = false\\\"></button>\\n                </div>\\n              </div>\\n\\n              <div class=\\\"wb-history-modal-main\\\">\\n                <aside class=\\\"wb-history-versions\\\">\\n                  <div class=\\\"wb-history-versions-title\\\">L/R</div>\\n                  <div class=\\\"wb-history-versions-scroll\\\">\\n                    <div v-for=\\\"ver in entryVersionViews\\\" :key=\\\"ver.id\\\" class=\\\"wb-history-version-item\\\">\\n                      <div class=\\\"wb-history-version-line\\\">\\n                        <strong>{{ formatHistoryOptionLabel(ver.label, ver.ts, ver.isCurrent) }}</strong>\\n                        <div class=\\\"wb-history-lr\\\">\\n                          <button class=\\\"mini-lr\\\" :class=\\\"{ active: entryHistoryLeftId === ver.id }\\\" @click=\\\"entryHistoryLeftId = ver.id\\\">L</button>\\n                          <button class=\\\"mini-lr\\\" :class=\\\"{ active: entryHistoryRightId === ver.id }\\\" @click=\\\"entryHistoryRightId = ver.id\\\">R</button>\\n                        </div>\\n                      </div>\\n                      <span>{{ ver.name }}</span>\\n                    </div>\\n                    <div v-if=\\\"entryVersionViews.length <= 1\\\" class=\\\"empty-note\\\"></div>\\n                  </div>\\n                </aside>\\n\\n                <section class=\\\"wb-history-diff-wrap\\\">\\n                  <div class=\\\"wb-history-diff-head\\\">\\n                    <div>\\n                      Left: {{ selectedEntryHistoryLeft ? formatHistoryOptionLabel(selectedEntryHistoryLeft.label, selectedEntryHistoryLeft.ts, selectedEntryHistoryLeft.isCurrent) : '-' }}\\n                      |\\n                      Right: {{ selectedEntryHistoryRight ? formatHistoryOptionLabel(selectedEntryHistoryRight.label, selectedEntryHistoryRight.ts, selectedEntryHistoryRight.isCurrent) : '-' }}\\n                    </div>\\n                    <button class=\\\"btn mini\\\" type=\\\"button\\\" :disabled=\\\"!canRestoreEntryFromLeft\\\" @click=\\\"restoreEntryFromLeftHistory\\\">\\n                       Left\\n                    </button>\\n                  </div>\\n                  <div class=\\\"wb-history-diff-grid\\\">\\n                    <div>\\n                      <div class=\\\"wb-history-diff-title\\\">Left</div>\\n                      <div class=\\\"wb-history-diff-body\\\" v-html=\\\"entryHistoryDiff.leftHtml\\\"></div>\\n                    </div>\\n                    <div>\\n                      <div class=\\\"wb-history-diff-title\\\">Right</div>\\n                      <div class=\\\"wb-history-diff-body\\\" v-html=\\\"entryHistoryDiff.rightHtml\\\"></div>\\n                    </div>\\n                  </div>\\n                </section>\\n              </div>\\n            </div>\\n          </div>\\n\\n          <div v-if=\\\"showWorldbookHistoryModal\\\" class=\\\"wb-modal-backdrop\\\" @click.self=\\\"showWorldbookHistoryModal = false\\\">\\n            <div class=\\\"wb-history-modal\\\">\\n              <div class=\\\"wb-history-modal-header\\\">\\n                <div>\\n                  <strong> </strong>\\n                  <span>{{ getWorldbookVersionDiffSummary(selectedWorldbookHistoryLeft, selectedWorldbookHistoryRight) }}</span>\\n                </div>\\n                <div class=\\\"wb-history-modal-actions\\\">\\n                  <button class=\\\"btn mini\\\" type=\\\"button\\\" :disabled=\\\"!selectedWorldbookName\\\" @click=\\\"createManualSnapshot\\\">\\n                    \\n                  </button>\\n                  <button\\n                    class=\\\"btn mini danger\\\"\\n                    type=\\\"button\\\"\\n                    :disabled=\\\"!snapshotsForCurrent.length\\\"\\n                    @click=\\\"clearCurrentSnapshots\\\"\\n                  >\\n                    \\n                  </button>\\n                  <button class=\\\"btn mini\\\" type=\\\"button\\\" @click=\\\"showWorldbookHistoryModal = false\\\"></button>\\n                </div>\\n              </div>\\n\\n              <div class=\\\"wb-history-modal-main\\\">\\n                <aside class=\\\"wb-history-versions\\\">\\n                  <div class=\\\"wb-history-versions-title\\\">L/R</div>\\n                  <div class=\\\"wb-history-versions-scroll\\\">\\n                    <div v-for=\\\"ver in worldbookVersionViews\\\" :key=\\\"ver.id\\\" class=\\\"wb-history-version-item\\\">\\n                      <div class=\\\"wb-history-version-line\\\">\\n                        <strong>{{ formatHistoryOptionLabel(ver.label, ver.ts, ver.isCurrent) }}</strong>\\n                        <div class=\\\"wb-history-lr\\\">\\n                          <button class=\\\"mini-lr\\\" :class=\\\"{ active: worldbookHistoryLeftId === ver.id }\\\" @click=\\\"worldbookHistoryLeftId = ver.id\\\">L</button>\\n                          <button class=\\\"mini-lr\\\" :class=\\\"{ active: worldbookHistoryRightId === ver.id }\\\" @click=\\\"worldbookHistoryRightId = ver.id\\\">R</button>\\n                        </div>\\n                      </div>\\n                      <span>entries: {{ ver.entries.length }}</span>\\n                    </div>\\n                  </div>\\n                </aside>\\n\\n                <section class=\\\"wb-history-diff-wrap\\\">\\n                  <div class=\\\"wb-history-diff-head\\\">\\n                    <div>\\n                      Left: {{ selectedWorldbookHistoryLeft ? formatHistoryOptionLabel(selectedWorldbookHistoryLeft.label, selectedWorldbookHistoryLeft.ts, selectedWorldbookHistoryLeft.isCurrent) : '-' }}\\n                      |\\n                      Right: {{ selectedWorldbookHistoryRight ? formatHistoryOptionLabel(selectedWorldbookHistoryRight.label, selectedWorldbookHistoryRight.ts, selectedWorldbookHistoryRight.isCurrent) : '-' }}\\n                    </div>\\n                    <button\\n                      class=\\\"btn mini\\\"\\n                      type=\\\"button\\\"\\n                      :disabled=\\\"!canRestoreWorldbookFromLeft\\\"\\n                      @click=\\\"restoreWorldbookFromLeftHistory\\\"\\n                    >\\n                       Left\\n                    </button>\\n                  </div>\\n                  <div class=\\\"wb-history-diff-grid\\\">\\n                    <div>\\n                      <div class=\\\"wb-history-diff-title\\\">Left</div>\\n                      <div class=\\\"wb-history-diff-body\\\" v-html=\\\"worldbookHistoryDiff.leftHtml\\\"></div>\\n                    </div>\\n                    <div>\\n                      <div class=\\\"wb-history-diff-title\\\">Right</div>\\n                      <div class=\\\"wb-history-diff-body\\\" v-html=\\\"worldbookHistoryDiff.rightHtml\\\"></div>\\n                    </div>\\n                  </div>\\n                </section>\\n              </div>\\n            </div>\\n          </div>\\n\\n          <div\\n            v-if=\\\"floatingPanels.find.visible\\\"\\n            class=\\\"wb-floating-window find-window\\\"\\n            :style=\\\"getFloatingPanelStyle('find')\\\"\\n            @pointerdown=\\\"bringFloatingToFront('find')\\\"\\n          >\\n            <div class=\\\"wb-floating-header\\\" @pointerdown=\\\"startFloatingDrag('find', $event)\\\">\\n              <strong> </strong>\\n              <div class=\\\"wb-floating-header-actions\\\">\\n                <button\\n                  class=\\\"btn mini\\\"\\n                  type=\\\"button\\\"\\n                  :disabled=\\\"!draftEntries.length\\\"\\n                  @pointerdown.stop\\n                  @click=\\\"applyBatchReplace\\\"\\n                >\\n                  \\n                </button>\\n                <button class=\\\"btn mini danger\\\" type=\\\"button\\\" @pointerdown.stop @click=\\\"closeFloatingPanel('find')\\\">\\n                  \\n                </button>\\n              </div>\\n            </div>\\n            <div class=\\\"wb-floating-body\\\">\\n              <div class=\\\"tool-line stacked\\\">\\n                <input v-model=\\\"batchFindText\\\" type=\\\"text\\\" class=\\\"text-input\\\" placeholder=\\\" / \\\" />\\n                <input v-model=\\\"batchReplaceText\\\" type=\\\"text\\\" class=\\\"text-input\\\" placeholder=\\\"\\\" />\\n                <input\\n                  v-model=\\\"batchExcludeText\\\"\\n                  type=\\\"text\\\"\\n                  class=\\\"text-input\\\"\\n                  placeholder=\\\" / #UID\\\"\\n                />\\n                <div class=\\\"batch-exclude-note\\\">: `#12, name:, `</div>\\n                <div v-if=\\\"batchExcludeTokensPreview.length\\\" class=\\\"batch-exclude-chips\\\">\\n                  <span v-for=\\\"token in batchExcludeTokensPreview\\\" :key=\\\"token\\\" class=\\\"exclude-chip\\\">{{ token }}</span>\\n                </div>\\n                <div class=\\\"find-flags\\\">\\n                  <label class=\\\"checkbox-inline\\\">\\n                    <input v-model=\\\"batchUseRegex\\\" type=\\\"checkbox\\\" />\\n                    <span></span>\\n                  </label>\\n                  <label class=\\\"checkbox-inline\\\">\\n                    <input v-model=\\\"batchInName\\\" type=\\\"checkbox\\\" />\\n                    <span></span>\\n                  </label>\\n                  <label class=\\\"checkbox-inline\\\">\\n                    <input v-model=\\\"batchInContent\\\" type=\\\"checkbox\\\" />\\n                    <span></span>\\n                  </label>\\n                  <label class=\\\"checkbox-inline\\\">\\n                    <input v-model=\\\"batchInKeys\\\" type=\\\"checkbox\\\" />\\n                    <span></span>\\n                  </label>\\n                </div>\\n              </div>\\n              <details class=\\\"tool-details\\\">\\n                <summary></summary>\\n                <div class=\\\"tool-line\\\">\\n                  <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!draftEntries.length\\\" @click=\\\"normalizeAllEntries\\\">\\n                    \\n                  </button>\\n                  <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!draftEntries.length\\\" @click=\\\"sortEntriesByOrderDesc\\\">\\n                     order \\n                  </button>\\n                </div>\\n                <div class=\\\"tool-line\\\">\\n                  <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!draftEntries.length\\\" @click=\\\"setEnabledForAll(true)\\\">\\n                    \\n                  </button>\\n                  <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!draftEntries.length\\\" @click=\\\"setEnabledForAll(false)\\\">\\n                    \\n                  </button>\\n                </div>\\n              </details>\\n            </div>\\n          </div>\\n\\n          <div\\n            v-if=\\\"floatingPanels.clipboard.visible\\\"\\n            class=\\\"wb-floating-window clipboard-window\\\"\\n            :style=\\\"getFloatingPanelStyle('clipboard')\\\"\\n            @pointerdown=\\\"bringFloatingToFront('clipboard')\\\"\\n          >\\n            <div class=\\\"wb-floating-header\\\" @pointerdown=\\\"startFloatingDrag('clipboard', $event)\\\">\\n              <strong> </strong>\\n              <div class=\\\"wb-floating-header-actions\\\">\\n                <button\\n                  class=\\\"btn mini danger\\\"\\n                  type=\\\"button\\\"\\n                  :disabled=\\\"!clipboardItems.length\\\"\\n                  @pointerdown.stop\\n                  @click=\\\"clearClipboard\\\"\\n                >\\n                  \\n                </button>\\n                <button\\n                  class=\\\"btn mini danger\\\"\\n                  type=\\\"button\\\"\\n                  @pointerdown.stop\\n                  @click=\\\"closeFloatingPanel('clipboard')\\\"\\n                >\\n                  \\n                </button>\\n              </div>\\n            </div>\\n            <div class=\\\"wb-floating-body\\\">\\n              <div class=\\\"tool-scroll\\\">\\n                <div v-for=\\\"item in clipboardItems\\\" :key=\\\"item.id\\\" class=\\\"tool-list-item\\\">\\n                  <div class=\\\"item-main\\\">\\n                    <strong>{{ item.name || '' }}</strong>\\n                    <span>{{ formatDateTime(item.copied_at) }}</span>\\n                  </div>\\n                  <div class=\\\"item-actions\\\">\\n                    <button\\n                      class=\\\"btn mini\\\"\\n                      type=\\\"button\\\"\\n                      :disabled=\\\"!selectedWorldbookName\\\"\\n                      @click=\\\"pasteClipboardItem(item.id)\\\"\\n                    >\\n                      \\n                    </button>\\n                    <button class=\\\"btn mini danger\\\" type=\\\"button\\\" @click=\\\"deleteClipboardItem(item.id)\\\"></button>\\n                  </div>\\n                </div>\\n                <div v-if=\\\"!clipboardItems.length\\\" class=\\\"empty-note\\\"></div>\\n              </div>\\n            </div>\\n          </div>\\n\\n          <div\\n            v-if=\\\"floatingPanels.activation.visible\\\"\\n            class=\\\"wb-floating-window activation-window\\\"\\n            :style=\\\"getFloatingPanelStyle('activation')\\\"\\n            @pointerdown=\\\"bringFloatingToFront('activation')\\\"\\n          >\\n            <div class=\\\"wb-floating-header\\\" @pointerdown=\\\"startFloatingDrag('activation', $event)\\\">\\n              <strong> WORLD_INFO_ACTIVATED</strong>\\n              <div class=\\\"wb-floating-header-actions\\\">\\n                <button\\n                  class=\\\"btn mini danger\\\"\\n                  type=\\\"button\\\"\\n                  :disabled=\\\"!activationLogs.length\\\"\\n                  @pointerdown.stop\\n                  @click=\\\"clearActivationLogs\\\"\\n                >\\n                  \\n                </button>\\n                <button\\n                  class=\\\"btn mini danger\\\"\\n                  type=\\\"button\\\"\\n                  @pointerdown.stop\\n                  @click=\\\"closeFloatingPanel('activation')\\\"\\n                >\\n                  \\n                </button>\\n              </div>\\n            </div>\\n            <div class=\\\"wb-floating-body\\\">\\n              <div class=\\\"tool-scroll\\\">\\n                <div v-for=\\\"log in activationLogs\\\" :key=\\\"log.id\\\" class=\\\"activation-item\\\">\\n                  <div class=\\\"activation-main\\\">\\n                    <strong>{{ log.world }}</strong>\\n                    <span>#{{ log.uid }}  {{ log.name }}</span>\\n                  </div>\\n                  <div class=\\\"activation-sub\\\">\\n                    <span>{{ formatDateTime(log.time) }}</span>\\n                    <span>{{ log.contentPreview }}</span>\\n                  </div>\\n                </div>\\n                <div v-if=\\\"!activationLogs.length\\\" class=\\\"empty-note\\\"></div>\\n              </div>\\n            </div>\\n          </div>\\n  </div>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\nimport { diffLines } from 'https://testingcf.jsdelivr.net/npm/diff/+esm';\\nimport { klona } from 'klona';\\n\\ntype StrategyType = WorldbookEntry['strategy']['type'];\\ntype SecondaryLogic = WorldbookEntry['strategy']['keys_secondary']['logic'];\\ntype PositionType = WorldbookEntry['position']['type'];\\ntype RoleType = WorldbookEntry['position']['role'];\\ntype EntryVisualStatus = 'constant' | 'vector' | 'normal' | 'disabled';\\ntype FloatingPanelKey = 'find' | 'clipboard' | 'activation';\\ntype PaneResizeKey = 'main' | 'editor';\\n\\ninterface FloatingPanelState {\\n  visible: boolean;\\n  x: number;\\n  y: number;\\n  z: number;\\n  width: number;\\n}\\n\\ninterface PaneResizeState {\\n  key: PaneResizeKey;\\n  pointerId: number;\\n  doc: Document;\\n  win: Window;\\n}\\n\\ninterface ClipboardItem {\\n  id: string;\\n  copied_at: number;\\n  name: string;\\n  entry: WorldbookEntry;\\n}\\n\\ninterface WorldbookSnapshot {\\n  id: string;\\n  label: string;\\n  ts: number;\\n  entries: WorldbookEntry[];\\n}\\n\\ninterface EntrySnapshot {\\n  id: string;\\n  label: string;\\n  ts: number;\\n  uid: number;\\n  name: string;\\n  entry: WorldbookEntry;\\n}\\n\\ninterface EntryVersionView {\\n  id: string;\\n  label: string;\\n  ts: number;\\n  name: string;\\n  entry: WorldbookEntry;\\n  isCurrent: boolean;\\n}\\n\\ninterface WorldbookVersionView {\\n  id: string;\\n  label: string;\\n  ts: number;\\n  entries: WorldbookEntry[];\\n  isCurrent: boolean;\\n}\\n\\ninterface PersistedState {\\n  last_worldbook: string;\\n  clipboard: ClipboardItem[];\\n  history: Record<string, WorldbookSnapshot[]>;\\n  entry_history: Record<string, Record<string, EntrySnapshot[]>>;\\n}\\n\\ninterface ActivationLog {\\n  id: string;\\n  time: number;\\n  world: string;\\n  uid: number | string;\\n  name: string;\\n  contentPreview: string;\\n}\\n\\ninterface ImportedPayload {\\n  name: string;\\n  entries: WorldbookEntry[];\\n}\\n\\ninterface EventSubscription {\\n  stop: () => void;\\n}\\n\\nconst STORAGE_KEY = 'worldbook_assistant_state_v1';\\nconst DIRTY_STATE_KEY = '__WB_ASSISTANT_HAS_UNSAVED_CHANGES__';\\nconst HISTORY_LIMIT = 12;\\nconst ENTRY_HISTORY_LIMIT = 7;\\nconst CLIPBOARD_LIMIT = 40;\\nconst ACTIVATION_LOG_LIMIT = 120;\\nconst RESIZE_HANDLE_SIZE = 10;\\nconst MAIN_PANE_MIN = 220;\\nconst MAIN_EDITOR_MIN = 540;\\nconst EDITOR_SIDE_MIN = 280;\\nconst EDITOR_CENTER_MIN = 420;\\n\\nconst strategyTypeOptions: StrategyType[] = ['constant', 'selective', 'vectorized'];\\nconst secondaryLogicOptions: SecondaryLogic[] = ['and_any', 'and_all', 'not_all', 'not_any'];\\nconst positionTypeOptions: PositionType[] = [\\n  'before_character_definition',\\n  'after_character_definition',\\n  'before_example_messages',\\n  'after_example_messages',\\n  'before_author_note',\\n  'after_author_note',\\n  'at_depth',\\n];\\n\\nconst worldbookNames = ref<string[]>([]);\\nconst selectedWorldbookName = ref('');\\nconst globalWorldbookMode = ref(false);\\nconst originalEntries = ref<WorldbookEntry[]>([]);\\nconst draftEntries = ref<WorldbookEntry[]>([]);\\nconst selectedEntryUid = ref<number | null>(null);\\n\\nconst searchText = ref('');\\nconst onlyEnabled = ref(false);\\nconst importFileInput = ref<HTMLInputElement | null>(null);\\nconst selectedExtraText = ref('');\\nconst globalAddSearchText = ref('');\\nconst globalFilterText = ref('');\\n\\nconst batchFindText = ref('');\\nconst batchReplaceText = ref('');\\nconst batchExcludeText = ref('');\\nconst batchUseRegex = ref(false);\\nconst batchInName = ref(true);\\nconst batchInContent = ref(true);\\nconst batchInKeys = ref(false);\\n\\nconst statusMessage = ref('');\\nconst isBusy = ref(false);\\nconst isSaving = ref(false);\\nconst showEntryHistoryModal = ref(false);\\nconst showWorldbookHistoryModal = ref(false);\\nconst entryHistoryLeftId = ref('');\\nconst entryHistoryRightId = ref('');\\nconst worldbookHistoryLeftId = ref('');\\nconst worldbookHistoryRightId = ref('');\\nconst floatingZCounter = ref(10005);\\nconst floatingPanels = reactive<Record<FloatingPanelKey, FloatingPanelState>>({\\n  find: { visible: false, x: 420, y: 170, z: 10006, width: 500 },\\n  clipboard: { visible: false, x: 700, y: 190, z: 10007, width: 430 },\\n  activation: { visible: false, x: 760, y: 230, z: 10008, width: 480 },\\n});\\nconst activeFloatingDrag = ref<{\\n  key: FloatingPanelKey;\\n  pointerId: number;\\n  offsetX: number;\\n  offsetY: number;\\n  doc: Document;\\n  win: Window;\\n} | null>(null);\\nconst floatingPanelKeys: FloatingPanelKey[] = ['find', 'clipboard', 'activation'];\\nconst viewportWidth = ref(typeof window !== 'undefined' ? window.innerWidth : 1440);\\nconst mainLayoutRef = ref<HTMLElement | null>(null);\\nconst editorShellRef = ref<HTMLElement | null>(null);\\nconst mainPaneWidth = ref(320);\\nconst editorSideWidth = ref(360);\\nconst paneResizeState = ref<PaneResizeState | null>(null);\\nconst hostResizeWindow = ref<Window | null>(null);\\n\\nconst bindings = reactive({\\n  global: [] as string[],\\n  charPrimary: null as string | null,\\n  charAdditional: [] as string[],\\n  chat: null as string | null,\\n});\\n\\nconst activationLogs = ref<ActivationLog[]>([]);\\nconst persistedState = ref<PersistedState>(createDefaultPersistedState());\\n\\nconst subscriptions: EventSubscription[] = [];\\n\\nconst selectedEntry = computed(() => {\\n  if (selectedEntryUid.value === null) {\\n    return null;\\n  }\\n  return draftEntries.value.find(entry => entry.uid === selectedEntryUid.value) ?? null;\\n});\\n\\nconst selectedEntryIndex = computed(() => {\\n  if (!selectedEntry.value) {\\n    return -1;\\n  }\\n  return draftEntries.value.findIndex(entry => entry.uid === selectedEntry.value?.uid);\\n});\\n\\nconst filteredEntries = computed(() => {\\n  const keyword = searchText.value.trim().toLowerCase();\\n  return draftEntries.value.filter(entry => {\\n    if (onlyEnabled.value && !entry.enabled) {\\n      return false;\\n    }\\n    if (!keyword) {\\n      return true;\\n    }\\n    const keysJoined = entry.strategy.keys.map(stringifyKeyword).join(' ').toLowerCase();\\n    return (\\n      entry.name.toLowerCase().includes(keyword) ||\\n      entry.content.toLowerCase().includes(keyword) ||\\n      keysJoined.includes(keyword)\\n    );\\n  });\\n});\\n\\nconst enabledEntryCount = computed(() => draftEntries.value.filter(entry => entry.enabled).length);\\n\\nconst totalContentChars = computed(() =>\\n  draftEntries.value.reduce((sum, entry) => {\\n    return sum + entry.content.length;\\n  }, 0),\\n);\\n\\nconst hasUnsavedChanges = computed(() => JSON.stringify(draftEntries.value) !== JSON.stringify(originalEntries.value));\\nconst isCompactLayout = computed(() => viewportWidth.value <= 1100);\\n\\nconst mainLayoutStyle = computed<Record<string, string> | undefined>(() => {\\n  if (isCompactLayout.value) {\\n    return undefined;\\n  }\\n  return {\\n    gridTemplateColumns: `minmax(${MAIN_PANE_MIN}px, min(${mainPaneWidth.value}px, calc(100% - ${MAIN_EDITOR_MIN + RESIZE_HANDLE_SIZE}px))) ${RESIZE_HANDLE_SIZE}px minmax(0, 1fr)`,\\n  };\\n});\\n\\nconst editorShellStyle = computed<Record<string, string> | undefined>(() => {\\n  if (isCompactLayout.value) {\\n    return undefined;\\n  }\\n  return {\\n    gridTemplateColumns: `minmax(0, 1fr) ${RESIZE_HANDLE_SIZE}px minmax(${EDITOR_SIDE_MIN}px, min(${editorSideWidth.value}px, calc(100% - ${EDITOR_CENTER_MIN + RESIZE_HANDLE_SIZE}px)))`,\\n  };\\n});\\n\\nconst selectableWorldbookNames = computed(() => {\\n  if (!globalWorldbookMode.value) {\\n    return worldbookNames.value;\\n  }\\n  return bindings.global.filter(name => worldbookNames.value.includes(name));\\n});\\n\\nconst globalAddCandidates = computed(() => {\\n  const keyword = globalAddSearchText.value.trim().toLowerCase();\\n  return worldbookNames.value.filter(name => {\\n    if (bindings.global.includes(name)) {\\n      return false;\\n    }\\n    if (!keyword) {\\n      return true;\\n    }\\n    return name.toLowerCase().includes(keyword);\\n  });\\n});\\n\\nconst filteredGlobalWorldbooks = computed(() => {\\n  const keyword = globalFilterText.value.trim().toLowerCase();\\n  if (!keyword) {\\n    return bindings.global;\\n  }\\n  return bindings.global.filter(name => name.toLowerCase().includes(keyword));\\n});\\n\\nconst isGlobalBound = computed(() => {\\n  if (!selectedWorldbookName.value) {\\n    return false;\\n  }\\n  return bindings.global.includes(selectedWorldbookName.value);\\n});\\n\\nconst clipboardItems = computed(() => persistedState.value.clipboard);\\n\\nconst snapshotsForCurrent = computed(() => {\\n  if (!selectedWorldbookName.value) {\\n    return [];\\n  }\\n  return persistedState.value.history[selectedWorldbookName.value] ?? [];\\n});\\n\\nconst entrySnapshotsForSelected = computed(() => {\\n  if (!selectedWorldbookName.value || !selectedEntry.value) {\\n    return [];\\n  }\\n  const byWorldbook = persistedState.value.entry_history[selectedWorldbookName.value] ?? {};\\n  return byWorldbook[String(selectedEntry.value.uid)] ?? [];\\n});\\n\\nconst entryVersionViews = computed<EntryVersionView[]>(() => {\\n  if (!selectedEntry.value) {\\n    return [];\\n  }\\n  const baselineEntry = originalEntries.value.find(item => item.uid === selectedEntry.value?.uid) ?? null;\\n  const current: EntryVersionView = {\\n    id: '__current__',\\n    label: '',\\n    ts: Date.now(),\\n    name: selectedEntry.value.name,\\n    entry: selectedEntry.value,\\n    isCurrent: true,\\n  };\\n  const baseline = baselineEntry\\n    ? ({\\n        id: '__baseline__',\\n        label: '',\\n        ts: 0,\\n        name: baselineEntry.name,\\n        entry: baselineEntry,\\n        isCurrent: false,\\n      } satisfies EntryVersionView)\\n    : null;\\n  const history = entrySnapshotsForSelected.value.map(item => ({\\n    id: item.id,\\n    label: item.label,\\n    ts: item.ts,\\n    name: item.name,\\n    entry: item.entry,\\n    isCurrent: false,\\n  }));\\n  return [current, ...(baseline ? [baseline] : []), ...history];\\n});\\n\\nconst selectedEntryHistoryLeft = computed(() => {\\n  return entryVersionViews.value.find(item => item.id === entryHistoryLeftId.value) ?? null;\\n});\\n\\nconst selectedEntryHistoryRight = computed(() => {\\n  return entryVersionViews.value.find(item => item.id === entryHistoryRightId.value) ?? null;\\n});\\n\\nconst canRestoreEntryFromLeft = computed(() => {\\n  return Boolean(selectedEntry.value && selectedEntryHistoryLeft.value && !selectedEntryHistoryLeft.value.isCurrent);\\n});\\n\\nconst worldbookVersionViews = computed<WorldbookVersionView[]>(() => {\\n  if (!selectedWorldbookName.value) {\\n    return [];\\n  }\\n  const current: WorldbookVersionView = {\\n    id: '__current__',\\n    label: '',\\n    ts: Date.now(),\\n    entries: draftEntries.value,\\n    isCurrent: true,\\n  };\\n  const baseline: WorldbookVersionView | null = {\\n    id: '__baseline__',\\n    label: '',\\n    ts: 0,\\n    entries: originalEntries.value,\\n    isCurrent: false,\\n  };\\n  const history = snapshotsForCurrent.value.map(item => ({\\n    id: item.id,\\n    label: item.label,\\n    ts: item.ts,\\n    entries: item.entries,\\n    isCurrent: false,\\n  }));\\n  return [current, ...(originalEntries.value.length ? [baseline] : []), ...history];\\n});\\n\\nconst selectedWorldbookHistoryLeft = computed(() => {\\n  return worldbookVersionViews.value.find(item => item.id === worldbookHistoryLeftId.value) ?? null;\\n});\\n\\nconst selectedWorldbookHistoryRight = computed(() => {\\n  return worldbookVersionViews.value.find(item => item.id === worldbookHistoryRightId.value) ?? null;\\n});\\n\\nconst canRestoreWorldbookFromLeft = computed(() => {\\n  return Boolean(selectedWorldbookHistoryLeft.value && !selectedWorldbookHistoryLeft.value.isCurrent);\\n});\\n\\nconst batchExcludeTokensPreview = computed(() => parseBatchExcludeTokens(batchExcludeText.value));\\n\\nconst entryHistoryDiff = computed(() => {\\n  return buildDiffHtml(\\n    serializeEntryVersionForDiff(selectedEntryHistoryLeft.value),\\n    serializeEntryVersionForDiff(selectedEntryHistoryRight.value),\\n  );\\n});\\n\\nconst entryHistorySummary = computed(() => {\\n  return getEntryVersionDiffSummary(selectedEntryHistoryLeft.value, selectedEntryHistoryRight.value);\\n});\\n\\nconst worldbookHistoryDiff = computed(() => {\\n  return buildDiffHtml(\\n    serializeWorldbookVersionForDiff(selectedWorldbookHistoryLeft.value),\\n    serializeWorldbookVersionForDiff(selectedWorldbookHistoryRight.value),\\n  );\\n});\\n\\nconst selectedKeysText = computed({\\n  get: () => {\\n    if (!selectedEntry.value) {\\n      return '';\\n    }\\n    return selectedEntry.value.strategy.keys.map(stringifyKeyword).join(', ');\\n  },\\n  set: (value: string) => {\\n    if (!selectedEntry.value) {\\n      return;\\n    }\\n    selectedEntry.value.strategy.keys = parseKeywordsFromText(value);\\n  },\\n});\\n\\nconst selectedSecondaryKeysText = computed({\\n  get: () => {\\n    if (!selectedEntry.value) {\\n      return '';\\n    }\\n    return selectedEntry.value.strategy.keys_secondary.keys.map(stringifyKeyword).join(', ');\\n  },\\n  set: (value: string) => {\\n    if (!selectedEntry.value) {\\n      return;\\n    }\\n    selectedEntry.value.strategy.keys_secondary.keys = parseKeywordsFromText(value);\\n  },\\n});\\n\\nconst selectedScanDepthText = computed({\\n  get: () => {\\n    if (!selectedEntry.value) {\\n      return '';\\n    }\\n    const depth = selectedEntry.value.strategy.scan_depth;\\n    return typeof depth === 'number' ? String(depth) : 'same_as_global';\\n  },\\n  set: (value: string) => {\\n    if (!selectedEntry.value) {\\n      return;\\n    }\\n    selectedEntry.value.strategy.scan_depth = normalizeScanDepth(value);\\n  },\\n});\\n\\nconst selectedRecursionDelayText = computed({\\n  get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.recursion.delay_until) : ''),\\n  set: (value: string) => {\\n    if (!selectedEntry.value) {\\n      return;\\n    }\\n    selectedEntry.value.recursion.delay_until = parseNullableInteger(value);\\n  },\\n});\\n\\nconst selectedStickyText = computed({\\n  get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.effect.sticky) : ''),\\n  set: (value: string) => {\\n    if (!selectedEntry.value) {\\n      return;\\n    }\\n    selectedEntry.value.effect.sticky = parseNullableInteger(value);\\n  },\\n});\\n\\nconst selectedCooldownText = computed({\\n  get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.effect.cooldown) : ''),\\n  set: (value: string) => {\\n    if (!selectedEntry.value) {\\n      return;\\n    }\\n    selectedEntry.value.effect.cooldown = parseNullableInteger(value);\\n  },\\n});\\n\\nconst selectedEffectDelayText = computed({\\n  get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.effect.delay) : ''),\\n  set: (value: string) => {\\n    if (!selectedEntry.value) {\\n      return;\\n    }\\n    selectedEntry.value.effect.delay = parseNullableInteger(value);\\n  },\\n});\\n\\nconst selectedContentChars = computed(() => {\\n  return selectedEntry.value?.content.length ?? 0;\\n});\\n\\nconst selectedTokenEstimate = computed(() => {\\n  const chars = selectedContentChars.value;\\n  if (chars <= 0) {\\n    return 0;\\n  }\\n  return Math.max(1, Math.round(chars / 3.6));\\n});\\n\\nwatch(selectedWorldbookName, name => {\\n  if (!name) {\\n    draftEntries.value = [];\\n    originalEntries.value = [];\\n    selectedEntryUid.value = null;\\n    return;\\n  }\\n  updatePersistedState(state => {\\n    state.last_worldbook = name;\\n  });\\n  void loadWorldbook(name);\\n});\\n\\nwatch(\\n  () => selectedEntryUid.value,\\n  () => {\\n    syncExtraTextWithSelection();\\n  },\\n);\\n\\nwatch(\\n  entryVersionViews,\\n  views => {\\n    if (!views.length) {\\n      entryHistoryLeftId.value = '';\\n      entryHistoryRightId.value = '';\\n      return;\\n    }\\n\\n    const ids = new Set(views.map(item => item.id));\\n    if (!ids.has(entryHistoryRightId.value)) {\\n      entryHistoryRightId.value = '__current__';\\n    }\\n    if (!ids.has(entryHistoryLeftId.value)) {\\n      const fallback = views.find(item => !item.isCurrent) ?? views[0];\\n      entryHistoryLeftId.value = fallback.id;\\n    }\\n    if (entryHistoryLeftId.value === entryHistoryRightId.value && views.length > 1) {\\n      const fallback = views.find(item => item.id !== entryHistoryRightId.value);\\n      if (fallback) {\\n        entryHistoryLeftId.value = fallback.id;\\n      }\\n    }\\n  },\\n  { immediate: true },\\n);\\n\\nwatch(\\n  worldbookVersionViews,\\n  views => {\\n    if (!views.length) {\\n      worldbookHistoryLeftId.value = '';\\n      worldbookHistoryRightId.value = '';\\n      return;\\n    }\\n\\n    const ids = new Set(views.map(item => item.id));\\n    if (!ids.has(worldbookHistoryRightId.value)) {\\n      worldbookHistoryRightId.value = '__current__';\\n    }\\n    if (!ids.has(worldbookHistoryLeftId.value)) {\\n      const fallback = views.find(item => !item.isCurrent) ?? views[0];\\n      worldbookHistoryLeftId.value = fallback.id;\\n    }\\n    if (worldbookHistoryLeftId.value === worldbookHistoryRightId.value && views.length > 1) {\\n      const fallback = views.find(item => item.id !== worldbookHistoryRightId.value);\\n      if (fallback) {\\n        worldbookHistoryLeftId.value = fallback.id;\\n      }\\n    }\\n  },\\n  { immediate: true },\\n);\\n\\nwatch(\\n  () => selectedEntry.value?.position.type,\\n  () => {\\n    if (!selectedEntry.value) {\\n      return;\\n    }\\n    if (selectedEntry.value.position.type !== 'at_depth') {\\n      selectedEntry.value.position.role = 'system';\\n      selectedEntry.value.position.depth = 4;\\n    }\\n  },\\n);\\n\\nwatch(\\n  hasUnsavedChanges,\\n  dirty => {\\n    const target = window as unknown as Record<string, unknown>;\\n    target[DIRTY_STATE_KEY] = dirty;\\n  },\\n  { immediate: true },\\n);\\n\\nfunction createId(prefix: string): string {\\n  return `${prefix}-${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 9)}`;\\n}\\n\\nfunction asRecord(value: unknown): Record<string, unknown> | null {\\n  if (value && typeof value === 'object' && !Array.isArray(value)) {\\n    return value as Record<string, unknown>;\\n  }\\n  return null;\\n}\\n\\nfunction toStringSafe(value: unknown, fallback = ''): string {\\n  if (typeof value === 'string') {\\n    return value;\\n  }\\n  if (value === null || value === undefined) {\\n    return fallback;\\n  }\\n  return String(value);\\n}\\n\\nfunction toNumberSafe(value: unknown, fallback: number): number {\\n  if (typeof value === 'number' && Number.isFinite(value)) {\\n    return value;\\n  }\\n  if (typeof value === 'string' && value.trim()) {\\n    const parsed = Number(value);\\n    if (Number.isFinite(parsed)) {\\n      return parsed;\\n    }\\n  }\\n  return fallback;\\n}\\n\\nfunction clampNumber(value: number, min: number, max: number): number {\\n  return Math.min(max, Math.max(min, value));\\n}\\n\\nfunction parseNullableInteger(value: unknown): number | null {\\n  if (value === null || value === undefined) {\\n    return null;\\n  }\\n  if (typeof value === 'string' && !value.trim()) {\\n    return null;\\n  }\\n  const parsed = Number(value);\\n  if (!Number.isFinite(parsed)) {\\n    return null;\\n  }\\n  return Math.max(0, Math.floor(parsed));\\n}\\n\\nfunction nullableNumberToText(value: number | null): string {\\n  return value === null ? '' : String(value);\\n}\\n\\nfunction stringifyKeyword(value: string | RegExp): string {\\n  return value instanceof RegExp ? value.toString() : value;\\n}\\n\\nfunction parseKeywordToken(token: string): string | RegExp {\\n  const trimmed = token.trim();\\n  if (!trimmed) {\\n    return '';\\n  }\\n  const regexMatch = trimmed.match(/^\\\\/(.+)\\\\/([dgimsuy]*)$/);\\n  if (!regexMatch) {\\n    return trimmed;\\n  }\\n  try {\\n    return new RegExp(regexMatch[1], regexMatch[2]);\\n  } catch {\\n    return trimmed;\\n  }\\n}\\n\\nfunction normalizeKeywordList(value: unknown): (string | RegExp)[] {\\n  const sourceList = Array.isArray(value) ? value : typeof value === 'string' ? value.split(/[\\\\n,]/g) : [];\\n  const normalized: (string | RegExp)[] = [];\\n  const seen = new Set<string>();\\n\\n  for (const item of sourceList) {\\n    const token = item instanceof RegExp ? item : parseKeywordToken(toStringSafe(item).trim());\\n    const tokenString = stringifyKeyword(token);\\n    if (!tokenString) {\\n      continue;\\n    }\\n    const dedupeKey = tokenString.toLowerCase();\\n    if (seen.has(dedupeKey)) {\\n      continue;\\n    }\\n    seen.add(dedupeKey);\\n    normalized.push(token);\\n  }\\n\\n  return normalized;\\n}\\n\\nfunction parseKeywordsFromText(value: string): (string | RegExp)[] {\\n  return normalizeKeywordList(value.split(/[\\\\n,]/g));\\n}\\n\\nfunction getStrategyTypeLabel(type: StrategyType): string {\\n  if (type === 'constant') {\\n    return '  (constant)';\\n  }\\n  if (type === 'vectorized') {\\n    return '  (vectorized)';\\n  }\\n  return '  (selective)';\\n}\\n\\nfunction getSecondaryLogicLabel(logic: SecondaryLogic): string {\\n  const map: Record<SecondaryLogic, string> = {\\n    and_any: ' (and_any)',\\n    and_all: ' (and_all)',\\n    not_all: ' (not_all)',\\n    not_any: ' (not_any)',\\n  };\\n  return map[logic];\\n}\\n\\nfunction getPositionTypeLabel(type: PositionType): string {\\n  const map: Record<PositionType, string> = {\\n    before_character_definition: '',\\n    after_character_definition: '',\\n    before_example_messages: '',\\n    after_example_messages: '',\\n    before_author_note: '',\\n    after_author_note: '',\\n    at_depth: '',\\n  };\\n  return map[type];\\n}\\n\\nfunction getEntryVisualStatus(entry: WorldbookEntry): EntryVisualStatus {\\n  if (!entry.enabled) {\\n    return 'disabled';\\n  }\\n  if (entry.strategy.type === 'constant') {\\n    return 'constant';\\n  }\\n  if (entry.strategy.type === 'vectorized') {\\n    return 'vector';\\n  }\\n  return 'normal';\\n}\\n\\nfunction getEntryStatusLabel(entry: WorldbookEntry): string {\\n  const status = getEntryVisualStatus(entry);\\n  if (status === 'disabled') {\\n    return ' ';\\n  }\\n  if (status === 'constant') {\\n    return ' ';\\n  }\\n  if (status === 'vector') {\\n    return ' ';\\n  }\\n  return ' ';\\n}\\n\\nfunction getEntryKeyPreview(entry: WorldbookEntry): string {\\n  const rendered = entry.strategy.keys\\n    .slice(0, 3)\\n    .map(key => stringifyKeyword(key))\\n    .join(' / ');\\n  if (!rendered) {\\n    return '';\\n  }\\n  if (entry.strategy.keys.length > 3) {\\n    return `${rendered} ...`;\\n  }\\n  return rendered;\\n}\\n\\nfunction normalizeSecondaryLogic(value: unknown): SecondaryLogic {\\n  if (typeof value === 'string' && secondaryLogicOptions.includes(value as SecondaryLogic)) {\\n    return value as SecondaryLogic;\\n  }\\n  if (typeof value === 'number') {\\n    const map: SecondaryLogic[] = ['and_any', 'and_all', 'not_all', 'not_any'];\\n    return map[value] ?? 'and_any';\\n  }\\n  return 'and_any';\\n}\\n\\nfunction normalizeStrategyType(\\n  raw: Record<string, unknown>,\\n  strategyRecord: Record<string, unknown> | null,\\n): StrategyType {\\n  const directType = strategyRecord?.type;\\n  if (typeof directType === 'string' && strategyTypeOptions.includes(directType as StrategyType)) {\\n    return directType as StrategyType;\\n  }\\n  if (raw.constant) {\\n    return 'constant';\\n  }\\n  if (raw.vectorized) {\\n    return 'vectorized';\\n  }\\n  return 'selective';\\n}\\n\\nfunction normalizePositionType(value: unknown): PositionType {\\n  if (typeof value === 'string') {\\n    if (positionTypeOptions.includes(value as PositionType)) {\\n      return value as PositionType;\\n    }\\n    const depthMatch = value.match(/^at_depth_as_(system|assistant|user)$/);\\n    if (depthMatch) {\\n      return 'at_depth';\\n    }\\n  }\\n  if (typeof value === 'number') {\\n    const map: Record<number, PositionType> = {\\n      0: 'before_character_definition',\\n      1: 'after_character_definition',\\n      2: 'before_example_messages',\\n      3: 'after_example_messages',\\n      4: 'before_author_note',\\n      5: 'after_author_note',\\n      6: 'at_depth',\\n    };\\n    return map[value] ?? 'after_character_definition';\\n  }\\n  return 'after_character_definition';\\n}\\n\\nfunction normalizeRole(value: unknown): RoleType {\\n  if (value === 'assistant' || value === 'user' || value === 'system') {\\n    return value;\\n  }\\n  if (typeof value === 'number') {\\n    const map: Record<number, RoleType> = {\\n      0: 'system',\\n      1: 'assistant',\\n      2: 'user',\\n    };\\n    return map[value] ?? 'system';\\n  }\\n  if (typeof value === 'string') {\\n    if (value.includes('assistant')) {\\n      return 'assistant';\\n    }\\n    if (value.includes('user')) {\\n      return 'user';\\n    }\\n  }\\n  return 'system';\\n}\\n\\nfunction normalizeScanDepth(value: unknown): 'same_as_global' | number {\\n  if (value === 'same_as_global') {\\n    return 'same_as_global';\\n  }\\n  const numeric = Math.floor(toNumberSafe(value, NaN));\\n  if (Number.isFinite(numeric) && numeric > 0) {\\n    return numeric;\\n  }\\n  return 'same_as_global';\\n}\\n\\nfunction createDefaultEntry(uid: number): WorldbookEntry {\\n  return {\\n    uid,\\n    name: ` ${uid}`,\\n    enabled: true,\\n    strategy: {\\n      type: 'selective',\\n      keys: [],\\n      keys_secondary: {\\n        logic: 'and_any',\\n        keys: [],\\n      },\\n      scan_depth: 'same_as_global',\\n    },\\n    position: {\\n      type: 'after_character_definition',\\n      role: 'system',\\n      depth: 4,\\n      order: 100,\\n    },\\n    content: '',\\n    probability: 100,\\n    recursion: {\\n      prevent_incoming: false,\\n      prevent_outgoing: false,\\n      delay_until: null,\\n    },\\n    effect: {\\n      sticky: null,\\n      cooldown: null,\\n      delay: null,\\n    },\\n  };\\n}\\n\\nfunction collectExtraFields(raw: Record<string, unknown>): Record<string, unknown> | undefined {\\n  const known = new Set([\\n    'uid',\\n    'id',\\n    'name',\\n    'comment',\\n    'enabled',\\n    'disable',\\n    'strategy',\\n    'position',\\n    'content',\\n    'probability',\\n    'recursion',\\n    'effect',\\n    'extra',\\n    'keys',\\n    'key',\\n    'secondary_keys',\\n    'keysecondary',\\n    'filters',\\n    'logic',\\n    'selectiveLogic',\\n    'scan_depth',\\n    'constant',\\n    'vectorized',\\n    'selective',\\n    'insertion_order',\\n    'order',\\n    'role',\\n    'depth',\\n    'preventRecursion',\\n    'excludeRecursion',\\n    'delayUntilRecursion',\\n    'sticky',\\n    'cooldown',\\n    'delay',\\n    'useProbability',\\n  ]);\\n\\n  const extra: Record<string, unknown> = {};\\n  for (const [key, value] of Object.entries(raw)) {\\n    if (!known.has(key)) {\\n      extra[key] = value;\\n    }\\n  }\\n  if (Object.keys(extra).length === 0) {\\n    return undefined;\\n  }\\n  return extra;\\n}\\n\\nfunction normalizeEntry(rawInput: unknown, fallbackUid: number): WorldbookEntry {\\n  const raw = asRecord(rawInput) ?? {};\\n  const base = createDefaultEntry(fallbackUid);\\n  const strategyRecord = asRecord(raw.strategy);\\n  const positionRecord = asRecord(raw.position);\\n  const recursionRecord = asRecord(raw.recursion);\\n  const effectRecord = asRecord(raw.effect);\\n  const secondaryRecord = asRecord(strategyRecord?.keys_secondary);\\n\\n  const uid = Math.max(0, Math.floor(toNumberSafe(raw.uid ?? raw.id, fallbackUid)));\\n  const name = toStringSafe(raw.name ?? raw.comment, ` ${uid}`).trim() || ` ${uid}`;\\n  const strategyType = normalizeStrategyType(raw, strategyRecord);\\n  const keys = normalizeKeywordList(strategyRecord?.keys ?? raw.keys ?? raw.key);\\n  const secondaryKeys = normalizeKeywordList(\\n    secondaryRecord?.keys ?? raw.secondary_keys ?? raw.keysecondary ?? raw.filters,\\n  );\\n  const secondaryLogic = normalizeSecondaryLogic(secondaryRecord?.logic ?? raw.logic ?? raw.selectiveLogic);\\n  const positionType = normalizePositionType(positionRecord?.type ?? raw.position);\\n  const role = normalizeRole(positionRecord?.role ?? raw.role);\\n  const depth = Math.max(1, Math.floor(toNumberSafe(positionRecord?.depth ?? raw.depth, 4)));\\n  const order = Math.floor(toNumberSafe(positionRecord?.order ?? raw.insertion_order ?? raw.order, 100));\\n  const probability = clampNumber(toNumberSafe(raw.probability, 100), 0, 100);\\n\\n  const preventIncoming = recursionRecord?.prevent_incoming ?? raw.preventRecursion;\\n  const preventOutgoing = recursionRecord?.prevent_outgoing ?? raw.excludeRecursion;\\n\\n  const entry: WorldbookEntry = {\\n    ...base,\\n    uid,\\n    name,\\n    enabled: raw.enabled === undefined ? !Boolean(raw.disable) : Boolean(raw.enabled),\\n    strategy: {\\n      type: strategyType,\\n      keys,\\n      keys_secondary: {\\n        logic: secondaryLogic,\\n        keys: secondaryKeys,\\n      },\\n      scan_depth: normalizeScanDepth(strategyRecord?.scan_depth ?? raw.scan_depth),\\n    },\\n    position: {\\n      type: positionType,\\n      role: positionType === 'at_depth' ? role : 'system',\\n      depth: positionType === 'at_depth' ? depth : 4,\\n      order,\\n    },\\n    content: toStringSafe(raw.content),\\n    probability,\\n    recursion: {\\n      prevent_incoming: Boolean(preventIncoming),\\n      prevent_outgoing: Boolean(preventOutgoing),\\n      delay_until: parseNullableInteger(recursionRecord?.delay_until ?? raw.delayUntilRecursion),\\n    },\\n    effect: {\\n      sticky: parseNullableInteger(effectRecord?.sticky ?? raw.sticky),\\n      cooldown: parseNullableInteger(effectRecord?.cooldown ?? raw.cooldown),\\n      delay: parseNullableInteger(effectRecord?.delay ?? raw.delay),\\n    },\\n  };\\n\\n  const directExtra = asRecord(raw.extra);\\n  if (directExtra && Object.keys(directExtra).length > 0) {\\n    entry.extra = klona(directExtra);\\n  } else {\\n    const extras = collectExtraFields(raw);\\n    if (extras) {\\n      entry.extra = klona(extras);\\n    }\\n  }\\n\\n  return entry;\\n}\\n\\nfunction normalizeEntryList(rawEntries: unknown[]): WorldbookEntry[] {\\n  const result: WorldbookEntry[] = [];\\n  const uidSet = new Set<number>();\\n\\n  for (let index = 0; index < rawEntries.length; index += 1) {\\n    const rawRecord = asRecord(rawEntries[index]);\\n    let uid = Math.max(0, Math.floor(toNumberSafe(rawRecord?.uid ?? rawRecord?.id, index)));\\n    while (uidSet.has(uid)) {\\n      uid += 1;\\n    }\\n    uidSet.add(uid);\\n    result.push(normalizeEntry(rawEntries[index], uid));\\n  }\\n\\n  return result;\\n}\\n\\nfunction getNextUid(entries: WorldbookEntry[]): number {\\n  if (entries.length === 0) {\\n    return 0;\\n  }\\n  return Math.max(...entries.map(entry => entry.uid)) + 1;\\n}\\n\\nfunction createDefaultPersistedState(): PersistedState {\\n  return {\\n    last_worldbook: '',\\n    clipboard: [],\\n    history: {},\\n    entry_history: {},\\n  };\\n}\\n\\nfunction normalizePersistedState(input: unknown): PersistedState {\\n  const root = asRecord(input);\\n  if (!root) {\\n    return createDefaultPersistedState();\\n  }\\n\\n  const historyRoot = asRecord(root.history) ?? {};\\n  const history: Record<string, WorldbookSnapshot[]> = {};\\n  for (const [name, rawSnapshots] of Object.entries(historyRoot)) {\\n    if (!Array.isArray(rawSnapshots)) {\\n      continue;\\n    }\\n    history[name] = rawSnapshots\\n      .map(item => {\\n        const record = asRecord(item);\\n        if (!record) {\\n          return null;\\n        }\\n        const entriesRaw = Array.isArray(record.entries) ? record.entries : [];\\n        return {\\n          id: toStringSafe(record.id, createId('snapshot')),\\n          label: toStringSafe(record.label, ''),\\n          ts: toNumberSafe(record.ts, Date.now()),\\n          entries: normalizeEntryList(entriesRaw),\\n        } satisfies WorldbookSnapshot;\\n      })\\n      .filter((item): item is WorldbookSnapshot => item !== null)\\n      .slice(0, HISTORY_LIMIT);\\n  }\\n\\n  const entryHistoryRoot = asRecord(root.entry_history) ?? {};\\n  const entryHistory: Record<string, Record<string, EntrySnapshot[]>> = {};\\n  for (const [worldbookName, rawByUid] of Object.entries(entryHistoryRoot)) {\\n    const uidRecord = asRecord(rawByUid);\\n    if (!uidRecord) {\\n      continue;\\n    }\\n    const normalizedByUid: Record<string, EntrySnapshot[]> = {};\\n    for (const [uidKey, rawItems] of Object.entries(uidRecord)) {\\n      if (!Array.isArray(rawItems)) {\\n        continue;\\n      }\\n      const uidNumber = Math.max(0, Math.floor(toNumberSafe(uidKey, 0)));\\n      normalizedByUid[uidKey] = rawItems\\n        .map(item => {\\n          const record = asRecord(item);\\n          if (!record) {\\n            return null;\\n          }\\n          return {\\n            id: toStringSafe(record.id, createId('entry-snapshot')),\\n            label: toStringSafe(record.label, ''),\\n            ts: toNumberSafe(record.ts, Date.now()),\\n            uid: uidNumber,\\n            name: toStringSafe(record.name, ` ${uidNumber}`),\\n            entry: normalizeEntry(record.entry, uidNumber),\\n          } satisfies EntrySnapshot;\\n        })\\n        .filter((item): item is EntrySnapshot => item !== null)\\n        .slice(0, ENTRY_HISTORY_LIMIT);\\n    }\\n    if (Object.keys(normalizedByUid).length > 0) {\\n      entryHistory[worldbookName] = normalizedByUid;\\n    }\\n  }\\n\\n  const clipboardRaw = Array.isArray(root.clipboard) ? root.clipboard : [];\\n  const clipboard = clipboardRaw\\n    .map(item => {\\n      const record = asRecord(item);\\n      if (!record) {\\n        return null;\\n      }\\n      return {\\n        id: toStringSafe(record.id, createId('clip')),\\n        copied_at: toNumberSafe(record.copied_at, Date.now()),\\n        name: toStringSafe(record.name, ''),\\n        entry: normalizeEntry(record.entry, 0),\\n      } satisfies ClipboardItem;\\n    })\\n    .filter((item): item is ClipboardItem => item !== null)\\n    .slice(0, CLIPBOARD_LIMIT);\\n\\n  return {\\n    last_worldbook: toStringSafe(root.last_worldbook),\\n    history,\\n    entry_history: entryHistory,\\n    clipboard,\\n  };\\n}\\n\\nfunction readPersistedState(): PersistedState {\\n  const vars = getVariables({ type: 'script', script_id: getScriptId() });\\n  return normalizePersistedState(vars[STORAGE_KEY]);\\n}\\n\\nfunction writePersistedState(state: PersistedState): void {\\n  const vars = getVariables({ type: 'script', script_id: getScriptId() });\\n  vars[STORAGE_KEY] = state;\\n  replaceVariables(vars, { type: 'script', script_id: getScriptId() });\\n  persistedState.value = state;\\n}\\n\\nfunction updatePersistedState(mutator: (state: PersistedState) => void): void {\\n  const state = readPersistedState();\\n  mutator(state);\\n  writePersistedState(state);\\n}\\n\\nfunction setStatus(message: string): void {\\n  statusMessage.value = message;\\n}\\n\\nfunction syncExtraTextWithSelection(): void {\\n  if (!selectedEntry.value || !selectedEntry.value.extra) {\\n    selectedExtraText.value = '';\\n    return;\\n  }\\n  selectedExtraText.value = JSON.stringify(selectedEntry.value.extra, null, 2);\\n}\\n\\nfunction formatDateTime(timestamp: number): string {\\n  try {\\n    return new Date(timestamp).toLocaleString('zh-CN', { hour12: false });\\n  } catch {\\n    return String(timestamp);\\n  }\\n}\\n\\nfunction formatHistoryOptionLabel(label: string, ts: number, isCurrent: boolean): string {\\n  if (isCurrent) {\\n    return 'Current';\\n  }\\n  if (label === '' || ts <= 0) {\\n    return label;\\n  }\\n  return `${label}  ${formatDateTime(ts)}`;\\n}\\n\\nfunction getEntryVersionPreview(view: EntryVersionView | null): string {\\n  if (!view) {\\n    return '';\\n  }\\n  const content = toStringSafe(view.entry.content).replace(/\\\\s+/g, ' ').trim();\\n  if (!content) {\\n    return '()';\\n  }\\n  return content.slice(0, 160);\\n}\\n\\nfunction getWorldbookVersionDiffSummary(\\n  left: WorldbookVersionView | null,\\n  right: WorldbookVersionView | null,\\n): string {\\n  if (!left || !right) {\\n    return '';\\n  }\\n  const leftMap = new Map<number, WorldbookEntry>();\\n  const rightMap = new Map<number, WorldbookEntry>();\\n  left.entries.forEach(entry => leftMap.set(entry.uid, entry));\\n  right.entries.forEach(entry => rightMap.set(entry.uid, entry));\\n\\n  let added = 0;\\n  let removed = 0;\\n  let changed = 0;\\n\\n  for (const [uid, rightEntry] of rightMap) {\\n    const leftEntry = leftMap.get(uid);\\n    if (!leftEntry) {\\n      added += 1;\\n      continue;\\n    }\\n    if (JSON.stringify(leftEntry) !== JSON.stringify(rightEntry)) {\\n      changed += 1;\\n    }\\n  }\\n  for (const uid of leftMap.keys()) {\\n    if (!rightMap.has(uid)) {\\n      removed += 1;\\n    }\\n  }\\n\\n  return ` ${added} /  ${changed} /  ${removed}`;\\n}\\n\\nfunction getEntryVersionDiffSummary(left: EntryVersionView | null, right: EntryVersionView | null): string {\\n  if (!left || !right) {\\n    return '';\\n  }\\n  const leftText = serializeEntryVersionForDiff(left);\\n  const rightText = serializeEntryVersionForDiff(right);\\n  const parts = diffLines(leftText, rightText) as Array<{ value: string; added?: boolean; removed?: boolean }>;\\n  let addLines = 0;\\n  let delLines = 0;\\n  for (const part of parts) {\\n    const lines = part.value.split('\\\\n');\\n    if (lines.length && lines[lines.length - 1] === '') {\\n      lines.pop();\\n    }\\n    if (part.added) {\\n      addLines += lines.length;\\n    } else if (part.removed) {\\n      delLines += lines.length;\\n    }\\n  }\\n  const changed = Math.min(addLines, delLines);\\n  const added = Math.max(0, addLines - changed);\\n  const removed = Math.max(0, delLines - changed);\\n  return ` ${added} /  ${changed} /  ${removed}`;\\n}\\n\\nfunction escapeHtml(text: string): string {\\n  return text\\n    .replaceAll('&', '&amp;')\\n    .replaceAll('<', '&lt;')\\n    .replaceAll('>', '&gt;')\\n    .replaceAll('\\\"', '&quot;')\\n    .replaceAll(\\\"'\\\", '&#39;');\\n}\\n\\nfunction serializeEntryVersionForDiff(view: EntryVersionView | null): string {\\n  if (!view) {\\n    return '';\\n  }\\n  const entry = view.entry;\\n  const payload = {\\n    uid: entry.uid,\\n    name: entry.name,\\n    enabled: entry.enabled,\\n    strategy: entry.strategy,\\n    position: entry.position,\\n    probability: entry.probability,\\n    recursion: entry.recursion,\\n    effect: entry.effect,\\n    content: entry.content,\\n    extra: entry.extra ?? null,\\n  };\\n  return JSON.stringify(payload, null, 2);\\n}\\n\\nfunction serializeWorldbookVersionForDiff(view: WorldbookVersionView | null): string {\\n  if (!view) {\\n    return '';\\n  }\\n  const entries = view.entries\\n    .map(entry => ({\\n      uid: entry.uid,\\n      name: entry.name,\\n      enabled: entry.enabled,\\n      type: entry.strategy.type,\\n      keys: entry.strategy.keys.map(stringifyKeyword),\\n      position: entry.position,\\n      probability: entry.probability,\\n      content: entry.content,\\n    }))\\n    .sort((left, right) => left.uid - right.uid);\\n  return JSON.stringify({ entries }, null, 2);\\n}\\n\\nfunction buildDiffHtml(leftText: string, rightText: string): { leftHtml: string; rightHtml: string } {\\n  const leftRendered: string[] = [];\\n  const rightRendered: string[] = [];\\n  let leftLineNo = 1;\\n  let rightLineNo = 1;\\n  const parts = diffLines(leftText, rightText);\\n\\n  for (const part of parts as Array<{ value: string; added?: boolean; removed?: boolean }>) {\\n    const lines = part.value.split('\\\\n');\\n    if (lines.length && lines[lines.length - 1] === '') {\\n      lines.pop();\\n    }\\n    if (!lines.length) {\\n      continue;\\n    }\\n\\n    if (part.added) {\\n      for (const line of lines) {\\n        leftRendered.push(`<div class=\\\"diff-row empty\\\"><span class=\\\"line-no\\\"></span><span class=\\\"line-text\\\">&nbsp;</span></div>`);\\n        rightRendered.push(\\n          `<div class=\\\"diff-row add\\\"><span class=\\\"line-no\\\">${rightLineNo}</span><span class=\\\"line-text\\\">${escapeHtml(line) || '&nbsp;'}</span></div>`,\\n        );\\n        rightLineNo += 1;\\n      }\\n      continue;\\n    }\\n\\n    if (part.removed) {\\n      for (const line of lines) {\\n        leftRendered.push(\\n          `<div class=\\\"diff-row del\\\"><span class=\\\"line-no\\\">${leftLineNo}</span><span class=\\\"line-text\\\">${escapeHtml(line) || '&nbsp;'}</span></div>`,\\n        );\\n        rightRendered.push(`<div class=\\\"diff-row empty\\\"><span class=\\\"line-no\\\"></span><span class=\\\"line-text\\\">&nbsp;</span></div>`);\\n        leftLineNo += 1;\\n      }\\n      continue;\\n    }\\n\\n    for (const line of lines) {\\n      const safe = escapeHtml(line) || '&nbsp;';\\n      leftRendered.push(`<div class=\\\"diff-row\\\"><span class=\\\"line-no\\\">${leftLineNo}</span><span class=\\\"line-text\\\">${safe}</span></div>`);\\n      rightRendered.push(`<div class=\\\"diff-row\\\"><span class=\\\"line-no\\\">${rightLineNo}</span><span class=\\\"line-text\\\">${safe}</span></div>`);\\n      leftLineNo += 1;\\n      rightLineNo += 1;\\n    }\\n  }\\n\\n  return {\\n    leftHtml: leftRendered.join(''),\\n    rightHtml: rightRendered.join(''),\\n  };\\n}\\n\\nfunction parseBatchExcludeTokens(value: string): string[] {\\n  const seen = new Set<string>();\\n  const tokens: string[] = [];\\n  for (const raw of value.split(/[\\\\n,]/g)) {\\n    const token = raw.trim().toLowerCase();\\n    if (!token || seen.has(token)) {\\n      continue;\\n    }\\n    seen.add(token);\\n    tokens.push(token);\\n  }\\n  return tokens;\\n}\\n\\nfunction shouldExcludeEntryForBatch(entry: WorldbookEntry, tokens: string[]): boolean {\\n  if (!tokens.length) {\\n    return false;\\n  }\\n  const name = entry.name.toLowerCase();\\n  const keys = entry.strategy.keys.map(key => stringifyKeyword(key).toLowerCase()).join(' ');\\n\\n  for (const token of tokens) {\\n    const uidMatch = token.match(/^(?:#|uid:)?(\\\\d+)$/);\\n    if (uidMatch && Number(uidMatch[1]) === entry.uid) {\\n      return true;\\n    }\\n\\n    const plain = token.replace(/^name:/, '').trim();\\n    if (plain && (name.includes(plain) || keys.includes(plain))) {\\n      return true;\\n    }\\n  }\\n  return false;\\n}\\n\\nfunction ensureSelectedEntryExists(): void {\\n  if (!draftEntries.value.length) {\\n    selectedEntryUid.value = null;\\n    return;\\n  }\\n  if (selectedEntryUid.value === null) {\\n    selectedEntryUid.value = draftEntries.value[0].uid;\\n    return;\\n  }\\n  const exists = draftEntries.value.some(entry => entry.uid === selectedEntryUid.value);\\n  if (!exists) {\\n    selectedEntryUid.value = draftEntries.value[0].uid;\\n  }\\n}\\n\\nfunction selectEntry(uid: number): void {\\n  selectedEntryUid.value = uid;\\n}\\n\\nfunction createEntrySnapshotRecord(\\n  label: string,\\n  uid: number,\\n  name: string,\\n  entry: WorldbookEntry,\\n): EntrySnapshot {\\n  return {\\n    id: createId('entry-snapshot'),\\n    label,\\n    ts: Date.now(),\\n    uid,\\n    name: name || ` ${uid}`,\\n    entry: normalizeEntry(klona(entry), uid),\\n  };\\n}\\n\\nfunction pushEntrySnapshotsBulk(\\n  items: Array<{\\n    label: string;\\n    uid: number;\\n    name: string;\\n    entry: WorldbookEntry;\\n  }>,\\n): number {\\n  if (!selectedWorldbookName.value || !items.length) {\\n    return 0;\\n  }\\n\\n  let added = 0;\\n  const worldbookName = selectedWorldbookName.value;\\n\\n  updatePersistedState(state => {\\n    const byWorldbook = state.entry_history[worldbookName] ?? {};\\n\\n    for (const item of items) {\\n      const uidKey = String(item.uid);\\n      const incoming = createEntrySnapshotRecord(item.label, item.uid, item.name, item.entry);\\n      const list = byWorldbook[uidKey] ?? [];\\n\\n      if (list[0] && JSON.stringify(list[0].entry) === JSON.stringify(incoming.entry)) {\\n        continue;\\n      }\\n\\n      list.unshift(incoming);\\n      if (list.length > ENTRY_HISTORY_LIMIT) {\\n        list.length = ENTRY_HISTORY_LIMIT;\\n      }\\n      byWorldbook[uidKey] = list;\\n      added += 1;\\n    }\\n\\n    state.entry_history[worldbookName] = byWorldbook;\\n  });\\n\\n  return added;\\n}\\n\\nfunction pushEntrySnapshot(label: string, entry: WorldbookEntry): boolean {\\n  const added = pushEntrySnapshotsBulk([\\n    {\\n      label,\\n      uid: entry.uid,\\n      name: entry.name,\\n      entry,\\n    },\\n  ]);\\n  return added > 0;\\n}\\n\\nfunction collectEntrySnapshotsBeforeSave(): Array<{\\n  label: string;\\n  uid: number;\\n  name: string;\\n  entry: WorldbookEntry;\\n}> {\\n  const result: Array<{\\n    label: string;\\n    uid: number;\\n    name: string;\\n    entry: WorldbookEntry;\\n  }> = [];\\n  const draftByUid = new Map<number, WorldbookEntry>();\\n  draftEntries.value.forEach(entry => {\\n    draftByUid.set(entry.uid, entry);\\n  });\\n\\n  for (const previous of originalEntries.value) {\\n    const current = draftByUid.get(previous.uid);\\n    if (!current) {\\n      result.push({\\n        label: '',\\n        uid: previous.uid,\\n        name: previous.name,\\n        entry: previous,\\n      });\\n      continue;\\n    }\\n    if (JSON.stringify(previous) !== JSON.stringify(current)) {\\n      result.push({\\n        label: '',\\n        uid: previous.uid,\\n        name: previous.name,\\n        entry: previous,\\n      });\\n    }\\n  }\\n\\n  return result;\\n}\\n\\nfunction pushSnapshot(label: string): void {\\n  if (!selectedWorldbookName.value) {\\n    return;\\n  }\\n  const worldbookName = selectedWorldbookName.value;\\n  const snapshot: WorldbookSnapshot = {\\n    id: createId('snapshot'),\\n    label,\\n    ts: Date.now(),\\n    entries: klona(draftEntries.value),\\n  };\\n\\n  updatePersistedState(state => {\\n    const list = state.history[worldbookName] ?? [];\\n    list.unshift(snapshot);\\n    if (list.length > HISTORY_LIMIT) {\\n      list.length = HISTORY_LIMIT;\\n    }\\n    state.history[worldbookName] = list;\\n  });\\n}\\n\\nfunction createManualSnapshot(): void {\\n  if (!selectedWorldbookName.value) {\\n    toastr.warning('');\\n    return;\\n  }\\n  pushSnapshot('');\\n  toastr.success('');\\n}\\n\\nfunction openEntryHistoryModal(): void {\\n  if (!selectedEntry.value) {\\n    toastr.warning('');\\n    return;\\n  }\\n  const nonCurrent = entryVersionViews.value.find(item => !item.isCurrent) ?? null;\\n  entryHistoryRightId.value = '__current__';\\n  entryHistoryLeftId.value = nonCurrent?.id ?? '__current__';\\n  showEntryHistoryModal.value = true;\\n}\\n\\nfunction openWorldbookHistoryModal(): void {\\n  if (!selectedWorldbookName.value) {\\n    toastr.warning('');\\n    return;\\n  }\\n  const nonCurrent = worldbookVersionViews.value.find(item => !item.isCurrent) ?? null;\\n  worldbookHistoryRightId.value = '__current__';\\n  worldbookHistoryLeftId.value = nonCurrent?.id ?? '__current__';\\n  showWorldbookHistoryModal.value = true;\\n}\\n\\nfunction createManualEntrySnapshot(): void {\\n  if (!selectedEntry.value) {\\n    toastr.warning('');\\n    return;\\n  }\\n  const added = pushEntrySnapshot('', selectedEntry.value);\\n  if (added) {\\n    toastr.success('');\\n  } else {\\n    toastr.info('');\\n  }\\n}\\n\\nfunction restoreSnapshot(snapshotId: string): void {\\n  const snapshot = snapshotsForCurrent.value.find(item => item.id === snapshotId);\\n  if (!snapshot) {\\n    return;\\n  }\\n  if (!confirm(` \\\"${snapshot.label}\\\" ? `)) {\\n    return;\\n  }\\n  draftEntries.value = normalizeEntryList(snapshot.entries);\\n  ensureSelectedEntryExists();\\n  setStatus(`${snapshot.label}`);\\n}\\n\\nfunction restoreWorldbookFromLeftHistory(): void {\\n  const target = selectedWorldbookHistoryLeft.value;\\n  if (!target || target.isCurrent) {\\n    return;\\n  }\\n  if (!confirm(` Left  \\\"${target.label}\\\" ? `)) {\\n    return;\\n  }\\n  draftEntries.value = normalizeEntryList(klona(target.entries));\\n  ensureSelectedEntryExists();\\n  setStatus(`${target.label}`);\\n  toastr.success(' Left ');\\n}\\n\\nfunction deleteSnapshot(snapshotId: string): void {\\n  if (!selectedWorldbookName.value) {\\n    return;\\n  }\\n  updatePersistedState(state => {\\n    const list = state.history[selectedWorldbookName.value] ?? [];\\n    state.history[selectedWorldbookName.value] = list.filter(item => item.id !== snapshotId);\\n  });\\n}\\n\\nfunction clearCurrentSnapshots(): void {\\n  if (!selectedWorldbookName.value || !snapshotsForCurrent.value.length) {\\n    return;\\n  }\\n  if (!confirm(` \\\"${selectedWorldbookName.value}\\\" `)) {\\n    return;\\n  }\\n  updatePersistedState(state => {\\n    delete state.history[selectedWorldbookName.value];\\n  });\\n}\\n\\nfunction restoreEntrySnapshot(snapshotId: string): void {\\n  if (!selectedEntry.value || selectedEntryIndex.value < 0) {\\n    return;\\n  }\\n  const snapshot = entrySnapshotsForSelected.value.find(item => item.id === snapshotId);\\n  if (!snapshot) {\\n    return;\\n  }\\n  if (!confirm(` \\\"${snapshot.label}\\\" ?`)) {\\n    return;\\n  }\\n\\n  // \\n  pushEntrySnapshot('', selectedEntry.value);\\n\\n  const restored = normalizeEntry(klona(snapshot.entry), selectedEntry.value.uid);\\n  restored.uid = selectedEntry.value.uid;\\n  draftEntries.value.splice(selectedEntryIndex.value, 1, restored);\\n  selectedEntryUid.value = restored.uid;\\n  setStatus(`${snapshot.label}`);\\n  toastr.success('');\\n}\\n\\nfunction restoreEntryFromLeftHistory(): void {\\n  const target = selectedEntryHistoryLeft.value;\\n  if (!target || target.isCurrent) {\\n    return;\\n  }\\n  if (!selectedEntry.value || selectedEntryIndex.value < 0) {\\n    return;\\n  }\\n  if (!confirm(` \\\"${target.label}\\\" ?`)) {\\n    return;\\n  }\\n  pushEntrySnapshot('', selectedEntry.value);\\n  const restored = normalizeEntry(klona(target.entry), selectedEntry.value.uid);\\n  restored.uid = selectedEntry.value.uid;\\n  draftEntries.value.splice(selectedEntryIndex.value, 1, restored);\\n  selectedEntryUid.value = restored.uid;\\n  setStatus(`${target.label}`);\\n  toastr.success(' Left ');\\n}\\n\\nfunction deleteEntrySnapshot(snapshotId: string): void {\\n  if (!selectedWorldbookName.value || !selectedEntry.value) {\\n    return;\\n  }\\n  const worldbookName = selectedWorldbookName.value;\\n  const uidKey = String(selectedEntry.value.uid);\\n  updatePersistedState(state => {\\n    const byWorldbook = state.entry_history[worldbookName] ?? {};\\n    const list = byWorldbook[uidKey] ?? [];\\n    byWorldbook[uidKey] = list.filter(item => item.id !== snapshotId);\\n    state.entry_history[worldbookName] = byWorldbook;\\n  });\\n}\\n\\nfunction clearCurrentEntrySnapshots(): void {\\n  if (!selectedWorldbookName.value || !selectedEntry.value || !entrySnapshotsForSelected.value.length) {\\n    return;\\n  }\\n  if (!confirm(` #${selectedEntry.value.uid} `)) {\\n    return;\\n  }\\n  const worldbookName = selectedWorldbookName.value;\\n  const uidKey = String(selectedEntry.value.uid);\\n  updatePersistedState(state => {\\n    const byWorldbook = state.entry_history[worldbookName] ?? {};\\n    delete byWorldbook[uidKey];\\n    state.entry_history[worldbookName] = byWorldbook;\\n  });\\n}\\n\\nfunction copySelectedEntryToClipboard(): void {\\n  if (!selectedEntry.value) {\\n    return;\\n  }\\n  const item: ClipboardItem = {\\n    id: createId('clip'),\\n    copied_at: Date.now(),\\n    name: selectedEntry.value.name,\\n    entry: normalizeEntry(klona(selectedEntry.value), selectedEntry.value.uid),\\n  };\\n  updatePersistedState(state => {\\n    state.clipboard.unshift(item);\\n    if (state.clipboard.length > CLIPBOARD_LIMIT) {\\n      state.clipboard.length = CLIPBOARD_LIMIT;\\n    }\\n  });\\n  toastr.success('');\\n}\\n\\nfunction pasteClipboardItem(itemId: string): void {\\n  const item = clipboardItems.value.find(entry => entry.id === itemId);\\n  if (!item) {\\n    return;\\n  }\\n  const insertIndex = selectedEntryIndex.value >= 0 ? selectedEntryIndex.value + 1 : draftEntries.value.length;\\n  const uid = getNextUid(draftEntries.value);\\n  const cloned = normalizeEntry(klona(item.entry), uid);\\n  cloned.uid = uid;\\n  draftEntries.value.splice(insertIndex, 0, cloned);\\n  selectedEntryUid.value = cloned.uid;\\n  setStatus(` \\\"${cloned.name}\\\"`);\\n}\\n\\nfunction deleteClipboardItem(itemId: string): void {\\n  updatePersistedState(state => {\\n    state.clipboard = state.clipboard.filter(entry => entry.id !== itemId);\\n  });\\n}\\n\\nfunction clearClipboard(): void {\\n  if (!clipboardItems.value.length) {\\n    return;\\n  }\\n  if (!confirm('')) {\\n    return;\\n  }\\n  updatePersistedState(state => {\\n    state.clipboard = [];\\n  });\\n}\\n\\nfunction handleSelectedPositionTypeChanged(): void {\\n  if (!selectedEntry.value) {\\n    return;\\n  }\\n  if (selectedEntry.value.position.type !== 'at_depth') {\\n    selectedEntry.value.position.role = 'system';\\n    selectedEntry.value.position.depth = 4;\\n  }\\n}\\n\\nfunction applyExtraJson(): void {\\n  if (!selectedEntry.value) {\\n    return;\\n  }\\n  const text = selectedExtraText.value.trim();\\n  if (!text) {\\n    selectedEntry.value.extra = undefined;\\n    return;\\n  }\\n  try {\\n    const parsed = JSON.parse(text);\\n    const parsedRecord = asRecord(parsed);\\n    if (!parsedRecord) {\\n      throw new Error('extra  JSON ');\\n    }\\n    selectedEntry.value.extra = klona(parsedRecord);\\n    toastr.success('extra ');\\n  } catch (error) {\\n    toastr.error(`extra JSON : ${error instanceof Error ? error.message : String(error)}`);\\n  }\\n}\\n\\nfunction clearExtra(): void {\\n  if (!selectedEntry.value) {\\n    return;\\n  }\\n  selectedEntry.value.extra = undefined;\\n  selectedExtraText.value = '';\\n}\\n\\nfunction addEntry(): void {\\n  const uid = getNextUid(draftEntries.value);\\n  const entry = createDefaultEntry(uid);\\n  draftEntries.value.push(entry);\\n  selectedEntryUid.value = uid;\\n  setStatus(` #${uid}`);\\n}\\n\\nfunction duplicateSelectedEntry(): void {\\n  if (!selectedEntry.value || selectedEntryIndex.value < 0) {\\n    return;\\n  }\\n  const uid = getNextUid(draftEntries.value);\\n  const duplicated = normalizeEntry(klona(selectedEntry.value), uid);\\n  duplicated.uid = uid;\\n  duplicated.name = `${duplicated.name} ()`;\\n  draftEntries.value.splice(selectedEntryIndex.value + 1, 0, duplicated);\\n  selectedEntryUid.value = uid;\\n  setStatus(` #${selectedEntry.value.uid}`);\\n}\\n\\nfunction removeSelectedEntry(): void {\\n  if (!selectedEntry.value || selectedEntryIndex.value < 0) {\\n    return;\\n  }\\n  if (!confirm(` \\\"${selectedEntry.value.name}\\\" ?`)) {\\n    return;\\n  }\\n  pushEntrySnapshot('', selectedEntry.value);\\n  draftEntries.value.splice(selectedEntryIndex.value, 1);\\n  ensureSelectedEntryExists();\\n  setStatus('');\\n}\\n\\nfunction moveSelectedEntry(direction: -1 | 1): void {\\n  if (selectedEntryIndex.value < 0) {\\n    return;\\n  }\\n  const target = selectedEntryIndex.value + direction;\\n  if (target < 0 || target >= draftEntries.value.length) {\\n    return;\\n  }\\n  const [entry] = draftEntries.value.splice(selectedEntryIndex.value, 1);\\n  draftEntries.value.splice(target, 0, entry);\\n  selectedEntryUid.value = entry.uid;\\n}\\n\\nfunction normalizeAllEntries(): void {\\n  draftEntries.value = normalizeEntryList(draftEntries.value.map(entry => klona(entry)));\\n  ensureSelectedEntryExists();\\n  setStatus('');\\n}\\n\\nfunction sortEntriesByOrderDesc(): void {\\n  draftEntries.value.sort((left, right) => right.position.order - left.position.order);\\n  ensureSelectedEntryExists();\\n  setStatus(' order ');\\n}\\n\\nfunction setEnabledForAll(enabled: boolean): void {\\n  draftEntries.value.forEach(entry => {\\n    entry.enabled = enabled;\\n  });\\n  setStatus(enabled ? '' : '');\\n}\\n\\nfunction applyBatchReplace(): void {\\n  const findText = batchFindText.value;\\n  if (!findText) {\\n    toastr.warning('');\\n    return;\\n  }\\n  const excludeTokens = parseBatchExcludeTokens(batchExcludeText.value);\\n\\n  let regex: RegExp | null = null;\\n  if (batchUseRegex.value) {\\n    try {\\n      regex = new RegExp(findText, 'g');\\n    } catch (error) {\\n      toastr.error(`: ${error instanceof Error ? error.message : String(error)}`);\\n      return;\\n    }\\n  }\\n\\n  let touched = 0;\\n  let skipped = 0;\\n  for (const entry of draftEntries.value) {\\n    if (shouldExcludeEntryForBatch(entry, excludeTokens)) {\\n      skipped += 1;\\n      continue;\\n    }\\n\\n    let changed = false;\\n\\n    if (batchInName.value) {\\n      const next = regex\\n        ? entry.name.replace(regex, batchReplaceText.value)\\n        : entry.name.split(findText).join(batchReplaceText.value);\\n      if (next !== entry.name) {\\n        entry.name = next;\\n        changed = true;\\n      }\\n    }\\n\\n    if (batchInContent.value) {\\n      const next = regex\\n        ? entry.content.replace(regex, batchReplaceText.value)\\n        : entry.content.split(findText).join(batchReplaceText.value);\\n      if (next !== entry.content) {\\n        entry.content = next;\\n        changed = true;\\n      }\\n    }\\n\\n    if (batchInKeys.value) {\\n      const nextKeys = entry.strategy.keys.map(key => {\\n        const text = stringifyKeyword(key);\\n        return regex ? text.replace(regex, batchReplaceText.value) : text.split(findText).join(batchReplaceText.value);\\n      });\\n      const normalized = normalizeKeywordList(nextKeys);\\n      if (\\n        JSON.stringify(normalized.map(stringifyKeyword)) !== JSON.stringify(entry.strategy.keys.map(stringifyKeyword))\\n      ) {\\n        entry.strategy.keys = normalized;\\n        changed = true;\\n      }\\n    }\\n\\n    if (changed) {\\n      touched += 1;\\n    }\\n  }\\n\\n  setStatus(` ${touched}  ${skipped} `);\\n}\\n\\nfunction downloadJson(filename: string, payload: unknown): void {\\n  const text = JSON.stringify(payload, null, 2);\\n  const blob = new Blob([text], { type: 'application/json' });\\n  const url = URL.createObjectURL(blob);\\n  const anchor = document.createElement('a');\\n  anchor.href = url;\\n  anchor.download = filename;\\n  document.body.appendChild(anchor);\\n  anchor.click();\\n  document.body.removeChild(anchor);\\n  URL.revokeObjectURL(url);\\n}\\n\\nfunction exportCurrentWorldbook(): void {\\n  if (!selectedWorldbookName.value) {\\n    return;\\n  }\\n  const payload = {\\n    format: 'worldbook_assistant_v1',\\n    name: selectedWorldbookName.value,\\n    exported_at: new Date().toISOString(),\\n    entries: draftEntries.value,\\n  };\\n  const filename = `${selectedWorldbookName.value.replace(/[\\\\\\\\/:*?\\\"<>|]/g, '_')}.json`;\\n  downloadJson(filename, payload);\\n}\\n\\nfunction collectRawEntries(root: Record<string, unknown>): unknown[] {\\n  if (Array.isArray(root.entries)) {\\n    return root.entries;\\n  }\\n  const entriesMap = asRecord(root.entries);\\n  if (entriesMap) {\\n    return Object.values(entriesMap);\\n  }\\n  const dataRoot = asRecord(root.data);\\n  if (dataRoot) {\\n    if (Array.isArray(dataRoot.entries)) {\\n      return dataRoot.entries;\\n    }\\n    const dataEntriesMap = asRecord(dataRoot.entries);\\n    if (dataEntriesMap) {\\n      return Object.values(dataEntriesMap);\\n    }\\n  }\\n  return [];\\n}\\n\\nfunction parseImportedPayload(fileName: string, text: string): ImportedPayload {\\n  const parsed = JSON.parse(text) as unknown;\\n  const fallbackName = fileName.replace(/\\\\.[^/.]+$/, '') || '';\\n\\n  if (Array.isArray(parsed)) {\\n    return {\\n      name: fallbackName,\\n      entries: normalizeEntryList(parsed),\\n    };\\n  }\\n\\n  const root = asRecord(parsed);\\n  if (!root) {\\n    throw new Error(' JSON ');\\n  }\\n\\n  const entries = collectRawEntries(root);\\n  if (!entries.length) {\\n    throw new Error(' entries');\\n  }\\n\\n  const dataRoot = asRecord(root.data);\\n  const nameCandidate = toStringSafe(root.name ?? dataRoot?.name, fallbackName).trim();\\n\\n  return {\\n    name: nameCandidate || fallbackName,\\n    entries: normalizeEntryList(entries),\\n  };\\n}\\n\\nfunction triggerImport(): void {\\n  importFileInput.value?.click();\\n}\\n\\nasync function onImportChange(event: Event): Promise<void> {\\n  const target = event.target as HTMLInputElement | null;\\n  const file = target?.files?.[0];\\n  if (!file) {\\n    return;\\n  }\\n\\n  const fileText = await file.text();\\n  try {\\n    const payload = parseImportedPayload(file.name, fileText);\\n    const suggested = payload.name || file.name.replace(/\\\\.[^/.]+$/, '');\\n    const newNameRaw = prompt('', suggested);\\n    const newName = toStringSafe(newNameRaw).trim();\\n    if (!newName) {\\n      return;\\n    }\\n    await createOrReplaceWorldbook(newName, payload.entries, { render: 'immediate' });\\n    await reloadWorldbookNames(newName);\\n    await refreshBindings();\\n    toastr.success(`: ${newName}`);\\n  } catch (error) {\\n    const message = error instanceof Error ? error.message : String(error);\\n    const shouldFallback = confirm(`: ${message}\\\\n`);\\n    if (!shouldFallback) {\\n      return;\\n    }\\n    const response = await importRawWorldbook(file.name, fileText);\\n    if (!response.ok) {\\n      throw new Error(`: HTTP ${response.status}`);\\n    }\\n    await hardRefresh();\\n    toastr.success('');\\n  } finally {\\n    if (target) {\\n      target.value = '';\\n    }\\n  }\\n}\\n\\nasync function refreshBindings(): Promise<void> {\\n  bindings.global = [...getGlobalWorldbookNames()];\\n  try {\\n    const charBindings = getCharWorldbookNames('current');\\n    bindings.charPrimary = charBindings.primary;\\n    bindings.charAdditional = [...charBindings.additional];\\n  } catch {\\n    bindings.charPrimary = null;\\n    bindings.charAdditional = [];\\n  }\\n\\n  try {\\n    bindings.chat = getChatWorldbookName('current');\\n  } catch {\\n    bindings.chat = null;\\n  }\\n  if (globalWorldbookMode.value) {\\n    ensureSelectionForGlobalMode();\\n  }\\n}\\n\\nfunction resolveContextWorldbookCandidate(): string | null {\\n  const available = worldbookNames.value;\\n  if (!available.length) {\\n    return null;\\n  }\\n  const chatBound = toStringSafe(bindings.chat).trim();\\n  if (chatBound && available.includes(chatBound)) {\\n    return chatBound;\\n  }\\n  const charPrimary = toStringSafe(bindings.charPrimary).trim();\\n  if (charPrimary && available.includes(charPrimary)) {\\n    return charPrimary;\\n  }\\n  const charAdditional = bindings.charAdditional.find(name => available.includes(name));\\n  return charAdditional ?? null;\\n}\\n\\nfunction ensureSelectionForGlobalMode(): void {\\n  if (!globalWorldbookMode.value) {\\n    return;\\n  }\\n  const globals = selectableWorldbookNames.value;\\n  if (!globals.length) {\\n    selectedWorldbookName.value = '';\\n    return;\\n  }\\n  if (!globals.includes(selectedWorldbookName.value)) {\\n    selectedWorldbookName.value = globals[0];\\n  }\\n}\\n\\nfunction trySelectWorldbookByContext(options: { preferWhenEmptyOnly?: boolean; force?: boolean } = {}): boolean {\\n  if (globalWorldbookMode.value) {\\n    return false;\\n  }\\n  if (options.preferWhenEmptyOnly && selectedWorldbookName.value) {\\n    return false;\\n  }\\n  const candidate = resolveContextWorldbookCandidate();\\n  if (!candidate || candidate === selectedWorldbookName.value) {\\n    return false;\\n  }\\n  if (!options.force && hasUnsavedChanges.value) {\\n    setStatus('/');\\n    return false;\\n  }\\n  selectedWorldbookName.value = candidate;\\n  setStatus(`: ${candidate}`);\\n  return true;\\n}\\n\\nfunction toggleGlobalMode(): void {\\n  globalWorldbookMode.value = !globalWorldbookMode.value;\\n  if (globalWorldbookMode.value) {\\n    ensureSelectionForGlobalMode();\\n    setStatus('');\\n    return;\\n  }\\n  if (!selectedWorldbookName.value) {\\n    trySelectWorldbookByContext({ force: true });\\n  }\\n  setStatus('');\\n}\\n\\nasync function applyGlobalWorldbooks(nextGlobal: string[], statusLabel = ''): Promise<boolean> {\\n  const normalized = [...new Set(nextGlobal.map(name => name.trim()).filter(Boolean))].filter(name =>\\n    worldbookNames.value.includes(name),\\n  );\\n  try {\\n    await rebindGlobalWorldbooks(normalized);\\n    await refreshBindings();\\n    ensureSelectionForGlobalMode();\\n    setStatus(`${statusLabel}${normalized.length} `);\\n    return true;\\n  } catch (error) {\\n    const message = error instanceof Error ? error.message : String(error);\\n    toastr.error(`: ${message}`);\\n    return false;\\n  }\\n}\\n\\nfunction addFirstGlobalCandidate(): void {\\n  const first = globalAddCandidates.value[0];\\n  if (!first) {\\n    return;\\n  }\\n  void addGlobalWorldbook(first);\\n}\\n\\nasync function addGlobalWorldbook(name: string): Promise<void> {\\n  if (!name || bindings.global.includes(name)) {\\n    return;\\n  }\\n  const success = await applyGlobalWorldbooks([...bindings.global, name], `: ${name}`);\\n  if (success) {\\n    globalAddSearchText.value = '';\\n  }\\n}\\n\\nasync function removeGlobalWorldbook(name: string): Promise<void> {\\n  if (!name || !bindings.global.includes(name)) {\\n    return;\\n  }\\n  await applyGlobalWorldbooks(\\n    bindings.global.filter(item => item !== name),\\n    `: ${name}`,\\n  );\\n}\\n\\nasync function clearGlobalWorldbooks(): Promise<void> {\\n  if (!bindings.global.length) {\\n    return;\\n  }\\n  if (!confirm('')) {\\n    return;\\n  }\\n  await applyGlobalWorldbooks([], '');\\n}\\n\\nasync function loadWorldbook(name: string): Promise<void> {\\n  if (!name) {\\n    return;\\n  }\\n  isBusy.value = true;\\n  try {\\n    const rawEntries = await getWorldbook(name);\\n    const normalized = normalizeEntryList(rawEntries);\\n    draftEntries.value = klona(normalized);\\n    originalEntries.value = klona(normalized);\\n    ensureSelectedEntryExists();\\n    setStatus(` \\\"${name}\\\" ${normalized.length}`);\\n  } catch (error) {\\n    const message = error instanceof Error ? error.message : String(error);\\n    toastr.error(`: ${message}`);\\n    setStatus(`: ${message}`);\\n  } finally {\\n    isBusy.value = false;\\n  }\\n}\\n\\nasync function reloadWorldbookNames(preferred?: string): Promise<void> {\\n  const names = [...getWorldbookNames()].sort((left, right) => left.localeCompare(right, 'zh-Hans-CN'));\\n  worldbookNames.value = names;\\n\\n  if (!names.length) {\\n    selectedWorldbookName.value = '';\\n    draftEntries.value = [];\\n    originalEntries.value = [];\\n    selectedEntryUid.value = null;\\n    return;\\n  }\\n\\n  const fallbackName = persistedState.value.last_worldbook;\\n  const candidate =\\n    (preferred && names.includes(preferred) && preferred) ||\\n    (fallbackName && names.includes(fallbackName) && fallbackName) ||\\n    selectedWorldbookName.value ||\\n    names[0];\\n\\n  if (candidate && selectedWorldbookName.value !== candidate) {\\n    selectedWorldbookName.value = candidate;\\n    return;\\n  }\\n\\n  if (selectedWorldbookName.value && !draftEntries.value.length) {\\n    await loadWorldbook(selectedWorldbookName.value);\\n  }\\n}\\n\\nasync function hardRefresh(): Promise<void> {\\n  persistedState.value = readPersistedState();\\n  await reloadWorldbookNames(selectedWorldbookName.value || undefined);\\n  await refreshBindings();\\n  if (globalWorldbookMode.value) {\\n    ensureSelectionForGlobalMode();\\n  } else {\\n    trySelectWorldbookByContext({ preferWhenEmptyOnly: true });\\n  }\\n  setStatus('');\\n}\\n\\nasync function saveCurrentWorldbook(): Promise<void> {\\n  if (!selectedWorldbookName.value) {\\n    toastr.warning('');\\n    return;\\n  }\\n  if (!hasUnsavedChanges.value) {\\n    setStatus('');\\n    return;\\n  }\\n  isSaving.value = true;\\n  try {\\n    draftEntries.value = normalizeEntryList(draftEntries.value.map(entry => klona(entry)));\\n    const pendingEntrySnapshots = collectEntrySnapshotsBeforeSave();\\n    const savedEntrySnapshotCount = pushEntrySnapshotsBulk(pendingEntrySnapshots);\\n    await replaceWorldbook(selectedWorldbookName.value, klona(draftEntries.value), { render: 'immediate' });\\n    originalEntries.value = klona(draftEntries.value);\\n    pushSnapshot('');\\n    await refreshBindings();\\n    toastr.success(`: ${selectedWorldbookName.value}`);\\n    setStatus(`: ${selectedWorldbookName.value} +${savedEntrySnapshotCount}`);\\n  } catch (error) {\\n    const message = error instanceof Error ? error.message : String(error);\\n    toastr.error(`: ${message}`);\\n    setStatus(`: ${message}`);\\n  } finally {\\n    isSaving.value = false;\\n  }\\n}\\n\\nasync function createNewWorldbook(): Promise<void> {\\n  const nameRaw = prompt('');\\n  const name = toStringSafe(nameRaw).trim();\\n  if (!name) {\\n    return;\\n  }\\n  try {\\n    await createOrReplaceWorldbook(name, [], { render: 'immediate' });\\n    await reloadWorldbookNames(name);\\n    await refreshBindings();\\n    toastr.success(`: ${name}`);\\n  } catch (error) {\\n    const message = error instanceof Error ? error.message : String(error);\\n    toastr.error(`: ${message}`);\\n  }\\n}\\n\\nasync function duplicateWorldbook(): Promise<void> {\\n  if (!selectedWorldbookName.value) {\\n    return;\\n  }\\n  const suggested = `${selectedWorldbookName.value}_copy`;\\n  const newNameRaw = prompt('', suggested);\\n  const newName = toStringSafe(newNameRaw).trim();\\n  if (!newName) {\\n    return;\\n  }\\n  try {\\n    await createOrReplaceWorldbook(newName, klona(draftEntries.value), { render: 'immediate' });\\n    await reloadWorldbookNames(newName);\\n    await refreshBindings();\\n    toastr.success(`: ${newName}`);\\n  } catch (error) {\\n    const message = error instanceof Error ? error.message : String(error);\\n    toastr.error(`: ${message}`);\\n  }\\n}\\n\\nasync function deleteCurrentWorldbook(): Promise<void> {\\n  if (!selectedWorldbookName.value) {\\n    return;\\n  }\\n  const current = selectedWorldbookName.value;\\n  if (!confirm(` \\\"${current}\\\" ?`)) {\\n    return;\\n  }\\n  try {\\n    const success = await deleteWorldbook(current);\\n    if (!success) {\\n      throw new Error(' false');\\n    }\\n    updatePersistedState(state => {\\n      delete state.history[current];\\n      delete state.entry_history[current];\\n    });\\n    toastr.success(`: ${current}`);\\n    await reloadWorldbookNames();\\n    await refreshBindings();\\n  } catch (error) {\\n    const message = error instanceof Error ? error.message : String(error);\\n    toastr.error(`: ${message}`);\\n  }\\n}\\n\\nasync function toggleGlobalBinding(): Promise<void> {\\n  if (!selectedWorldbookName.value) {\\n    return;\\n  }\\n  const next = new Set(getGlobalWorldbookNames());\\n  if (next.has(selectedWorldbookName.value)) {\\n    next.delete(selectedWorldbookName.value);\\n  } else {\\n    next.add(selectedWorldbookName.value);\\n  }\\n  await applyGlobalWorldbooks([...next], '');\\n}\\n\\nfunction pushActivationLogs(entries: Array<{ world: string } & Record<string, unknown>>): void {\\n  const logs = entries.map(item => {\\n    const uid = item.uid ?? item.displayIndex ?? '?';\\n    const name = toStringSafe(item.name ?? item.comment, `UID ${uid}`);\\n    const content = toStringSafe(item.content).replace(/\\\\s+/g, ' ').trim().slice(0, 80);\\n    return {\\n      id: createId('activation'),\\n      time: Date.now(),\\n      world: toStringSafe(item.world, 'unknown'),\\n      uid: typeof uid === 'number' || typeof uid === 'string' ? uid : '?',\\n      name,\\n      contentPreview: content || '()',\\n    } satisfies ActivationLog;\\n  });\\n  activationLogs.value.unshift(...logs);\\n  if (activationLogs.value.length > ACTIVATION_LOG_LIMIT) {\\n    activationLogs.value.length = ACTIVATION_LOG_LIMIT;\\n  }\\n}\\n\\nfunction clearActivationLogs(): void {\\n  activationLogs.value = [];\\n}\\n\\nfunction resolveHostWindow(): Window {\\n  return mainLayoutRef.value?.ownerDocument?.defaultView ?? editorShellRef.value?.ownerDocument?.defaultView ?? window;\\n}\\n\\nfunction clampFloatingPanelToViewport(panel: FloatingPanelState): void {\\n  const hostWin = resolveHostWindow();\\n  const viewportWidth = hostWin.innerWidth;\\n  const viewportHeight = hostWin.innerHeight;\\n  const maxX = Math.max(8, viewportWidth - panel.width - 8);\\n  const maxY = Math.max(8, viewportHeight - 68);\\n  panel.x = clampNumber(panel.x, 8, maxX);\\n  panel.y = clampNumber(panel.y, 8, maxY);\\n}\\n\\nfunction handleFloatingWindowResize(): void {\\n  viewportWidth.value = resolveHostWindow().innerWidth;\\n  clampPaneWidths();\\n  for (const key of floatingPanelKeys) {\\n    if (!floatingPanels[key].visible) {\\n      continue;\\n    }\\n    clampFloatingPanelToViewport(floatingPanels[key]);\\n  }\\n}\\n\\nfunction bringFloatingToFront(key: FloatingPanelKey): void {\\n  floatingZCounter.value += 1;\\n  floatingPanels[key].z = floatingZCounter.value;\\n}\\n\\nfunction openFloatingPanel(key: FloatingPanelKey): void {\\n  const panel = floatingPanels[key];\\n  panel.visible = true;\\n  clampFloatingPanelToViewport(panel);\\n  bringFloatingToFront(key);\\n}\\n\\nfunction closeFloatingPanel(key: FloatingPanelKey): void {\\n  floatingPanels[key].visible = false;\\n  if (activeFloatingDrag.value?.key === key) {\\n    stopFloatingDrag();\\n  }\\n}\\n\\nfunction toggleFloatingPanel(key: FloatingPanelKey): void {\\n  if (floatingPanels[key].visible) {\\n    closeFloatingPanel(key);\\n    return;\\n  }\\n  openFloatingPanel(key);\\n}\\n\\nfunction getFloatingPanelStyle(key: FloatingPanelKey): Record<string, string> {\\n  const panel = floatingPanels[key];\\n  return {\\n    left: `${panel.x}px`,\\n    top: `${panel.y}px`,\\n    zIndex: String(panel.z),\\n    width: `${panel.width}px`,\\n  };\\n}\\n\\nfunction startFloatingDrag(key: FloatingPanelKey, event: PointerEvent): void {\\n  if (event.pointerType === 'mouse' && event.button !== 0) {\\n    return;\\n  }\\n  const panel = floatingPanels[key];\\n  const target = event.currentTarget as HTMLElement | null;\\n  if (!target) {\\n    return;\\n  }\\n  const hostDoc = target.ownerDocument ?? document;\\n  const hostWin = hostDoc.defaultView ?? window;\\n  const rect = target.getBoundingClientRect();\\n  bringFloatingToFront(key);\\n  const dragState = {\\n    key,\\n    pointerId: event.pointerId,\\n    offsetX: event.clientX - panel.x,\\n    offsetY: event.clientY - panel.y,\\n    doc: hostDoc,\\n    win: hostWin,\\n  };\\n  activeFloatingDrag.value = dragState;\\n  target.setPointerCapture?.(event.pointerId);\\n  hostDoc.addEventListener('pointermove', onFloatingDragMove);\\n  hostDoc.addEventListener('pointerup', stopFloatingDrag);\\n  hostDoc.addEventListener('pointercancel', stopFloatingDrag);\\n  hostWin.addEventListener('blur', stopFloatingDrag);\\n  panel.x = clampNumber(event.clientX - dragState.offsetX, 8, Math.max(8, hostWin.innerWidth - panel.width - 8));\\n  panel.y = clampNumber(event.clientY - dragState.offsetY, 8, Math.max(8, hostWin.innerHeight - rect.height - 8));\\n  event.preventDefault();\\n}\\n\\nfunction onFloatingDragMove(event: PointerEvent): void {\\n  const drag = activeFloatingDrag.value;\\n  if (!drag) {\\n    return;\\n  }\\n  if (event.pointerId !== drag.pointerId) {\\n    return;\\n  }\\n  const panel = floatingPanels[drag.key];\\n  panel.x = clampNumber(event.clientX - drag.offsetX, 8, Math.max(8, drag.win.innerWidth - panel.width - 8));\\n  panel.y = clampNumber(event.clientY - drag.offsetY, 8, Math.max(8, drag.win.innerHeight - 68));\\n}\\n\\nfunction stopFloatingDrag(): void {\\n  const drag = activeFloatingDrag.value;\\n  if (drag) {\\n    drag.doc.removeEventListener('pointermove', onFloatingDragMove);\\n    drag.doc.removeEventListener('pointerup', stopFloatingDrag);\\n    drag.doc.removeEventListener('pointercancel', stopFloatingDrag);\\n    drag.win.removeEventListener('blur', stopFloatingDrag);\\n  }\\n  activeFloatingDrag.value = null;\\n}\\n\\nfunction clampPaneWidths(): void {\\n  if (isCompactLayout.value) {\\n    return;\\n  }\\n\\n  const mainRect = mainLayoutRef.value?.getBoundingClientRect();\\n  if (mainRect) {\\n    const maxLeft = Math.max(MAIN_PANE_MIN, Math.floor(mainRect.width - MAIN_EDITOR_MIN - RESIZE_HANDLE_SIZE));\\n    mainPaneWidth.value = clampNumber(mainPaneWidth.value, MAIN_PANE_MIN, maxLeft);\\n  }\\n\\n  const editorRect = editorShellRef.value?.getBoundingClientRect();\\n  if (editorRect) {\\n    const maxSide = Math.max(EDITOR_SIDE_MIN, Math.floor(editorRect.width - EDITOR_CENTER_MIN - RESIZE_HANDLE_SIZE));\\n    editorSideWidth.value = clampNumber(editorSideWidth.value, EDITOR_SIDE_MIN, maxSide);\\n  }\\n}\\n\\nfunction startPaneResize(key: PaneResizeKey, event: PointerEvent): void {\\n  if (isCompactLayout.value) {\\n    return;\\n  }\\n  if (event.pointerType === 'mouse' && event.button !== 0) {\\n    return;\\n  }\\n  const target = event.currentTarget as HTMLElement | null;\\n  const hostDoc = target?.ownerDocument ?? document;\\n  const hostWin = hostDoc.defaultView ?? window;\\n  paneResizeState.value = {\\n    key,\\n    pointerId: event.pointerId,\\n    doc: hostDoc,\\n    win: hostWin,\\n  };\\n  target?.setPointerCapture?.(event.pointerId);\\n  hostDoc.addEventListener('pointermove', onPaneResizeMove);\\n  hostDoc.addEventListener('pointerup', stopPaneResize);\\n  hostDoc.addEventListener('pointercancel', stopPaneResize);\\n  hostWin.addEventListener('blur', stopPaneResize);\\n  event.preventDefault();\\n}\\n\\nfunction onPaneResizeMove(event: PointerEvent): void {\\n  const state = paneResizeState.value;\\n  if (!state || event.pointerId !== state.pointerId) {\\n    return;\\n  }\\n  if (state.key === 'main') {\\n    const rect = mainLayoutRef.value?.getBoundingClientRect();\\n    if (!rect) {\\n      return;\\n    }\\n    const left = Math.floor(event.clientX - rect.left);\\n    const maxLeft = Math.max(MAIN_PANE_MIN, Math.floor(rect.width - MAIN_EDITOR_MIN - RESIZE_HANDLE_SIZE));\\n    mainPaneWidth.value = clampNumber(left, MAIN_PANE_MIN, maxLeft);\\n    return;\\n  }\\n\\n  const rect = editorShellRef.value?.getBoundingClientRect();\\n  if (!rect) {\\n    return;\\n  }\\n  const side = Math.floor(rect.right - event.clientX);\\n  const maxSide = Math.max(EDITOR_SIDE_MIN, Math.floor(rect.width - EDITOR_CENTER_MIN - RESIZE_HANDLE_SIZE));\\n  editorSideWidth.value = clampNumber(side, EDITOR_SIDE_MIN, maxSide);\\n}\\n\\nfunction stopPaneResize(): void {\\n  const state = paneResizeState.value;\\n  if (state) {\\n    state.doc.removeEventListener('pointermove', onPaneResizeMove);\\n    state.doc.removeEventListener('pointerup', stopPaneResize);\\n    state.doc.removeEventListener('pointercancel', stopPaneResize);\\n    state.win.removeEventListener('blur', stopPaneResize);\\n  }\\n  paneResizeState.value = null;\\n}\\n\\nfunction onPanelRefresh(): void {\\n  void hardRefresh();\\n}\\n\\nfunction onPanelSave(): void {\\n  void saveCurrentWorldbook();\\n}\\n\\nonMounted(() => {\\n  persistedState.value = readPersistedState();\\n\\n  subscriptions.push(\\n    eventOn(tavern_events.WORLD_INFO_ACTIVATED, entries => {\\n      pushActivationLogs(entries as Array<{ world: string } & Record<string, unknown>>);\\n    }),\\n  );\\n  subscriptions.push(\\n    eventOn(tavern_events.WORLDINFO_UPDATED, () => {\\n      void hardRefresh();\\n    }),\\n  );\\n  subscriptions.push(\\n    eventOn(tavern_events.CHAT_CHANGED, () => {\\n      void (async () => {\\n        await refreshBindings();\\n        if (globalWorldbookMode.value) {\\n          ensureSelectionForGlobalMode();\\n          return;\\n        }\\n        trySelectWorldbookByContext();\\n      })();\\n    }),\\n  );\\n\\n  window.addEventListener('wb-helper:refresh', onPanelRefresh);\\n  window.addEventListener('wb-helper:save', onPanelSave);\\n  hostResizeWindow.value = resolveHostWindow();\\n  hostResizeWindow.value.addEventListener('resize', handleFloatingWindowResize);\\n\\n  handleFloatingWindowResize();\\n  void hardRefresh();\\n});\\n\\nonUnmounted(() => {\\n  const target = window as unknown as Record<string, unknown>;\\n  target[DIRTY_STATE_KEY] = false;\\n  subscriptions.forEach(subscription => {\\n    subscription.stop();\\n  });\\n  stopFloatingDrag();\\n  stopPaneResize();\\n  window.removeEventListener('wb-helper:refresh', onPanelRefresh);\\n  window.removeEventListener('wb-helper:save', onPanelSave);\\n  hostResizeWindow.value?.removeEventListener('resize', handleFloatingWindowResize);\\n  hostResizeWindow.value = null;\\n});\\n</script>\\n\\n<style scoped>\\n.wb-assistant-root {\\n  height: auto;\\n  width: 100%;\\n  box-sizing: border-box;\\n  display: flex;\\n  flex-direction: column;\\n  padding: 10px;\\n  gap: 10px;\\n  background: linear-gradient(145deg, #0f172a 0%, #111827 45%, #1e293b 100%);\\n  color: #e2e8f0;\\n  font-size: 13px;\\n  line-height: 1.35;\\n  border-radius: 10px;\\n}\\n\\n.wb-settings-wrapper {\\n  width: 100%;\\n}\\n\\n.wb-header {\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  border: 1px solid #334155;\\n  border-radius: 10px;\\n  padding: 8px 10px;\\n  background: rgba(15, 23, 42, 0.6);\\n}\\n\\n.wb-title {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 2px;\\n}\\n\\n.wb-title strong {\\n  font-size: 16px;\\n}\\n\\n.wb-title span {\\n  color: #94a3b8;\\n}\\n\\n.wb-header-actions,\\n.list-actions,\\n.tool-line {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n}\\n\\n.wb-toolbar {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n  align-items: center;\\n  border: 1px solid #334155;\\n  border-radius: 10px;\\n  padding: 8px;\\n  background: rgba(15, 23, 42, 0.55);\\n}\\n\\n.toolbar-label {\\n  display: inline-flex;\\n  align-items: center;\\n  gap: 6px;\\n  color: #cbd5e1;\\n}\\n\\n.toolbar-select {\\n  min-width: 200px;\\n}\\n\\n.toolbar-select.small {\\n  min-width: 160px;\\n}\\n\\n.wb-bindings {\\n  border: 1px solid #334155;\\n  border-radius: 10px;\\n  padding: 8px;\\n  display: grid;\\n  gap: 8px;\\n  background: rgba(15, 23, 42, 0.5);\\n}\\n\\n.wb-history-shortcuts {\\n  display: flex;\\n  justify-content: flex-start;\\n  gap: 8px;\\n  flex-wrap: wrap;\\n  align-items: center;\\n}\\n\\n.global-mode-panel {\\n  border: 1px solid #334155;\\n  border-radius: 9px;\\n  background: rgba(15, 23, 42, 0.58);\\n  padding: 8px;\\n  display: grid;\\n  gap: 8px;\\n}\\n\\n.global-mode-head {\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  gap: 8px;\\n}\\n\\n.global-mode-title {\\n  color: #93c5fd;\\n  font-weight: 700;\\n  letter-spacing: 0.02em;\\n}\\n\\n.global-mode-grid {\\n  display: grid;\\n  grid-template-columns: repeat(2, minmax(0, 1fr));\\n  gap: 8px;\\n}\\n\\n.global-mode-column {\\n  border: 1px solid #334155;\\n  border-radius: 8px;\\n  padding: 8px;\\n  background: rgba(2, 6, 23, 0.42);\\n  display: grid;\\n  gap: 6px;\\n  min-height: 168px;\\n}\\n\\n.global-mode-list {\\n  border: 1px solid #334155;\\n  border-radius: 8px;\\n  background: rgba(15, 23, 42, 0.6);\\n  max-height: 176px;\\n  min-height: 88px;\\n  overflow: auto;\\n  display: flex;\\n  flex-direction: column;\\n}\\n\\n.global-mode-item {\\n  width: 100%;\\n  border: none;\\n  border-bottom: 1px solid rgba(51, 65, 85, 0.6);\\n  background: transparent;\\n  color: #e2e8f0;\\n  padding: 7px 8px;\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  gap: 10px;\\n  cursor: pointer;\\n  text-align: left;\\n}\\n\\n.global-mode-item:last-child {\\n  border-bottom: none;\\n}\\n\\n.global-mode-item:hover {\\n  background: rgba(56, 189, 248, 0.14);\\n}\\n\\n.global-mode-item.add .global-mode-item-action {\\n  color: #86efac;\\n}\\n\\n.global-mode-item.active .global-mode-item-action {\\n  color: #fca5a5;\\n}\\n\\n.global-mode-item-name {\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n  white-space: nowrap;\\n}\\n\\n.global-mode-item-action {\\n  font-size: 12px;\\n  flex-shrink: 0;\\n}\\n\\n.global-mode-actions {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n}\\n\\n.history-btn {\\n  border-color: #3b82f6;\\n  background: rgba(30, 58, 138, 0.25);\\n}\\n\\n.utility-btn {\\n  border-color: #0ea5e9;\\n  background: rgba(6, 78, 118, 0.25);\\n}\\n\\n.utility-btn.active {\\n  border-color: #22d3ee;\\n  background: rgba(34, 211, 238, 0.16);\\n  color: #67e8f9;\\n}\\n\\n.wb-main-layout {\\n  min-height: 460px;\\n  max-height: 70vh;\\n  display: grid;\\n  grid-template-columns: 320px 10px minmax(0, 1fr);\\n  gap: 0;\\n}\\n\\n.wb-entry-list,\\n.wb-editor {\\n  border: 1px solid #334155;\\n  border-radius: 10px;\\n  padding: 8px;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 8px;\\n  background: rgba(15, 23, 42, 0.55);\\n  min-height: 0;\\n}\\n\\n.list-search {\\n  display: grid;\\n  gap: 6px;\\n}\\n\\n.list-summary {\\n  color: #94a3b8;\\n  font-size: 12px;\\n}\\n\\n.list-scroll {\\n  flex: 1 1 auto;\\n  min-height: 210px;\\n  max-height: calc(70vh - 210px);\\n  overflow: auto;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 6px;\\n}\\n\\n.entry-item {\\n  width: 100%;\\n  text-align: left;\\n  border: 1px solid #334155;\\n  background: linear-gradient(145deg, rgba(15, 23, 42, 0.88), rgba(2, 6, 23, 0.9));\\n  color: #e2e8f0;\\n  border-radius: 8px;\\n  padding: 8px 8px 7px 10px;\\n  cursor: pointer;\\n  display: grid;\\n  gap: 6px;\\n  position: relative;\\n  transition: border-color 0.16s ease, transform 0.16s ease, box-shadow 0.16s ease;\\n}\\n\\n.entry-item::before {\\n  content: '';\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n  bottom: 0;\\n  width: 4px;\\n  border-radius: 8px 0 0 8px;\\n  background: linear-gradient(to bottom, #64748b, rgba(100, 116, 139, 0.05));\\n}\\n\\n.entry-item[data-status='constant']::before {\\n  background: linear-gradient(to bottom, #3b82f6, rgba(59, 130, 246, 0));\\n}\\n\\n.entry-item[data-status='vector']::before {\\n  background: linear-gradient(to bottom, #a855f7, rgba(168, 85, 247, 0));\\n}\\n\\n.entry-item[data-status='normal']::before {\\n  background: linear-gradient(to bottom, #22c55e, rgba(34, 197, 94, 0));\\n}\\n\\n.entry-item[data-status='disabled']::before {\\n  background: linear-gradient(to bottom, #6b7280, rgba(107, 114, 128, 0));\\n}\\n\\n.entry-item:hover {\\n  border-color: #475569;\\n  transform: translateY(-1px);\\n}\\n\\n.entry-item.selected {\\n  border-color: #38bdf8;\\n  box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.5) inset, 0 6px 16px rgba(14, 116, 144, 0.3);\\n}\\n\\n.entry-item.disabled {\\n  opacity: 0.74;\\n}\\n\\n.entry-item-head {\\n  display: flex;\\n  align-items: center;\\n  gap: 7px;\\n  min-width: 0;\\n}\\n\\n.entry-status-dot {\\n  width: 9px;\\n  height: 9px;\\n  border-radius: 999px;\\n  background: #64748b;\\n  flex-shrink: 0;\\n  box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.85);\\n}\\n\\n.entry-status-dot[data-status='constant'] {\\n  background: #3b82f6;\\n}\\n\\n.entry-status-dot[data-status='vector'] {\\n  background: #a855f7;\\n}\\n\\n.entry-status-dot[data-status='normal'] {\\n  background: #22c55e;\\n}\\n\\n.entry-status-dot[data-status='disabled'] {\\n  background: #6b7280;\\n}\\n\\n.entry-item-title {\\n  font-weight: 700;\\n  flex: 1;\\n  min-width: 0;\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n}\\n\\n.entry-item-tags {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n}\\n\\n.entry-chip {\\n  display: inline-flex;\\n  align-items: center;\\n  gap: 4px;\\n  border: 1px solid #334155;\\n  border-radius: 999px;\\n  padding: 1px 8px;\\n  color: #cbd5e1;\\n  font-size: 11px;\\n  background: rgba(15, 23, 42, 0.55);\\n}\\n\\n.entry-chip.uid {\\n  color: #93c5fd;\\n  font-size: 10px;\\n  padding: 1px 7px;\\n}\\n\\n.entry-chip.mono {\\n  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;\\n  font-size: 10px;\\n}\\n\\n.entry-chip.status[data-status='constant'] {\\n  border-color: rgba(59, 130, 246, 0.65);\\n  color: #93c5fd;\\n  background: rgba(59, 130, 246, 0.16);\\n}\\n\\n.entry-chip.status[data-status='vector'] {\\n  border-color: rgba(168, 85, 247, 0.65);\\n  color: #d8b4fe;\\n  background: rgba(168, 85, 247, 0.16);\\n}\\n\\n.entry-chip.status[data-status='normal'] {\\n  border-color: rgba(34, 197, 94, 0.65);\\n  color: #86efac;\\n  background: rgba(34, 197, 94, 0.16);\\n}\\n\\n.entry-chip.status[data-status='disabled'] {\\n  border-color: rgba(107, 114, 128, 0.7);\\n  color: #cbd5e1;\\n  background: rgba(100, 116, 139, 0.15);\\n}\\n\\n.entry-item-preview {\\n  color: #94a3b8;\\n  font-size: 11px;\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n  padding-left: 16px;\\n  opacity: 0.85;\\n}\\n\\n.entry-item-preview::before {\\n  content: 'Keys: ';\\n  color: #64748b;\\n  margin-right: 4px;\\n}\\n\\n.wb-editor {\\n  max-height: 70vh;\\n  overflow: hidden;\\n}\\n\\n.wb-editor-shell {\\n  height: 100%;\\n  min-height: 0;\\n  display: grid;\\n  grid-template-columns: minmax(0, 1fr) 10px 360px;\\n  gap: 0;\\n}\\n\\n.wb-resize-handle {\\n  position: relative;\\n  width: 10px;\\n  cursor: col-resize;\\n  user-select: none;\\n  touch-action: none;\\n}\\n\\n.wb-resize-handle::before {\\n  content: '';\\n  position: absolute;\\n  left: 4px;\\n  top: 12px;\\n  bottom: 12px;\\n  width: 2px;\\n  border-radius: 999px;\\n  background: rgba(100, 116, 139, 0.5);\\n  transition: background-color 0.15s ease;\\n}\\n\\n.wb-resize-handle:hover::before,\\n.wb-resize-handle.dragging::before {\\n  background: rgba(56, 189, 248, 0.95);\\n}\\n\\n.editor-center {\\n  border: 1px solid #1e293b;\\n  border-radius: 10px;\\n  background: rgba(2, 6, 23, 0.7);\\n  padding: 10px;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 10px;\\n  min-height: 0;\\n  overflow: auto;\\n}\\n\\n.editor-head {\\n  display: flex;\\n  justify-content: space-between;\\n  gap: 10px;\\n  align-items: flex-end;\\n  border-bottom: 1px solid #1e293b;\\n  padding-bottom: 8px;\\n}\\n\\n.editor-comment {\\n  flex: 1;\\n}\\n\\n.editor-badges {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n  justify-content: flex-end;\\n}\\n\\n.editor-badge {\\n  font-size: 10px;\\n  border: 1px solid #334155;\\n  border-radius: 999px;\\n  padding: 2px 8px;\\n  color: #94a3b8;\\n  background: rgba(15, 23, 42, 0.72);\\n  white-space: nowrap;\\n}\\n\\n.editor-badge.mono {\\n  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;\\n}\\n\\n.editor-badge.on {\\n  border-color: rgba(34, 197, 94, 0.65);\\n  color: #86efac;\\n}\\n\\n.editor-badge.off {\\n  border-color: rgba(107, 114, 128, 0.75);\\n  color: #cbd5e1;\\n}\\n\\n.editor-badge.strategy[data-status='constant'] {\\n  border-color: rgba(59, 130, 246, 0.65);\\n  color: #93c5fd;\\n}\\n\\n.editor-badge.strategy[data-status='vector'] {\\n  border-color: rgba(168, 85, 247, 0.65);\\n  color: #d8b4fe;\\n}\\n\\n.editor-badge.strategy[data-status='normal'] {\\n  border-color: rgba(34, 197, 94, 0.65);\\n  color: #86efac;\\n}\\n\\n.editor-badge.strategy[data-status='disabled'] {\\n  border-color: rgba(107, 114, 128, 0.75);\\n  color: #cbd5e1;\\n}\\n\\n.editor-keyword-grid .text-area.compact {\\n  min-height: 36px;\\n  height: 36px;\\n  line-height: 1.35;\\n}\\n\\n.editor-content-block {\\n  min-height: 0;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 6px;\\n  flex: 1;\\n}\\n\\n.editor-content-title {\\n  font-size: 12px;\\n  color: #93c5fd;\\n  letter-spacing: 0.01em;\\n}\\n\\n.editor-content-area {\\n  min-height: 320px;\\n  flex: 1;\\n  resize: none;\\n  line-height: 1.5;\\n}\\n\\n.editor-advanced {\\n  border: 1px solid #334155;\\n  border-radius: 8px;\\n  padding: 7px;\\n  background: rgba(15, 23, 42, 0.4);\\n}\\n\\n.editor-advanced > summary {\\n  cursor: pointer;\\n  font-size: 12px;\\n  color: #cbd5e1;\\n}\\n\\n.editor-advanced[open] > summary {\\n  margin-bottom: 7px;\\n}\\n\\n.editor-side {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 8px;\\n  min-height: 0;\\n  overflow: auto;\\n}\\n\\n.editor-card {\\n  border: 1px solid #334155;\\n  border-radius: 10px;\\n  padding: 8px;\\n  background: rgba(15, 23, 42, 0.7);\\n  display: grid;\\n  gap: 7px;\\n}\\n\\n.editor-card h4 {\\n  margin: 0;\\n  font-size: 12px;\\n  color: #f59e0b;\\n}\\n\\n.strategy-switch {\\n  display: grid;\\n  gap: 6px;\\n}\\n\\n.strategy-pill {\\n  border: 1px solid #334155;\\n  border-radius: 8px;\\n  background: rgba(15, 23, 42, 0.7);\\n  color: #cbd5e1;\\n  padding: 6px 8px;\\n  font-size: 12px;\\n  cursor: pointer;\\n  text-align: left;\\n}\\n\\n.strategy-pill:hover {\\n  border-color: #475569;\\n}\\n\\n.strategy-pill.active.constant {\\n  border-color: rgba(59, 130, 246, 0.8);\\n  background: rgba(59, 130, 246, 0.16);\\n  color: #93c5fd;\\n}\\n\\n.strategy-pill.active.vector {\\n  border-color: rgba(168, 85, 247, 0.8);\\n  background: rgba(168, 85, 247, 0.16);\\n  color: #d8b4fe;\\n}\\n\\n.strategy-pill.active.selective {\\n  border-color: rgba(34, 197, 94, 0.8);\\n  background: rgba(34, 197, 94, 0.16);\\n  color: #86efac;\\n}\\n\\n.editor-grid {\\n  display: grid;\\n  gap: 8px;\\n}\\n\\n.editor-grid.two-cols {\\n  grid-template-columns: 1fr 1fr;\\n}\\n\\n.editor-grid.three-cols {\\n  grid-template-columns: repeat(3, minmax(0, 1fr));\\n}\\n\\n.field {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 4px;\\n}\\n\\n.field > span {\\n  color: #93c5fd;\\n}\\n\\n.field.disabled {\\n  opacity: 0.56;\\n}\\n\\n.field-end {\\n  align-self: end;\\n}\\n\\n.field-actions {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n}\\n\\n.text-input,\\n.text-area,\\n.toolbar-select {\\n  width: 100%;\\n  box-sizing: border-box;\\n  border: 1px solid #334155;\\n  border-radius: 7px;\\n  padding: 6px 8px;\\n  color: #f8fafc;\\n  background: #0f172a;\\n}\\n\\n.text-area {\\n  min-height: 96px;\\n  resize: vertical;\\n}\\n\\n.text-area.compact {\\n  min-height: 84px;\\n}\\n\\n.text-area.large {\\n  min-height: 190px;\\n}\\n\\n.checkbox-inline {\\n  display: inline-flex;\\n  align-items: center;\\n  gap: 6px;\\n}\\n\\n.wb-tools-grid {\\n  display: grid;\\n  gap: 8px;\\n  grid-template-columns: repeat(2, minmax(0, 1fr));\\n}\\n\\n.tool-card {\\n  border: 1px solid #334155;\\n  border-radius: 10px;\\n  padding: 8px;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 8px;\\n  min-height: 170px;\\n  background: rgba(15, 23, 42, 0.45);\\n}\\n\\n.tool-card h4 {\\n  margin: 0;\\n  font-size: 13px;\\n  color: #93c5fd;\\n}\\n\\n.tool-line.stacked {\\n  display: grid;\\n  gap: 6px;\\n}\\n\\n.find-flags {\\n  display: flex;\\n  flex-wrap: wrap;\\n  gap: 8px;\\n}\\n\\n.batch-exclude-note {\\n  color: #94a3b8;\\n  font-size: 11px;\\n}\\n\\n.batch-exclude-chips {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n}\\n\\n.exclude-chip {\\n  border: 1px solid #475569;\\n  border-radius: 999px;\\n  padding: 1px 8px;\\n  font-size: 11px;\\n  color: #cbd5e1;\\n  background: rgba(15, 23, 42, 0.6);\\n}\\n\\n.tool-details {\\n  border: 1px solid #334155;\\n  border-radius: 8px;\\n  padding: 6px;\\n  background: rgba(15, 23, 42, 0.35);\\n}\\n\\n.tool-details > summary {\\n  cursor: pointer;\\n  color: #cbd5e1;\\n  font-size: 12px;\\n}\\n\\n.tool-details[open] > summary {\\n  margin-bottom: 6px;\\n}\\n\\n.history-compare {\\n  display: grid;\\n  gap: 6px;\\n}\\n\\n.history-preview-grid {\\n  display: grid;\\n  grid-template-columns: repeat(2, minmax(0, 1fr));\\n  gap: 6px;\\n}\\n\\n.history-preview-card {\\n  border: 1px solid #334155;\\n  border-radius: 8px;\\n  padding: 6px;\\n  display: grid;\\n  gap: 3px;\\n  background: rgba(2, 6, 23, 0.48);\\n}\\n\\n.history-preview-card strong {\\n  color: #93c5fd;\\n  font-size: 11px;\\n}\\n\\n.history-preview-card span {\\n  color: #94a3b8;\\n  font-size: 11px;\\n  line-height: 1.35;\\n}\\n\\n.history-note {\\n  border: 1px dashed #334155;\\n  border-radius: 8px;\\n  padding: 6px;\\n  color: #94a3b8;\\n  font-size: 11px;\\n  background: rgba(15, 23, 42, 0.32);\\n}\\n\\n.tool-scroll {\\n  overflow: auto;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 6px;\\n}\\n\\n.tool-list-item {\\n  border: 1px solid #334155;\\n  border-radius: 8px;\\n  padding: 6px;\\n  display: flex;\\n  justify-content: space-between;\\n  gap: 8px;\\n  align-items: center;\\n}\\n\\n.item-main {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 2px;\\n  min-width: 0;\\n}\\n\\n.item-main strong,\\n.activation-main strong {\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n}\\n\\n.item-main span {\\n  color: #94a3b8;\\n  font-size: 12px;\\n}\\n\\n.item-actions {\\n  display: flex;\\n  gap: 6px;\\n}\\n\\n.activation-item {\\n  border: 1px solid #334155;\\n  border-radius: 8px;\\n  padding: 6px;\\n  display: grid;\\n  gap: 3px;\\n}\\n\\n.activation-main,\\n.activation-sub {\\n  display: flex;\\n  justify-content: space-between;\\n  gap: 6px;\\n}\\n\\n.activation-main span,\\n.activation-sub {\\n  color: #94a3b8;\\n  font-size: 12px;\\n}\\n\\n.activation-sub span:last-child {\\n  flex: 1;\\n  text-align: right;\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n}\\n\\n.wb-floating-window {\\n  position: fixed;\\n  max-width: calc(100vw - 16px);\\n  max-height: min(74vh, 760px);\\n  border: 1px solid #334155;\\n  border-radius: 10px;\\n  background: linear-gradient(155deg, rgba(2, 6, 23, 0.95), rgba(15, 23, 42, 0.95));\\n  box-shadow: 0 14px 36px rgba(2, 6, 23, 0.7);\\n  display: flex;\\n  flex-direction: column;\\n  overflow: hidden;\\n}\\n\\n.wb-floating-header {\\n  display: flex;\\n  justify-content: space-between;\\n  gap: 8px;\\n  align-items: center;\\n  padding: 8px 10px;\\n  border-bottom: 1px solid #334155;\\n  background: rgba(15, 23, 42, 0.9);\\n  cursor: move;\\n  user-select: none;\\n  touch-action: none;\\n}\\n\\n.wb-floating-header strong {\\n  font-size: 12px;\\n  color: #cbd5e1;\\n}\\n\\n.wb-floating-header-actions {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n}\\n\\n.wb-floating-body {\\n  min-height: 0;\\n  padding: 8px;\\n  display: grid;\\n  gap: 8px;\\n  overflow: auto;\\n}\\n\\n.find-window .wb-floating-body {\\n  gap: 10px;\\n}\\n\\n.clipboard-window .tool-scroll,\\n.activation-window .tool-scroll {\\n  max-height: min(58vh, 520px);\\n}\\n\\n.wb-status {\\n  border: 1px solid #334155;\\n  border-radius: 10px;\\n  background: rgba(15, 23, 42, 0.52);\\n  padding: 8px;\\n  display: flex;\\n  justify-content: space-between;\\n  gap: 8px;\\n  color: #cbd5e1;\\n  flex-wrap: wrap;\\n}\\n\\n.btn {\\n  border: 1px solid #475569;\\n  background: #1e293b;\\n  color: #f8fafc;\\n  border-radius: 7px;\\n  padding: 5px 10px;\\n  cursor: pointer;\\n}\\n\\n.btn:hover:not(:disabled) {\\n  border-color: #38bdf8;\\n}\\n\\n.btn:disabled {\\n  opacity: 0.5;\\n  cursor: default;\\n}\\n\\n.btn.primary {\\n  background: #0c4a6e;\\n  border-color: #0284c7;\\n}\\n\\n.btn.danger {\\n  background: #4c0519;\\n  border-color: #e11d48;\\n}\\n\\n.btn.mini {\\n  padding: 4px 8px;\\n  font-size: 12px;\\n}\\n\\n.empty-note,\\n.empty-block {\\n  color: #94a3b8;\\n  font-size: 12px;\\n}\\n\\n.empty-block {\\n  padding: 14px;\\n  border: 1px dashed #475569;\\n  border-radius: 8px;\\n}\\n\\n.hidden-input {\\n  display: none;\\n}\\n\\n.wb-modal-backdrop {\\n  position: fixed;\\n  inset: 0;\\n  background: rgba(2, 6, 23, 0.72);\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  z-index: 10020;\\n  padding: 14px;\\n}\\n\\n.wb-history-modal {\\n  width: min(1260px, 100%);\\n  height: min(88vh, 940px);\\n  border: 1px solid #334155;\\n  border-radius: 12px;\\n  background: linear-gradient(155deg, #0b1325, #020617);\\n  box-shadow: 0 20px 48px rgba(0, 0, 0, 0.55);\\n  display: flex;\\n  flex-direction: column;\\n  overflow: hidden;\\n}\\n\\n.wb-history-modal-header {\\n  display: flex;\\n  justify-content: space-between;\\n  gap: 8px;\\n  align-items: center;\\n  padding: 10px 12px;\\n  border-bottom: 1px solid #334155;\\n  background: rgba(15, 23, 42, 0.85);\\n}\\n\\n.wb-history-modal-header strong {\\n  display: block;\\n  font-size: 14px;\\n}\\n\\n.wb-history-modal-header span {\\n  color: #94a3b8;\\n  font-size: 11px;\\n}\\n\\n.wb-history-modal-actions {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n}\\n\\n.wb-history-modal-main {\\n  min-height: 0;\\n  flex: 1;\\n  display: grid;\\n  grid-template-columns: 300px 1fr;\\n  overflow: hidden;\\n}\\n\\n.wb-history-versions {\\n  border-right: 1px solid #334155;\\n  background: rgba(15, 23, 42, 0.8);\\n  display: flex;\\n  flex-direction: column;\\n  min-height: 0;\\n}\\n\\n.wb-history-versions-title {\\n  padding: 8px 10px;\\n  font-size: 11px;\\n  color: #94a3b8;\\n  border-bottom: 1px solid #334155;\\n}\\n\\n.wb-history-versions-scroll {\\n  flex: 1;\\n  min-height: 0;\\n  overflow: auto;\\n  padding: 8px;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 7px;\\n}\\n\\n.wb-history-version-item {\\n  border: 1px solid #334155;\\n  border-radius: 8px;\\n  padding: 6px;\\n  display: grid;\\n  gap: 4px;\\n  background: rgba(15, 23, 42, 0.56);\\n}\\n\\n.wb-history-version-line {\\n  display: flex;\\n  justify-content: space-between;\\n  gap: 6px;\\n  align-items: center;\\n}\\n\\n.wb-history-version-line strong {\\n  font-size: 11px;\\n  color: #cbd5e1;\\n}\\n\\n.wb-history-version-item span {\\n  font-size: 11px;\\n  color: #94a3b8;\\n  word-break: break-all;\\n}\\n\\n.wb-history-lr {\\n  display: inline-flex;\\n  gap: 4px;\\n}\\n\\n.mini-lr {\\n  border: 1px solid #475569;\\n  background: #0f172a;\\n  color: #94a3b8;\\n  border-radius: 6px;\\n  min-width: 24px;\\n  font-size: 10px;\\n  cursor: pointer;\\n}\\n\\n.mini-lr.active {\\n  border-color: #22d3ee;\\n  color: #67e8f9;\\n}\\n\\n.wb-history-diff-wrap {\\n  min-height: 0;\\n  display: flex;\\n  flex-direction: column;\\n}\\n\\n.wb-history-diff-head {\\n  border-bottom: 1px solid #334155;\\n  background: rgba(15, 23, 42, 0.58);\\n  padding: 8px 10px;\\n  display: flex;\\n  justify-content: space-between;\\n  gap: 8px;\\n  align-items: center;\\n  font-size: 11px;\\n  color: #94a3b8;\\n}\\n\\n.wb-history-diff-grid {\\n  min-height: 0;\\n  flex: 1;\\n  display: grid;\\n  grid-template-columns: 1fr 1fr;\\n}\\n\\n.wb-history-diff-grid > div {\\n  min-height: 0;\\n  display: flex;\\n  flex-direction: column;\\n}\\n\\n.wb-history-diff-grid > div + div {\\n  border-left: 1px solid #334155;\\n}\\n\\n.wb-history-diff-title {\\n  padding: 8px 10px;\\n  border-bottom: 1px solid #334155;\\n  font-size: 11px;\\n  color: #93c5fd;\\n}\\n\\n.wb-history-diff-body {\\n  min-height: 0;\\n  flex: 1;\\n  overflow: auto;\\n  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;\\n  font-size: 11px;\\n  background: rgba(2, 6, 23, 0.9);\\n}\\n\\n.diff-row {\\n  display: grid;\\n  grid-template-columns: 54px 1fr;\\n  align-items: start;\\n  border-bottom: 1px solid rgba(51, 65, 85, 0.25);\\n}\\n\\n.line-no {\\n  color: #64748b;\\n  padding: 2px 8px;\\n  border-right: 1px solid rgba(51, 65, 85, 0.35);\\n  user-select: none;\\n}\\n\\n.line-text {\\n  white-space: pre-wrap;\\n  word-break: break-word;\\n  padding: 2px 8px;\\n  color: #cbd5e1;\\n}\\n\\n.diff-row.add {\\n  background: rgba(34, 197, 94, 0.18);\\n}\\n\\n.diff-row.del {\\n  background: rgba(239, 68, 68, 0.18);\\n}\\n\\n.diff-row.empty {\\n  background: rgba(100, 116, 139, 0.08);\\n}\\n\\n@media (max-width: 1380px) {\\n  .wb-editor-shell {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .editor-side {\\n    overflow: visible;\\n    max-height: none;\\n  }\\n\\n  .wb-history-modal-main {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .wb-history-versions {\\n    border-right: none;\\n    border-bottom: 1px solid #334155;\\n    max-height: 240px;\\n  }\\n}\\n\\n@media (max-width: 1100px) {\\n  .global-mode-grid {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .wb-resize-handle {\\n    display: none;\\n  }\\n\\n  .wb-main-layout {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .wb-tools-grid {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .editor-grid.two-cols,\\n  .editor-grid.three-cols {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .editor-head {\\n    flex-direction: column;\\n    align-items: stretch;\\n  }\\n\\n  .editor-badges {\\n    justify-content: flex-start;\\n  }\\n\\n  .history-preview-grid {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .wb-history-diff-grid {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .wb-history-diff-grid > div + div {\\n    border-left: none;\\n    border-top: 1px solid #334155;\\n  }\\n\\n  .wb-status {\\n    flex-direction: column;\\n  }\\n\\n  .wb-floating-window {\\n    width: calc(100vw - 16px) !important;\\n    left: 8px !important;\\n    right: 8px;\\n  }\\n}\\n</style>\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../node_modules/.pnpm/css-loader@7.1.3_webpack@5.105.2/node_modules/css-loader/dist/cjs.js??clonedRuleSet-16.use[1]!../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_71d7740e7607e74f4d732110d38a3681/node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/.pnpm/postcss-loader@8.2.1_postcs_4a4b9398903558e15a2a4076ed121c2a/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_71d7740e7607e74f4d732110d38a3681/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./App.vue?vue&type=style&index=0&id=2f8c74d2&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"dc973c2c\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../node_modules/.pnpm/css-loader@7.1.3_webpack@5.105.2/node_modules/css-loader/dist/cjs.js??clonedRuleSet-16.use[1]!../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_71d7740e7607e74f4d732110d38a3681/node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/.pnpm/postcss-loader@8.2.1_postcs_4a4b9398903558e15a2a4076ed121c2a/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_71d7740e7607e74f4d732110d38a3681/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./App.vue?vue&type=style&index=0&id=2f8c74d2&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../node_modules/.pnpm/css-loader@7.1.3_webpack@5.105.2/node_modules/css-loader/dist/cjs.js??clonedRuleSet-16.use[1]!../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_71d7740e7607e74f4d732110d38a3681/node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/.pnpm/postcss-loader@8.2.1_postcs_4a4b9398903558e15a2a4076ed121c2a/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_71d7740e7607e74f4d732110d38a3681/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./App.vue?vue&type=style&index=0&id=2f8c74d2&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","/**\n * Translates the list format produced by css-loader into something\n * easier to manipulate.\n */\nexport default function listToStyles (parentId, list) {\n  var styles = []\n  var newStyles = {}\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i]\n    var id = item[0]\n    var css = item[1]\n    var media = item[2]\n    var sourceMap = item[3]\n    var part = {\n      id: parentId + ':' + i,\n      css: css,\n      media: media,\n      sourceMap: sourceMap\n    }\n    if (!newStyles[id]) {\n      styles.push(newStyles[id] = { id: id, parts: [part] })\n    } else {\n      newStyles[id].parts.push(part)\n    }\n  }\n  return styles\n}\n","/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n  Modified by Evan You @yyx990803\n*/\n\nimport listToStyles from './listToStyles'\n\nvar hasDocument = typeof document !== 'undefined'\n\nif (typeof DEBUG !== 'undefined' && DEBUG) {\n  if (!hasDocument) {\n    throw new Error(\n    'vue-style-loader cannot be used in a non-browser environment. ' +\n    \"Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.\"\n  ) }\n}\n\n/*\ntype StyleObject = {\n  id: number;\n  parts: Array<StyleObjectPart>\n}\n\ntype StyleObjectPart = {\n  css: string;\n  media: string;\n  sourceMap: ?string\n}\n*/\n\nvar stylesInDom = {/*\n  [id: number]: {\n    id: number,\n    refs: number,\n    parts: Array<(obj?: StyleObjectPart) => void>\n  }\n*/}\n\nvar head = hasDocument && (document.head || document.getElementsByTagName('head')[0])\nvar singletonElement = null\nvar singletonCounter = 0\nvar isProduction = false\nvar noop = function () {}\nvar options = null\nvar ssrIdKey = 'data-vue-ssr-id'\n\n// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n// tags it will allow on a page\nvar isOldIE = typeof navigator !== 'undefined' && /msie [6-9]\\b/.test(navigator.userAgent.toLowerCase())\n\nexport default function addStylesClient (parentId, list, _isProduction, _options) {\n  isProduction = _isProduction\n\n  options = _options || {}\n\n  var styles = listToStyles(parentId, list)\n  addStylesToDom(styles)\n\n  return function update (newList) {\n    var mayRemove = []\n    for (var i = 0; i < styles.length; i++) {\n      var item = styles[i]\n      var domStyle = stylesInDom[item.id]\n      domStyle.refs--\n      mayRemove.push(domStyle)\n    }\n    if (newList) {\n      styles = listToStyles(parentId, newList)\n      addStylesToDom(styles)\n    } else {\n      styles = []\n    }\n    for (var i = 0; i < mayRemove.length; i++) {\n      var domStyle = mayRemove[i]\n      if (domStyle.refs === 0) {\n        for (var j = 0; j < domStyle.parts.length; j++) {\n          domStyle.parts[j]()\n        }\n        delete stylesInDom[domStyle.id]\n      }\n    }\n  }\n}\n\nfunction addStylesToDom (styles /* Array<StyleObject> */) {\n  for (var i = 0; i < styles.length; i++) {\n    var item = styles[i]\n    var domStyle = stylesInDom[item.id]\n    if (domStyle) {\n      domStyle.refs++\n      for (var j = 0; j < domStyle.parts.length; j++) {\n        domStyle.parts[j](item.parts[j])\n      }\n      for (; j < item.parts.length; j++) {\n        domStyle.parts.push(addStyle(item.parts[j]))\n      }\n      if (domStyle.parts.length > item.parts.length) {\n        domStyle.parts.length = item.parts.length\n      }\n    } else {\n      var parts = []\n      for (var j = 0; j < item.parts.length; j++) {\n        parts.push(addStyle(item.parts[j]))\n      }\n      stylesInDom[item.id] = { id: item.id, refs: 1, parts: parts }\n    }\n  }\n}\n\nfunction createStyleElement () {\n  var styleElement = document.createElement('style')\n  styleElement.type = 'text/css'\n  head.appendChild(styleElement)\n  return styleElement\n}\n\nfunction addStyle (obj /* StyleObjectPart */) {\n  var update, remove\n  var styleElement = document.querySelector('style[' + ssrIdKey + '~=\"' + obj.id + '\"]')\n\n  if (styleElement) {\n    if (isProduction) {\n      // has SSR styles and in production mode.\n      // simply do nothing.\n      return noop\n    } else {\n      // has SSR styles but in dev mode.\n      // for some reason Chrome can't handle source map in server-rendered\n      // style tags - source maps in <style> only works if the style tag is\n      // created and inserted dynamically. So we remove the server rendered\n      // styles and inject new ones.\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  if (isOldIE) {\n    // use singleton mode for IE9.\n    var styleIndex = singletonCounter++\n    styleElement = singletonElement || (singletonElement = createStyleElement())\n    update = applyToSingletonTag.bind(null, styleElement, styleIndex, false)\n    remove = applyToSingletonTag.bind(null, styleElement, styleIndex, true)\n  } else {\n    // use multi-style-tag mode in all other cases\n    styleElement = createStyleElement()\n    update = applyToTag.bind(null, styleElement)\n    remove = function () {\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  update(obj)\n\n  return function updateStyle (newObj /* StyleObjectPart */) {\n    if (newObj) {\n      if (newObj.css === obj.css &&\n          newObj.media === obj.media &&\n          newObj.sourceMap === obj.sourceMap) {\n        return\n      }\n      update(obj = newObj)\n    } else {\n      remove()\n    }\n  }\n}\n\nvar replaceText = (function () {\n  var textStore = []\n\n  return function (index, replacement) {\n    textStore[index] = replacement\n    return textStore.filter(Boolean).join('\\n')\n  }\n})()\n\nfunction applyToSingletonTag (styleElement, index, remove, obj) {\n  var css = remove ? '' : obj.css\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = replaceText(index, css)\n  } else {\n    var cssNode = document.createTextNode(css)\n    var childNodes = styleElement.childNodes\n    if (childNodes[index]) styleElement.removeChild(childNodes[index])\n    if (childNodes.length) {\n      styleElement.insertBefore(cssNode, childNodes[index])\n    } else {\n      styleElement.appendChild(cssNode)\n    }\n  }\n}\n\nfunction applyToTag (styleElement, obj) {\n  var css = obj.css\n  var media = obj.media\n  var sourceMap = obj.sourceMap\n\n  if (media) {\n    styleElement.setAttribute('media', media)\n  }\n  if (options.ssrId) {\n    styleElement.setAttribute(ssrIdKey, obj.id)\n  }\n\n  if (sourceMap) {\n    // https://developer.chrome.com/devtools/docs/javascript-debugging\n    // this makes source maps inside style tags work properly in Chrome\n    css += '\\n/*# sourceURL=' + sourceMap.sources[0] + ' */'\n    // http://stackoverflow.com/a/26603875\n    css += '\\n/*# sourceMappingURL=data:application/json;base64,' + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + ' */'\n  }\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild)\n    }\n    styleElement.appendChild(document.createTextNode(css))\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, isRef as _isRef, vModelSelect as _vModelSelect, createElementVNode as _createElementVNode, withDirectives as _withDirectives, createTextVNode as _createTextVNode, normalizeClass as _normalizeClass, vModelText as _vModelText, withModifiers as _withModifiers, withKeys as _withKeys, createCommentVNode as _createCommentVNode, vModelCheckbox as _vModelCheckbox, normalizeStyle as _normalizeStyle } from \"vue\";\nconst _hoisted_1 = { class: \"wb-assistant-root\" };\nconst _hoisted_2 = { class: \"wb-toolbar\" };\nconst _hoisted_3 = { class: \"toolbar-label\" };\nconst _hoisted_4 = [\"value\"];\nconst _hoisted_5 = [\"disabled\"];\nconst _hoisted_6 = [\"disabled\"];\nconst _hoisted_7 = [\"disabled\"];\nconst _hoisted_8 = { class: \"wb-bindings\" };\nconst _hoisted_9 = { class: \"wb-history-shortcuts\" };\nconst _hoisted_10 = [\"disabled\"];\nconst _hoisted_11 = [\"disabled\"];\nconst _hoisted_12 = [\"disabled\"];\nconst _hoisted_13 = {\n    key: 0,\n    class: \"global-mode-panel\"\n};\nconst _hoisted_14 = { class: \"global-mode-head\" };\nconst _hoisted_15 = { class: \"global-mode-title\" };\nconst _hoisted_16 = [\"disabled\"];\nconst _hoisted_17 = { class: \"global-mode-grid\" };\nconst _hoisted_18 = { class: \"global-mode-column\" };\nconst _hoisted_19 = { class: \"field\" };\nconst _hoisted_20 = [\"onKeydown\"];\nconst _hoisted_21 = { class: \"global-mode-list\" };\nconst _hoisted_22 = [\"onClick\"];\nconst _hoisted_23 = { class: \"global-mode-item-name\" };\nconst _hoisted_24 = {\n    key: 0,\n    class: \"empty-note\"\n};\nconst _hoisted_25 = { class: \"global-mode-column\" };\nconst _hoisted_26 = { class: \"field\" };\nconst _hoisted_27 = { class: \"global-mode-list\" };\nconst _hoisted_28 = [\"onClick\"];\nconst _hoisted_29 = { class: \"global-mode-item-name\" };\nconst _hoisted_30 = {\n    key: 0,\n    class: \"empty-note\"\n};\nconst _hoisted_31 = { class: \"global-mode-actions\" };\nconst _hoisted_32 = [\"disabled\"];\nconst _hoisted_33 = { class: \"wb-entry-list\" };\nconst _hoisted_34 = { class: \"list-search\" };\nconst _hoisted_35 = { class: \"checkbox-inline\" };\nconst _hoisted_36 = { class: \"list-summary\" };\nconst _hoisted_37 = { class: \"list-scroll\" };\nconst _hoisted_38 = [\"data-status\", \"onClick\"];\nconst _hoisted_39 = { class: \"entry-item-head\" };\nconst _hoisted_40 = [\"data-status\"];\nconst _hoisted_41 = { class: \"entry-item-title\" };\nconst _hoisted_42 = { class: \"entry-chip uid\" };\nconst _hoisted_43 = { class: \"entry-item-tags\" };\nconst _hoisted_44 = [\"data-status\"];\nconst _hoisted_45 = { class: \"entry-chip\" };\nconst _hoisted_46 = { class: \"entry-chip\" };\nconst _hoisted_47 = { class: \"entry-chip mono\" };\nconst _hoisted_48 = { class: \"entry-item-preview\" };\nconst _hoisted_49 = { class: \"list-actions\" };\nconst _hoisted_50 = [\"disabled\"];\nconst _hoisted_51 = [\"disabled\"];\nconst _hoisted_52 = [\"disabled\"];\nconst _hoisted_53 = [\"disabled\"];\nconst _hoisted_54 = [\"disabled\"];\nconst _hoisted_55 = { class: \"wb-editor\" };\nconst _hoisted_56 = { class: \"editor-center\" };\nconst _hoisted_57 = { class: \"editor-head\" };\nconst _hoisted_58 = { class: \"field editor-comment\" };\nconst _hoisted_59 = { class: \"editor-badges\" };\nconst _hoisted_60 = [\"data-status\"];\nconst _hoisted_61 = { class: \"editor-badge mono\" };\nconst _hoisted_62 = { class: \"editor-badge mono\" };\nconst _hoisted_63 = { class: \"editor-badge mono\" };\nconst _hoisted_64 = { class: \"editor-grid two-cols editor-keyword-grid\" };\nconst _hoisted_65 = { class: \"field\" };\nconst _hoisted_66 = { class: \"field\" };\nconst _hoisted_67 = { class: \"editor-content-block\" };\nconst _hoisted_68 = { class: \"editor-advanced\" };\nconst _hoisted_69 = { class: \"field\" };\nconst _hoisted_70 = { class: \"editor-side\" };\nconst _hoisted_71 = { class: \"editor-card\" };\nconst _hoisted_72 = { class: \"field checkbox-inline\" };\nconst _hoisted_73 = { class: \"strategy-switch\" };\nconst _hoisted_74 = { class: \"editor-advanced\" };\nconst _hoisted_75 = { class: \"field\" };\nconst _hoisted_76 = [\"value\"];\nconst _hoisted_77 = { class: \"field\" };\nconst _hoisted_78 = { class: \"field\" };\nconst _hoisted_79 = { class: \"editor-card\" };\nconst _hoisted_80 = { class: \"field\" };\nconst _hoisted_81 = [\"value\"];\nconst _hoisted_82 = { class: \"field\" };\nconst _hoisted_83 = { class: \"editor-grid two-cols\" };\nconst _hoisted_84 = [\"disabled\"];\nconst _hoisted_85 = [\"disabled\"];\nconst _hoisted_86 = { class: \"editor-card\" };\nconst _hoisted_87 = { class: \"field checkbox-inline\" };\nconst _hoisted_88 = { class: \"field checkbox-inline\" };\nconst _hoisted_89 = { class: \"field\" };\nconst _hoisted_90 = { class: \"editor-grid two-cols\" };\nconst _hoisted_91 = { class: \"field\" };\nconst _hoisted_92 = { class: \"field\" };\nconst _hoisted_93 = { class: \"field\" };\nconst _hoisted_94 = {\n    key: 1,\n    class: \"empty-block\"\n};\nconst _hoisted_95 = { class: \"wb-status\" };\nconst _hoisted_96 = { class: \"wb-history-modal\" };\nconst _hoisted_97 = { class: \"wb-history-modal-header\" };\nconst _hoisted_98 = { class: \"wb-history-modal-actions\" };\nconst _hoisted_99 = [\"disabled\"];\nconst _hoisted_100 = [\"disabled\"];\nconst _hoisted_101 = { class: \"wb-history-modal-main\" };\nconst _hoisted_102 = { class: \"wb-history-versions\" };\nconst _hoisted_103 = { class: \"wb-history-versions-scroll\" };\nconst _hoisted_104 = { class: \"wb-history-version-line\" };\nconst _hoisted_105 = { class: \"wb-history-lr\" };\nconst _hoisted_106 = [\"onClick\"];\nconst _hoisted_107 = [\"onClick\"];\nconst _hoisted_108 = {\n    key: 0,\n    class: \"empty-note\"\n};\nconst _hoisted_109 = { class: \"wb-history-diff-wrap\" };\nconst _hoisted_110 = { class: \"wb-history-diff-head\" };\nconst _hoisted_111 = [\"disabled\"];\nconst _hoisted_112 = { class: \"wb-history-diff-grid\" };\nconst _hoisted_113 = [\"innerHTML\"];\nconst _hoisted_114 = [\"innerHTML\"];\nconst _hoisted_115 = { class: \"wb-history-modal\" };\nconst _hoisted_116 = { class: \"wb-history-modal-header\" };\nconst _hoisted_117 = { class: \"wb-history-modal-actions\" };\nconst _hoisted_118 = [\"disabled\"];\nconst _hoisted_119 = [\"disabled\"];\nconst _hoisted_120 = { class: \"wb-history-modal-main\" };\nconst _hoisted_121 = { class: \"wb-history-versions\" };\nconst _hoisted_122 = { class: \"wb-history-versions-scroll\" };\nconst _hoisted_123 = { class: \"wb-history-version-line\" };\nconst _hoisted_124 = { class: \"wb-history-lr\" };\nconst _hoisted_125 = [\"onClick\"];\nconst _hoisted_126 = [\"onClick\"];\nconst _hoisted_127 = { class: \"wb-history-diff-wrap\" };\nconst _hoisted_128 = { class: \"wb-history-diff-head\" };\nconst _hoisted_129 = [\"disabled\"];\nconst _hoisted_130 = { class: \"wb-history-diff-grid\" };\nconst _hoisted_131 = [\"innerHTML\"];\nconst _hoisted_132 = [\"innerHTML\"];\nconst _hoisted_133 = { class: \"wb-floating-header-actions\" };\nconst _hoisted_134 = [\"disabled\"];\nconst _hoisted_135 = { class: \"wb-floating-body\" };\nconst _hoisted_136 = { class: \"tool-line stacked\" };\nconst _hoisted_137 = {\n    key: 0,\n    class: \"batch-exclude-chips\"\n};\nconst _hoisted_138 = { class: \"find-flags\" };\nconst _hoisted_139 = { class: \"checkbox-inline\" };\nconst _hoisted_140 = { class: \"checkbox-inline\" };\nconst _hoisted_141 = { class: \"checkbox-inline\" };\nconst _hoisted_142 = { class: \"checkbox-inline\" };\nconst _hoisted_143 = { class: \"tool-details\" };\nconst _hoisted_144 = { class: \"tool-line\" };\nconst _hoisted_145 = [\"disabled\"];\nconst _hoisted_146 = [\"disabled\"];\nconst _hoisted_147 = { class: \"tool-line\" };\nconst _hoisted_148 = [\"disabled\"];\nconst _hoisted_149 = [\"disabled\"];\nconst _hoisted_150 = { class: \"wb-floating-header-actions\" };\nconst _hoisted_151 = [\"disabled\"];\nconst _hoisted_152 = { class: \"wb-floating-body\" };\nconst _hoisted_153 = { class: \"tool-scroll\" };\nconst _hoisted_154 = { class: \"item-main\" };\nconst _hoisted_155 = { class: \"item-actions\" };\nconst _hoisted_156 = [\"disabled\", \"onClick\"];\nconst _hoisted_157 = [\"onClick\"];\nconst _hoisted_158 = {\n    key: 0,\n    class: \"empty-note\"\n};\nconst _hoisted_159 = { class: \"wb-floating-header-actions\" };\nconst _hoisted_160 = [\"disabled\"];\nconst _hoisted_161 = { class: \"wb-floating-body\" };\nconst _hoisted_162 = { class: \"tool-scroll\" };\nconst _hoisted_163 = { class: \"activation-main\" };\nconst _hoisted_164 = { class: \"activation-sub\" };\nconst _hoisted_165 = {\n    key: 0,\n    class: \"empty-note\"\n};\nimport { diffLines } from 'https://testingcf.jsdelivr.net/npm/diff/+esm';\nimport { klona } from 'klona';\n\nimport { ref, reactive, computed, watch, onMounted, onUnmounted } from 'vue';\nconst STORAGE_KEY = 'worldbook_assistant_state_v1';\nconst DIRTY_STATE_KEY = '__WB_ASSISTANT_HAS_UNSAVED_CHANGES__';\nconst HISTORY_LIMIT = 12;\nconst ENTRY_HISTORY_LIMIT = 7;\nconst CLIPBOARD_LIMIT = 40;\nconst ACTIVATION_LOG_LIMIT = 120;\nconst RESIZE_HANDLE_SIZE = 10;\nconst MAIN_PANE_MIN = 220;\nconst MAIN_EDITOR_MIN = 540;\nconst EDITOR_SIDE_MIN = 280;\nconst EDITOR_CENTER_MIN = 420;\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'App',\n    setup(__props) {\n        const strategyTypeOptions = ['constant', 'selective', 'vectorized'];\n        const secondaryLogicOptions = ['and_any', 'and_all', 'not_all', 'not_any'];\n        const positionTypeOptions = [\n            'before_character_definition',\n            'after_character_definition',\n            'before_example_messages',\n            'after_example_messages',\n            'before_author_note',\n            'after_author_note',\n            'at_depth',\n        ];\n        const worldbookNames = ref([]);\n        const selectedWorldbookName = ref('');\n        const globalWorldbookMode = ref(false);\n        const originalEntries = ref([]);\n        const draftEntries = ref([]);\n        const selectedEntryUid = ref(null);\n        const searchText = ref('');\n        const onlyEnabled = ref(false);\n        const importFileInput = ref(null);\n        const selectedExtraText = ref('');\n        const globalAddSearchText = ref('');\n        const globalFilterText = ref('');\n        const batchFindText = ref('');\n        const batchReplaceText = ref('');\n        const batchExcludeText = ref('');\n        const batchUseRegex = ref(false);\n        const batchInName = ref(true);\n        const batchInContent = ref(true);\n        const batchInKeys = ref(false);\n        const statusMessage = ref('');\n        const isBusy = ref(false);\n        const isSaving = ref(false);\n        const showEntryHistoryModal = ref(false);\n        const showWorldbookHistoryModal = ref(false);\n        const entryHistoryLeftId = ref('');\n        const entryHistoryRightId = ref('');\n        const worldbookHistoryLeftId = ref('');\n        const worldbookHistoryRightId = ref('');\n        const floatingZCounter = ref(10005);\n        const floatingPanels = reactive({\n            find: { visible: false, x: 420, y: 170, z: 10006, width: 500 },\n            clipboard: { visible: false, x: 700, y: 190, z: 10007, width: 430 },\n            activation: { visible: false, x: 760, y: 230, z: 10008, width: 480 },\n        });\n        const activeFloatingDrag = ref(null);\n        const floatingPanelKeys = ['find', 'clipboard', 'activation'];\n        const viewportWidth = ref(typeof window !== 'undefined' ? window.innerWidth : 1440);\n        const mainLayoutRef = ref(null);\n        const editorShellRef = ref(null);\n        const mainPaneWidth = ref(320);\n        const editorSideWidth = ref(360);\n        const paneResizeState = ref(null);\n        const hostResizeWindow = ref(null);\n        const bindings = reactive({\n            global: [],\n            charPrimary: null,\n            charAdditional: [],\n            chat: null,\n        });\n        const activationLogs = ref([]);\n        const persistedState = ref(createDefaultPersistedState());\n        const subscriptions = [];\n        const selectedEntry = computed(() => {\n            if (selectedEntryUid.value === null) {\n                return null;\n            }\n            return draftEntries.value.find(entry => entry.uid === selectedEntryUid.value) ?? null;\n        });\n        const selectedEntryIndex = computed(() => {\n            if (!selectedEntry.value) {\n                return -1;\n            }\n            return draftEntries.value.findIndex(entry => entry.uid === selectedEntry.value?.uid);\n        });\n        const filteredEntries = computed(() => {\n            const keyword = searchText.value.trim().toLowerCase();\n            return draftEntries.value.filter(entry => {\n                if (onlyEnabled.value && !entry.enabled) {\n                    return false;\n                }\n                if (!keyword) {\n                    return true;\n                }\n                const keysJoined = entry.strategy.keys.map(stringifyKeyword).join(' ').toLowerCase();\n                return (entry.name.toLowerCase().includes(keyword) ||\n                    entry.content.toLowerCase().includes(keyword) ||\n                    keysJoined.includes(keyword));\n            });\n        });\n        const enabledEntryCount = computed(() => draftEntries.value.filter(entry => entry.enabled).length);\n        const totalContentChars = computed(() => draftEntries.value.reduce((sum, entry) => {\n            return sum + entry.content.length;\n        }, 0));\n        const hasUnsavedChanges = computed(() => JSON.stringify(draftEntries.value) !== JSON.stringify(originalEntries.value));\n        const isCompactLayout = computed(() => viewportWidth.value <= 1100);\n        const mainLayoutStyle = computed(() => {\n            if (isCompactLayout.value) {\n                return undefined;\n            }\n            return {\n                gridTemplateColumns: `minmax(${MAIN_PANE_MIN}px, min(${mainPaneWidth.value}px, calc(100% - ${MAIN_EDITOR_MIN + RESIZE_HANDLE_SIZE}px))) ${RESIZE_HANDLE_SIZE}px minmax(0, 1fr)`,\n            };\n        });\n        const editorShellStyle = computed(() => {\n            if (isCompactLayout.value) {\n                return undefined;\n            }\n            return {\n                gridTemplateColumns: `minmax(0, 1fr) ${RESIZE_HANDLE_SIZE}px minmax(${EDITOR_SIDE_MIN}px, min(${editorSideWidth.value}px, calc(100% - ${EDITOR_CENTER_MIN + RESIZE_HANDLE_SIZE}px)))`,\n            };\n        });\n        const selectableWorldbookNames = computed(() => {\n            if (!globalWorldbookMode.value) {\n                return worldbookNames.value;\n            }\n            return bindings.global.filter(name => worldbookNames.value.includes(name));\n        });\n        const globalAddCandidates = computed(() => {\n            const keyword = globalAddSearchText.value.trim().toLowerCase();\n            return worldbookNames.value.filter(name => {\n                if (bindings.global.includes(name)) {\n                    return false;\n                }\n                if (!keyword) {\n                    return true;\n                }\n                return name.toLowerCase().includes(keyword);\n            });\n        });\n        const filteredGlobalWorldbooks = computed(() => {\n            const keyword = globalFilterText.value.trim().toLowerCase();\n            if (!keyword) {\n                return bindings.global;\n            }\n            return bindings.global.filter(name => name.toLowerCase().includes(keyword));\n        });\n        const isGlobalBound = computed(() => {\n            if (!selectedWorldbookName.value) {\n                return false;\n            }\n            return bindings.global.includes(selectedWorldbookName.value);\n        });\n        const clipboardItems = computed(() => persistedState.value.clipboard);\n        const snapshotsForCurrent = computed(() => {\n            if (!selectedWorldbookName.value) {\n                return [];\n            }\n            return persistedState.value.history[selectedWorldbookName.value] ?? [];\n        });\n        const entrySnapshotsForSelected = computed(() => {\n            if (!selectedWorldbookName.value || !selectedEntry.value) {\n                return [];\n            }\n            const byWorldbook = persistedState.value.entry_history[selectedWorldbookName.value] ?? {};\n            return byWorldbook[String(selectedEntry.value.uid)] ?? [];\n        });\n        const entryVersionViews = computed(() => {\n            if (!selectedEntry.value) {\n                return [];\n            }\n            const baselineEntry = originalEntries.value.find(item => item.uid === selectedEntry.value?.uid) ?? null;\n            const current = {\n                id: '__current__',\n                label: '',\n                ts: Date.now(),\n                name: selectedEntry.value.name,\n                entry: selectedEntry.value,\n                isCurrent: true,\n            };\n            const baseline = baselineEntry\n                ? {\n                    id: '__baseline__',\n                    label: '',\n                    ts: 0,\n                    name: baselineEntry.name,\n                    entry: baselineEntry,\n                    isCurrent: false,\n                }\n                : null;\n            const history = entrySnapshotsForSelected.value.map(item => ({\n                id: item.id,\n                label: item.label,\n                ts: item.ts,\n                name: item.name,\n                entry: item.entry,\n                isCurrent: false,\n            }));\n            return [current, ...(baseline ? [baseline] : []), ...history];\n        });\n        const selectedEntryHistoryLeft = computed(() => {\n            return entryVersionViews.value.find(item => item.id === entryHistoryLeftId.value) ?? null;\n        });\n        const selectedEntryHistoryRight = computed(() => {\n            return entryVersionViews.value.find(item => item.id === entryHistoryRightId.value) ?? null;\n        });\n        const canRestoreEntryFromLeft = computed(() => {\n            return Boolean(selectedEntry.value && selectedEntryHistoryLeft.value && !selectedEntryHistoryLeft.value.isCurrent);\n        });\n        const worldbookVersionViews = computed(() => {\n            if (!selectedWorldbookName.value) {\n                return [];\n            }\n            const current = {\n                id: '__current__',\n                label: '',\n                ts: Date.now(),\n                entries: draftEntries.value,\n                isCurrent: true,\n            };\n            const baseline = {\n                id: '__baseline__',\n                label: '',\n                ts: 0,\n                entries: originalEntries.value,\n                isCurrent: false,\n            };\n            const history = snapshotsForCurrent.value.map(item => ({\n                id: item.id,\n                label: item.label,\n                ts: item.ts,\n                entries: item.entries,\n                isCurrent: false,\n            }));\n            return [current, ...(originalEntries.value.length ? [baseline] : []), ...history];\n        });\n        const selectedWorldbookHistoryLeft = computed(() => {\n            return worldbookVersionViews.value.find(item => item.id === worldbookHistoryLeftId.value) ?? null;\n        });\n        const selectedWorldbookHistoryRight = computed(() => {\n            return worldbookVersionViews.value.find(item => item.id === worldbookHistoryRightId.value) ?? null;\n        });\n        const canRestoreWorldbookFromLeft = computed(() => {\n            return Boolean(selectedWorldbookHistoryLeft.value && !selectedWorldbookHistoryLeft.value.isCurrent);\n        });\n        const batchExcludeTokensPreview = computed(() => parseBatchExcludeTokens(batchExcludeText.value));\n        const entryHistoryDiff = computed(() => {\n            return buildDiffHtml(serializeEntryVersionForDiff(selectedEntryHistoryLeft.value), serializeEntryVersionForDiff(selectedEntryHistoryRight.value));\n        });\n        const entryHistorySummary = computed(() => {\n            return getEntryVersionDiffSummary(selectedEntryHistoryLeft.value, selectedEntryHistoryRight.value);\n        });\n        const worldbookHistoryDiff = computed(() => {\n            return buildDiffHtml(serializeWorldbookVersionForDiff(selectedWorldbookHistoryLeft.value), serializeWorldbookVersionForDiff(selectedWorldbookHistoryRight.value));\n        });\n        const selectedKeysText = computed({\n            get: () => {\n                if (!selectedEntry.value) {\n                    return '';\n                }\n                return selectedEntry.value.strategy.keys.map(stringifyKeyword).join(', ');\n            },\n            set: (value) => {\n                if (!selectedEntry.value) {\n                    return;\n                }\n                selectedEntry.value.strategy.keys = parseKeywordsFromText(value);\n            },\n        });\n        const selectedSecondaryKeysText = computed({\n            get: () => {\n                if (!selectedEntry.value) {\n                    return '';\n                }\n                return selectedEntry.value.strategy.keys_secondary.keys.map(stringifyKeyword).join(', ');\n            },\n            set: (value) => {\n                if (!selectedEntry.value) {\n                    return;\n                }\n                selectedEntry.value.strategy.keys_secondary.keys = parseKeywordsFromText(value);\n            },\n        });\n        const selectedScanDepthText = computed({\n            get: () => {\n                if (!selectedEntry.value) {\n                    return '';\n                }\n                const depth = selectedEntry.value.strategy.scan_depth;\n                return typeof depth === 'number' ? String(depth) : 'same_as_global';\n            },\n            set: (value) => {\n                if (!selectedEntry.value) {\n                    return;\n                }\n                selectedEntry.value.strategy.scan_depth = normalizeScanDepth(value);\n            },\n        });\n        const selectedRecursionDelayText = computed({\n            get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.recursion.delay_until) : ''),\n            set: (value) => {\n                if (!selectedEntry.value) {\n                    return;\n                }\n                selectedEntry.value.recursion.delay_until = parseNullableInteger(value);\n            },\n        });\n        const selectedStickyText = computed({\n            get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.effect.sticky) : ''),\n            set: (value) => {\n                if (!selectedEntry.value) {\n                    return;\n                }\n                selectedEntry.value.effect.sticky = parseNullableInteger(value);\n            },\n        });\n        const selectedCooldownText = computed({\n            get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.effect.cooldown) : ''),\n            set: (value) => {\n                if (!selectedEntry.value) {\n                    return;\n                }\n                selectedEntry.value.effect.cooldown = parseNullableInteger(value);\n            },\n        });\n        const selectedEffectDelayText = computed({\n            get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.effect.delay) : ''),\n            set: (value) => {\n                if (!selectedEntry.value) {\n                    return;\n                }\n                selectedEntry.value.effect.delay = parseNullableInteger(value);\n            },\n        });\n        const selectedContentChars = computed(() => {\n            return selectedEntry.value?.content.length ?? 0;\n        });\n        const selectedTokenEstimate = computed(() => {\n            const chars = selectedContentChars.value;\n            if (chars <= 0) {\n                return 0;\n            }\n            return Math.max(1, Math.round(chars / 3.6));\n        });\n        watch(selectedWorldbookName, name => {\n            if (!name) {\n                draftEntries.value = [];\n                originalEntries.value = [];\n                selectedEntryUid.value = null;\n                return;\n            }\n            updatePersistedState(state => {\n                state.last_worldbook = name;\n            });\n            void loadWorldbook(name);\n        });\n        watch(() => selectedEntryUid.value, () => {\n            syncExtraTextWithSelection();\n        });\n        watch(entryVersionViews, views => {\n            if (!views.length) {\n                entryHistoryLeftId.value = '';\n                entryHistoryRightId.value = '';\n                return;\n            }\n            const ids = new Set(views.map(item => item.id));\n            if (!ids.has(entryHistoryRightId.value)) {\n                entryHistoryRightId.value = '__current__';\n            }\n            if (!ids.has(entryHistoryLeftId.value)) {\n                const fallback = views.find(item => !item.isCurrent) ?? views[0];\n                entryHistoryLeftId.value = fallback.id;\n            }\n            if (entryHistoryLeftId.value === entryHistoryRightId.value && views.length > 1) {\n                const fallback = views.find(item => item.id !== entryHistoryRightId.value);\n                if (fallback) {\n                    entryHistoryLeftId.value = fallback.id;\n                }\n            }\n        }, { immediate: true });\n        watch(worldbookVersionViews, views => {\n            if (!views.length) {\n                worldbookHistoryLeftId.value = '';\n                worldbookHistoryRightId.value = '';\n                return;\n            }\n            const ids = new Set(views.map(item => item.id));\n            if (!ids.has(worldbookHistoryRightId.value)) {\n                worldbookHistoryRightId.value = '__current__';\n            }\n            if (!ids.has(worldbookHistoryLeftId.value)) {\n                const fallback = views.find(item => !item.isCurrent) ?? views[0];\n                worldbookHistoryLeftId.value = fallback.id;\n            }\n            if (worldbookHistoryLeftId.value === worldbookHistoryRightId.value && views.length > 1) {\n                const fallback = views.find(item => item.id !== worldbookHistoryRightId.value);\n                if (fallback) {\n                    worldbookHistoryLeftId.value = fallback.id;\n                }\n            }\n        }, { immediate: true });\n        watch(() => selectedEntry.value?.position.type, () => {\n            if (!selectedEntry.value) {\n                return;\n            }\n            if (selectedEntry.value.position.type !== 'at_depth') {\n                selectedEntry.value.position.role = 'system';\n                selectedEntry.value.position.depth = 4;\n            }\n        });\n        watch(hasUnsavedChanges, dirty => {\n            const target = window;\n            target[DIRTY_STATE_KEY] = dirty;\n        }, { immediate: true });\n        function createId(prefix) {\n            return `${prefix}-${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 9)}`;\n        }\n        function asRecord(value) {\n            if (value && typeof value === 'object' && !Array.isArray(value)) {\n                return value;\n            }\n            return null;\n        }\n        function toStringSafe(value, fallback = '') {\n            if (typeof value === 'string') {\n                return value;\n            }\n            if (value === null || value === undefined) {\n                return fallback;\n            }\n            return String(value);\n        }\n        function toNumberSafe(value, fallback) {\n            if (typeof value === 'number' && Number.isFinite(value)) {\n                return value;\n            }\n            if (typeof value === 'string' && value.trim()) {\n                const parsed = Number(value);\n                if (Number.isFinite(parsed)) {\n                    return parsed;\n                }\n            }\n            return fallback;\n        }\n        function clampNumber(value, min, max) {\n            return Math.min(max, Math.max(min, value));\n        }\n        function parseNullableInteger(value) {\n            if (value === null || value === undefined) {\n                return null;\n            }\n            if (typeof value === 'string' && !value.trim()) {\n                return null;\n            }\n            const parsed = Number(value);\n            if (!Number.isFinite(parsed)) {\n                return null;\n            }\n            return Math.max(0, Math.floor(parsed));\n        }\n        function nullableNumberToText(value) {\n            return value === null ? '' : String(value);\n        }\n        function stringifyKeyword(value) {\n            return value instanceof RegExp ? value.toString() : value;\n        }\n        function parseKeywordToken(token) {\n            const trimmed = token.trim();\n            if (!trimmed) {\n                return '';\n            }\n            const regexMatch = trimmed.match(/^\\/(.+)\\/([dgimsuy]*)$/);\n            if (!regexMatch) {\n                return trimmed;\n            }\n            try {\n                return new RegExp(regexMatch[1], regexMatch[2]);\n            }\n            catch {\n                return trimmed;\n            }\n        }\n        function normalizeKeywordList(value) {\n            const sourceList = Array.isArray(value) ? value : typeof value === 'string' ? value.split(/[\\n,]/g) : [];\n            const normalized = [];\n            const seen = new Set();\n            for (const item of sourceList) {\n                const token = item instanceof RegExp ? item : parseKeywordToken(toStringSafe(item).trim());\n                const tokenString = stringifyKeyword(token);\n                if (!tokenString) {\n                    continue;\n                }\n                const dedupeKey = tokenString.toLowerCase();\n                if (seen.has(dedupeKey)) {\n                    continue;\n                }\n                seen.add(dedupeKey);\n                normalized.push(token);\n            }\n            return normalized;\n        }\n        function parseKeywordsFromText(value) {\n            return normalizeKeywordList(value.split(/[\\n,]/g));\n        }\n        function getStrategyTypeLabel(type) {\n            if (type === 'constant') {\n                return '  (constant)';\n            }\n            if (type === 'vectorized') {\n                return '  (vectorized)';\n            }\n            return '  (selective)';\n        }\n        function getSecondaryLogicLabel(logic) {\n            const map = {\n                and_any: ' (and_any)',\n                and_all: ' (and_all)',\n                not_all: ' (not_all)',\n                not_any: ' (not_any)',\n            };\n            return map[logic];\n        }\n        function getPositionTypeLabel(type) {\n            const map = {\n                before_character_definition: '',\n                after_character_definition: '',\n                before_example_messages: '',\n                after_example_messages: '',\n                before_author_note: '',\n                after_author_note: '',\n                at_depth: '',\n            };\n            return map[type];\n        }\n        function getEntryVisualStatus(entry) {\n            if (!entry.enabled) {\n                return 'disabled';\n            }\n            if (entry.strategy.type === 'constant') {\n                return 'constant';\n            }\n            if (entry.strategy.type === 'vectorized') {\n                return 'vector';\n            }\n            return 'normal';\n        }\n        function getEntryStatusLabel(entry) {\n            const status = getEntryVisualStatus(entry);\n            if (status === 'disabled') {\n                return ' ';\n            }\n            if (status === 'constant') {\n                return ' ';\n            }\n            if (status === 'vector') {\n                return ' ';\n            }\n            return ' ';\n        }\n        function getEntryKeyPreview(entry) {\n            const rendered = entry.strategy.keys\n                .slice(0, 3)\n                .map(key => stringifyKeyword(key))\n                .join(' / ');\n            if (!rendered) {\n                return '';\n            }\n            if (entry.strategy.keys.length > 3) {\n                return `${rendered} ...`;\n            }\n            return rendered;\n        }\n        function normalizeSecondaryLogic(value) {\n            if (typeof value === 'string' && secondaryLogicOptions.includes(value)) {\n                return value;\n            }\n            if (typeof value === 'number') {\n                const map = ['and_any', 'and_all', 'not_all', 'not_any'];\n                return map[value] ?? 'and_any';\n            }\n            return 'and_any';\n        }\n        function normalizeStrategyType(raw, strategyRecord) {\n            const directType = strategyRecord?.type;\n            if (typeof directType === 'string' && strategyTypeOptions.includes(directType)) {\n                return directType;\n            }\n            if (raw.constant) {\n                return 'constant';\n            }\n            if (raw.vectorized) {\n                return 'vectorized';\n            }\n            return 'selective';\n        }\n        function normalizePositionType(value) {\n            if (typeof value === 'string') {\n                if (positionTypeOptions.includes(value)) {\n                    return value;\n                }\n                const depthMatch = value.match(/^at_depth_as_(system|assistant|user)$/);\n                if (depthMatch) {\n                    return 'at_depth';\n                }\n            }\n            if (typeof value === 'number') {\n                const map = {\n                    0: 'before_character_definition',\n                    1: 'after_character_definition',\n                    2: 'before_example_messages',\n                    3: 'after_example_messages',\n                    4: 'before_author_note',\n                    5: 'after_author_note',\n                    6: 'at_depth',\n                };\n                return map[value] ?? 'after_character_definition';\n            }\n            return 'after_character_definition';\n        }\n        function normalizeRole(value) {\n            if (value === 'assistant' || value === 'user' || value === 'system') {\n                return value;\n            }\n            if (typeof value === 'number') {\n                const map = {\n                    0: 'system',\n                    1: 'assistant',\n                    2: 'user',\n                };\n                return map[value] ?? 'system';\n            }\n            if (typeof value === 'string') {\n                if (value.includes('assistant')) {\n                    return 'assistant';\n                }\n                if (value.includes('user')) {\n                    return 'user';\n                }\n            }\n            return 'system';\n        }\n        function normalizeScanDepth(value) {\n            if (value === 'same_as_global') {\n                return 'same_as_global';\n            }\n            const numeric = Math.floor(toNumberSafe(value, NaN));\n            if (Number.isFinite(numeric) && numeric > 0) {\n                return numeric;\n            }\n            return 'same_as_global';\n        }\n        function createDefaultEntry(uid) {\n            return {\n                uid,\n                name: ` ${uid}`,\n                enabled: true,\n                strategy: {\n                    type: 'selective',\n                    keys: [],\n                    keys_secondary: {\n                        logic: 'and_any',\n                        keys: [],\n                    },\n                    scan_depth: 'same_as_global',\n                },\n                position: {\n                    type: 'after_character_definition',\n                    role: 'system',\n                    depth: 4,\n                    order: 100,\n                },\n                content: '',\n                probability: 100,\n                recursion: {\n                    prevent_incoming: false,\n                    prevent_outgoing: false,\n                    delay_until: null,\n                },\n                effect: {\n                    sticky: null,\n                    cooldown: null,\n                    delay: null,\n                },\n            };\n        }\n        function collectExtraFields(raw) {\n            const known = new Set([\n                'uid',\n                'id',\n                'name',\n                'comment',\n                'enabled',\n                'disable',\n                'strategy',\n                'position',\n                'content',\n                'probability',\n                'recursion',\n                'effect',\n                'extra',\n                'keys',\n                'key',\n                'secondary_keys',\n                'keysecondary',\n                'filters',\n                'logic',\n                'selectiveLogic',\n                'scan_depth',\n                'constant',\n                'vectorized',\n                'selective',\n                'insertion_order',\n                'order',\n                'role',\n                'depth',\n                'preventRecursion',\n                'excludeRecursion',\n                'delayUntilRecursion',\n                'sticky',\n                'cooldown',\n                'delay',\n                'useProbability',\n            ]);\n            const extra = {};\n            for (const [key, value] of Object.entries(raw)) {\n                if (!known.has(key)) {\n                    extra[key] = value;\n                }\n            }\n            if (Object.keys(extra).length === 0) {\n                return undefined;\n            }\n            return extra;\n        }\n        function normalizeEntry(rawInput, fallbackUid) {\n            const raw = asRecord(rawInput) ?? {};\n            const base = createDefaultEntry(fallbackUid);\n            const strategyRecord = asRecord(raw.strategy);\n            const positionRecord = asRecord(raw.position);\n            const recursionRecord = asRecord(raw.recursion);\n            const effectRecord = asRecord(raw.effect);\n            const secondaryRecord = asRecord(strategyRecord?.keys_secondary);\n            const uid = Math.max(0, Math.floor(toNumberSafe(raw.uid ?? raw.id, fallbackUid)));\n            const name = toStringSafe(raw.name ?? raw.comment, ` ${uid}`).trim() || ` ${uid}`;\n            const strategyType = normalizeStrategyType(raw, strategyRecord);\n            const keys = normalizeKeywordList(strategyRecord?.keys ?? raw.keys ?? raw.key);\n            const secondaryKeys = normalizeKeywordList(secondaryRecord?.keys ?? raw.secondary_keys ?? raw.keysecondary ?? raw.filters);\n            const secondaryLogic = normalizeSecondaryLogic(secondaryRecord?.logic ?? raw.logic ?? raw.selectiveLogic);\n            const positionType = normalizePositionType(positionRecord?.type ?? raw.position);\n            const role = normalizeRole(positionRecord?.role ?? raw.role);\n            const depth = Math.max(1, Math.floor(toNumberSafe(positionRecord?.depth ?? raw.depth, 4)));\n            const order = Math.floor(toNumberSafe(positionRecord?.order ?? raw.insertion_order ?? raw.order, 100));\n            const probability = clampNumber(toNumberSafe(raw.probability, 100), 0, 100);\n            const preventIncoming = recursionRecord?.prevent_incoming ?? raw.preventRecursion;\n            const preventOutgoing = recursionRecord?.prevent_outgoing ?? raw.excludeRecursion;\n            const entry = {\n                ...base,\n                uid,\n                name,\n                enabled: raw.enabled === undefined ? !Boolean(raw.disable) : Boolean(raw.enabled),\n                strategy: {\n                    type: strategyType,\n                    keys,\n                    keys_secondary: {\n                        logic: secondaryLogic,\n                        keys: secondaryKeys,\n                    },\n                    scan_depth: normalizeScanDepth(strategyRecord?.scan_depth ?? raw.scan_depth),\n                },\n                position: {\n                    type: positionType,\n                    role: positionType === 'at_depth' ? role : 'system',\n                    depth: positionType === 'at_depth' ? depth : 4,\n                    order,\n                },\n                content: toStringSafe(raw.content),\n                probability,\n                recursion: {\n                    prevent_incoming: Boolean(preventIncoming),\n                    prevent_outgoing: Boolean(preventOutgoing),\n                    delay_until: parseNullableInteger(recursionRecord?.delay_until ?? raw.delayUntilRecursion),\n                },\n                effect: {\n                    sticky: parseNullableInteger(effectRecord?.sticky ?? raw.sticky),\n                    cooldown: parseNullableInteger(effectRecord?.cooldown ?? raw.cooldown),\n                    delay: parseNullableInteger(effectRecord?.delay ?? raw.delay),\n                },\n            };\n            const directExtra = asRecord(raw.extra);\n            if (directExtra && Object.keys(directExtra).length > 0) {\n                entry.extra = klona(directExtra);\n            }\n            else {\n                const extras = collectExtraFields(raw);\n                if (extras) {\n                    entry.extra = klona(extras);\n                }\n            }\n            return entry;\n        }\n        function normalizeEntryList(rawEntries) {\n            const result = [];\n            const uidSet = new Set();\n            for (let index = 0; index < rawEntries.length; index += 1) {\n                const rawRecord = asRecord(rawEntries[index]);\n                let uid = Math.max(0, Math.floor(toNumberSafe(rawRecord?.uid ?? rawRecord?.id, index)));\n                while (uidSet.has(uid)) {\n                    uid += 1;\n                }\n                uidSet.add(uid);\n                result.push(normalizeEntry(rawEntries[index], uid));\n            }\n            return result;\n        }\n        function getNextUid(entries) {\n            if (entries.length === 0) {\n                return 0;\n            }\n            return Math.max(...entries.map(entry => entry.uid)) + 1;\n        }\n        function createDefaultPersistedState() {\n            return {\n                last_worldbook: '',\n                clipboard: [],\n                history: {},\n                entry_history: {},\n            };\n        }\n        function normalizePersistedState(input) {\n            const root = asRecord(input);\n            if (!root) {\n                return createDefaultPersistedState();\n            }\n            const historyRoot = asRecord(root.history) ?? {};\n            const history = {};\n            for (const [name, rawSnapshots] of Object.entries(historyRoot)) {\n                if (!Array.isArray(rawSnapshots)) {\n                    continue;\n                }\n                history[name] = rawSnapshots\n                    .map(item => {\n                    const record = asRecord(item);\n                    if (!record) {\n                        return null;\n                    }\n                    const entriesRaw = Array.isArray(record.entries) ? record.entries : [];\n                    return {\n                        id: toStringSafe(record.id, createId('snapshot')),\n                        label: toStringSafe(record.label, ''),\n                        ts: toNumberSafe(record.ts, Date.now()),\n                        entries: normalizeEntryList(entriesRaw),\n                    };\n                })\n                    .filter((item) => item !== null)\n                    .slice(0, HISTORY_LIMIT);\n            }\n            const entryHistoryRoot = asRecord(root.entry_history) ?? {};\n            const entryHistory = {};\n            for (const [worldbookName, rawByUid] of Object.entries(entryHistoryRoot)) {\n                const uidRecord = asRecord(rawByUid);\n                if (!uidRecord) {\n                    continue;\n                }\n                const normalizedByUid = {};\n                for (const [uidKey, rawItems] of Object.entries(uidRecord)) {\n                    if (!Array.isArray(rawItems)) {\n                        continue;\n                    }\n                    const uidNumber = Math.max(0, Math.floor(toNumberSafe(uidKey, 0)));\n                    normalizedByUid[uidKey] = rawItems\n                        .map(item => {\n                        const record = asRecord(item);\n                        if (!record) {\n                            return null;\n                        }\n                        return {\n                            id: toStringSafe(record.id, createId('entry-snapshot')),\n                            label: toStringSafe(record.label, ''),\n                            ts: toNumberSafe(record.ts, Date.now()),\n                            uid: uidNumber,\n                            name: toStringSafe(record.name, ` ${uidNumber}`),\n                            entry: normalizeEntry(record.entry, uidNumber),\n                        };\n                    })\n                        .filter((item) => item !== null)\n                        .slice(0, ENTRY_HISTORY_LIMIT);\n                }\n                if (Object.keys(normalizedByUid).length > 0) {\n                    entryHistory[worldbookName] = normalizedByUid;\n                }\n            }\n            const clipboardRaw = Array.isArray(root.clipboard) ? root.clipboard : [];\n            const clipboard = clipboardRaw\n                .map(item => {\n                const record = asRecord(item);\n                if (!record) {\n                    return null;\n                }\n                return {\n                    id: toStringSafe(record.id, createId('clip')),\n                    copied_at: toNumberSafe(record.copied_at, Date.now()),\n                    name: toStringSafe(record.name, ''),\n                    entry: normalizeEntry(record.entry, 0),\n                };\n            })\n                .filter((item) => item !== null)\n                .slice(0, CLIPBOARD_LIMIT);\n            return {\n                last_worldbook: toStringSafe(root.last_worldbook),\n                history,\n                entry_history: entryHistory,\n                clipboard,\n            };\n        }\n        function readPersistedState() {\n            const vars = getVariables({ type: 'script', script_id: getScriptId() });\n            return normalizePersistedState(vars[STORAGE_KEY]);\n        }\n        function writePersistedState(state) {\n            const vars = getVariables({ type: 'script', script_id: getScriptId() });\n            vars[STORAGE_KEY] = state;\n            replaceVariables(vars, { type: 'script', script_id: getScriptId() });\n            persistedState.value = state;\n        }\n        function updatePersistedState(mutator) {\n            const state = readPersistedState();\n            mutator(state);\n            writePersistedState(state);\n        }\n        function setStatus(message) {\n            statusMessage.value = message;\n        }\n        function syncExtraTextWithSelection() {\n            if (!selectedEntry.value || !selectedEntry.value.extra) {\n                selectedExtraText.value = '';\n                return;\n            }\n            selectedExtraText.value = JSON.stringify(selectedEntry.value.extra, null, 2);\n        }\n        function formatDateTime(timestamp) {\n            try {\n                return new Date(timestamp).toLocaleString('zh-CN', { hour12: false });\n            }\n            catch {\n                return String(timestamp);\n            }\n        }\n        function formatHistoryOptionLabel(label, ts, isCurrent) {\n            if (isCurrent) {\n                return 'Current';\n            }\n            if (label === '' || ts <= 0) {\n                return label;\n            }\n            return `${label}  ${formatDateTime(ts)}`;\n        }\n        function getEntryVersionPreview(view) {\n            if (!view) {\n                return '';\n            }\n            const content = toStringSafe(view.entry.content).replace(/\\s+/g, ' ').trim();\n            if (!content) {\n                return '()';\n            }\n            return content.slice(0, 160);\n        }\n        function getWorldbookVersionDiffSummary(left, right) {\n            if (!left || !right) {\n                return '';\n            }\n            const leftMap = new Map();\n            const rightMap = new Map();\n            left.entries.forEach(entry => leftMap.set(entry.uid, entry));\n            right.entries.forEach(entry => rightMap.set(entry.uid, entry));\n            let added = 0;\n            let removed = 0;\n            let changed = 0;\n            for (const [uid, rightEntry] of rightMap) {\n                const leftEntry = leftMap.get(uid);\n                if (!leftEntry) {\n                    added += 1;\n                    continue;\n                }\n                if (JSON.stringify(leftEntry) !== JSON.stringify(rightEntry)) {\n                    changed += 1;\n                }\n            }\n            for (const uid of leftMap.keys()) {\n                if (!rightMap.has(uid)) {\n                    removed += 1;\n                }\n            }\n            return ` ${added} /  ${changed} /  ${removed}`;\n        }\n        function getEntryVersionDiffSummary(left, right) {\n            if (!left || !right) {\n                return '';\n            }\n            const leftText = serializeEntryVersionForDiff(left);\n            const rightText = serializeEntryVersionForDiff(right);\n            const parts = diffLines(leftText, rightText);\n            let addLines = 0;\n            let delLines = 0;\n            for (const part of parts) {\n                const lines = part.value.split('\\n');\n                if (lines.length && lines[lines.length - 1] === '') {\n                    lines.pop();\n                }\n                if (part.added) {\n                    addLines += lines.length;\n                }\n                else if (part.removed) {\n                    delLines += lines.length;\n                }\n            }\n            const changed = Math.min(addLines, delLines);\n            const added = Math.max(0, addLines - changed);\n            const removed = Math.max(0, delLines - changed);\n            return ` ${added} /  ${changed} /  ${removed}`;\n        }\n        function escapeHtml(text) {\n            return text\n                .replaceAll('&', '&amp;')\n                .replaceAll('<', '&lt;')\n                .replaceAll('>', '&gt;')\n                .replaceAll('\"', '&quot;')\n                .replaceAll(\"'\", '&#39;');\n        }\n        function serializeEntryVersionForDiff(view) {\n            if (!view) {\n                return '';\n            }\n            const entry = view.entry;\n            const payload = {\n                uid: entry.uid,\n                name: entry.name,\n                enabled: entry.enabled,\n                strategy: entry.strategy,\n                position: entry.position,\n                probability: entry.probability,\n                recursion: entry.recursion,\n                effect: entry.effect,\n                content: entry.content,\n                extra: entry.extra ?? null,\n            };\n            return JSON.stringify(payload, null, 2);\n        }\n        function serializeWorldbookVersionForDiff(view) {\n            if (!view) {\n                return '';\n            }\n            const entries = view.entries\n                .map(entry => ({\n                uid: entry.uid,\n                name: entry.name,\n                enabled: entry.enabled,\n                type: entry.strategy.type,\n                keys: entry.strategy.keys.map(stringifyKeyword),\n                position: entry.position,\n                probability: entry.probability,\n                content: entry.content,\n            }))\n                .sort((left, right) => left.uid - right.uid);\n            return JSON.stringify({ entries }, null, 2);\n        }\n        function buildDiffHtml(leftText, rightText) {\n            const leftRendered = [];\n            const rightRendered = [];\n            let leftLineNo = 1;\n            let rightLineNo = 1;\n            const parts = diffLines(leftText, rightText);\n            for (const part of parts) {\n                const lines = part.value.split('\\n');\n                if (lines.length && lines[lines.length - 1] === '') {\n                    lines.pop();\n                }\n                if (!lines.length) {\n                    continue;\n                }\n                if (part.added) {\n                    for (const line of lines) {\n                        leftRendered.push(`<div class=\"diff-row empty\"><span class=\"line-no\"></span><span class=\"line-text\">&nbsp;</span></div>`);\n                        rightRendered.push(`<div class=\"diff-row add\"><span class=\"line-no\">${rightLineNo}</span><span class=\"line-text\">${escapeHtml(line) || '&nbsp;'}</span></div>`);\n                        rightLineNo += 1;\n                    }\n                    continue;\n                }\n                if (part.removed) {\n                    for (const line of lines) {\n                        leftRendered.push(`<div class=\"diff-row del\"><span class=\"line-no\">${leftLineNo}</span><span class=\"line-text\">${escapeHtml(line) || '&nbsp;'}</span></div>`);\n                        rightRendered.push(`<div class=\"diff-row empty\"><span class=\"line-no\"></span><span class=\"line-text\">&nbsp;</span></div>`);\n                        leftLineNo += 1;\n                    }\n                    continue;\n                }\n                for (const line of lines) {\n                    const safe = escapeHtml(line) || '&nbsp;';\n                    leftRendered.push(`<div class=\"diff-row\"><span class=\"line-no\">${leftLineNo}</span><span class=\"line-text\">${safe}</span></div>`);\n                    rightRendered.push(`<div class=\"diff-row\"><span class=\"line-no\">${rightLineNo}</span><span class=\"line-text\">${safe}</span></div>`);\n                    leftLineNo += 1;\n                    rightLineNo += 1;\n                }\n            }\n            return {\n                leftHtml: leftRendered.join(''),\n                rightHtml: rightRendered.join(''),\n            };\n        }\n        function parseBatchExcludeTokens(value) {\n            const seen = new Set();\n            const tokens = [];\n            for (const raw of value.split(/[\\n,]/g)) {\n                const token = raw.trim().toLowerCase();\n                if (!token || seen.has(token)) {\n                    continue;\n                }\n                seen.add(token);\n                tokens.push(token);\n            }\n            return tokens;\n        }\n        function shouldExcludeEntryForBatch(entry, tokens) {\n            if (!tokens.length) {\n                return false;\n            }\n            const name = entry.name.toLowerCase();\n            const keys = entry.strategy.keys.map(key => stringifyKeyword(key).toLowerCase()).join(' ');\n            for (const token of tokens) {\n                const uidMatch = token.match(/^(?:#|uid:)?(\\d+)$/);\n                if (uidMatch && Number(uidMatch[1]) === entry.uid) {\n                    return true;\n                }\n                const plain = token.replace(/^name:/, '').trim();\n                if (plain && (name.includes(plain) || keys.includes(plain))) {\n                    return true;\n                }\n            }\n            return false;\n        }\n        function ensureSelectedEntryExists() {\n            if (!draftEntries.value.length) {\n                selectedEntryUid.value = null;\n                return;\n            }\n            if (selectedEntryUid.value === null) {\n                selectedEntryUid.value = draftEntries.value[0].uid;\n                return;\n            }\n            const exists = draftEntries.value.some(entry => entry.uid === selectedEntryUid.value);\n            if (!exists) {\n                selectedEntryUid.value = draftEntries.value[0].uid;\n            }\n        }\n        function selectEntry(uid) {\n            selectedEntryUid.value = uid;\n        }\n        function createEntrySnapshotRecord(label, uid, name, entry) {\n            return {\n                id: createId('entry-snapshot'),\n                label,\n                ts: Date.now(),\n                uid,\n                name: name || ` ${uid}`,\n                entry: normalizeEntry(klona(entry), uid),\n            };\n        }\n        function pushEntrySnapshotsBulk(items) {\n            if (!selectedWorldbookName.value || !items.length) {\n                return 0;\n            }\n            let added = 0;\n            const worldbookName = selectedWorldbookName.value;\n            updatePersistedState(state => {\n                const byWorldbook = state.entry_history[worldbookName] ?? {};\n                for (const item of items) {\n                    const uidKey = String(item.uid);\n                    const incoming = createEntrySnapshotRecord(item.label, item.uid, item.name, item.entry);\n                    const list = byWorldbook[uidKey] ?? [];\n                    if (list[0] && JSON.stringify(list[0].entry) === JSON.stringify(incoming.entry)) {\n                        continue;\n                    }\n                    list.unshift(incoming);\n                    if (list.length > ENTRY_HISTORY_LIMIT) {\n                        list.length = ENTRY_HISTORY_LIMIT;\n                    }\n                    byWorldbook[uidKey] = list;\n                    added += 1;\n                }\n                state.entry_history[worldbookName] = byWorldbook;\n            });\n            return added;\n        }\n        function pushEntrySnapshot(label, entry) {\n            const added = pushEntrySnapshotsBulk([\n                {\n                    label,\n                    uid: entry.uid,\n                    name: entry.name,\n                    entry,\n                },\n            ]);\n            return added > 0;\n        }\n        function collectEntrySnapshotsBeforeSave() {\n            const result = [];\n            const draftByUid = new Map();\n            draftEntries.value.forEach(entry => {\n                draftByUid.set(entry.uid, entry);\n            });\n            for (const previous of originalEntries.value) {\n                const current = draftByUid.get(previous.uid);\n                if (!current) {\n                    result.push({\n                        label: '',\n                        uid: previous.uid,\n                        name: previous.name,\n                        entry: previous,\n                    });\n                    continue;\n                }\n                if (JSON.stringify(previous) !== JSON.stringify(current)) {\n                    result.push({\n                        label: '',\n                        uid: previous.uid,\n                        name: previous.name,\n                        entry: previous,\n                    });\n                }\n            }\n            return result;\n        }\n        function pushSnapshot(label) {\n            if (!selectedWorldbookName.value) {\n                return;\n            }\n            const worldbookName = selectedWorldbookName.value;\n            const snapshot = {\n                id: createId('snapshot'),\n                label,\n                ts: Date.now(),\n                entries: klona(draftEntries.value),\n            };\n            updatePersistedState(state => {\n                const list = state.history[worldbookName] ?? [];\n                list.unshift(snapshot);\n                if (list.length > HISTORY_LIMIT) {\n                    list.length = HISTORY_LIMIT;\n                }\n                state.history[worldbookName] = list;\n            });\n        }\n        function createManualSnapshot() {\n            if (!selectedWorldbookName.value) {\n                toastr.warning('');\n                return;\n            }\n            pushSnapshot('');\n            toastr.success('');\n        }\n        function openEntryHistoryModal() {\n            if (!selectedEntry.value) {\n                toastr.warning('');\n                return;\n            }\n            const nonCurrent = entryVersionViews.value.find(item => !item.isCurrent) ?? null;\n            entryHistoryRightId.value = '__current__';\n            entryHistoryLeftId.value = nonCurrent?.id ?? '__current__';\n            showEntryHistoryModal.value = true;\n        }\n        function openWorldbookHistoryModal() {\n            if (!selectedWorldbookName.value) {\n                toastr.warning('');\n                return;\n            }\n            const nonCurrent = worldbookVersionViews.value.find(item => !item.isCurrent) ?? null;\n            worldbookHistoryRightId.value = '__current__';\n            worldbookHistoryLeftId.value = nonCurrent?.id ?? '__current__';\n            showWorldbookHistoryModal.value = true;\n        }\n        function createManualEntrySnapshot() {\n            if (!selectedEntry.value) {\n                toastr.warning('');\n                return;\n            }\n            const added = pushEntrySnapshot('', selectedEntry.value);\n            if (added) {\n                toastr.success('');\n            }\n            else {\n                toastr.info('');\n            }\n        }\n        function restoreSnapshot(snapshotId) {\n            const snapshot = snapshotsForCurrent.value.find(item => item.id === snapshotId);\n            if (!snapshot) {\n                return;\n            }\n            if (!confirm(` \"${snapshot.label}\" ? `)) {\n                return;\n            }\n            draftEntries.value = normalizeEntryList(snapshot.entries);\n            ensureSelectedEntryExists();\n            setStatus(`${snapshot.label}`);\n        }\n        function restoreWorldbookFromLeftHistory() {\n            const target = selectedWorldbookHistoryLeft.value;\n            if (!target || target.isCurrent) {\n                return;\n            }\n            if (!confirm(` Left  \"${target.label}\" ? `)) {\n                return;\n            }\n            draftEntries.value = normalizeEntryList(klona(target.entries));\n            ensureSelectedEntryExists();\n            setStatus(`${target.label}`);\n            toastr.success(' Left ');\n        }\n        function deleteSnapshot(snapshotId) {\n            if (!selectedWorldbookName.value) {\n                return;\n            }\n            updatePersistedState(state => {\n                const list = state.history[selectedWorldbookName.value] ?? [];\n                state.history[selectedWorldbookName.value] = list.filter(item => item.id !== snapshotId);\n            });\n        }\n        function clearCurrentSnapshots() {\n            if (!selectedWorldbookName.value || !snapshotsForCurrent.value.length) {\n                return;\n            }\n            if (!confirm(` \"${selectedWorldbookName.value}\" `)) {\n                return;\n            }\n            updatePersistedState(state => {\n                delete state.history[selectedWorldbookName.value];\n            });\n        }\n        function restoreEntrySnapshot(snapshotId) {\n            if (!selectedEntry.value || selectedEntryIndex.value < 0) {\n                return;\n            }\n            const snapshot = entrySnapshotsForSelected.value.find(item => item.id === snapshotId);\n            if (!snapshot) {\n                return;\n            }\n            if (!confirm(` \"${snapshot.label}\" ?`)) {\n                return;\n            }\n            // \n            pushEntrySnapshot('', selectedEntry.value);\n            const restored = normalizeEntry(klona(snapshot.entry), selectedEntry.value.uid);\n            restored.uid = selectedEntry.value.uid;\n            draftEntries.value.splice(selectedEntryIndex.value, 1, restored);\n            selectedEntryUid.value = restored.uid;\n            setStatus(`${snapshot.label}`);\n            toastr.success('');\n        }\n        function restoreEntryFromLeftHistory() {\n            const target = selectedEntryHistoryLeft.value;\n            if (!target || target.isCurrent) {\n                return;\n            }\n            if (!selectedEntry.value || selectedEntryIndex.value < 0) {\n                return;\n            }\n            if (!confirm(` \"${target.label}\" ?`)) {\n                return;\n            }\n            pushEntrySnapshot('', selectedEntry.value);\n            const restored = normalizeEntry(klona(target.entry), selectedEntry.value.uid);\n            restored.uid = selectedEntry.value.uid;\n            draftEntries.value.splice(selectedEntryIndex.value, 1, restored);\n            selectedEntryUid.value = restored.uid;\n            setStatus(`${target.label}`);\n            toastr.success(' Left ');\n        }\n        function deleteEntrySnapshot(snapshotId) {\n            if (!selectedWorldbookName.value || !selectedEntry.value) {\n                return;\n            }\n            const worldbookName = selectedWorldbookName.value;\n            const uidKey = String(selectedEntry.value.uid);\n            updatePersistedState(state => {\n                const byWorldbook = state.entry_history[worldbookName] ?? {};\n                const list = byWorldbook[uidKey] ?? [];\n                byWorldbook[uidKey] = list.filter(item => item.id !== snapshotId);\n                state.entry_history[worldbookName] = byWorldbook;\n            });\n        }\n        function clearCurrentEntrySnapshots() {\n            if (!selectedWorldbookName.value || !selectedEntry.value || !entrySnapshotsForSelected.value.length) {\n                return;\n            }\n            if (!confirm(` #${selectedEntry.value.uid} `)) {\n                return;\n            }\n            const worldbookName = selectedWorldbookName.value;\n            const uidKey = String(selectedEntry.value.uid);\n            updatePersistedState(state => {\n                const byWorldbook = state.entry_history[worldbookName] ?? {};\n                delete byWorldbook[uidKey];\n                state.entry_history[worldbookName] = byWorldbook;\n            });\n        }\n        function copySelectedEntryToClipboard() {\n            if (!selectedEntry.value) {\n                return;\n            }\n            const item = {\n                id: createId('clip'),\n                copied_at: Date.now(),\n                name: selectedEntry.value.name,\n                entry: normalizeEntry(klona(selectedEntry.value), selectedEntry.value.uid),\n            };\n            updatePersistedState(state => {\n                state.clipboard.unshift(item);\n                if (state.clipboard.length > CLIPBOARD_LIMIT) {\n                    state.clipboard.length = CLIPBOARD_LIMIT;\n                }\n            });\n            toastr.success('');\n        }\n        function pasteClipboardItem(itemId) {\n            const item = clipboardItems.value.find(entry => entry.id === itemId);\n            if (!item) {\n                return;\n            }\n            const insertIndex = selectedEntryIndex.value >= 0 ? selectedEntryIndex.value + 1 : draftEntries.value.length;\n            const uid = getNextUid(draftEntries.value);\n            const cloned = normalizeEntry(klona(item.entry), uid);\n            cloned.uid = uid;\n            draftEntries.value.splice(insertIndex, 0, cloned);\n            selectedEntryUid.value = cloned.uid;\n            setStatus(` \"${cloned.name}\"`);\n        }\n        function deleteClipboardItem(itemId) {\n            updatePersistedState(state => {\n                state.clipboard = state.clipboard.filter(entry => entry.id !== itemId);\n            });\n        }\n        function clearClipboard() {\n            if (!clipboardItems.value.length) {\n                return;\n            }\n            if (!confirm('')) {\n                return;\n            }\n            updatePersistedState(state => {\n                state.clipboard = [];\n            });\n        }\n        function handleSelectedPositionTypeChanged() {\n            if (!selectedEntry.value) {\n                return;\n            }\n            if (selectedEntry.value.position.type !== 'at_depth') {\n                selectedEntry.value.position.role = 'system';\n                selectedEntry.value.position.depth = 4;\n            }\n        }\n        function applyExtraJson() {\n            if (!selectedEntry.value) {\n                return;\n            }\n            const text = selectedExtraText.value.trim();\n            if (!text) {\n                selectedEntry.value.extra = undefined;\n                return;\n            }\n            try {\n                const parsed = JSON.parse(text);\n                const parsedRecord = asRecord(parsed);\n                if (!parsedRecord) {\n                    throw new Error('extra  JSON ');\n                }\n                selectedEntry.value.extra = klona(parsedRecord);\n                toastr.success('extra ');\n            }\n            catch (error) {\n                toastr.error(`extra JSON : ${error instanceof Error ? error.message : String(error)}`);\n            }\n        }\n        function clearExtra() {\n            if (!selectedEntry.value) {\n                return;\n            }\n            selectedEntry.value.extra = undefined;\n            selectedExtraText.value = '';\n        }\n        function addEntry() {\n            const uid = getNextUid(draftEntries.value);\n            const entry = createDefaultEntry(uid);\n            draftEntries.value.push(entry);\n            selectedEntryUid.value = uid;\n            setStatus(` #${uid}`);\n        }\n        function duplicateSelectedEntry() {\n            if (!selectedEntry.value || selectedEntryIndex.value < 0) {\n                return;\n            }\n            const uid = getNextUid(draftEntries.value);\n            const duplicated = normalizeEntry(klona(selectedEntry.value), uid);\n            duplicated.uid = uid;\n            duplicated.name = `${duplicated.name} ()`;\n            draftEntries.value.splice(selectedEntryIndex.value + 1, 0, duplicated);\n            selectedEntryUid.value = uid;\n            setStatus(` #${selectedEntry.value.uid}`);\n        }\n        function removeSelectedEntry() {\n            if (!selectedEntry.value || selectedEntryIndex.value < 0) {\n                return;\n            }\n            if (!confirm(` \"${selectedEntry.value.name}\" ?`)) {\n                return;\n            }\n            pushEntrySnapshot('', selectedEntry.value);\n            draftEntries.value.splice(selectedEntryIndex.value, 1);\n            ensureSelectedEntryExists();\n            setStatus('');\n        }\n        function moveSelectedEntry(direction) {\n            if (selectedEntryIndex.value < 0) {\n                return;\n            }\n            const target = selectedEntryIndex.value + direction;\n            if (target < 0 || target >= draftEntries.value.length) {\n                return;\n            }\n            const [entry] = draftEntries.value.splice(selectedEntryIndex.value, 1);\n            draftEntries.value.splice(target, 0, entry);\n            selectedEntryUid.value = entry.uid;\n        }\n        function normalizeAllEntries() {\n            draftEntries.value = normalizeEntryList(draftEntries.value.map(entry => klona(entry)));\n            ensureSelectedEntryExists();\n            setStatus('');\n        }\n        function sortEntriesByOrderDesc() {\n            draftEntries.value.sort((left, right) => right.position.order - left.position.order);\n            ensureSelectedEntryExists();\n            setStatus(' order ');\n        }\n        function setEnabledForAll(enabled) {\n            draftEntries.value.forEach(entry => {\n                entry.enabled = enabled;\n            });\n            setStatus(enabled ? '' : '');\n        }\n        function applyBatchReplace() {\n            const findText = batchFindText.value;\n            if (!findText) {\n                toastr.warning('');\n                return;\n            }\n            const excludeTokens = parseBatchExcludeTokens(batchExcludeText.value);\n            let regex = null;\n            if (batchUseRegex.value) {\n                try {\n                    regex = new RegExp(findText, 'g');\n                }\n                catch (error) {\n                    toastr.error(`: ${error instanceof Error ? error.message : String(error)}`);\n                    return;\n                }\n            }\n            let touched = 0;\n            let skipped = 0;\n            for (const entry of draftEntries.value) {\n                if (shouldExcludeEntryForBatch(entry, excludeTokens)) {\n                    skipped += 1;\n                    continue;\n                }\n                let changed = false;\n                if (batchInName.value) {\n                    const next = regex\n                        ? entry.name.replace(regex, batchReplaceText.value)\n                        : entry.name.split(findText).join(batchReplaceText.value);\n                    if (next !== entry.name) {\n                        entry.name = next;\n                        changed = true;\n                    }\n                }\n                if (batchInContent.value) {\n                    const next = regex\n                        ? entry.content.replace(regex, batchReplaceText.value)\n                        : entry.content.split(findText).join(batchReplaceText.value);\n                    if (next !== entry.content) {\n                        entry.content = next;\n                        changed = true;\n                    }\n                }\n                if (batchInKeys.value) {\n                    const nextKeys = entry.strategy.keys.map(key => {\n                        const text = stringifyKeyword(key);\n                        return regex ? text.replace(regex, batchReplaceText.value) : text.split(findText).join(batchReplaceText.value);\n                    });\n                    const normalized = normalizeKeywordList(nextKeys);\n                    if (JSON.stringify(normalized.map(stringifyKeyword)) !== JSON.stringify(entry.strategy.keys.map(stringifyKeyword))) {\n                        entry.strategy.keys = normalized;\n                        changed = true;\n                    }\n                }\n                if (changed) {\n                    touched += 1;\n                }\n            }\n            setStatus(` ${touched}  ${skipped} `);\n        }\n        function downloadJson(filename, payload) {\n            const text = JSON.stringify(payload, null, 2);\n            const blob = new Blob([text], { type: 'application/json' });\n            const url = URL.createObjectURL(blob);\n            const anchor = document.createElement('a');\n            anchor.href = url;\n            anchor.download = filename;\n            document.body.appendChild(anchor);\n            anchor.click();\n            document.body.removeChild(anchor);\n            URL.revokeObjectURL(url);\n        }\n        function exportCurrentWorldbook() {\n            if (!selectedWorldbookName.value) {\n                return;\n            }\n            const payload = {\n                format: 'worldbook_assistant_v1',\n                name: selectedWorldbookName.value,\n                exported_at: new Date().toISOString(),\n                entries: draftEntries.value,\n            };\n            const filename = `${selectedWorldbookName.value.replace(/[\\\\/:*?\"<>|]/g, '_')}.json`;\n            downloadJson(filename, payload);\n        }\n        function collectRawEntries(root) {\n            if (Array.isArray(root.entries)) {\n                return root.entries;\n            }\n            const entriesMap = asRecord(root.entries);\n            if (entriesMap) {\n                return Object.values(entriesMap);\n            }\n            const dataRoot = asRecord(root.data);\n            if (dataRoot) {\n                if (Array.isArray(dataRoot.entries)) {\n                    return dataRoot.entries;\n                }\n                const dataEntriesMap = asRecord(dataRoot.entries);\n                if (dataEntriesMap) {\n                    return Object.values(dataEntriesMap);\n                }\n            }\n            return [];\n        }\n        function parseImportedPayload(fileName, text) {\n            const parsed = JSON.parse(text);\n            const fallbackName = fileName.replace(/\\.[^/.]+$/, '') || '';\n            if (Array.isArray(parsed)) {\n                return {\n                    name: fallbackName,\n                    entries: normalizeEntryList(parsed),\n                };\n            }\n            const root = asRecord(parsed);\n            if (!root) {\n                throw new Error(' JSON ');\n            }\n            const entries = collectRawEntries(root);\n            if (!entries.length) {\n                throw new Error(' entries');\n            }\n            const dataRoot = asRecord(root.data);\n            const nameCandidate = toStringSafe(root.name ?? dataRoot?.name, fallbackName).trim();\n            return {\n                name: nameCandidate || fallbackName,\n                entries: normalizeEntryList(entries),\n            };\n        }\n        function triggerImport() {\n            importFileInput.value?.click();\n        }\n        async function onImportChange(event) {\n            const target = event.target;\n            const file = target?.files?.[0];\n            if (!file) {\n                return;\n            }\n            const fileText = await file.text();\n            try {\n                const payload = parseImportedPayload(file.name, fileText);\n                const suggested = payload.name || file.name.replace(/\\.[^/.]+$/, '');\n                const newNameRaw = prompt('', suggested);\n                const newName = toStringSafe(newNameRaw).trim();\n                if (!newName) {\n                    return;\n                }\n                await createOrReplaceWorldbook(newName, payload.entries, { render: 'immediate' });\n                await reloadWorldbookNames(newName);\n                await refreshBindings();\n                toastr.success(`: ${newName}`);\n            }\n            catch (error) {\n                const message = error instanceof Error ? error.message : String(error);\n                const shouldFallback = confirm(`: ${message}\\n`);\n                if (!shouldFallback) {\n                    return;\n                }\n                const response = await importRawWorldbook(file.name, fileText);\n                if (!response.ok) {\n                    throw new Error(`: HTTP ${response.status}`);\n                }\n                await hardRefresh();\n                toastr.success('');\n            }\n            finally {\n                if (target) {\n                    target.value = '';\n                }\n            }\n        }\n        async function refreshBindings() {\n            bindings.global = [...getGlobalWorldbookNames()];\n            try {\n                const charBindings = getCharWorldbookNames('current');\n                bindings.charPrimary = charBindings.primary;\n                bindings.charAdditional = [...charBindings.additional];\n            }\n            catch {\n                bindings.charPrimary = null;\n                bindings.charAdditional = [];\n            }\n            try {\n                bindings.chat = getChatWorldbookName('current');\n            }\n            catch {\n                bindings.chat = null;\n            }\n            if (globalWorldbookMode.value) {\n                ensureSelectionForGlobalMode();\n            }\n        }\n        function resolveContextWorldbookCandidate() {\n            const available = worldbookNames.value;\n            if (!available.length) {\n                return null;\n            }\n            const chatBound = toStringSafe(bindings.chat).trim();\n            if (chatBound && available.includes(chatBound)) {\n                return chatBound;\n            }\n            const charPrimary = toStringSafe(bindings.charPrimary).trim();\n            if (charPrimary && available.includes(charPrimary)) {\n                return charPrimary;\n            }\n            const charAdditional = bindings.charAdditional.find(name => available.includes(name));\n            return charAdditional ?? null;\n        }\n        function ensureSelectionForGlobalMode() {\n            if (!globalWorldbookMode.value) {\n                return;\n            }\n            const globals = selectableWorldbookNames.value;\n            if (!globals.length) {\n                selectedWorldbookName.value = '';\n                return;\n            }\n            if (!globals.includes(selectedWorldbookName.value)) {\n                selectedWorldbookName.value = globals[0];\n            }\n        }\n        function trySelectWorldbookByContext(options = {}) {\n            if (globalWorldbookMode.value) {\n                return false;\n            }\n            if (options.preferWhenEmptyOnly && selectedWorldbookName.value) {\n                return false;\n            }\n            const candidate = resolveContextWorldbookCandidate();\n            if (!candidate || candidate === selectedWorldbookName.value) {\n                return false;\n            }\n            if (!options.force && hasUnsavedChanges.value) {\n                setStatus('/');\n                return false;\n            }\n            selectedWorldbookName.value = candidate;\n            setStatus(`: ${candidate}`);\n            return true;\n        }\n        function toggleGlobalMode() {\n            globalWorldbookMode.value = !globalWorldbookMode.value;\n            if (globalWorldbookMode.value) {\n                ensureSelectionForGlobalMode();\n                setStatus('');\n                return;\n            }\n            if (!selectedWorldbookName.value) {\n                trySelectWorldbookByContext({ force: true });\n            }\n            setStatus('');\n        }\n        async function applyGlobalWorldbooks(nextGlobal, statusLabel = '') {\n            const normalized = [...new Set(nextGlobal.map(name => name.trim()).filter(Boolean))].filter(name => worldbookNames.value.includes(name));\n            try {\n                await rebindGlobalWorldbooks(normalized);\n                await refreshBindings();\n                ensureSelectionForGlobalMode();\n                setStatus(`${statusLabel}${normalized.length} `);\n                return true;\n            }\n            catch (error) {\n                const message = error instanceof Error ? error.message : String(error);\n                toastr.error(`: ${message}`);\n                return false;\n            }\n        }\n        function addFirstGlobalCandidate() {\n            const first = globalAddCandidates.value[0];\n            if (!first) {\n                return;\n            }\n            void addGlobalWorldbook(first);\n        }\n        async function addGlobalWorldbook(name) {\n            if (!name || bindings.global.includes(name)) {\n                return;\n            }\n            const success = await applyGlobalWorldbooks([...bindings.global, name], `: ${name}`);\n            if (success) {\n                globalAddSearchText.value = '';\n            }\n        }\n        async function removeGlobalWorldbook(name) {\n            if (!name || !bindings.global.includes(name)) {\n                return;\n            }\n            await applyGlobalWorldbooks(bindings.global.filter(item => item !== name), `: ${name}`);\n        }\n        async function clearGlobalWorldbooks() {\n            if (!bindings.global.length) {\n                return;\n            }\n            if (!confirm('')) {\n                return;\n            }\n            await applyGlobalWorldbooks([], '');\n        }\n        async function loadWorldbook(name) {\n            if (!name) {\n                return;\n            }\n            isBusy.value = true;\n            try {\n                const rawEntries = await getWorldbook(name);\n                const normalized = normalizeEntryList(rawEntries);\n                draftEntries.value = klona(normalized);\n                originalEntries.value = klona(normalized);\n                ensureSelectedEntryExists();\n                setStatus(` \"${name}\" ${normalized.length}`);\n            }\n            catch (error) {\n                const message = error instanceof Error ? error.message : String(error);\n                toastr.error(`: ${message}`);\n                setStatus(`: ${message}`);\n            }\n            finally {\n                isBusy.value = false;\n            }\n        }\n        async function reloadWorldbookNames(preferred) {\n            const names = [...getWorldbookNames()].sort((left, right) => left.localeCompare(right, 'zh-Hans-CN'));\n            worldbookNames.value = names;\n            if (!names.length) {\n                selectedWorldbookName.value = '';\n                draftEntries.value = [];\n                originalEntries.value = [];\n                selectedEntryUid.value = null;\n                return;\n            }\n            const fallbackName = persistedState.value.last_worldbook;\n            const candidate = (preferred && names.includes(preferred) && preferred) ||\n                (fallbackName && names.includes(fallbackName) && fallbackName) ||\n                selectedWorldbookName.value ||\n                names[0];\n            if (candidate && selectedWorldbookName.value !== candidate) {\n                selectedWorldbookName.value = candidate;\n                return;\n            }\n            if (selectedWorldbookName.value && !draftEntries.value.length) {\n                await loadWorldbook(selectedWorldbookName.value);\n            }\n        }\n        async function hardRefresh() {\n            persistedState.value = readPersistedState();\n            await reloadWorldbookNames(selectedWorldbookName.value || undefined);\n            await refreshBindings();\n            if (globalWorldbookMode.value) {\n                ensureSelectionForGlobalMode();\n            }\n            else {\n                trySelectWorldbookByContext({ preferWhenEmptyOnly: true });\n            }\n            setStatus('');\n        }\n        async function saveCurrentWorldbook() {\n            if (!selectedWorldbookName.value) {\n                toastr.warning('');\n                return;\n            }\n            if (!hasUnsavedChanges.value) {\n                setStatus('');\n                return;\n            }\n            isSaving.value = true;\n            try {\n                draftEntries.value = normalizeEntryList(draftEntries.value.map(entry => klona(entry)));\n                const pendingEntrySnapshots = collectEntrySnapshotsBeforeSave();\n                const savedEntrySnapshotCount = pushEntrySnapshotsBulk(pendingEntrySnapshots);\n                await replaceWorldbook(selectedWorldbookName.value, klona(draftEntries.value), { render: 'immediate' });\n                originalEntries.value = klona(draftEntries.value);\n                pushSnapshot('');\n                await refreshBindings();\n                toastr.success(`: ${selectedWorldbookName.value}`);\n                setStatus(`: ${selectedWorldbookName.value} +${savedEntrySnapshotCount}`);\n            }\n            catch (error) {\n                const message = error instanceof Error ? error.message : String(error);\n                toastr.error(`: ${message}`);\n                setStatus(`: ${message}`);\n            }\n            finally {\n                isSaving.value = false;\n            }\n        }\n        async function createNewWorldbook() {\n            const nameRaw = prompt('');\n            const name = toStringSafe(nameRaw).trim();\n            if (!name) {\n                return;\n            }\n            try {\n                await createOrReplaceWorldbook(name, [], { render: 'immediate' });\n                await reloadWorldbookNames(name);\n                await refreshBindings();\n                toastr.success(`: ${name}`);\n            }\n            catch (error) {\n                const message = error instanceof Error ? error.message : String(error);\n                toastr.error(`: ${message}`);\n            }\n        }\n        async function duplicateWorldbook() {\n            if (!selectedWorldbookName.value) {\n                return;\n            }\n            const suggested = `${selectedWorldbookName.value}_copy`;\n            const newNameRaw = prompt('', suggested);\n            const newName = toStringSafe(newNameRaw).trim();\n            if (!newName) {\n                return;\n            }\n            try {\n                await createOrReplaceWorldbook(newName, klona(draftEntries.value), { render: 'immediate' });\n                await reloadWorldbookNames(newName);\n                await refreshBindings();\n                toastr.success(`: ${newName}`);\n            }\n            catch (error) {\n                const message = error instanceof Error ? error.message : String(error);\n                toastr.error(`: ${message}`);\n            }\n        }\n        async function deleteCurrentWorldbook() {\n            if (!selectedWorldbookName.value) {\n                return;\n            }\n            const current = selectedWorldbookName.value;\n            if (!confirm(` \"${current}\" ?`)) {\n                return;\n            }\n            try {\n                const success = await deleteWorldbook(current);\n                if (!success) {\n                    throw new Error(' false');\n                }\n                updatePersistedState(state => {\n                    delete state.history[current];\n                    delete state.entry_history[current];\n                });\n                toastr.success(`: ${current}`);\n                await reloadWorldbookNames();\n                await refreshBindings();\n            }\n            catch (error) {\n                const message = error instanceof Error ? error.message : String(error);\n                toastr.error(`: ${message}`);\n            }\n        }\n        async function toggleGlobalBinding() {\n            if (!selectedWorldbookName.value) {\n                return;\n            }\n            const next = new Set(getGlobalWorldbookNames());\n            if (next.has(selectedWorldbookName.value)) {\n                next.delete(selectedWorldbookName.value);\n            }\n            else {\n                next.add(selectedWorldbookName.value);\n            }\n            await applyGlobalWorldbooks([...next], '');\n        }\n        function pushActivationLogs(entries) {\n            const logs = entries.map(item => {\n                const uid = item.uid ?? item.displayIndex ?? '?';\n                const name = toStringSafe(item.name ?? item.comment, `UID ${uid}`);\n                const content = toStringSafe(item.content).replace(/\\s+/g, ' ').trim().slice(0, 80);\n                return {\n                    id: createId('activation'),\n                    time: Date.now(),\n                    world: toStringSafe(item.world, 'unknown'),\n                    uid: typeof uid === 'number' || typeof uid === 'string' ? uid : '?',\n                    name,\n                    contentPreview: content || '()',\n                };\n            });\n            activationLogs.value.unshift(...logs);\n            if (activationLogs.value.length > ACTIVATION_LOG_LIMIT) {\n                activationLogs.value.length = ACTIVATION_LOG_LIMIT;\n            }\n        }\n        function clearActivationLogs() {\n            activationLogs.value = [];\n        }\n        function resolveHostWindow() {\n            return mainLayoutRef.value?.ownerDocument?.defaultView ?? editorShellRef.value?.ownerDocument?.defaultView ?? window;\n        }\n        function clampFloatingPanelToViewport(panel) {\n            const hostWin = resolveHostWindow();\n            const viewportWidth = hostWin.innerWidth;\n            const viewportHeight = hostWin.innerHeight;\n            const maxX = Math.max(8, viewportWidth - panel.width - 8);\n            const maxY = Math.max(8, viewportHeight - 68);\n            panel.x = clampNumber(panel.x, 8, maxX);\n            panel.y = clampNumber(panel.y, 8, maxY);\n        }\n        function handleFloatingWindowResize() {\n            viewportWidth.value = resolveHostWindow().innerWidth;\n            clampPaneWidths();\n            for (const key of floatingPanelKeys) {\n                if (!floatingPanels[key].visible) {\n                    continue;\n                }\n                clampFloatingPanelToViewport(floatingPanels[key]);\n            }\n        }\n        function bringFloatingToFront(key) {\n            floatingZCounter.value += 1;\n            floatingPanels[key].z = floatingZCounter.value;\n        }\n        function openFloatingPanel(key) {\n            const panel = floatingPanels[key];\n            panel.visible = true;\n            clampFloatingPanelToViewport(panel);\n            bringFloatingToFront(key);\n        }\n        function closeFloatingPanel(key) {\n            floatingPanels[key].visible = false;\n            if (activeFloatingDrag.value?.key === key) {\n                stopFloatingDrag();\n            }\n        }\n        function toggleFloatingPanel(key) {\n            if (floatingPanels[key].visible) {\n                closeFloatingPanel(key);\n                return;\n            }\n            openFloatingPanel(key);\n        }\n        function getFloatingPanelStyle(key) {\n            const panel = floatingPanels[key];\n            return {\n                left: `${panel.x}px`,\n                top: `${panel.y}px`,\n                zIndex: String(panel.z),\n                width: `${panel.width}px`,\n            };\n        }\n        function startFloatingDrag(key, event) {\n            if (event.pointerType === 'mouse' && event.button !== 0) {\n                return;\n            }\n            const panel = floatingPanels[key];\n            const target = event.currentTarget;\n            if (!target) {\n                return;\n            }\n            const hostDoc = target.ownerDocument ?? document;\n            const hostWin = hostDoc.defaultView ?? window;\n            const rect = target.getBoundingClientRect();\n            bringFloatingToFront(key);\n            const dragState = {\n                key,\n                pointerId: event.pointerId,\n                offsetX: event.clientX - panel.x,\n                offsetY: event.clientY - panel.y,\n                doc: hostDoc,\n                win: hostWin,\n            };\n            activeFloatingDrag.value = dragState;\n            target.setPointerCapture?.(event.pointerId);\n            hostDoc.addEventListener('pointermove', onFloatingDragMove);\n            hostDoc.addEventListener('pointerup', stopFloatingDrag);\n            hostDoc.addEventListener('pointercancel', stopFloatingDrag);\n            hostWin.addEventListener('blur', stopFloatingDrag);\n            panel.x = clampNumber(event.clientX - dragState.offsetX, 8, Math.max(8, hostWin.innerWidth - panel.width - 8));\n            panel.y = clampNumber(event.clientY - dragState.offsetY, 8, Math.max(8, hostWin.innerHeight - rect.height - 8));\n            event.preventDefault();\n        }\n        function onFloatingDragMove(event) {\n            const drag = activeFloatingDrag.value;\n            if (!drag) {\n                return;\n            }\n            if (event.pointerId !== drag.pointerId) {\n                return;\n            }\n            const panel = floatingPanels[drag.key];\n            panel.x = clampNumber(event.clientX - drag.offsetX, 8, Math.max(8, drag.win.innerWidth - panel.width - 8));\n            panel.y = clampNumber(event.clientY - drag.offsetY, 8, Math.max(8, drag.win.innerHeight - 68));\n        }\n        function stopFloatingDrag() {\n            const drag = activeFloatingDrag.value;\n            if (drag) {\n                drag.doc.removeEventListener('pointermove', onFloatingDragMove);\n                drag.doc.removeEventListener('pointerup', stopFloatingDrag);\n                drag.doc.removeEventListener('pointercancel', stopFloatingDrag);\n                drag.win.removeEventListener('blur', stopFloatingDrag);\n            }\n            activeFloatingDrag.value = null;\n        }\n        function clampPaneWidths() {\n            if (isCompactLayout.value) {\n                return;\n            }\n            const mainRect = mainLayoutRef.value?.getBoundingClientRect();\n            if (mainRect) {\n                const maxLeft = Math.max(MAIN_PANE_MIN, Math.floor(mainRect.width - MAIN_EDITOR_MIN - RESIZE_HANDLE_SIZE));\n                mainPaneWidth.value = clampNumber(mainPaneWidth.value, MAIN_PANE_MIN, maxLeft);\n            }\n            const editorRect = editorShellRef.value?.getBoundingClientRect();\n            if (editorRect) {\n                const maxSide = Math.max(EDITOR_SIDE_MIN, Math.floor(editorRect.width - EDITOR_CENTER_MIN - RESIZE_HANDLE_SIZE));\n                editorSideWidth.value = clampNumber(editorSideWidth.value, EDITOR_SIDE_MIN, maxSide);\n            }\n        }\n        function startPaneResize(key, event) {\n            if (isCompactLayout.value) {\n                return;\n            }\n            if (event.pointerType === 'mouse' && event.button !== 0) {\n                return;\n            }\n            const target = event.currentTarget;\n            const hostDoc = target?.ownerDocument ?? document;\n            const hostWin = hostDoc.defaultView ?? window;\n            paneResizeState.value = {\n                key,\n                pointerId: event.pointerId,\n                doc: hostDoc,\n                win: hostWin,\n            };\n            target?.setPointerCapture?.(event.pointerId);\n            hostDoc.addEventListener('pointermove', onPaneResizeMove);\n            hostDoc.addEventListener('pointerup', stopPaneResize);\n            hostDoc.addEventListener('pointercancel', stopPaneResize);\n            hostWin.addEventListener('blur', stopPaneResize);\n            event.preventDefault();\n        }\n        function onPaneResizeMove(event) {\n            const state = paneResizeState.value;\n            if (!state || event.pointerId !== state.pointerId) {\n                return;\n            }\n            if (state.key === 'main') {\n                const rect = mainLayoutRef.value?.getBoundingClientRect();\n                if (!rect) {\n                    return;\n                }\n                const left = Math.floor(event.clientX - rect.left);\n                const maxLeft = Math.max(MAIN_PANE_MIN, Math.floor(rect.width - MAIN_EDITOR_MIN - RESIZE_HANDLE_SIZE));\n                mainPaneWidth.value = clampNumber(left, MAIN_PANE_MIN, maxLeft);\n                return;\n            }\n            const rect = editorShellRef.value?.getBoundingClientRect();\n            if (!rect) {\n                return;\n            }\n            const side = Math.floor(rect.right - event.clientX);\n            const maxSide = Math.max(EDITOR_SIDE_MIN, Math.floor(rect.width - EDITOR_CENTER_MIN - RESIZE_HANDLE_SIZE));\n            editorSideWidth.value = clampNumber(side, EDITOR_SIDE_MIN, maxSide);\n        }\n        function stopPaneResize() {\n            const state = paneResizeState.value;\n            if (state) {\n                state.doc.removeEventListener('pointermove', onPaneResizeMove);\n                state.doc.removeEventListener('pointerup', stopPaneResize);\n                state.doc.removeEventListener('pointercancel', stopPaneResize);\n                state.win.removeEventListener('blur', stopPaneResize);\n            }\n            paneResizeState.value = null;\n        }\n        function onPanelRefresh() {\n            void hardRefresh();\n        }\n        function onPanelSave() {\n            void saveCurrentWorldbook();\n        }\n        onMounted(() => {\n            persistedState.value = readPersistedState();\n            subscriptions.push(eventOn(tavern_events.WORLD_INFO_ACTIVATED, entries => {\n                pushActivationLogs(entries);\n            }));\n            subscriptions.push(eventOn(tavern_events.WORLDINFO_UPDATED, () => {\n                void hardRefresh();\n            }));\n            subscriptions.push(eventOn(tavern_events.CHAT_CHANGED, () => {\n                void (async () => {\n                    await refreshBindings();\n                    if (globalWorldbookMode.value) {\n                        ensureSelectionForGlobalMode();\n                        return;\n                    }\n                    trySelectWorldbookByContext();\n                })();\n            }));\n            window.addEventListener('wb-helper:refresh', onPanelRefresh);\n            window.addEventListener('wb-helper:save', onPanelSave);\n            hostResizeWindow.value = resolveHostWindow();\n            hostResizeWindow.value.addEventListener('resize', handleFloatingWindowResize);\n            handleFloatingWindowResize();\n            void hardRefresh();\n        });\n        onUnmounted(() => {\n            const target = window;\n            target[DIRTY_STATE_KEY] = false;\n            subscriptions.forEach(subscription => {\n                subscription.stop();\n            });\n            stopFloatingDrag();\n            stopPaneResize();\n            window.removeEventListener('wb-helper:refresh', onPanelRefresh);\n            window.removeEventListener('wb-helper:save', onPanelSave);\n            hostResizeWindow.value?.removeEventListener('resize', handleFloatingWindowResize);\n            hostResizeWindow.value = null;\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                _createElementVNode(\"section\", _hoisted_2, [\n                    _createElementVNode(\"label\", _hoisted_3, [\n                        _cache[62] || (_cache[62] = _createTextVNode(\"  \", -1 /* CACHED */)),\n                        _withDirectives(_createElementVNode(\"select\", {\n                            \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => (_isRef(selectedWorldbookName) ? (selectedWorldbookName).value = $event : null)),\n                            class: \"toolbar-select\"\n                        }, [\n                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(selectableWorldbookNames), (name) => {\n                                return (_openBlock(), _createElementBlock(\"option\", {\n                                    key: name,\n                                    value: name\n                                }, _toDisplayString(name), 9 /* TEXT, PROPS */, _hoisted_4));\n                            }), 128 /* KEYED_FRAGMENT */))\n                        ], 512 /* NEED_PATCH */), [\n                            [_vModelSelect, _unref(selectedWorldbookName)]\n                        ])\n                    ]),\n                    _createElementVNode(\"button\", {\n                        class: \"btn\",\n                        type: \"button\",\n                        onClick: createNewWorldbook\n                    }, \"\"),\n                    _createElementVNode(\"button\", {\n                        class: \"btn\",\n                        type: \"button\",\n                        disabled: !_unref(selectedWorldbookName),\n                        onClick: duplicateWorldbook\n                    }, \"  \", 8 /* PROPS */, _hoisted_5),\n                    _createElementVNode(\"button\", {\n                        class: \"btn danger\",\n                        type: \"button\",\n                        disabled: !_unref(selectedWorldbookName),\n                        onClick: deleteCurrentWorldbook\n                    }, \"  \", 8 /* PROPS */, _hoisted_6),\n                    _createElementVNode(\"button\", {\n                        class: \"btn\",\n                        type: \"button\",\n                        disabled: !_unref(selectedWorldbookName),\n                        onClick: exportCurrentWorldbook\n                    }, \"  \", 8 /* PROPS */, _hoisted_7),\n                    _createElementVNode(\"button\", {\n                        class: \"btn\",\n                        type: \"button\",\n                        onClick: triggerImport\n                    }, \"\"),\n                    _createElementVNode(\"input\", {\n                        ref_key: \"importFileInput\",\n                        ref: importFileInput,\n                        class: \"hidden-input\",\n                        type: \"file\",\n                        accept: \".json,application/json\",\n                        onChange: onImportChange\n                    }, null, 544 /* NEED_HYDRATION, NEED_PATCH */)\n                ]),\n                _createElementVNode(\"section\", _hoisted_8, [\n                    _createElementVNode(\"div\", _hoisted_9, [\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"btn history-btn utility-btn\", { active: _unref(globalWorldbookMode) }]),\n                            type: \"button\",\n                            onClick: toggleGlobalMode\n                        }, \"   \", 2 /* CLASS */),\n                        _createElementVNode(\"button\", {\n                            class: \"btn history-btn\",\n                            type: \"button\",\n                            disabled: !_unref(selectedEntry),\n                            onClick: openEntryHistoryModal\n                        }, \"   \", 8 /* PROPS */, _hoisted_10),\n                        _createElementVNode(\"button\", {\n                            class: \"btn history-btn\",\n                            type: \"button\",\n                            disabled: !_unref(selectedWorldbookName),\n                            onClick: openWorldbookHistoryModal\n                        }, \"   \", 8 /* PROPS */, _hoisted_11),\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"btn history-btn utility-btn\", { active: _unref(floatingPanels).find.visible }]),\n                            type: \"button\",\n                            disabled: !_unref(draftEntries).length,\n                            onClick: _cache[1] || (_cache[1] = ($event) => (toggleFloatingPanel('find')))\n                        }, \"   \", 10 /* CLASS, PROPS */, _hoisted_12),\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"btn history-btn utility-btn\", { active: _unref(floatingPanels).clipboard.visible }]),\n                            type: \"button\",\n                            onClick: _cache[2] || (_cache[2] = ($event) => (toggleFloatingPanel('clipboard')))\n                        }, \"   \", 2 /* CLASS */),\n                        _createElementVNode(\"button\", {\n                            class: _normalizeClass([\"btn history-btn utility-btn\", { active: _unref(floatingPanels).activation.visible }]),\n                            type: \"button\",\n                            onClick: _cache[3] || (_cache[3] = ($event) => (toggleFloatingPanel('activation')))\n                        }, \"   \", 2 /* CLASS */)\n                    ]),\n                    (_unref(globalWorldbookMode))\n                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, [\n                            _createElementVNode(\"div\", _hoisted_14, [\n                                _createElementVNode(\"span\", _hoisted_15, \"\" + _toDisplayString(_unref(bindings).global.length) + \"\", 1 /* TEXT */),\n                                _createElementVNode(\"button\", {\n                                    class: \"btn mini danger\",\n                                    type: \"button\",\n                                    disabled: !_unref(bindings).global.length,\n                                    onClick: clearGlobalWorldbooks\n                                }, \"  \", 8 /* PROPS */, _hoisted_16)\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_17, [\n                                _createElementVNode(\"div\", _hoisted_18, [\n                                    _createElementVNode(\"label\", _hoisted_19, [\n                                        _cache[63] || (_cache[63] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[4] || (_cache[4] = ($event) => (_isRef(globalAddSearchText) ? (globalAddSearchText).value = $event : null)),\n                                            type: \"text\",\n                                            class: \"text-input\",\n                                            placeholder: \"...\",\n                                            onKeydown: _withKeys(_withModifiers(addFirstGlobalCandidate, [\"prevent\"]), [\"enter\"])\n                                        }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_20), [\n                                            [_vModelText, _unref(globalAddSearchText)]\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_21, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(globalAddCandidates), (name) => {\n                                            return (_openBlock(), _createElementBlock(\"button\", {\n                                                key: `add-${name}`,\n                                                class: \"global-mode-item add\",\n                                                type: \"button\",\n                                                onClick: ($event) => (addGlobalWorldbook(name))\n                                            }, [\n                                                _createElementVNode(\"span\", _hoisted_23, _toDisplayString(name), 1 /* TEXT */),\n                                                _cache[64] || (_cache[64] = _createElementVNode(\"span\", { class: \"global-mode-item-action\" }, \"\", -1 /* CACHED */))\n                                            ], 8 /* PROPS */, _hoisted_22));\n                                        }), 128 /* KEYED_FRAGMENT */)),\n                                        (!_unref(globalAddCandidates).length)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_24, \"\"))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ])\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_25, [\n                                    _createElementVNode(\"label\", _hoisted_26, [\n                                        _cache[65] || (_cache[65] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[5] || (_cache[5] = ($event) => (_isRef(globalFilterText) ? (globalFilterText).value = $event : null)),\n                                            type: \"text\",\n                                            class: \"text-input\",\n                                            placeholder: \"...\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelText, _unref(globalFilterText)]\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_27, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(filteredGlobalWorldbooks), (name) => {\n                                            return (_openBlock(), _createElementBlock(\"button\", {\n                                                key: `global-${name}`,\n                                                class: \"global-mode-item active\",\n                                                type: \"button\",\n                                                onClick: ($event) => (removeGlobalWorldbook(name))\n                                            }, [\n                                                _createElementVNode(\"span\", _hoisted_29, _toDisplayString(name), 1 /* TEXT */),\n                                                _cache[66] || (_cache[66] = _createElementVNode(\"span\", { class: \"global-mode-item-action\" }, \"\", -1 /* CACHED */))\n                                            ], 8 /* PROPS */, _hoisted_28));\n                                        }), 128 /* KEYED_FRAGMENT */)),\n                                        (!_unref(filteredGlobalWorldbooks).length)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_30, _toDisplayString(_unref(bindings).global.length ? '' : ''), 1 /* TEXT */))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ])\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_31, [\n                                _createElementVNode(\"button\", {\n                                    class: \"btn\",\n                                    type: \"button\",\n                                    disabled: !_unref(selectedWorldbookName),\n                                    onClick: toggleGlobalBinding\n                                }, _toDisplayString(_unref(isGlobalBound) ? '' : ''), 9 /* TEXT, PROPS */, _hoisted_32)\n                            ])\n                        ]))\n                        : _createCommentVNode(\"v-if\", true)\n                ]),\n                _createElementVNode(\"section\", {\n                    ref_key: \"mainLayoutRef\",\n                    ref: mainLayoutRef,\n                    class: \"wb-main-layout\",\n                    style: _normalizeStyle(_unref(mainLayoutStyle))\n                }, [\n                    _createElementVNode(\"aside\", _hoisted_33, [\n                        _createElementVNode(\"div\", _hoisted_34, [\n                            _withDirectives(_createElementVNode(\"input\", {\n                                \"onUpdate:modelValue\": _cache[6] || (_cache[6] = ($event) => (_isRef(searchText) ? (searchText).value = $event : null)),\n                                type: \"text\",\n                                class: \"text-input\",\n                                placeholder: \" /  / \"\n                            }, null, 512 /* NEED_PATCH */), [\n                                [_vModelText, _unref(searchText)]\n                            ]),\n                            _createElementVNode(\"label\", _hoisted_35, [\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[7] || (_cache[7] = ($event) => (_isRef(onlyEnabled) ? (onlyEnabled).value = $event : null)),\n                                    type: \"checkbox\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelCheckbox, _unref(onlyEnabled)]\n                                ]),\n                                _cache[67] || (_cache[67] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n                            ])\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_36, \"  \" + _toDisplayString(_unref(filteredEntries).length) + \" / \" + _toDisplayString(_unref(draftEntries).length) + \" |  \" + _toDisplayString(_unref(enabledEntryCount)), 1 /* TEXT */),\n                        _createElementVNode(\"div\", _hoisted_37, [\n                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(filteredEntries), (entry) => {\n                                return (_openBlock(), _createElementBlock(\"button\", {\n                                    key: entry.uid,\n                                    type: \"button\",\n                                    class: _normalizeClass([\"entry-item\", {\n                                            selected: entry.uid === _unref(selectedEntryUid),\n                                            disabled: !entry.enabled,\n                                        }]),\n                                    \"data-status\": getEntryVisualStatus(entry),\n                                    onClick: ($event) => (selectEntry(entry.uid))\n                                }, [\n                                    _createElementVNode(\"div\", _hoisted_39, [\n                                        _createElementVNode(\"span\", {\n                                            class: \"entry-status-dot\",\n                                            \"data-status\": getEntryVisualStatus(entry)\n                                        }, null, 8 /* PROPS */, _hoisted_40),\n                                        _createElementVNode(\"div\", _hoisted_41, _toDisplayString(entry.name || ` ${entry.uid}`), 1 /* TEXT */),\n                                        _createElementVNode(\"span\", _hoisted_42, \"#\" + _toDisplayString(entry.uid), 1 /* TEXT */)\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_43, [\n                                        _createElementVNode(\"span\", {\n                                            class: \"entry-chip status\",\n                                            \"data-status\": getEntryVisualStatus(entry)\n                                        }, _toDisplayString(getEntryStatusLabel(entry)), 9 /* TEXT, PROPS */, _hoisted_44),\n                                        _createElementVNode(\"span\", _hoisted_45, \" \" + _toDisplayString(entry.strategy.keys.length), 1 /* TEXT */),\n                                        _createElementVNode(\"span\", _hoisted_46, \" \" + _toDisplayString(entry.probability), 1 /* TEXT */),\n                                        _createElementVNode(\"span\", _hoisted_47, \"#\" + _toDisplayString(entry.position.order), 1 /* TEXT */)\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_48, _toDisplayString(getEntryKeyPreview(entry)), 1 /* TEXT */)\n                                ], 10 /* CLASS, PROPS */, _hoisted_38));\n                            }), 128 /* KEYED_FRAGMENT */))\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_49, [\n                            _createElementVNode(\"button\", {\n                                class: \"btn\",\n                                type: \"button\",\n                                disabled: !_unref(selectedWorldbookName),\n                                onClick: addEntry\n                            }, \"\", 8 /* PROPS */, _hoisted_50),\n                            _createElementVNode(\"button\", {\n                                class: \"btn\",\n                                type: \"button\",\n                                disabled: !_unref(selectedEntry),\n                                onClick: duplicateSelectedEntry\n                            }, \"  \", 8 /* PROPS */, _hoisted_51),\n                            _createElementVNode(\"button\", {\n                                class: \"btn danger\",\n                                type: \"button\",\n                                disabled: !_unref(selectedEntry),\n                                onClick: removeSelectedEntry\n                            }, \"  \", 8 /* PROPS */, _hoisted_52),\n                            _createElementVNode(\"button\", {\n                                class: \"btn\",\n                                type: \"button\",\n                                disabled: !_unref(selectedEntry),\n                                onClick: _cache[8] || (_cache[8] = ($event) => (moveSelectedEntry(-1)))\n                            }, \"  \", 8 /* PROPS */, _hoisted_53),\n                            _createElementVNode(\"button\", {\n                                class: \"btn\",\n                                type: \"button\",\n                                disabled: !_unref(selectedEntry),\n                                onClick: _cache[9] || (_cache[9] = ($event) => (moveSelectedEntry(1)))\n                            }, \"\", 8 /* PROPS */, _hoisted_54)\n                        ])\n                    ]),\n                    _createElementVNode(\"div\", {\n                        class: _normalizeClass([\"wb-resize-handle main\", { dragging: _unref(paneResizeState)?.key === 'main' }]),\n                        onPointerdown: _cache[10] || (_cache[10] = ($event) => (startPaneResize('main', $event)))\n                    }, null, 34 /* CLASS, NEED_HYDRATION */),\n                    _createElementVNode(\"main\", _hoisted_55, [\n                        (_unref(selectedEntry))\n                            ? (_openBlock(), _createElementBlock(\"div\", {\n                                key: 0,\n                                ref_key: \"editorShellRef\",\n                                ref: editorShellRef,\n                                class: \"wb-editor-shell\",\n                                style: _normalizeStyle(_unref(editorShellStyle))\n                            }, [\n                                _createElementVNode(\"section\", _hoisted_56, [\n                                    _createElementVNode(\"header\", _hoisted_57, [\n                                        _createElementVNode(\"label\", _hoisted_58, [\n                                            _cache[68] || (_cache[68] = _createElementVNode(\"span\", null, \" (COMMENT)\", -1 /* CACHED */)),\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[11] || (_cache[11] = ($event) => ((_unref(selectedEntry).name) = $event)),\n                                                type: \"text\",\n                                                class: \"text-input\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(selectedEntry).name]\n                                            ])\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_59, [\n                                            _createElementVNode(\"span\", {\n                                                class: _normalizeClass([\"editor-badge\", _unref(selectedEntry).enabled ? 'on' : 'off'])\n                                            }, _toDisplayString(_unref(selectedEntry).enabled ? 'EN' : 'OFF'), 3 /* TEXT, CLASS */),\n                                            _createElementVNode(\"span\", {\n                                                class: \"editor-badge strategy\",\n                                                \"data-status\": getEntryVisualStatus(_unref(selectedEntry))\n                                            }, _toDisplayString(getEntryStatusLabel(_unref(selectedEntry))), 9 /* TEXT, PROPS */, _hoisted_60),\n                                            _createElementVNode(\"span\", _hoisted_61, \"#\" + _toDisplayString(_unref(selectedEntry).uid), 1 /* TEXT */),\n                                            _createElementVNode(\"span\", _hoisted_62, \"Chars \" + _toDisplayString(_unref(selectedContentChars)), 1 /* TEXT */),\n                                            _createElementVNode(\"span\", _hoisted_63, \"~\" + _toDisplayString(_unref(selectedTokenEstimate)) + \"T\", 1 /* TEXT */)\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"section\", _hoisted_64, [\n                                        _createElementVNode(\"label\", _hoisted_65, [\n                                            _cache[69] || (_cache[69] = _createElementVNode(\"span\", null, \" (KEYS)\", -1 /* CACHED */)),\n                                            _withDirectives(_createElementVNode(\"textarea\", {\n                                                \"onUpdate:modelValue\": _cache[12] || (_cache[12] = ($event) => (_isRef(selectedKeysText) ? (selectedKeysText).value = $event : null)),\n                                                class: \"text-area compact\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(selectedKeysText)]\n                                            ])\n                                        ]),\n                                        _createElementVNode(\"label\", _hoisted_66, [\n                                            _cache[70] || (_cache[70] = _createElementVNode(\"span\", null, \" (SECONDARY)\", -1 /* CACHED */)),\n                                            _withDirectives(_createElementVNode(\"textarea\", {\n                                                \"onUpdate:modelValue\": _cache[13] || (_cache[13] = ($event) => (_isRef(selectedSecondaryKeysText) ? (selectedSecondaryKeysText).value = $event : null)),\n                                                class: \"text-area compact\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(selectedSecondaryKeysText)]\n                                            ])\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"section\", _hoisted_67, [\n                                        _cache[71] || (_cache[71] = _createElementVNode(\"div\", { class: \"editor-content-title\" }, \" /  (CONTENT)\", -1 /* CACHED */)),\n                                        _withDirectives(_createElementVNode(\"textarea\", {\n                                            \"onUpdate:modelValue\": _cache[14] || (_cache[14] = ($event) => ((_unref(selectedEntry).content) = $event)),\n                                            class: \"text-area large editor-content-area\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelText, _unref(selectedEntry).content]\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"details\", _hoisted_68, [\n                                        _cache[73] || (_cache[73] = _createElementVNode(\"summary\", null, \" / extra JSON\", -1 /* CACHED */)),\n                                        _createElementVNode(\"label\", _hoisted_69, [\n                                            _cache[72] || (_cache[72] = _createElementVNode(\"span\", null, \"extra JSON\", -1 /* CACHED */)),\n                                            _withDirectives(_createElementVNode(\"textarea\", {\n                                                \"onUpdate:modelValue\": _cache[15] || (_cache[15] = ($event) => (_isRef(selectedExtraText) ? (selectedExtraText).value = $event : null)),\n                                                class: \"text-area compact\",\n                                                placeholder: \"{ ... }\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(selectedExtraText)]\n                                            ])\n                                        ]),\n                                        _createElementVNode(\"div\", { class: \"field-actions\" }, [\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn\",\n                                                type: \"button\",\n                                                onClick: applyExtraJson\n                                            }, \" extra\"),\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn\",\n                                                type: \"button\",\n                                                onClick: clearExtra\n                                            }, \" extra\"),\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn\",\n                                                type: \"button\",\n                                                onClick: copySelectedEntryToClipboard\n                                            }, \"\")\n                                        ])\n                                    ])\n                                ]),\n                                _createElementVNode(\"div\", {\n                                    class: _normalizeClass([\"wb-resize-handle editor\", { dragging: _unref(paneResizeState)?.key === 'editor' }]),\n                                    onPointerdown: _cache[16] || (_cache[16] = ($event) => (startPaneResize('editor', $event)))\n                                }, null, 34 /* CLASS, NEED_HYDRATION */),\n                                _createElementVNode(\"aside\", _hoisted_70, [\n                                    _createElementVNode(\"article\", _hoisted_71, [\n                                        _cache[79] || (_cache[79] = _createElementVNode(\"h4\", null, \" (STRATEGY)\", -1 /* CACHED */)),\n                                        _createElementVNode(\"label\", _hoisted_72, [\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[17] || (_cache[17] = ($event) => ((_unref(selectedEntry).enabled) = $event)),\n                                                type: \"checkbox\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelCheckbox, _unref(selectedEntry).enabled]\n                                            ]),\n                                            _cache[74] || (_cache[74] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_73, [\n                                            _createElementVNode(\"button\", {\n                                                type: \"button\",\n                                                class: _normalizeClass([\"strategy-pill constant\", { active: _unref(selectedEntry).strategy.type === 'constant' }]),\n                                                onClick: _cache[18] || (_cache[18] = ($event) => (_unref(selectedEntry).strategy.type = 'constant'))\n                                            }, \"   (Constant) \", 2 /* CLASS */),\n                                            _createElementVNode(\"button\", {\n                                                type: \"button\",\n                                                class: _normalizeClass([\"strategy-pill vector\", { active: _unref(selectedEntry).strategy.type === 'vectorized' }]),\n                                                onClick: _cache[19] || (_cache[19] = ($event) => (_unref(selectedEntry).strategy.type = 'vectorized'))\n                                            }, \"   (Vector) \", 2 /* CLASS */),\n                                            _createElementVNode(\"button\", {\n                                                type: \"button\",\n                                                class: _normalizeClass([\"strategy-pill selective\", { active: _unref(selectedEntry).strategy.type === 'selective' }]),\n                                                onClick: _cache[20] || (_cache[20] = ($event) => (_unref(selectedEntry).strategy.type = 'selective'))\n                                            }, \"   (Selective) \", 2 /* CLASS */)\n                                        ]),\n                                        _createElementVNode(\"details\", _hoisted_74, [\n                                            _cache[78] || (_cache[78] = _createElementVNode(\"summary\", null, \"\", -1 /* CACHED */)),\n                                            _createElementVNode(\"label\", _hoisted_75, [\n                                                _cache[75] || (_cache[75] = _createElementVNode(\"span\", null, \" (LOGIC)\", -1 /* CACHED */)),\n                                                _withDirectives(_createElementVNode(\"select\", {\n                                                    \"onUpdate:modelValue\": _cache[21] || (_cache[21] = ($event) => ((_unref(selectedEntry).strategy.keys_secondary.logic) = $event)),\n                                                    class: \"text-input\"\n                                                }, [\n                                                    (_openBlock(), _createElementBlock(_Fragment, null, _renderList(secondaryLogicOptions, (item) => {\n                                                        return _createElementVNode(\"option\", {\n                                                            key: item,\n                                                            value: item\n                                                        }, _toDisplayString(getSecondaryLogicLabel(item)), 9 /* TEXT, PROPS */, _hoisted_76);\n                                                    }), 64 /* STABLE_FRAGMENT */))\n                                                ], 512 /* NEED_PATCH */), [\n                                                    [_vModelSelect, _unref(selectedEntry).strategy.keys_secondary.logic]\n                                                ])\n                                            ]),\n                                            _createElementVNode(\"label\", _hoisted_77, [\n                                                _cache[76] || (_cache[76] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                                _withDirectives(_createElementVNode(\"input\", {\n                                                    \"onUpdate:modelValue\": _cache[22] || (_cache[22] = ($event) => (_isRef(selectedScanDepthText) ? (selectedScanDepthText).value = $event : null)),\n                                                    type: \"text\",\n                                                    class: \"text-input\",\n                                                    placeholder: \" same_as_global\"\n                                                }, null, 512 /* NEED_PATCH */), [\n                                                    [_vModelText, _unref(selectedScanDepthText)]\n                                                ])\n                                            ]),\n                                            _createElementVNode(\"label\", _hoisted_78, [\n                                                _cache[77] || (_cache[77] = _createElementVNode(\"span\", null, \"(0-100)\", -1 /* CACHED */)),\n                                                _withDirectives(_createElementVNode(\"input\", {\n                                                    \"onUpdate:modelValue\": _cache[23] || (_cache[23] = ($event) => ((_unref(selectedEntry).probability) = $event)),\n                                                    type: \"number\",\n                                                    class: \"text-input\",\n                                                    min: \"0\",\n                                                    max: \"100\",\n                                                    step: \"1\"\n                                                }, null, 512 /* NEED_PATCH */), [\n                                                    [\n                                                        _vModelText,\n                                                        _unref(selectedEntry).probability,\n                                                        void 0,\n                                                        { number: true }\n                                                    ]\n                                                ])\n                                            ])\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"article\", _hoisted_79, [\n                                        _cache[85] || (_cache[85] = _createElementVNode(\"h4\", null, \" (INSERTION)\", -1 /* CACHED */)),\n                                        _createElementVNode(\"label\", _hoisted_80, [\n                                            _cache[80] || (_cache[80] = _createElementVNode(\"span\", null, \" (Position)\", -1 /* CACHED */)),\n                                            _withDirectives(_createElementVNode(\"select\", {\n                                                \"onUpdate:modelValue\": _cache[24] || (_cache[24] = ($event) => ((_unref(selectedEntry).position.type) = $event)),\n                                                class: \"text-input\",\n                                                onChange: handleSelectedPositionTypeChanged\n                                            }, [\n                                                (_openBlock(), _createElementBlock(_Fragment, null, _renderList(positionTypeOptions, (item) => {\n                                                    return _createElementVNode(\"option\", {\n                                                        key: item,\n                                                        value: item\n                                                    }, _toDisplayString(getPositionTypeLabel(item)), 9 /* TEXT, PROPS */, _hoisted_81);\n                                                }), 64 /* STABLE_FRAGMENT */))\n                                            ], 544 /* NEED_HYDRATION, NEED_PATCH */), [\n                                                [_vModelSelect, _unref(selectedEntry).position.type]\n                                            ])\n                                        ]),\n                                        _createElementVNode(\"label\", _hoisted_82, [\n                                            _cache[81] || (_cache[81] = _createElementVNode(\"span\", null, \" (Order)\", -1 /* CACHED */)),\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[25] || (_cache[25] = ($event) => ((_unref(selectedEntry).position.order) = $event)),\n                                                type: \"number\",\n                                                class: \"text-input\",\n                                                step: \"1\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [\n                                                    _vModelText,\n                                                    _unref(selectedEntry).position.order,\n                                                    void 0,\n                                                    { number: true }\n                                                ]\n                                            ])\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_83, [\n                                            _createElementVNode(\"label\", {\n                                                class: _normalizeClass([\"field\", { disabled: _unref(selectedEntry).position.type !== 'at_depth' }])\n                                            }, [\n                                                _cache[83] || (_cache[83] = _createElementVNode(\"span\", null, \"at_depth role\", -1 /* CACHED */)),\n                                                _withDirectives(_createElementVNode(\"select\", {\n                                                    \"onUpdate:modelValue\": _cache[26] || (_cache[26] = ($event) => ((_unref(selectedEntry).position.role) = $event)),\n                                                    class: \"text-input\",\n                                                    disabled: _unref(selectedEntry).position.type !== 'at_depth'\n                                                }, [...(_cache[82] || (_cache[82] = [\n                                                        _createElementVNode(\"option\", { value: \"system\" }, \"system\", -1 /* CACHED */),\n                                                        _createElementVNode(\"option\", { value: \"assistant\" }, \"assistant\", -1 /* CACHED */),\n                                                        _createElementVNode(\"option\", { value: \"user\" }, \"user\", -1 /* CACHED */)\n                                                    ]))], 8 /* PROPS */, _hoisted_84), [\n                                                    [_vModelSelect, _unref(selectedEntry).position.role]\n                                                ])\n                                            ], 2 /* CLASS */),\n                                            _createElementVNode(\"label\", {\n                                                class: _normalizeClass([\"field\", { disabled: _unref(selectedEntry).position.type !== 'at_depth' }])\n                                            }, [\n                                                _cache[84] || (_cache[84] = _createElementVNode(\"span\", null, \"at_depth depth\", -1 /* CACHED */)),\n                                                _withDirectives(_createElementVNode(\"input\", {\n                                                    \"onUpdate:modelValue\": _cache[27] || (_cache[27] = ($event) => ((_unref(selectedEntry).position.depth) = $event)),\n                                                    type: \"number\",\n                                                    class: \"text-input\",\n                                                    min: \"1\",\n                                                    step: \"1\",\n                                                    disabled: _unref(selectedEntry).position.type !== 'at_depth'\n                                                }, null, 8 /* PROPS */, _hoisted_85), [\n                                                    [\n                                                        _vModelText,\n                                                        _unref(selectedEntry).position.depth,\n                                                        void 0,\n                                                        { number: true }\n                                                    ]\n                                                ])\n                                            ], 2 /* CLASS */)\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"article\", _hoisted_86, [\n                                        _cache[92] || (_cache[92] = _createElementVNode(\"h4\", null, \" (RECURSION)\", -1 /* CACHED */)),\n                                        _createElementVNode(\"label\", _hoisted_87, [\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[28] || (_cache[28] = ($event) => ((_unref(selectedEntry).recursion.prevent_incoming) = $event)),\n                                                type: \"checkbox\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelCheckbox, _unref(selectedEntry).recursion.prevent_incoming]\n                                            ]),\n                                            _cache[86] || (_cache[86] = _createElementVNode(\"span\", null, \" (Exclude Incoming)\", -1 /* CACHED */))\n                                        ]),\n                                        _createElementVNode(\"label\", _hoisted_88, [\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[29] || (_cache[29] = ($event) => ((_unref(selectedEntry).recursion.prevent_outgoing) = $event)),\n                                                type: \"checkbox\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelCheckbox, _unref(selectedEntry).recursion.prevent_outgoing]\n                                            ]),\n                                            _cache[87] || (_cache[87] = _createElementVNode(\"span\", null, \" (Prevent Outgoing)\", -1 /* CACHED */))\n                                        ]),\n                                        _createElementVNode(\"label\", _hoisted_89, [\n                                            _cache[88] || (_cache[88] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[30] || (_cache[30] = ($event) => (_isRef(selectedRecursionDelayText) ? (selectedRecursionDelayText).value = $event : null)),\n                                                type: \"text\",\n                                                class: \"text-input\",\n                                                placeholder: \" null\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(selectedRecursionDelayText)]\n                                            ])\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_90, [\n                                            _createElementVNode(\"label\", _hoisted_91, [\n                                                _cache[89] || (_cache[89] = _createElementVNode(\"span\", null, \"sticky\", -1 /* CACHED */)),\n                                                _withDirectives(_createElementVNode(\"input\", {\n                                                    \"onUpdate:modelValue\": _cache[31] || (_cache[31] = ($event) => (_isRef(selectedStickyText) ? (selectedStickyText).value = $event : null)),\n                                                    type: \"text\",\n                                                    class: \"text-input\",\n                                                    placeholder: \" null\"\n                                                }, null, 512 /* NEED_PATCH */), [\n                                                    [_vModelText, _unref(selectedStickyText)]\n                                                ])\n                                            ]),\n                                            _createElementVNode(\"label\", _hoisted_92, [\n                                                _cache[90] || (_cache[90] = _createElementVNode(\"span\", null, \"cooldown\", -1 /* CACHED */)),\n                                                _withDirectives(_createElementVNode(\"input\", {\n                                                    \"onUpdate:modelValue\": _cache[32] || (_cache[32] = ($event) => (_isRef(selectedCooldownText) ? (selectedCooldownText).value = $event : null)),\n                                                    type: \"text\",\n                                                    class: \"text-input\",\n                                                    placeholder: \" null\"\n                                                }, null, 512 /* NEED_PATCH */), [\n                                                    [_vModelText, _unref(selectedCooldownText)]\n                                                ])\n                                            ])\n                                        ]),\n                                        _createElementVNode(\"label\", _hoisted_93, [\n                                            _cache[91] || (_cache[91] = _createElementVNode(\"span\", null, \"delay\", -1 /* CACHED */)),\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[33] || (_cache[33] = ($event) => (_isRef(selectedEffectDelayText) ? (selectedEffectDelayText).value = $event : null)),\n                                                type: \"text\",\n                                                class: \"text-input\",\n                                                placeholder: \" null\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelText, _unref(selectedEffectDelayText)]\n                                            ])\n                                        ])\n                                    ])\n                                ])\n                            ], 4 /* STYLE */))\n                            : (_openBlock(), _createElementBlock(\"div\", _hoisted_94, \"\"))\n                    ])\n                ], 4 /* STYLE */),\n                _createElementVNode(\"footer\", _hoisted_95, [\n                    _createElementVNode(\"span\", null, _toDisplayString(_unref(isBusy) ? '...' : _unref(statusMessage)), 1 /* TEXT */),\n                    _createElementVNode(\"span\", null, \" : \" + _toDisplayString(_unref(draftEntries).length) + \" | : \" + _toDisplayString(_unref(totalContentChars)) + \" | \" + _toDisplayString(_unref(hasUnsavedChanges) ? '' : ''), 1 /* TEXT */)\n                ]),\n                (_unref(showEntryHistoryModal))\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 0,\n                        class: \"wb-modal-backdrop\",\n                        onClick: _cache[35] || (_cache[35] = _withModifiers(($event) => (showEntryHistoryModal.value = false), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_96, [\n                            _createElementVNode(\"div\", _hoisted_97, [\n                                _createElementVNode(\"div\", null, [\n                                    _cache[93] || (_cache[93] = _createElementVNode(\"strong\", null, \" \", -1 /* CACHED */)),\n                                    _createElementVNode(\"span\", null, _toDisplayString(_unref(entryHistorySummary)), 1 /* TEXT */)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_98, [\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn mini\",\n                                        type: \"button\",\n                                        disabled: !_unref(selectedEntry),\n                                        onClick: createManualEntrySnapshot\n                                    }, \"  \", 8 /* PROPS */, _hoisted_99),\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn mini danger\",\n                                        type: \"button\",\n                                        disabled: !_unref(entrySnapshotsForSelected).length,\n                                        onClick: clearCurrentEntrySnapshots\n                                    }, \"  \", 8 /* PROPS */, _hoisted_100),\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn mini\",\n                                        type: \"button\",\n                                        onClick: _cache[34] || (_cache[34] = ($event) => (showEntryHistoryModal.value = false))\n                                    }, \"\")\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_101, [\n                                _createElementVNode(\"aside\", _hoisted_102, [\n                                    _cache[94] || (_cache[94] = _createElementVNode(\"div\", { class: \"wb-history-versions-title\" }, \"L/R\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_103, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(entryVersionViews), (ver) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: ver.id,\n                                                class: \"wb-history-version-item\"\n                                            }, [\n                                                _createElementVNode(\"div\", _hoisted_104, [\n                                                    _createElementVNode(\"strong\", null, _toDisplayString(formatHistoryOptionLabel(ver.label, ver.ts, ver.isCurrent)), 1 /* TEXT */),\n                                                    _createElementVNode(\"div\", _hoisted_105, [\n                                                        _createElementVNode(\"button\", {\n                                                            class: _normalizeClass([\"mini-lr\", { active: _unref(entryHistoryLeftId) === ver.id }]),\n                                                            onClick: ($event) => (entryHistoryLeftId.value = ver.id)\n                                                        }, \"L\", 10 /* CLASS, PROPS */, _hoisted_106),\n                                                        _createElementVNode(\"button\", {\n                                                            class: _normalizeClass([\"mini-lr\", { active: _unref(entryHistoryRightId) === ver.id }]),\n                                                            onClick: ($event) => (entryHistoryRightId.value = ver.id)\n                                                        }, \"R\", 10 /* CLASS, PROPS */, _hoisted_107)\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"span\", null, _toDisplayString(ver.name), 1 /* TEXT */)\n                                            ]));\n                                        }), 128 /* KEYED_FRAGMENT */)),\n                                        (_unref(entryVersionViews).length <= 1)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_108, \"\"))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ])\n                                ]),\n                                _createElementVNode(\"section\", _hoisted_109, [\n                                    _createElementVNode(\"div\", _hoisted_110, [\n                                        _createElementVNode(\"div\", null, \" Left: \" + _toDisplayString(_unref(selectedEntryHistoryLeft) ? formatHistoryOptionLabel(_unref(selectedEntryHistoryLeft).label, _unref(selectedEntryHistoryLeft).ts, _unref(selectedEntryHistoryLeft).isCurrent) : '-') + \" | Right: \" + _toDisplayString(_unref(selectedEntryHistoryRight) ? formatHistoryOptionLabel(_unref(selectedEntryHistoryRight).label, _unref(selectedEntryHistoryRight).ts, _unref(selectedEntryHistoryRight).isCurrent) : '-'), 1 /* TEXT */),\n                                        _createElementVNode(\"button\", {\n                                            class: \"btn mini\",\n                                            type: \"button\",\n                                            disabled: !_unref(canRestoreEntryFromLeft),\n                                            onClick: restoreEntryFromLeftHistory\n                                        }, \"  Left \", 8 /* PROPS */, _hoisted_111)\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_112, [\n                                        _createElementVNode(\"div\", null, [\n                                            _cache[95] || (_cache[95] = _createElementVNode(\"div\", { class: \"wb-history-diff-title\" }, \"Left\", -1 /* CACHED */)),\n                                            _createElementVNode(\"div\", {\n                                                class: \"wb-history-diff-body\",\n                                                innerHTML: _unref(entryHistoryDiff).leftHtml\n                                            }, null, 8 /* PROPS */, _hoisted_113)\n                                        ]),\n                                        _createElementVNode(\"div\", null, [\n                                            _cache[96] || (_cache[96] = _createElementVNode(\"div\", { class: \"wb-history-diff-title\" }, \"Right\", -1 /* CACHED */)),\n                                            _createElementVNode(\"div\", {\n                                                class: \"wb-history-diff-body\",\n                                                innerHTML: _unref(entryHistoryDiff).rightHtml\n                                            }, null, 8 /* PROPS */, _hoisted_114)\n                                        ])\n                                    ])\n                                ])\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (_unref(showWorldbookHistoryModal))\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 1,\n                        class: \"wb-modal-backdrop\",\n                        onClick: _cache[37] || (_cache[37] = _withModifiers(($event) => (showWorldbookHistoryModal.value = false), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_115, [\n                            _createElementVNode(\"div\", _hoisted_116, [\n                                _createElementVNode(\"div\", null, [\n                                    _cache[97] || (_cache[97] = _createElementVNode(\"strong\", null, \" \", -1 /* CACHED */)),\n                                    _createElementVNode(\"span\", null, _toDisplayString(getWorldbookVersionDiffSummary(_unref(selectedWorldbookHistoryLeft), _unref(selectedWorldbookHistoryRight))), 1 /* TEXT */)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_117, [\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn mini\",\n                                        type: \"button\",\n                                        disabled: !_unref(selectedWorldbookName),\n                                        onClick: createManualSnapshot\n                                    }, \"  \", 8 /* PROPS */, _hoisted_118),\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn mini danger\",\n                                        type: \"button\",\n                                        disabled: !_unref(snapshotsForCurrent).length,\n                                        onClick: clearCurrentSnapshots\n                                    }, \"  \", 8 /* PROPS */, _hoisted_119),\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn mini\",\n                                        type: \"button\",\n                                        onClick: _cache[36] || (_cache[36] = ($event) => (showWorldbookHistoryModal.value = false))\n                                    }, \"\")\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_120, [\n                                _createElementVNode(\"aside\", _hoisted_121, [\n                                    _cache[98] || (_cache[98] = _createElementVNode(\"div\", { class: \"wb-history-versions-title\" }, \"L/R\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_122, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(worldbookVersionViews), (ver) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: ver.id,\n                                                class: \"wb-history-version-item\"\n                                            }, [\n                                                _createElementVNode(\"div\", _hoisted_123, [\n                                                    _createElementVNode(\"strong\", null, _toDisplayString(formatHistoryOptionLabel(ver.label, ver.ts, ver.isCurrent)), 1 /* TEXT */),\n                                                    _createElementVNode(\"div\", _hoisted_124, [\n                                                        _createElementVNode(\"button\", {\n                                                            class: _normalizeClass([\"mini-lr\", { active: _unref(worldbookHistoryLeftId) === ver.id }]),\n                                                            onClick: ($event) => (worldbookHistoryLeftId.value = ver.id)\n                                                        }, \"L\", 10 /* CLASS, PROPS */, _hoisted_125),\n                                                        _createElementVNode(\"button\", {\n                                                            class: _normalizeClass([\"mini-lr\", { active: _unref(worldbookHistoryRightId) === ver.id }]),\n                                                            onClick: ($event) => (worldbookHistoryRightId.value = ver.id)\n                                                        }, \"R\", 10 /* CLASS, PROPS */, _hoisted_126)\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"span\", null, \"entries: \" + _toDisplayString(ver.entries.length), 1 /* TEXT */)\n                                            ]));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ])\n                                ]),\n                                _createElementVNode(\"section\", _hoisted_127, [\n                                    _createElementVNode(\"div\", _hoisted_128, [\n                                        _createElementVNode(\"div\", null, \" Left: \" + _toDisplayString(_unref(selectedWorldbookHistoryLeft) ? formatHistoryOptionLabel(_unref(selectedWorldbookHistoryLeft).label, _unref(selectedWorldbookHistoryLeft).ts, _unref(selectedWorldbookHistoryLeft).isCurrent) : '-') + \" | Right: \" + _toDisplayString(_unref(selectedWorldbookHistoryRight) ? formatHistoryOptionLabel(_unref(selectedWorldbookHistoryRight).label, _unref(selectedWorldbookHistoryRight).ts, _unref(selectedWorldbookHistoryRight).isCurrent) : '-'), 1 /* TEXT */),\n                                        _createElementVNode(\"button\", {\n                                            class: \"btn mini\",\n                                            type: \"button\",\n                                            disabled: !_unref(canRestoreWorldbookFromLeft),\n                                            onClick: restoreWorldbookFromLeftHistory\n                                        }, \"  Left \", 8 /* PROPS */, _hoisted_129)\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_130, [\n                                        _createElementVNode(\"div\", null, [\n                                            _cache[99] || (_cache[99] = _createElementVNode(\"div\", { class: \"wb-history-diff-title\" }, \"Left\", -1 /* CACHED */)),\n                                            _createElementVNode(\"div\", {\n                                                class: \"wb-history-diff-body\",\n                                                innerHTML: _unref(worldbookHistoryDiff).leftHtml\n                                            }, null, 8 /* PROPS */, _hoisted_131)\n                                        ]),\n                                        _createElementVNode(\"div\", null, [\n                                            _cache[100] || (_cache[100] = _createElementVNode(\"div\", { class: \"wb-history-diff-title\" }, \"Right\", -1 /* CACHED */)),\n                                            _createElementVNode(\"div\", {\n                                                class: \"wb-history-diff-body\",\n                                                innerHTML: _unref(worldbookHistoryDiff).rightHtml\n                                            }, null, 8 /* PROPS */, _hoisted_132)\n                                        ])\n                                    ])\n                                ])\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (_unref(floatingPanels).find.visible)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 2,\n                        class: \"wb-floating-window find-window\",\n                        style: _normalizeStyle(getFloatingPanelStyle('find')),\n                        onPointerdown: _cache[51] || (_cache[51] = ($event) => (bringFloatingToFront('find')))\n                    }, [\n                        _createElementVNode(\"div\", {\n                            class: \"wb-floating-header\",\n                            onPointerdown: _cache[41] || (_cache[41] = ($event) => (startFloatingDrag('find', $event)))\n                        }, [\n                            _cache[101] || (_cache[101] = _createElementVNode(\"strong\", null, \" \", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_133, [\n                                _createElementVNode(\"button\", {\n                                    class: \"btn mini\",\n                                    type: \"button\",\n                                    disabled: !_unref(draftEntries).length,\n                                    onPointerdown: _cache[38] || (_cache[38] = _withModifiers(() => { }, [\"stop\"])),\n                                    onClick: applyBatchReplace\n                                }, \"  \", 40 /* PROPS, NEED_HYDRATION */, _hoisted_134),\n                                _createElementVNode(\"button\", {\n                                    class: \"btn mini danger\",\n                                    type: \"button\",\n                                    onPointerdown: _cache[39] || (_cache[39] = _withModifiers(() => { }, [\"stop\"])),\n                                    onClick: _cache[40] || (_cache[40] = ($event) => (closeFloatingPanel('find')))\n                                }, \"  \", 32 /* NEED_HYDRATION */)\n                            ])\n                        ], 32 /* NEED_HYDRATION */),\n                        _createElementVNode(\"div\", _hoisted_135, [\n                            _createElementVNode(\"div\", _hoisted_136, [\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[42] || (_cache[42] = ($event) => (_isRef(batchFindText) ? (batchFindText).value = $event : null)),\n                                    type: \"text\",\n                                    class: \"text-input\",\n                                    placeholder: \" / \"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, _unref(batchFindText)]\n                                ]),\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[43] || (_cache[43] = ($event) => (_isRef(batchReplaceText) ? (batchReplaceText).value = $event : null)),\n                                    type: \"text\",\n                                    class: \"text-input\",\n                                    placeholder: \"\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, _unref(batchReplaceText)]\n                                ]),\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[44] || (_cache[44] = ($event) => (_isRef(batchExcludeText) ? (batchExcludeText).value = $event : null)),\n                                    type: \"text\",\n                                    class: \"text-input\",\n                                    placeholder: \" / #UID\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, _unref(batchExcludeText)]\n                                ]),\n                                _cache[106] || (_cache[106] = _createElementVNode(\"div\", { class: \"batch-exclude-note\" }, \": `#12, name:, `\", -1 /* CACHED */)),\n                                (_unref(batchExcludeTokensPreview).length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_137, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(batchExcludeTokensPreview), (token) => {\n                                            return (_openBlock(), _createElementBlock(\"span\", {\n                                                key: token,\n                                                class: \"exclude-chip\"\n                                            }, _toDisplayString(token), 1 /* TEXT */));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ]))\n                                    : _createCommentVNode(\"v-if\", true),\n                                _createElementVNode(\"div\", _hoisted_138, [\n                                    _createElementVNode(\"label\", _hoisted_139, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[45] || (_cache[45] = ($event) => (_isRef(batchUseRegex) ? (batchUseRegex).value = $event : null)),\n                                            type: \"checkbox\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelCheckbox, _unref(batchUseRegex)]\n                                        ]),\n                                        _cache[102] || (_cache[102] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n                                    ]),\n                                    _createElementVNode(\"label\", _hoisted_140, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[46] || (_cache[46] = ($event) => (_isRef(batchInName) ? (batchInName).value = $event : null)),\n                                            type: \"checkbox\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelCheckbox, _unref(batchInName)]\n                                        ]),\n                                        _cache[103] || (_cache[103] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n                                    ]),\n                                    _createElementVNode(\"label\", _hoisted_141, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[47] || (_cache[47] = ($event) => (_isRef(batchInContent) ? (batchInContent).value = $event : null)),\n                                            type: \"checkbox\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelCheckbox, _unref(batchInContent)]\n                                        ]),\n                                        _cache[104] || (_cache[104] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n                                    ]),\n                                    _createElementVNode(\"label\", _hoisted_142, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[48] || (_cache[48] = ($event) => (_isRef(batchInKeys) ? (batchInKeys).value = $event : null)),\n                                            type: \"checkbox\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelCheckbox, _unref(batchInKeys)]\n                                        ]),\n                                        _cache[105] || (_cache[105] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n                                    ])\n                                ])\n                            ]),\n                            _createElementVNode(\"details\", _hoisted_143, [\n                                _cache[107] || (_cache[107] = _createElementVNode(\"summary\", null, \"\", -1 /* CACHED */)),\n                                _createElementVNode(\"div\", _hoisted_144, [\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn\",\n                                        type: \"button\",\n                                        disabled: !_unref(draftEntries).length,\n                                        onClick: normalizeAllEntries\n                                    }, \"  \", 8 /* PROPS */, _hoisted_145),\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn\",\n                                        type: \"button\",\n                                        disabled: !_unref(draftEntries).length,\n                                        onClick: sortEntriesByOrderDesc\n                                    }, \"  order  \", 8 /* PROPS */, _hoisted_146)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_147, [\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn\",\n                                        type: \"button\",\n                                        disabled: !_unref(draftEntries).length,\n                                        onClick: _cache[49] || (_cache[49] = ($event) => (setEnabledForAll(true)))\n                                    }, \"  \", 8 /* PROPS */, _hoisted_148),\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn\",\n                                        type: \"button\",\n                                        disabled: !_unref(draftEntries).length,\n                                        onClick: _cache[50] || (_cache[50] = ($event) => (setEnabledForAll(false)))\n                                    }, \"  \", 8 /* PROPS */, _hoisted_149)\n                                ])\n                            ])\n                        ])\n                    ], 36 /* STYLE, NEED_HYDRATION */))\n                    : _createCommentVNode(\"v-if\", true),\n                (_unref(floatingPanels).clipboard.visible)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 3,\n                        class: \"wb-floating-window clipboard-window\",\n                        style: _normalizeStyle(getFloatingPanelStyle('clipboard')),\n                        onPointerdown: _cache[56] || (_cache[56] = ($event) => (bringFloatingToFront('clipboard')))\n                    }, [\n                        _createElementVNode(\"div\", {\n                            class: \"wb-floating-header\",\n                            onPointerdown: _cache[55] || (_cache[55] = ($event) => (startFloatingDrag('clipboard', $event)))\n                        }, [\n                            _cache[108] || (_cache[108] = _createElementVNode(\"strong\", null, \" \", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_150, [\n                                _createElementVNode(\"button\", {\n                                    class: \"btn mini danger\",\n                                    type: \"button\",\n                                    disabled: !_unref(clipboardItems).length,\n                                    onPointerdown: _cache[52] || (_cache[52] = _withModifiers(() => { }, [\"stop\"])),\n                                    onClick: clearClipboard\n                                }, \"  \", 40 /* PROPS, NEED_HYDRATION */, _hoisted_151),\n                                _createElementVNode(\"button\", {\n                                    class: \"btn mini danger\",\n                                    type: \"button\",\n                                    onPointerdown: _cache[53] || (_cache[53] = _withModifiers(() => { }, [\"stop\"])),\n                                    onClick: _cache[54] || (_cache[54] = ($event) => (closeFloatingPanel('clipboard')))\n                                }, \"  \", 32 /* NEED_HYDRATION */)\n                            ])\n                        ], 32 /* NEED_HYDRATION */),\n                        _createElementVNode(\"div\", _hoisted_152, [\n                            _createElementVNode(\"div\", _hoisted_153, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(clipboardItems), (item) => {\n                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                        key: item.id,\n                                        class: \"tool-list-item\"\n                                    }, [\n                                        _createElementVNode(\"div\", _hoisted_154, [\n                                            _createElementVNode(\"strong\", null, _toDisplayString(item.name || ''), 1 /* TEXT */),\n                                            _createElementVNode(\"span\", null, _toDisplayString(formatDateTime(item.copied_at)), 1 /* TEXT */)\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_155, [\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn mini\",\n                                                type: \"button\",\n                                                disabled: !_unref(selectedWorldbookName),\n                                                onClick: ($event) => (pasteClipboardItem(item.id))\n                                            }, \"  \", 8 /* PROPS */, _hoisted_156),\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn mini danger\",\n                                                type: \"button\",\n                                                onClick: ($event) => (deleteClipboardItem(item.id))\n                                            }, \"\", 8 /* PROPS */, _hoisted_157)\n                                        ])\n                                    ]));\n                                }), 128 /* KEYED_FRAGMENT */)),\n                                (!_unref(clipboardItems).length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_158, \"\"))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ])\n                        ])\n                    ], 36 /* STYLE, NEED_HYDRATION */))\n                    : _createCommentVNode(\"v-if\", true),\n                (_unref(floatingPanels).activation.visible)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 4,\n                        class: \"wb-floating-window activation-window\",\n                        style: _normalizeStyle(getFloatingPanelStyle('activation')),\n                        onPointerdown: _cache[61] || (_cache[61] = ($event) => (bringFloatingToFront('activation')))\n                    }, [\n                        _createElementVNode(\"div\", {\n                            class: \"wb-floating-header\",\n                            onPointerdown: _cache[60] || (_cache[60] = ($event) => (startFloatingDrag('activation', $event)))\n                        }, [\n                            _cache[109] || (_cache[109] = _createElementVNode(\"strong\", null, \" WORLD_INFO_ACTIVATED\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_159, [\n                                _createElementVNode(\"button\", {\n                                    class: \"btn mini danger\",\n                                    type: \"button\",\n                                    disabled: !_unref(activationLogs).length,\n                                    onPointerdown: _cache[57] || (_cache[57] = _withModifiers(() => { }, [\"stop\"])),\n                                    onClick: clearActivationLogs\n                                }, \"  \", 40 /* PROPS, NEED_HYDRATION */, _hoisted_160),\n                                _createElementVNode(\"button\", {\n                                    class: \"btn mini danger\",\n                                    type: \"button\",\n                                    onPointerdown: _cache[58] || (_cache[58] = _withModifiers(() => { }, [\"stop\"])),\n                                    onClick: _cache[59] || (_cache[59] = ($event) => (closeFloatingPanel('activation')))\n                                }, \"  \", 32 /* NEED_HYDRATION */)\n                            ])\n                        ], 32 /* NEED_HYDRATION */),\n                        _createElementVNode(\"div\", _hoisted_161, [\n                            _createElementVNode(\"div\", _hoisted_162, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(activationLogs), (log) => {\n                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                        key: log.id,\n                                        class: \"activation-item\"\n                                    }, [\n                                        _createElementVNode(\"div\", _hoisted_163, [\n                                            _createElementVNode(\"strong\", null, _toDisplayString(log.world), 1 /* TEXT */),\n                                            _createElementVNode(\"span\", null, \"#\" + _toDisplayString(log.uid) + \"  \" + _toDisplayString(log.name), 1 /* TEXT */)\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_164, [\n                                            _createElementVNode(\"span\", null, _toDisplayString(formatDateTime(log.time)), 1 /* TEXT */),\n                                            _createElementVNode(\"span\", null, _toDisplayString(log.contentPreview), 1 /* TEXT */)\n                                        ])\n                                    ]));\n                                }), 128 /* KEYED_FRAGMENT */)),\n                                (!_unref(activationLogs).length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_165, \"\"))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ])\n                        ])\n                    ], 36 /* STYLE, NEED_HYDRATION */))\n                    : _createCommentVNode(\"v-if\", true)\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./App.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=2f8c74d2&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_71d7740e7607e74f4d732110d38a3681/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-2f8c74d2\"]])\n\nexport default __exports__","import { createApp, type App as VueApp } from 'vue';\nimport { createScriptIdDiv, teleportStyle } from '@util/script';\nimport WorldbookAssistantApp from './App.vue';\n\nconst MENU_ID = 'wb-assistant-menu-item';\nconst PANEL_ID = 'wb-assistant-panel';\nconst PANEL_STYLE_ID = 'wb-assistant-panel-style';\nconst PANEL_BODY_ID = 'wb-assistant-panel-body';\nconst EVENT_NS = '.wbAssistantMenu';\nconst DIRTY_STATE_KEY = '__WB_ASSISTANT_HAS_UNSAVED_CHANGES__';\n\nlet app: VueApp<Element> | null = null;\nlet panelRoot: JQuery<HTMLDivElement> | null = null;\nlet destroyTeleport: (() => void) | null = null;\nlet menuObserver: MutationObserver | null = null;\nlet menuRetryTimer: number | null = null;\nlet isPanelVisible = false;\n\nfunction getHostWindow(): Window {\n  return window.parent || window;\n}\n\nfunction getHostDocument(): Document {\n  return getHostWindow().document;\n}\n\nfunction ensurePanelStyle(): void {\n  const doc = getHostDocument();\n  if (doc.getElementById(PANEL_STYLE_ID)) {\n    return;\n  }\n  const style = doc.createElement('style');\n  style.id = PANEL_STYLE_ID;\n  style.textContent = `\n#${PANEL_ID} {\n  position: fixed;\n  z-index: 10020;\n  left: 60px;\n  top: 8px;\n  width: min(1280px, calc(100vw - 120px));\n  height: calc(100vh - 16px);\n  min-width: 920px;\n  min-height: 560px;\n  max-width: calc(100vw - 16px);\n  max-height: calc(100vh - 16px);\n  display: none;\n  border: 1px solid #334155;\n  border-radius: 10px;\n  background: #0b1220;\n  box-shadow: 0 16px 48px rgba(0, 0, 0, 0.45);\n  overflow: hidden;\n  resize: both;\n}\n\n#${PANEL_ID}.active {\n  display: flex;\n  flex-direction: column;\n}\n\n#${PANEL_ID} .wb-assistant-header {\n  height: 44px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0 10px 0 12px;\n  background: #111827;\n  border-bottom: 1px solid #334155;\n  cursor: move;\n  user-select: none;\n}\n\n#${PANEL_ID} .wb-assistant-header-title {\n  color: #e2e8f0;\n  font-size: 14px;\n  font-weight: 600;\n}\n\n#${PANEL_ID} .wb-assistant-header-actions {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n}\n\n#${PANEL_ID} .wb-assistant-tool {\n  width: 30px;\n  height: 30px;\n  border: 1px solid #475569;\n  border-radius: 6px;\n  background: #1f2937;\n  color: #e2e8f0;\n  cursor: pointer;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 14px;\n}\n\n#${PANEL_ID} .wb-assistant-tool:hover {\n  border-color: #22d3ee;\n}\n\n#${PANEL_ID} .wb-assistant-save:hover {\n  border-color: #60a5fa;\n}\n\n#${PANEL_ID} .wb-assistant-close {\n  width: 30px;\n  height: 30px;\n  border: 1px solid #475569;\n  border-radius: 6px;\n  background: #1f2937;\n  color: #e2e8f0;\n  cursor: pointer;\n}\n\n#${PANEL_ID} .wb-assistant-close:hover {\n  border-color: #f43f5e;\n}\n\n#${PANEL_BODY_ID} {\n  flex: 1;\n  min-height: 0;\n  overflow: auto;\n}\n\n#${MENU_ID}.active {\n  background-color: rgba(56, 189, 248, 0.18) !important;\n}\n`;\n  doc.head.append(style);\n}\n\nfunction mountAppIntoPanel(): void {\n  if (panelRoot?.length) {\n    return;\n  }\n  const doc = getHostDocument();\n  const body = doc.getElementById(PANEL_BODY_ID);\n  if (!body) {\n    return;\n  }\n\n  panelRoot = createScriptIdDiv().appendTo(body as unknown as JQuery);\n  destroyTeleport = teleportStyle().destroy;\n  app = createApp(WorldbookAssistantApp);\n  app.mount(panelRoot[0]);\n}\n\nfunction ensurePanelElement(): JQuery {\n  const doc = getHostDocument();\n  let $panel = $(`#${PANEL_ID}`, doc);\n  if ($panel.length) {\n    return $panel;\n  }\n\n  ensurePanelStyle();\n  const panelHtml = `\n<div id=\"${PANEL_ID}\">\n  <div class=\"wb-assistant-header\">\n    <div class=\"wb-assistant-header-title\"></div>\n    <div class=\"wb-assistant-header-actions\">\n      <button type=\"button\" class=\"wb-assistant-tool wb-assistant-refresh\" title=\"\"></button>\n      <button type=\"button\" class=\"wb-assistant-tool wb-assistant-save\" title=\"\"></button>\n      <button type=\"button\" class=\"wb-assistant-close\" title=\"\"></button>\n    </div>\n  </div>\n  <div id=\"${PANEL_BODY_ID}\"></div>\n</div>\n`;\n  $('body', doc).append(panelHtml);\n  $panel = $(`#${PANEL_ID}`, doc);\n\n  enablePanelDrag($panel[0] as HTMLDivElement);\n  $panel.off(`click${EVENT_NS}`, '.wb-assistant-refresh').on(`click${EVENT_NS}`, '.wb-assistant-refresh', () => {\n    window.dispatchEvent(new Event('wb-helper:refresh'));\n  });\n  $panel.off(`click${EVENT_NS}`, '.wb-assistant-save').on(`click${EVENT_NS}`, '.wb-assistant-save', () => {\n    window.dispatchEvent(new Event('wb-helper:save'));\n  });\n  $panel.off(`click${EVENT_NS}`, '.wb-assistant-close').on(`click${EVENT_NS}`, '.wb-assistant-close', () => {\n    hidePanel();\n  });\n\n  return $panel;\n}\n\nfunction enablePanelDrag(panel: HTMLDivElement): void {\n  const hostWin = getHostWindow();\n  const handle = panel.querySelector('.wb-assistant-header') as HTMLDivElement | null;\n  if (!handle) {\n    return;\n  }\n\n  let dragging = false;\n  let offsetX = 0;\n  let offsetY = 0;\n\n  const onMouseMove = (event: MouseEvent) => {\n    if (!dragging) {\n      return;\n    }\n    const rect = panel.getBoundingClientRect();\n    const maxLeft = Math.max(8, hostWin.innerWidth - rect.width - 8);\n    const maxTop = Math.max(8, hostWin.innerHeight - rect.height - 8);\n    const nextLeft = Math.min(maxLeft, Math.max(8, event.clientX - offsetX));\n    const nextTop = Math.min(maxTop, Math.max(8, event.clientY - offsetY));\n    panel.style.left = `${nextLeft}px`;\n    panel.style.top = `${nextTop}px`;\n    panel.style.right = 'auto';\n    panel.style.bottom = 'auto';\n  };\n\n  const onMouseUp = () => {\n    if (!dragging) {\n      return;\n    }\n    dragging = false;\n    hostWin.document.removeEventListener('mousemove', onMouseMove, true);\n    hostWin.document.removeEventListener('mouseup', onMouseUp, true);\n  };\n\n  handle.addEventListener('mousedown', event => {\n    if (event.button !== 0) {\n      return;\n    }\n    if ((event.target as HTMLElement).closest('button')) {\n      return;\n    }\n    const rect = panel.getBoundingClientRect();\n    offsetX = event.clientX - rect.left;\n    offsetY = event.clientY - rect.top;\n    dragging = true;\n    panel.style.left = `${rect.left}px`;\n    panel.style.top = `${rect.top}px`;\n    panel.style.right = 'auto';\n    panel.style.bottom = 'auto';\n    hostWin.document.addEventListener('mousemove', onMouseMove, true);\n    hostWin.document.addEventListener('mouseup', onMouseUp, true);\n    event.preventDefault();\n  });\n}\n\nfunction setMenuActive(active: boolean): void {\n  const doc = getHostDocument();\n  const $menuItem = $(`#${MENU_ID}`, doc);\n  if (!$menuItem.length) {\n    return;\n  }\n  $menuItem.toggleClass('active', active);\n}\n\nfunction showPanel(): void {\n  const doc = getHostDocument();\n  const $panel = ensurePanelElement();\n  mountAppIntoPanel();\n  $panel.addClass('active');\n  isPanelVisible = true;\n  setMenuActive(true);\n  // \n  window.dispatchEvent(new Event('wb-helper:refresh'));\n  $(`#${MENU_ID}`, doc).blur();\n}\n\nfunction hasUnsavedChanges(): boolean {\n  const current = window as unknown as Record<string, unknown>;\n  const host = getHostWindow() as unknown as Record<string, unknown>;\n  return current[DIRTY_STATE_KEY] === true || host[DIRTY_STATE_KEY] === true;\n}\n\nfunction shouldClosePanel(): boolean {\n  if (!hasUnsavedChanges()) {\n    return true;\n  }\n  return confirm('');\n}\n\nfunction hidePanel(): boolean {\n  if (!shouldClosePanel()) {\n    return false;\n  }\n  const doc = getHostDocument();\n  $(`#${PANEL_ID}`, doc).removeClass('active');\n  isPanelVisible = false;\n  setMenuActive(false);\n  return true;\n}\n\nfunction togglePanel(): void {\n  if (isPanelVisible) {\n    void hidePanel();\n  } else {\n    showPanel();\n  }\n}\n\nfunction ensureMenuItem(): boolean {\n  const doc = getHostDocument();\n  const $menu = $('#extensionsMenu', doc);\n  if (!$menu.length) {\n    return false;\n  }\n\n  const $existing = $(`#${MENU_ID}`, doc);\n  if ($existing.length && !$existing.closest('#extensionsMenu').length) {\n    $existing.remove();\n  }\n  if (!$(`#${MENU_ID}`, doc).length) {\n    const menuHtml = `\n<div id=\"${MENU_ID}\" class=\"list-group-item flex-container flexGap5 interactable\" title=\"\" tabIndex=\"0\">\n  <i class=\"fa-solid fa-book-open\"></i>\n  <span></span>\n</div>\n`;\n    $menu.append(menuHtml);\n  }\n  setMenuActive(isPanelVisible);\n  return true;\n}\n\nfunction startMenuObserver(): void {\n  const doc = getHostDocument();\n  if (menuObserver) {\n    return;\n  }\n  menuObserver = new MutationObserver(() => {\n    ensureMenuItem();\n  });\n  menuObserver.observe(doc.body, { childList: true, subtree: true });\n}\n\nfunction stopMenuObserver(): void {\n  menuObserver?.disconnect();\n  menuObserver = null;\n}\n\nfunction ensureMenuRetry(): void {\n  if (menuRetryTimer !== null) {\n    return;\n  }\n  menuRetryTimer = window.setInterval(() => {\n    if (ensureMenuItem()) {\n      window.clearInterval(menuRetryTimer as number);\n      menuRetryTimer = null;\n    }\n  }, 1000);\n}\n\nfunction stopMenuRetry(): void {\n  if (menuRetryTimer === null) {\n    return;\n  }\n  window.clearInterval(menuRetryTimer);\n  menuRetryTimer = null;\n}\n\nfunction init(): void {\n  // \n  replaceScriptButtons([]);\n\n  const doc = getHostDocument();\n  $(doc).off(`click${EVENT_NS}`, `#${MENU_ID}`).on(`click${EVENT_NS}`, `#${MENU_ID}`, event => {\n    event.preventDefault();\n    togglePanel();\n  });\n\n  ensurePanelElement();\n  if (!ensureMenuItem()) {\n    ensureMenuRetry();\n  }\n  startMenuObserver();\n  toastr.success('', 'Worldbook Assistant');\n}\n\nfunction cleanup(): void {\n  const doc = getHostDocument();\n  stopMenuRetry();\n  stopMenuObserver();\n  $(doc).off(EVENT_NS);\n  $(`#${MENU_ID}`, doc).remove();\n  $(`#${PANEL_ID}`, doc).remove();\n  doc.getElementById(PANEL_STYLE_ID)?.remove();\n\n  app?.unmount();\n  app = null;\n  panelRoot?.remove();\n  panelRoot = null;\n  destroyTeleport?.();\n  destroyTeleport = null;\n}\n\n$(() => {\n  errorCatched(init)();\n});\n\n$(window).on('pagehide', () => {\n  cleanup();\n});\n","import iframe_srcdoc from './iframe_srcdoc.html';\n\nexport async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle(\n  append_to: JQuery.Selector | JQuery.htmlString | JQuery.TypeOrArray<Element | DocumentFragment> | JQuery = 'head',\n): { destroy: () => void } {\n  const $div = $(`<div>`)\n    .attr('script_id', getScriptId())\n    .append($(`head > style`, document).clone())\n    .appendTo(append_to);\n\n  return {\n    destroy: () => $div.remove(),\n  };\n}\n\nexport function createScriptIdIframe(): JQuery<HTMLIFrameElement> {\n  return $(`<iframe>`).attr({\n    script_id: getScriptId(),\n    frameborder: 0,\n    srcdoc: iframe_srcdoc,\n  }) as JQuery<HTMLIFrameElement>;\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n"],"names":["___CSS_LOADER_EXPORT___","push","module","id","exports","cssWithMappingToString","list","toString","this","map","item","content","needLayer","concat","length","join","i","modules","media","dedupe","supports","layer","undefined","alreadyImportedModules","k","_k","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","data","sourceMapping","__esModule","default","locals","add","sfc","props","target","__vccOpts","key","val","listToStyles","parentId","styles","newStyles","part","css","sourceMap","parts","hasDocument","document","DEBUG","Error","stylesInDom","head","getElementsByTagName","singletonElement","singletonCounter","isProduction","noop","options","ssrIdKey","isOldIE","navigator","test","userAgent","toLowerCase","addStylesClient","_isProduction","_options","addStylesToDom","newList","mayRemove","domStyle","refs","j","addStyle","createStyleElement","styleElement","createElement","type","appendChild","obj","update","remove","querySelector","parentNode","removeChild","styleIndex","applyToSingletonTag","bind","applyToTag","newObj","textStore","replaceText","index","replacement","filter","Boolean","styleSheet","cssText","cssNode","createTextNode","childNodes","insertBefore","setAttribute","ssrId","sources","firstChild","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","d","a","definition","o","Object","defineProperty","enumerable","get","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","Vue","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_hoisted_58","_hoisted_59","_hoisted_60","_hoisted_61","_hoisted_62","_hoisted_63","_hoisted_64","_hoisted_65","_hoisted_66","_hoisted_67","_hoisted_68","_hoisted_69","_hoisted_70","_hoisted_71","_hoisted_72","_hoisted_73","_hoisted_74","_hoisted_75","_hoisted_76","_hoisted_77","_hoisted_78","_hoisted_79","_hoisted_80","_hoisted_81","_hoisted_82","_hoisted_83","_hoisted_84","_hoisted_85","_hoisted_86","_hoisted_87","_hoisted_88","_hoisted_89","_hoisted_90","_hoisted_91","_hoisted_92","_hoisted_93","_hoisted_94","_hoisted_95","_hoisted_96","_hoisted_97","_hoisted_98","_hoisted_99","_hoisted_100","_hoisted_101","_hoisted_102","_hoisted_103","_hoisted_104","_hoisted_105","_hoisted_106","_hoisted_107","_hoisted_108","_hoisted_109","_hoisted_110","_hoisted_111","_hoisted_112","_hoisted_113","_hoisted_114","_hoisted_115","_hoisted_116","_hoisted_117","_hoisted_118","_hoisted_119","_hoisted_120","_hoisted_121","_hoisted_122","_hoisted_123","_hoisted_124","_hoisted_125","_hoisted_126","_hoisted_127","_hoisted_128","_hoisted_129","_hoisted_130","_hoisted_131","_hoisted_132","_hoisted_133","_hoisted_134","_hoisted_135","_hoisted_136","_hoisted_137","_hoisted_138","_hoisted_139","_hoisted_140","_hoisted_141","_hoisted_142","_hoisted_143","_hoisted_144","_hoisted_145","_hoisted_146","_hoisted_147","_hoisted_148","_hoisted_149","_hoisted_150","_hoisted_151","_hoisted_152","_hoisted_153","_hoisted_154","_hoisted_155","_hoisted_156","_hoisted_157","_hoisted_158","_hoisted_159","_hoisted_160","_hoisted_161","_hoisted_162","_hoisted_163","_hoisted_164","_hoisted_165","STORAGE_KEY","DIRTY_STATE_KEY","RESIZE_HANDLE_SIZE","MAIN_PANE_MIN","MAIN_EDITOR_MIN","EDITOR_SIDE_MIN","EDITOR_CENTER_MIN","__name","setup","__props","strategyTypeOptions","secondaryLogicOptions","positionTypeOptions","worldbookNames","ref","selectedWorldbookName","globalWorldbookMode","originalEntries","draftEntries","selectedEntryUid","searchText","onlyEnabled","importFileInput","selectedExtraText","globalAddSearchText","globalFilterText","batchFindText","batchReplaceText","batchExcludeText","batchUseRegex","batchInName","batchInContent","batchInKeys","statusMessage","isBusy","isSaving","showEntryHistoryModal","showWorldbookHistoryModal","entryHistoryLeftId","entryHistoryRightId","worldbookHistoryLeftId","worldbookHistoryRightId","floatingZCounter","floatingPanels","reactive","find","visible","x","y","z","width","clipboard","activation","activeFloatingDrag","floatingPanelKeys","viewportWidth","window","innerWidth","mainLayoutRef","editorShellRef","mainPaneWidth","editorSideWidth","paneResizeState","hostResizeWindow","bindings","global","charPrimary","charAdditional","chat","activationLogs","persistedState","last_worldbook","history","entry_history","subscriptions","selectedEntry","computed","entry","uid","selectedEntryIndex","findIndex","filteredEntries","keyword","trim","enabled","keysJoined","strategy","keys","stringifyKeyword","name","includes","enabledEntryCount","totalContentChars","reduce","sum","hasUnsavedChanges","isCompactLayout","mainLayoutStyle","gridTemplateColumns","editorShellStyle","selectableWorldbookNames","globalAddCandidates","filteredGlobalWorldbooks","isGlobalBound","clipboardItems","snapshotsForCurrent","entrySnapshotsForSelected","String","entryVersionViews","baselineEntry","current","label","ts","Date","now","isCurrent","baseline","selectedEntryHistoryLeft","selectedEntryHistoryRight","canRestoreEntryFromLeft","worldbookVersionViews","entries","selectedWorldbookHistoryLeft","selectedWorldbookHistoryRight","canRestoreWorldbookFromLeft","batchExcludeTokensPreview","parseBatchExcludeTokens","entryHistoryDiff","buildDiffHtml","serializeEntryVersionForDiff","entryHistorySummary","left","right","leftText","rightText","addLines","delLines","lines","split","pop","added","removed","changed","Math","min","max","getEntryVersionDiffSummary","worldbookHistoryDiff","serializeWorldbookVersionForDiff","selectedKeysText","set","parseKeywordsFromText","selectedSecondaryKeysText","keys_secondary","selectedScanDepthText","depth","scan_depth","normalizeScanDepth","selectedRecursionDelayText","nullableNumberToText","recursion","delay_until","parseNullableInteger","selectedStickyText","effect","sticky","selectedCooldownText","cooldown","selectedEffectDelayText","delay","selectedContentChars","selectedTokenEstimate","chars","round","createId","prefix","random","slice","asRecord","Array","isArray","toStringSafe","fallback","toNumberSafe","Number","isFinite","parsed","clampNumber","floor","RegExp","parseKeywordToken","token","trimmed","regexMatch","match","normalizeKeywordList","sourceList","normalized","seen","Set","tokenString","dedupeKey","has","getEntryVisualStatus","getEntryStatusLabel","status","getEntryKeyPreview","rendered","numeric","NaN","createDefaultEntry","logic","position","role","order","probability","prevent_incoming","prevent_outgoing","normalizeEntry","rawInput","fallbackUid","raw","base","strategyRecord","positionRecord","recursionRecord","effectRecord","secondaryRecord","comment","strategyType","directType","constant","vectorized","normalizeStrategyType","secondaryKeys","secondary_keys","keysecondary","filters","secondaryLogic","normalizeSecondaryLogic","selectiveLogic","positionType","normalizePositionType","normalizeRole","insertion_order","preventIncoming","preventRecursion","preventOutgoing","excludeRecursion","disable","delayUntilRecursion","directExtra","extra","extras","known","collectExtraFields","normalizeEntryList","rawEntries","result","uidSet","rawRecord","getNextUid","readPersistedState","input","root","historyRoot","rawSnapshots","record","entriesRaw","entryHistoryRoot","entryHistory","worldbookName","rawByUid","uidRecord","normalizedByUid","uidKey","rawItems","uidNumber","copied_at","normalizePersistedState","getVariables","script_id","getScriptId","updatePersistedState","mutator","state","vars","replaceVariables","writePersistedState","setStatus","message","formatDateTime","timestamp","toLocaleString","hour12","formatHistoryOptionLabel","getWorldbookVersionDiffSummary","leftMap","Map","rightMap","forEach","rightEntry","leftEntry","escapeHtml","text","replaceAll","view","payload","sort","leftRendered","rightRendered","leftLineNo","rightLineNo","line","safe","leftHtml","rightHtml","tokens","shouldExcludeEntryForBatch","uidMatch","plain","replace","ensureSelectedEntryExists","some","createEntrySnapshotRecord","pushEntrySnapshotsBulk","items","byWorldbook","incoming","unshift","pushEntrySnapshot","pushSnapshot","snapshot","createManualSnapshot","toastr","success","warning","openEntryHistoryModal","nonCurrent","openWorldbookHistoryModal","createManualEntrySnapshot","info","restoreWorldbookFromLeftHistory","confirm","clearCurrentSnapshots","restoreEntryFromLeftHistory","restored","splice","clearCurrentEntrySnapshots","copySelectedEntryToClipboard","clearClipboard","handleSelectedPositionTypeChanged","applyExtraJson","parsedRecord","parse","error","clearExtra","addEntry","duplicateSelectedEntry","duplicated","removeSelectedEntry","moveSelectedEntry","direction","normalizeAllEntries","sortEntriesByOrderDesc","setEnabledForAll","applyBatchReplace","findText","excludeTokens","regex","touched","skipped","next","exportCurrentWorldbook","format","exported_at","toISOString","filename","blob","Blob","url","URL","createObjectURL","anchor","href","download","body","click","revokeObjectURL","downloadJson","parseImportedPayload","fileName","fallbackName","entriesMap","values","dataRoot","dataEntriesMap","collectRawEntries","triggerImport","async","onImportChange","event","file","files","fileText","suggested","newName","prompt","createOrReplaceWorldbook","render","reloadWorldbookNames","refreshBindings","response","importRawWorldbook","ok","hardRefresh","getGlobalWorldbookNames","charBindings","getCharWorldbookNames","primary","additional","getChatWorldbookName","ensureSelectionForGlobalMode","globals","trySelectWorldbookByContext","preferWhenEmptyOnly","candidate","available","chatBound","resolveContextWorldbookCandidate","force","toggleGlobalMode","applyGlobalWorldbooks","nextGlobal","statusLabel","rebindGlobalWorldbooks","addFirstGlobalCandidate","first","addGlobalWorldbook","clearGlobalWorldbooks","loadWorldbook","getWorldbook","preferred","names","getWorldbookNames","localeCompare","saveCurrentWorldbook","savedEntrySnapshotCount","draftByUid","previous","collectEntrySnapshotsBeforeSave","replaceWorldbook","createNewWorldbook","duplicateWorldbook","deleteCurrentWorldbook","deleteWorldbook","toggleGlobalBinding","delete","clearActivationLogs","resolveHostWindow","ownerDocument","defaultView","clampFloatingPanelToViewport","panel","hostWin","viewportHeight","innerHeight","maxX","maxY","handleFloatingWindowResize","mainRect","getBoundingClientRect","maxLeft","editorRect","maxSide","clampPaneWidths","bringFloatingToFront","closeFloatingPanel","stopFloatingDrag","toggleFloatingPanel","openFloatingPanel","getFloatingPanelStyle","top","zIndex","startFloatingDrag","pointerType","button","currentTarget","hostDoc","rect","dragState","pointerId","offsetX","clientX","offsetY","clientY","doc","win","setPointerCapture","addEventListener","onFloatingDragMove","height","preventDefault","drag","removeEventListener","startPaneResize","onPaneResizeMove","stopPaneResize","side","onPanelRefresh","onPanelSave","watch","syncExtraTextWithSelection","views","ids","immediate","dirty","onMounted","eventOn","tavern_events","WORLD_INFO_ACTIVATED","logs","displayIndex","time","world","contentPreview","pushActivationLogs","WORLDINFO_UPDATED","CHAT_CHANGED","onUnmounted","subscription","stop","_ctx","_cache","$event","onClick","disabled","ref_key","accept","onChange","active","placeholder","onKeydown","style","selected","dragging","onPointerdown","and_any","and_all","not_all","not_any","step","number","before_character_definition","after_character_definition","before_example_messages","after_example_messages","before_author_note","after_author_note","at_depth","ver","innerHTML","itemId","insertIndex","cloned","log","MENU_ID","PANEL_ID","PANEL_STYLE_ID","PANEL_BODY_ID","EVENT_NS","app","panelRoot","destroyTeleport","menuObserver","menuRetryTimer","isPanelVisible","getHostWindow","parent","getHostDocument","mountAppIntoPanel","getElementById","$","attr","appendTo","append_to","$div","append","clone","destroy","teleportStyle","createApp","mount","ensurePanelElement","$panel","textContent","ensurePanelStyle","panelHtml","handle","onMouseMove","maxTop","nextLeft","nextTop","bottom","onMouseUp","closest","enablePanelDrag","off","on","dispatchEvent","Event","hidePanel","setMenuActive","$menuItem","toggleClass","shouldClosePanel","host","removeClass","togglePanel","addClass","blur","showPanel","ensureMenuItem","$menu","$existing","menuHtml","init","replaceScriptButtons","setInterval","clearInterval","MutationObserver","observe","childList","subtree","startMenuObserver","cleanup","disconnect","unmount","errorCatched"],"sourceRoot":""}