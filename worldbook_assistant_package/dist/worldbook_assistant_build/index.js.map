{"version":3,"file":"index.js","mappings":"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","sources":["webpack://tavern_helper_template/src/worldbook_assistant_build/App.vue?6d43","src://tavern_helper_template/node_modules/.pnpm/css-loader@7.1.3_webpack@5.105.2/node_modules/css-loader/dist/runtime/api.js","src://tavern_helper_template/node_modules/.pnpm/css-loader@7.1.3_webpack@5.105.2/node_modules/css-loader/dist/runtime/sourceMaps.js","webpack://tavern_helper_template/src/worldbook_assistant_build/App.vue?72ef","src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_71d7740e7607e74f4d732110d38a3681/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/listToStyles.js","src://tavern_helper_template/node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/webpack/runtime/compat get default export","src://tavern_helper_template/webpack/runtime/define property getters","src://tavern_helper_template/webpack/runtime/hasOwnProperty shorthand","src://tavern_helper_template/webpack/runtime/make namespace object","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/src/worldbook_assistant_build/App.vue","webpack://tavern_helper_template/src/worldbook_assistant_build/App.vue?dfe0","src://tavern_helper_template/src/worldbook_assistant_build/index.ts","src://tavern_helper_template/util/script.ts"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/.pnpm/css-loader@7.1.3_webpack@5.105.2/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/.pnpm/css-loader@7.1.3_webpack@5.105.2/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `.wb-assistant-root[data-v-032fd8fa]{flex:1;min-height:0;width:100%;box-sizing:border-box;display:flex;flex-direction:column;padding:10px;gap:10px;background:var(--wb-bg-root);color:var(--wb-text-main);font-size:13px;line-height:1.35;border-radius:10px;overflow:hidden}.wb-scroll-area[data-v-032fd8fa]{flex:1;min-height:0;overflow-y:auto;display:flex;flex-direction:column;gap:10px}.wb-settings-wrapper[data-v-032fd8fa]{width:100%}.wb-header[data-v-032fd8fa]{display:flex;justify-content:space-between;align-items:center;border-radius:12px;padding:12px 16px;background:var(--wb-bg-panel);margin-bottom:8px}.wb-title[data-v-032fd8fa]{display:flex;flex-direction:column;gap:2px}.wb-title strong[data-v-032fd8fa]{font-size:16px}.wb-title span[data-v-032fd8fa]{color:var(--wb-text-muted)}.wb-header-actions[data-v-032fd8fa],.list-actions[data-v-032fd8fa],.tool-line[data-v-032fd8fa]{display:flex;gap:6px;flex-wrap:wrap}.wb-toolbar[data-v-032fd8fa]{display:flex;gap:8px;flex-wrap:wrap;align-items:center;border-radius:12px;padding:10px 12px;background:var(--wb-bg-panel)}.toolbar-label[data-v-032fd8fa]{display:inline-flex;align-items:center;gap:6px;color:var(--wb-text-muted);min-width:320px;flex:1 1 520px}.toolbar-select[data-v-032fd8fa]{min-width:200px}.toolbar-select.small[data-v-032fd8fa]{min-width:160px}.worldbook-picker[data-v-032fd8fa]{position:relative;flex:1 1 auto;min-width:240px}.worldbook-picker-trigger[data-v-032fd8fa]{width:100%;box-sizing:border-box;border:1px solid transparent;border-radius:8px;padding:8px 10px;background:var(--wb-input-bg);color:var(--wb-text-main);display:flex;align-items:center;justify-content:space-between;gap:10px;cursor:pointer}.worldbook-picker-trigger[data-v-032fd8fa]:hover{border-color:var(--wb-primary-light)}.worldbook-picker-trigger-text[data-v-032fd8fa]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-align:left}.worldbook-picker-trigger-arrow[data-v-032fd8fa]{flex-shrink:0;color:var(--wb-text-muted)}.worldbook-picker-dropdown[data-v-032fd8fa]{position:absolute;left:0;right:0;top:calc(100% + 6px);z-index:10120;border:1px solid var(--wb-border-subtle);border-radius:8px;background:var(--wb-input-bg-focus);box-shadow:var(--wb-shadow-main);padding:8px;display:grid;gap:8px}.worldbook-picker-search[data-v-032fd8fa]{width:100%}.worldbook-picker-list[data-v-032fd8fa]{max-height:260px;overflow:auto;border:none;border-radius:8px;background:var(--wb-bg-panel);display:flex;flex-direction:column}.worldbook-picker-item[data-v-032fd8fa]{width:100%;border:none;border-bottom:1px solid var(--wb-border-subtle);background:transparent;color:var(--wb-text-main);padding:8px 10px;text-align:left;cursor:pointer}.worldbook-picker-item[data-v-032fd8fa]:last-child{border-bottom:none}.worldbook-picker-item[data-v-032fd8fa]:hover{background:var(--wb-primary-soft)}.worldbook-picker-item.active[data-v-032fd8fa]{background:var(--wb-primary-soft);color:var(--wb-primary-light)}.wb-bindings[data-v-032fd8fa]{border-radius:12px;padding:12px;display:grid;gap:8px;background:var(--wb-bg-panel)}.wb-history-shortcuts[data-v-032fd8fa]{display:flex;justify-content:flex-start;gap:8px;flex-wrap:wrap;align-items:center}.global-mode-panel[data-v-032fd8fa]{border-radius:12px;background:var(--wb-bg-panel);padding:12px;display:grid;gap:12px}.global-mode-head[data-v-032fd8fa]{display:flex;justify-content:space-between;align-items:center;gap:8px}.global-mode-title[data-v-032fd8fa]{color:var(--wb-primary-light);font-weight:700;letter-spacing:0.02em}.global-preset-panel[data-v-032fd8fa]{border-radius:8px;background:var(--wb-bg-panel);padding:10px;display:grid;gap:8px}.preset-role-panel[data-v-032fd8fa]{border-radius:8px;background:var(--wb-bg-panel);padding:10px;display:grid;gap:6px}.preset-role-head[data-v-032fd8fa]{display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap}.preset-role-current[data-v-032fd8fa]{color:var(--wb-primary);font-size:12px}.preset-role-current.empty[data-v-032fd8fa]{color:var(--wb-text-muted)}.preset-role-actions[data-v-032fd8fa]{display:flex;gap:6px;flex-wrap:wrap}.role-picker[data-v-032fd8fa]{position:relative}.role-picker-trigger[data-v-032fd8fa]{width:100%;box-sizing:border-box;border:1px solid transparent;border-radius:8px;padding:8px 10px;background:var(--wb-input-bg);color:var(--wb-text-main);display:flex;align-items:center;justify-content:space-between;gap:10px;cursor:pointer}.role-picker-trigger[data-v-032fd8fa]:disabled{opacity:0.55;cursor:default}.role-picker-trigger[data-v-032fd8fa]:hover:not(:disabled){border-color:var(--wb-primary-light)}.role-picker-trigger-text[data-v-032fd8fa]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;text-align:left}.role-picker-trigger-arrow[data-v-032fd8fa]{flex-shrink:0;color:var(--wb-text-muted)}.role-picker-dropdown[data-v-032fd8fa]{position:absolute;left:0;right:0;top:calc(100% + 6px);z-index:10130;border:1px solid var(--wb-border-subtle);border-radius:8px;background:var(--wb-input-bg-focus);box-shadow:var(--wb-shadow-main);padding:8px;display:grid;gap:8px}.role-picker-search[data-v-032fd8fa]{width:100%}.role-picker-list[data-v-032fd8fa]{border:none;border-radius:8px;background:var(--wb-bg-panel);max-height:220px;overflow:auto;display:flex;flex-direction:column}.role-picker-item[data-v-032fd8fa]{width:100%;border:none;border-bottom:1px solid var(--wb-border-subtle);background:transparent;color:var(--wb-text-main);padding:8px 10px;display:flex;align-items:center;justify-content:space-between;gap:8px;text-align:left;cursor:pointer}.role-picker-item[data-v-032fd8fa]:last-child{border-bottom:none}.role-picker-item[data-v-032fd8fa]:hover:not(:disabled){background:var(--wb-primary-soft)}.role-picker-item[data-v-032fd8fa]:disabled{opacity:0.55;cursor:default}.role-picker-item .name[data-v-032fd8fa]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.role-picker-item .meta[data-v-032fd8fa]{color:var(--wb-primary-light);flex-shrink:0;font-size:11px}.preset-role-tags[data-v-032fd8fa]{display:flex;gap:6px;flex-wrap:wrap}.preset-role-tag[data-v-032fd8fa]{border:1px solid var(--wb-border-subtle);border-radius:999px;background:var(--wb-bg-panel);color:var(--wb-text-main);padding:2px 10px;display:inline-flex;align-items:center;gap:6px;cursor:pointer}.preset-role-tag[data-v-032fd8fa]:hover{border-color:#f43f5e}.preset-role-tag .remove[data-v-032fd8fa]{color:#fca5a5}.global-mode-grid[data-v-032fd8fa]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}.global-mode-column[data-v-032fd8fa]{border-radius:8px;padding:10px;background:var(--wb-bg-panel);display:grid;gap:6px;min-height:168px}.global-mode-list[data-v-032fd8fa]{border-radius:8px;background:var(--wb-input-bg);max-height:176px;min-height:88px;overflow:auto;display:flex;flex-direction:column}.global-mode-item[data-v-032fd8fa]{width:100%;border:none;border-bottom:1px solid var(--wb-border-subtle);background:transparent;color:var(--wb-text-main);padding:7px 8px;display:flex;justify-content:space-between;align-items:center;gap:10px;cursor:pointer;text-align:left}.global-mode-item[data-v-032fd8fa]:last-child{border-bottom:none}.global-mode-item[data-v-032fd8fa]:hover{background:var(--wb-primary-soft)}.global-mode-item.add .global-mode-item-action[data-v-032fd8fa]{color:#86efac}.global-mode-item.active .global-mode-item-action[data-v-032fd8fa]{color:#fca5a5}.global-mode-item-name[data-v-032fd8fa]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.global-mode-item-action[data-v-032fd8fa]{font-size:12px;flex-shrink:0}.global-mode-actions[data-v-032fd8fa]{display:flex;gap:6px;flex-wrap:wrap}.history-btn[data-v-032fd8fa]{border-color:var(--wb-primary);background:var(--wb-primary-soft)}.utility-btn[data-v-032fd8fa]{border-color:var(--wb-primary-light);background:var(--wb-primary-soft)}.utility-btn.active[data-v-032fd8fa]{border-color:var(--wb-primary-light);background:var(--wb-primary-soft);color:var(--wb-primary-light)}.wb-main-layout[data-v-032fd8fa]{flex:1;min-height:60vh;display:grid;grid-template-columns:320px 10px minmax(0,1fr);gap:0}.wb-entry-list[data-v-032fd8fa],.wb-editor[data-v-032fd8fa]{border-radius:12px;padding:0;display:flex;flex-direction:column;gap:8px;background:transparent;min-height:0}.list-search[data-v-032fd8fa]{display:grid;gap:6px;padding:0 8px}.list-summary[data-v-032fd8fa]{color:var(--wb-text-muted);font-size:12px;padding:0 8px}.list-scroll[data-v-032fd8fa]{flex:1 1 auto;min-height:210px;max-height:calc(70vh - 210px);overflow:auto;display:flex;flex-direction:column;gap:6px}.entry-item[data-v-032fd8fa]{width:100%;text-align:left;border:none;background:transparent;color:var(--wb-text-main);border-radius:8px;padding:10px 12px 10px 14px;cursor:pointer;display:grid;gap:6px;position:relative;transition:background-color 0.15s ease;margin-bottom:4px}.entry-item[data-v-032fd8fa]::before{content:'';position:absolute;left:0;top:0;bottom:0;width:4px;border-radius:8px 0 0 8px;background:linear-gradient(to bottom,#64748b,rgba(100,116,139,0.05))}.entry-item[data-status='constant'][data-v-032fd8fa]::before{background:linear-gradient(to bottom,#3b82f6,rgba(59,130,246,0))}.entry-item[data-status='vector'][data-v-032fd8fa]::before{background:linear-gradient(to bottom,#a855f7,rgba(168,85,247,0))}.entry-item[data-status='normal'][data-v-032fd8fa]::before{background:linear-gradient(to bottom,#22c55e,rgba(34,197,94,0))}.entry-item[data-status='disabled'][data-v-032fd8fa]::before{background:linear-gradient(to bottom,#6b7280,rgba(107,114,128,0))}.entry-item[data-v-032fd8fa]:hover{background:var(--wb-primary-hover);transform:none}.entry-item.selected[data-v-032fd8fa]{background:var(--wb-primary-soft);box-shadow:none}.entry-item.disabled[data-v-032fd8fa]{opacity:0.74}.entry-item-head[data-v-032fd8fa]{display:flex;align-items:center;gap:7px;min-width:0}.entry-status-dot[data-v-032fd8fa]{width:9px;height:9px;border-radius:999px;background:#64748b;flex-shrink:0;box-shadow:0 0 0 2px var(--wb-bg-panel)}.entry-status-dot[data-status='constant'][data-v-032fd8fa]{background:#3b82f6}.entry-status-dot[data-status='vector'][data-v-032fd8fa]{background:#a855f7}.entry-status-dot[data-status='normal'][data-v-032fd8fa]{background:#22c55e}.entry-status-dot[data-status='disabled'][data-v-032fd8fa]{background:#6b7280}.entry-item-title[data-v-032fd8fa]{font-weight:700;flex:1;min-width:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.entry-item-tags[data-v-032fd8fa]{display:flex;gap:6px;flex-wrap:wrap}.entry-chip[data-v-032fd8fa]{display:inline-flex;align-items:center;gap:4px;border:none;border-radius:999px;padding:2px 8px;color:var(--wb-text-muted);font-size:11px;background:var(--wb-bg-panel)}.entry-chip.uid[data-v-032fd8fa]{color:var(--wb-primary-light);font-size:10px;padding:1px 7px}.entry-chip.mono[data-v-032fd8fa]{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,'Liberation Mono','Courier New',monospace;font-size:10px}.entry-chip.status[data-status='constant'][data-v-032fd8fa]{color:#93c5fd;background:rgba(59,130,246,0.16)}.entry-chip.status[data-status='vector'][data-v-032fd8fa]{color:#d8b4fe;background:rgba(168,85,247,0.16)}.entry-chip.status[data-status='normal'][data-v-032fd8fa]{color:#86efac;background:rgba(34,197,94,0.16)}.entry-chip.status[data-status='disabled'][data-v-032fd8fa]{color:#cbd5e1;background:rgba(100,116,139,0.15)}.entry-item-preview[data-v-032fd8fa]{color:var(--wb-text-muted);font-size:11px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-left:16px;opacity:0.85}.entry-item-preview[data-v-032fd8fa]::before{content:'Keys: ';color:var(--wb-text-muted);margin-right:4px}.wb-editor[data-v-032fd8fa]{max-height:70vh;overflow:hidden}.wb-editor-shell[data-v-032fd8fa]{height:100%;min-height:0;display:grid;grid-template-columns:minmax(0,1fr) 10px 360px;gap:0}.wb-resize-handle[data-v-032fd8fa]{position:relative;width:10px;cursor:col-resize;-webkit-user-select:none;user-select:none;touch-action:none}.wb-resize-handle[data-v-032fd8fa]::before{content:'';position:absolute;left:4px;top:12px;bottom:12px;width:2px;border-radius:999px;background:var(--wb-primary-hover);transition:background-color 0.15s ease}.wb-resize-handle[data-v-032fd8fa]:hover::before,.wb-resize-handle.dragging[data-v-032fd8fa]::before{background:var(--wb-primary-light)}.editor-center[data-v-032fd8fa]{border:none;border-radius:12px;background:var(--wb-bg-panel);padding:16px;display:flex;flex-direction:column;gap:10px;min-height:0;overflow:auto}.editor-head[data-v-032fd8fa]{display:flex;justify-content:space-between;gap:10px;align-items:flex-end;border-bottom:1px solid var(--wb-border-subtle);padding-bottom:12px}.editor-comment[data-v-032fd8fa]{flex:1}.editor-badges[data-v-032fd8fa]{display:flex;gap:6px;flex-wrap:wrap;justify-content:flex-end}.editor-badge[data-v-032fd8fa]{font-size:10px;border:none;border-radius:999px;padding:2px 8px;color:var(--wb-text-muted);background:var(--wb-bg-panel);white-space:nowrap}.editor-badge.mono[data-v-032fd8fa]{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,'Liberation Mono','Courier New',monospace}.editor-badge.on[data-v-032fd8fa]{color:#86efac;background:rgba(34,197,94,0.12)}.editor-badge.off[data-v-032fd8fa]{color:#cbd5e1;background:rgba(100,116,139,0.15)}.editor-badge.strategy[data-status='constant'][data-v-032fd8fa]{color:#93c5fd;background:rgba(59,130,246,0.12)}.editor-badge.strategy[data-status='vector'][data-v-032fd8fa]{color:#d8b4fe;background:rgba(168,85,247,0.12)}.editor-badge.strategy[data-status='normal'][data-v-032fd8fa]{color:#86efac;background:rgba(34,197,94,0.12)}.editor-badge.strategy[data-status='disabled'][data-v-032fd8fa]{color:#cbd5e1;background:rgba(100,116,139,0.12)}.editor-keyword-grid .text-area.compact[data-v-032fd8fa]{min-height:36px;height:36px;line-height:1.35}.editor-content-block[data-v-032fd8fa]{min-height:0;display:flex;flex-direction:column;gap:6px;flex:1}.editor-content-title[data-v-032fd8fa]{font-size:12px;color:var(--wb-primary-light);letter-spacing:0.01em}.editor-content-area[data-v-032fd8fa]{min-height:320px;flex:1;resize:none;line-height:1.5}.content-resize-handle[data-v-032fd8fa]{display:none;align-items:center;justify-content:center;height:22px;cursor:ns-resize;background:var(--wb-bg-panel);border-radius:0 0 8px 8px;touch-action:none;-webkit-user-select:none;user-select:none}.content-resize-grip[data-v-032fd8fa]{font-size:12px;color:var(--wb-text-dim);letter-spacing:3px;line-height:1}.editor-advanced[data-v-032fd8fa]{border:none;border-radius:8px;padding:10px;background:var(--wb-input-bg)}.editor-advanced>summary[data-v-032fd8fa]{cursor:pointer;font-size:12px;color:var(--wb-text-muted)}.editor-advanced[open]>summary[data-v-032fd8fa]{margin-bottom:7px}.editor-side[data-v-032fd8fa]{display:flex;flex-direction:column;gap:8px;min-height:0;overflow:auto}.editor-card[data-v-032fd8fa]{border:none;border-radius:12px;padding:12px;background:var(--wb-bg-panel);display:grid;gap:7px}.editor-card h4[data-v-032fd8fa]{margin:0;font-size:12px;color:var(--wb-primary)}.strategy-switch[data-v-032fd8fa]{display:grid;gap:6px}.strategy-pill[data-v-032fd8fa]{border:none;border-radius:6px;background:var(--wb-input-bg);color:var(--wb-text-muted);padding:6px 10px;font-size:12px;cursor:pointer;text-align:left;transition:background-color 0.15s ease}.strategy-pill[data-v-032fd8fa]:hover{background:var(--wb-primary-hover)}.strategy-pill.active.constant[data-v-032fd8fa]{background:rgba(59,130,246,0.16);color:#93c5fd}.strategy-pill.active.vector[data-v-032fd8fa]{background:rgba(168,85,247,0.16);color:#d8b4fe}.strategy-pill.active.selective[data-v-032fd8fa]{background:rgba(34,197,94,0.16);color:#86efac}.editor-grid[data-v-032fd8fa]{display:grid;gap:8px}.editor-grid.two-cols[data-v-032fd8fa]{grid-template-columns:1fr 1fr}.editor-grid.three-cols[data-v-032fd8fa]{grid-template-columns:repeat(3,minmax(0,1fr))}.field[data-v-032fd8fa]{display:flex;flex-direction:column;gap:4px}.field>span[data-v-032fd8fa]{color:var(--wb-primary-light)}.field.disabled[data-v-032fd8fa]{opacity:0.56}.field-end[data-v-032fd8fa]{align-self:end}.field-actions[data-v-032fd8fa]{display:flex;gap:6px;flex-wrap:wrap}.text-input[data-v-032fd8fa],.text-area[data-v-032fd8fa],.toolbar-select[data-v-032fd8fa]{width:100%;box-sizing:border-box;border:1px solid transparent;border-radius:6px;padding:8px 10px;color:var(--wb-text-main);background:var(--wb-input-bg);transition:all 0.2s ease}.text-input[data-v-032fd8fa]:hover,.text-area[data-v-032fd8fa]:hover,.toolbar-select[data-v-032fd8fa]:hover{background:var(--wb-input-bg-hover)}.text-input[data-v-032fd8fa]:focus,.text-area[data-v-032fd8fa]:focus,.toolbar-select[data-v-032fd8fa]:focus{background:var(--wb-input-bg-focus);border-color:var(--wb-primary-glow);outline:none;box-shadow:0 0 0 3px var(--wb-primary-soft)}.text-area[data-v-032fd8fa]{min-height:96px;resize:vertical}.text-area.compact[data-v-032fd8fa]{min-height:84px}.text-area.large[data-v-032fd8fa]{min-height:190px}.checkbox-inline[data-v-032fd8fa]{display:inline-flex;align-items:center;gap:6px}.wb-tools-grid[data-v-032fd8fa]{display:grid;gap:8px;grid-template-columns:repeat(2,minmax(0,1fr))}.tool-card[data-v-032fd8fa]{border-radius:10px;padding:10px;display:flex;flex-direction:column;gap:8px;min-height:170px;background:var(--wb-bg-panel)}.tool-card h4[data-v-032fd8fa]{margin:0;font-size:13px;color:var(--wb-primary-light)}.tool-line.stacked[data-v-032fd8fa]{display:grid;gap:6px}.find-flags[data-v-032fd8fa]{display:flex;flex-wrap:wrap;gap:8px}.find-scope-line[data-v-032fd8fa]{display:flex;align-items:center;gap:10px;flex-wrap:wrap}.find-summary-text[data-v-032fd8fa]{margin-left:auto;color:var(--wb-primary-light);font-size:12px}.find-active-hit[data-v-032fd8fa]{border:1px solid var(--wb-border-main);border-radius:7px;padding:6px 8px;display:grid;gap:2px;background:var(--wb-bg-panel)}.find-active-hit strong[data-v-032fd8fa]{color:var(--wb-text-main);font-size:12px}.find-active-hit span[data-v-032fd8fa]{color:var(--wb-text-muted);font-size:11px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.batch-exclude-note[data-v-032fd8fa]{color:var(--wb-text-muted);font-size:11px}.batch-exclude-chips[data-v-032fd8fa]{display:flex;gap:6px;flex-wrap:wrap}.exclude-chip[data-v-032fd8fa]{border:1px solid var(--wb-border-subtle);border-radius:999px;padding:1px 8px;font-size:11px;color:var(--wb-text-main);background:var(--wb-bg-panel)}.tool-details[data-v-032fd8fa]{border:1px solid var(--wb-border-main);border-radius:8px;padding:6px;background:var(--wb-bg-panel)}.tool-details>summary[data-v-032fd8fa]{cursor:pointer;color:var(--wb-text-main);font-size:12px}.tool-details[open]>summary[data-v-032fd8fa]{margin-bottom:6px}.history-compare[data-v-032fd8fa]{display:grid;gap:6px}.history-preview-grid[data-v-032fd8fa]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:6px}.history-preview-card[data-v-032fd8fa]{border:1px solid var(--wb-border-main);border-radius:8px;padding:6px;display:grid;gap:3px;background:var(--wb-bg-panel)}.history-preview-card strong[data-v-032fd8fa]{color:var(--wb-primary-light);font-size:11px}.history-preview-card span[data-v-032fd8fa]{color:var(--wb-text-muted);font-size:11px;line-height:1.35}.history-note[data-v-032fd8fa]{border:1px dashed var(--wb-border-main);border-radius:8px;padding:6px;color:var(--wb-text-muted);font-size:11px;background:var(--wb-bg-panel)}.tool-scroll[data-v-032fd8fa]{overflow:auto;display:flex;flex-direction:column;gap:6px}.tool-list-item[data-v-032fd8fa]{border-radius:8px;padding:8px;display:flex;justify-content:space-between;gap:8px;align-items:center;background:var(--wb-input-bg)}.item-main[data-v-032fd8fa]{display:flex;flex-direction:column;gap:2px;min-width:0}.item-main strong[data-v-032fd8fa],.activation-main strong[data-v-032fd8fa]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.item-main span[data-v-032fd8fa]{color:var(--wb-text-muted);font-size:12px}.item-actions[data-v-032fd8fa]{display:flex;gap:6px}.activation-item[data-v-032fd8fa]{border-radius:8px;padding:8px;display:grid;gap:3px;background:var(--wb-input-bg)}.activation-main[data-v-032fd8fa],.activation-sub[data-v-032fd8fa]{display:flex;justify-content:space-between;gap:6px}.activation-main span[data-v-032fd8fa],.activation-sub[data-v-032fd8fa]{color:var(--wb-text-muted);font-size:12px}.activation-sub span[data-v-032fd8fa]:last-child{flex:1;text-align:right;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.wb-floating-window[data-v-032fd8fa]{position:fixed;max-width:calc(100vw - 16px);max-height:min(74vh,760px);border:1px solid var(--wb-border-subtle);border-radius:10px;background:var(--wb-bg-root);box-shadow:var(--wb-shadow-main);display:flex;flex-direction:column;overflow:hidden}.wb-floating-header[data-v-032fd8fa]{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:8px 10px;border-bottom:1px solid var(--wb-border-subtle);background:var(--wb-bg-panel);cursor:move;-webkit-user-select:none;user-select:none;touch-action:none}.wb-floating-header strong[data-v-032fd8fa]{font-size:12px;color:var(--wb-text-main)}.wb-floating-header-actions[data-v-032fd8fa]{display:flex;gap:6px;flex-wrap:wrap}.wb-floating-body[data-v-032fd8fa]{min-height:0;padding:8px;display:grid;gap:8px;overflow:auto}.find-window .wb-floating-body[data-v-032fd8fa]{gap:10px}.activation-window .tool-scroll[data-v-032fd8fa]{max-height:min(58vh,520px)}.wb-status[data-v-032fd8fa]{border-radius:10px;background:var(--wb-bg-panel);padding:10px 12px;display:flex;justify-content:space-between;gap:8px;color:var(--wb-text-main);flex-wrap:wrap}.btn[data-v-032fd8fa]{border:1px solid var(--wb-border-main);background:var(--wb-bg-panel);color:var(--wb-text-main);border-radius:7px;padding:5px 10px;cursor:pointer}.btn[data-v-032fd8fa]:hover:not(:disabled){border-color:var(--wb-primary-light)}.btn[data-v-032fd8fa]:disabled{opacity:0.5;cursor:default}.btn.primary[data-v-032fd8fa]{background:var(--wb-primary-soft);border-color:var(--wb-primary)}.btn.danger[data-v-032fd8fa]{background:rgba(225,29,72,0.12);border-color:#e11d48;color:#e11d48}.btn.mini[data-v-032fd8fa]{padding:4px 8px;font-size:12px}.empty-note[data-v-032fd8fa],.empty-block[data-v-032fd8fa]{color:var(--wb-text-muted);font-size:12px}.empty-block[data-v-032fd8fa]{padding:14px;border:1px dashed var(--wb-border-main);border-radius:8px}.hidden-input[data-v-032fd8fa]{display:none}.wb-modal-backdrop[data-v-032fd8fa]{position:fixed;inset:0;background:rgba(0,0,0,0.55);display:flex;align-items:center;justify-content:center;z-index:10020;padding:14px;box-sizing:border-box}.wb-history-modal[data-v-032fd8fa]{width:min(1260px,100%);max-height:min(88vh,940px);border:1px solid var(--wb-border-main);border-radius:12px;background:var(--wb-bg-root);box-shadow:var(--wb-shadow-main);display:flex;flex-direction:column;overflow:hidden;box-sizing:border-box}.wb-history-modal-header[data-v-032fd8fa]{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:10px 12px;border-bottom:1px solid var(--wb-border-main);background:var(--wb-bg-panel)}.wb-history-modal-header strong[data-v-032fd8fa]{display:block;font-size:14px}.wb-history-modal-header span[data-v-032fd8fa]{color:var(--wb-text-muted);font-size:11px}.wb-history-modal-actions[data-v-032fd8fa]{display:flex;gap:6px;flex-wrap:wrap}.wb-history-modal-main[data-v-032fd8fa]{min-height:0;flex:1;display:grid;grid-template-columns:300px 1fr;overflow:hidden}.wb-history-versions[data-v-032fd8fa]{border-right:1px solid var(--wb-border-main);background:var(--wb-bg-panel);display:flex;flex-direction:column;min-height:0}.wb-history-versions-title[data-v-032fd8fa]{padding:8px 10px;font-size:11px;color:var(--wb-text-muted);border-bottom:1px solid var(--wb-border-main)}.wb-history-versions-scroll[data-v-032fd8fa]{flex:1;min-height:0;overflow:auto;padding:8px;display:flex;flex-direction:column;gap:7px}.wb-history-version-item[data-v-032fd8fa]{border:1px solid var(--wb-border-main);border-radius:8px;padding:6px;display:grid;gap:4px;background:var(--wb-bg-panel)}.wb-history-version-line[data-v-032fd8fa]{display:flex;justify-content:space-between;gap:6px;align-items:center}.wb-history-version-line strong[data-v-032fd8fa]{font-size:11px;color:var(--wb-text-main)}.wb-history-version-item span[data-v-032fd8fa]{font-size:11px;color:var(--wb-text-muted);word-break:break-all}.wb-history-lr[data-v-032fd8fa]{display:inline-flex;gap:4px}.mini-lr[data-v-032fd8fa]{border:1px solid var(--wb-border-main);background:var(--wb-input-bg);color:var(--wb-text-muted);border-radius:6px;min-width:24px;font-size:10px;cursor:pointer}.mini-lr.active[data-v-032fd8fa]{border-color:#22d3ee;color:#67e8f9}.wb-history-diff-wrap[data-v-032fd8fa]{min-height:0;flex:1;display:flex;flex-direction:column;overflow:hidden}.wb-history-diff-head[data-v-032fd8fa]{border-bottom:1px solid var(--wb-border-main);background:var(--wb-bg-panel);padding:8px 10px;display:flex;justify-content:space-between;gap:8px;align-items:center;font-size:11px;color:var(--wb-text-muted)}.wb-history-diff-grid[data-v-032fd8fa]{min-height:0;flex:1;display:grid;grid-template-columns:1fr 1fr}.wb-history-diff-grid>div[data-v-032fd8fa]{min-height:0;min-width:0;display:flex;flex-direction:column;overflow:hidden}.wb-history-diff-grid>div+div[data-v-032fd8fa]{border-left:1px solid var(--wb-border-main)}.wb-history-diff-title[data-v-032fd8fa]{padding:8px 10px;border-bottom:1px solid var(--wb-border-main);font-size:11px;color:var(--wb-primary-light)}.wb-history-diff-body[data-v-032fd8fa]{min-height:0;flex:1;overflow:auto;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,'Liberation Mono','Courier New',monospace;font-size:11px;background:var(--wb-input-bg-focus);word-break:break-all;overflow-wrap:break-word}.diff-row[data-v-032fd8fa]{display:grid;grid-template-columns:54px 1fr;align-items:start;border-bottom:1px solid var(--wb-border-subtle)}.line-no[data-v-032fd8fa]{color:var(--wb-text-muted);padding:2px 8px;border-right:1px solid var(--wb-border-subtle);-webkit-user-select:none;user-select:none}.line-text[data-v-032fd8fa]{white-space:pre-wrap;word-break:break-word;padding:2px 8px;color:var(--wb-text-main)}.diff-row.add[data-v-032fd8fa]{background:rgba(34,197,94,0.18)}.diff-row.del[data-v-032fd8fa]{background:rgba(239,68,68,0.18)}.diff-row.empty[data-v-032fd8fa]{background:rgba(100,116,139,0.08)}@media (max-width:1380px){.wb-editor-shell[data-v-032fd8fa]{grid-template-columns:1fr}.editor-side[data-v-032fd8fa]{overflow:visible;max-height:none}.wb-history-modal-main[data-v-032fd8fa]{grid-template-columns:1fr}.wb-history-versions[data-v-032fd8fa]{border-right:none;border-bottom:1px solid var(--wb-border-main);max-height:120px}.wb-modal-backdrop[data-v-032fd8fa]{padding:2px}.wb-history-modal[data-v-032fd8fa]{width:100%;max-height:calc(100vh - 4px);height:calc(100vh - 4px);border-radius:6px}.wb-history-modal-header[data-v-032fd8fa]{flex-wrap:wrap;gap:4px;padding:6px 8px;flex-shrink:0}.wb-history-modal-header strong[data-v-032fd8fa]{font-size:12px}.wb-history-modal-header>div:first-child span[data-v-032fd8fa]{display:none}.wb-history-modal-actions[data-v-032fd8fa]{gap:4px}.wb-history-modal-actions .btn[data-v-032fd8fa]{font-size:10px;padding:3px 6px}.wb-history-modal-main[data-v-032fd8fa]{grid-template-columns:1fr;overflow-y:auto;flex:1;min-height:0}.wb-history-diff-wrap[data-v-032fd8fa]{overflow-y:auto;min-height:0}.wb-history-diff-grid[data-v-032fd8fa]{grid-template-columns:1fr;overflow:visible}.wb-history-diff-grid>div[data-v-032fd8fa]{max-height:30vh;overflow:auto}.wb-history-diff-grid>div+div[data-v-032fd8fa]{border-left:none;border-top:1px solid var(--wb-border-main)}.diff-row[data-v-032fd8fa]{grid-template-columns:1fr}.line-no[data-v-032fd8fa]{display:none}.wb-history-diff-body[data-v-032fd8fa]{font-size:10px}.wb-history-diff-head[data-v-032fd8fa]{flex-wrap:wrap;gap:4px;padding:6px 8px}.wb-history-diff-head>div[data-v-032fd8fa]{font-size:10px}}@media (max-width:1100px){.global-mode-grid[data-v-032fd8fa]{grid-template-columns:1fr}.wb-resize-handle[data-v-032fd8fa]{display:none}.wb-main-layout[data-v-032fd8fa]{grid-template-columns:1fr}.wb-tools-grid[data-v-032fd8fa]{grid-template-columns:1fr}.editor-grid.two-cols[data-v-032fd8fa],.editor-grid.three-cols[data-v-032fd8fa]{grid-template-columns:1fr}.editor-head[data-v-032fd8fa]{flex-direction:column;align-items:stretch}.editor-badges[data-v-032fd8fa]{justify-content:flex-start}.history-preview-grid[data-v-032fd8fa]{grid-template-columns:1fr}.wb-history-diff-grid[data-v-032fd8fa]{grid-template-columns:1fr}.wb-history-diff-grid>div+div[data-v-032fd8fa]{border-left:none;border-top:1px solid var(--wb-border-main)}.wb-status[data-v-032fd8fa]{flex-direction:column}.wb-floating-window[data-v-032fd8fa]{width:calc(100vw - 16px) !important;left:8px !important;right:8px}}.editor-back-btn[data-v-032fd8fa]{display:flex;align-items:center;gap:8px;padding:10px 12px;margin:0 0 8px 0;background:var(--wb-bg-panel);border:none;border-radius:6px;color:var(--wb-primary);font-weight:600;cursor:pointer}.editor-back-btn[data-v-032fd8fa]:hover{background:var(--wb-primary-hover)}.mobile-tab-view[data-v-032fd8fa]{display:flex;flex-direction:column;flex:1;min-height:0;overflow:hidden}.mobile-tab-content[data-v-032fd8fa]{flex:1;min-height:0;position:relative}.mobile-pane[data-v-032fd8fa]{position:absolute;inset:0;overflow-y:auto;padding:8px;-webkit-overflow-scrolling:touch}.mobile-entry-list[data-v-032fd8fa]{display:flex;flex-direction:column;gap:4px}.mobile-ai-panel[data-v-032fd8fa]{height:100%;display:flex;flex-direction:column}.mobile-ai-panel .ai-chat-area[data-v-032fd8fa]{flex:1;min-height:0;display:flex;flex-direction:column}.mobile-danger-zone[data-v-032fd8fa]{display:flex;gap:8px;margin-top:16px;padding-top:16px;border-top:1px solid var(--wb-border)}.mobile-danger-zone .btn[data-v-032fd8fa]{flex:1}.mobile-tab-bar[data-v-032fd8fa]{position:fixed;bottom:0;left:0;right:0;z-index:10100;display:flex;border-top:1px solid var(--wb-border);background:var(--wb-bg-secondary);height:52px}.mobile-tab-bar button[data-v-032fd8fa]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;border:none;background:transparent;color:var(--wb-text-dim);font-size:10px;padding:4px 0;cursor:pointer;transition:color 0.15s,background 0.15s;-webkit-tap-highlight-color:transparent}.mobile-tab-bar button.active[data-v-032fd8fa]{color:var(--wb-accent);background:color-mix(in srgb,var(--wb-accent) 8%,transparent)}.mobile-tab-bar .tab-icon[data-v-032fd8fa]{font-size:20px;line-height:1}.mobile-tab-bar .tab-label[data-v-032fd8fa]{font-weight:500}@media (max-width:768px){.wb-assistant-root[data-v-032fd8fa]{padding:6px;gap:8px}.wb-header[data-v-032fd8fa],.wb-bindings[data-v-032fd8fa],.global-mode-panel[data-v-032fd8fa],.wb-toolbar[data-v-032fd8fa]{padding:6px;gap:6px}.toolbar-label[data-v-032fd8fa]{min-width:100%}.toolbar-select[data-v-032fd8fa]{width:100%}.worldbook-picker-trigger[data-v-032fd8fa]{white-space:normal}.wb-main-layout[data-v-032fd8fa]{display:block !important;height:auto !important;overflow:visible !important}.wb-entry-list[data-v-032fd8fa],.wb-editor[data-v-032fd8fa],.wb-editor-shell[data-v-032fd8fa],.editor-side[data-v-032fd8fa]{width:100% !important;height:auto !important;max-height:none !important;border:none !important;padding:0 !important}.wb-entry-list[data-v-032fd8fa]{max-height:80vh !important;overflow-y:auto}.wb-editor-shell[data-v-032fd8fa]{display:block !important}.list-scroll[data-v-032fd8fa]{max-height:60vh}.wb-floating-window[data-v-032fd8fa]{left:8px !important;right:8px !important;width:auto !important;max-width:none !important}}.list-actions[data-v-032fd8fa]{padding:0 8px}.wb-assistant-root input[data-v-032fd8fa],.wb-assistant-root textarea[data-v-032fd8fa],.wb-assistant-root select[data-v-032fd8fa],.wb-assistant-root option[data-v-032fd8fa],.wb-assistant-root button[data-v-032fd8fa]{color:var(--wb-text-main) !important}.wb-assistant-root input[type=\"text\"][data-v-032fd8fa],.wb-assistant-root input[type=\"number\"][data-v-032fd8fa],.wb-assistant-root textarea[data-v-032fd8fa],.wb-assistant-root select[data-v-032fd8fa]{background:var(--wb-input-bg) !important;border-color:transparent !important}.wb-assistant-root input[type=\"text\"][data-v-032fd8fa]:hover,.wb-assistant-root input[type=\"number\"][data-v-032fd8fa]:hover,.wb-assistant-root textarea[data-v-032fd8fa]:hover,.wb-assistant-root select[data-v-032fd8fa]:hover{background:var(--wb-input-bg-hover) !important}.wb-assistant-root input[type=\"text\"][data-v-032fd8fa]:focus,.wb-assistant-root input[type=\"number\"][data-v-032fd8fa]:focus,.wb-assistant-root textarea[data-v-032fd8fa]:focus,.wb-assistant-root select[data-v-032fd8fa]:focus{background:var(--wb-input-bg-focus) !important;border-color:var(--wb-primary-glow) !important;outline:none !important;box-shadow:0 0 0 3px var(--wb-primary-soft) !important}.ai-generator-panel[data-v-032fd8fa]{display:flex;gap:0;flex:1;min-height:0;border-radius:var(--wb-radius);overflow:hidden;background:var(--wb-bg-secondary)}.ai-sidebar[data-v-032fd8fa]{width:220px;min-width:180px;border-right:1px solid var(--wb-border);display:flex;flex-direction:column;background:var(--wb-bg-main)}.ai-sidebar-head[data-v-032fd8fa]{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--wb-border)}.ai-sidebar-title[data-v-032fd8fa]{font-weight:600;font-size:0.9em;color:var(--wb-text-main)}.ai-session-list[data-v-032fd8fa]{flex:1;overflow-y:auto;padding:6px}.ai-session-item[data-v-032fd8fa]{display:flex;flex-wrap:wrap;align-items:center;width:100%;padding:8px 10px;margin-bottom:2px;border:none;border-radius:var(--wb-radius-sm,6px);background:transparent;cursor:pointer;text-align:left;transition:background 0.15s;position:relative}.ai-session-item[data-v-032fd8fa]:hover{background:var(--wb-bg-highlight)}.ai-session-item.active[data-v-032fd8fa]{background:var(--wb-primary-soft)}.ai-session-title[data-v-032fd8fa]{flex:1;font-size:0.85em;color:var(--wb-text-main);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.ai-session-meta[data-v-032fd8fa]{font-size:0.72em;color:var(--wb-text-dim);width:100%;margin-top:2px}.ai-session-delete[data-v-032fd8fa]{position:absolute;top:4px;right:4px;width:20px;height:20px;border:none;background:transparent;color:var(--wb-text-dim);font-size:1em;cursor:pointer;border-radius:50%;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.15s,background 0.15s}.ai-session-item:hover .ai-session-delete[data-v-032fd8fa]{opacity:1}.ai-session-delete[data-v-032fd8fa]:hover{background:var(--wb-danger,#e74c3c);color:#fff}.ai-chat-area[data-v-032fd8fa]{flex:1;display:flex;flex-direction:column;min-width:0}.ai-chat-empty[data-v-032fd8fa]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;color:var(--wb-text-dim)}.ai-chat-empty-icon[data-v-032fd8fa]{font-size:3em;opacity:0.5}.ai-chat-empty-text[data-v-032fd8fa]{font-size:0.95em}.ai-chat-messages[data-v-032fd8fa]{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px}.ai-chat-bubble[data-v-032fd8fa]{max-width:85%;padding:10px 14px;border-radius:12px;line-height:1.55;white-space:pre-wrap;word-break:break-word}.ai-chat-bubble.user[data-v-032fd8fa]{align-self:flex-end;background:var(--wb-primary-soft);border-bottom-right-radius:4px}.ai-chat-bubble.assistant[data-v-032fd8fa]{align-self:flex-start;background:var(--wb-bg-main);border:1px solid var(--wb-border);border-bottom-left-radius:4px}.ai-chat-bubble-role[data-v-032fd8fa]{font-size:0.72em;font-weight:600;color:var(--wb-text-dim);margin-bottom:4px}.ai-chat-bubble-content[data-v-032fd8fa]{font-size:0.88em;color:var(--wb-text-main)}.ai-cursor[data-v-032fd8fa]{animation:ai-blink-032fd8fa 0.7s infinite;color:var(--wb-primary)}@keyframes ai-blink-032fd8fa{0%,100%{opacity:1}50%{opacity:0}}.ai-thinking[data-v-032fd8fa]{color:var(--wb-text-dim);font-style:italic}.ai-chat-input-bar[data-v-032fd8fa]{display:flex;flex-wrap:wrap;gap:8px;padding:12px 16px;border-top:1px solid var(--wb-border);background:var(--wb-bg-main);align-items:flex-end}.ai-context-toggle[data-v-032fd8fa]{width:100%;display:flex;align-items:center;gap:6px;font-size:0.78em;color:var(--wb-text-dim);cursor:pointer;-webkit-user-select:none;user-select:none}.ai-context-toggle input[data-v-032fd8fa]{margin:0}.ai-context-toggle span[data-v-032fd8fa]{white-space:nowrap}.ai-chat-input[data-v-032fd8fa]{flex:1;resize:vertical;min-height:40px;max-height:140px;font-size:0.88em}.ai-send-btn[data-v-032fd8fa],.ai-stop-btn[data-v-032fd8fa]{min-width:64px;height:40px}.ai-tag-review-overlay[data-v-032fd8fa]{position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,0.55);display:flex;align-items:center;justify-content:center}.ai-tag-review-modal[data-v-032fd8fa]{background:var(--wb-bg-main);border-radius:var(--wb-radius);box-shadow:0 12px 40px rgba(0,0,0,0.35);width:580px;max-width:92vw;max-height:80vh;display:flex;flex-direction:column;overflow:hidden}.ai-tag-review-head[data-v-032fd8fa]{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;border-bottom:1px solid var(--wb-border)}.ai-tag-review-title[data-v-032fd8fa]{font-weight:600;font-size:1em;color:var(--wb-text-main)}.ai-tag-review-close[data-v-032fd8fa]{width:28px;height:28px;border:none;background:transparent;color:var(--wb-text-dim);font-size:1.2em;cursor:pointer;border-radius:50%;display:flex;align-items:center;justify-content:center}.ai-tag-review-close[data-v-032fd8fa]:hover{background:var(--wb-bg-highlight)}.ai-tag-review-target[data-v-032fd8fa]{padding:12px 18px;border-bottom:1px solid var(--wb-border)}.ai-tag-list[data-v-032fd8fa]{flex:1;overflow-y:auto;padding:8px 18px}.ai-tag-item[data-v-032fd8fa]{display:flex;align-items:flex-start;gap:10px;padding:10px 0;border-bottom:1px solid var(--wb-border);cursor:pointer}.ai-tag-item[data-v-032fd8fa]:last-child{border-bottom:none}.ai-tag-item input[type=\"checkbox\"][data-v-032fd8fa]{margin-top:3px}.ai-tag-info[data-v-032fd8fa]{flex:1;display:flex;flex-direction:column;gap:4px;min-width:0}.ai-tag-name[data-v-032fd8fa]{font-weight:600;font-size:0.9em;color:var(--wb-primary)}.ai-tag-preview[data-v-032fd8fa]{font-size:0.8em;color:var(--wb-text-dim);white-space:pre-wrap;word-break:break-all;line-height:1.4}.ai-tag-review-actions[data-v-032fd8fa]{display:flex;gap:8px;padding:12px 18px;border-top:1px solid var(--wb-border);justify-content:flex-end}.btn.primary[data-v-032fd8fa]{background:var(--wb-primary);color:#fff;border-color:var(--wb-primary)}.btn.primary[data-v-032fd8fa]:hover{filter:brightness(1.1)}.btn.primary[data-v-032fd8fa]:disabled{opacity:0.5;cursor:not-allowed}@media (max-width:768px){.wb-assistant-root[data-v-032fd8fa]{padding:6px;gap:6px;border-radius:0}.toolbar-label[data-v-032fd8fa]{min-width:unset;width:100%}.toolbar-label select[data-v-032fd8fa]{flex:1;min-width:0}.toolbar-btns[data-v-032fd8fa]{width:100%;display:flex;flex-wrap:wrap;gap:4px}.toolbar-btns .btn[data-v-032fd8fa]{font-size:0.78em;padding:4px 8px}.wb-bindings[data-v-032fd8fa]{flex-wrap:wrap;gap:4px;padding:6px 8px;font-size:0.78em}.wb-main-layout[data-v-032fd8fa]{display:block !important;overflow:visible;flex:none}.wb-resize-handle[data-v-032fd8fa]{display:none !important}.wb-entry-list[data-v-032fd8fa],.wb-editor[data-v-032fd8fa]{min-height:0;max-height:none}.ai-generator-panel[data-v-032fd8fa]{flex-direction:column}.ai-sidebar[data-v-032fd8fa]{width:100%;min-width:unset;max-height:110px;border-right:none;border-bottom:1px solid var(--wb-border)}.ai-sidebar-head[data-v-032fd8fa]{padding:6px 10px}.ai-session-list[data-v-032fd8fa]{overflow-x:auto;overflow-y:hidden;display:flex;flex-direction:row;gap:4px;padding:4px 8px}.ai-session-item[data-v-032fd8fa]{flex-shrink:0;min-width:140px;max-width:200px}.ai-chat-messages[data-v-032fd8fa]{padding:10px;gap:8px}.ai-chat-bubble[data-v-032fd8fa]{max-width:95%}.ai-chat-input-bar[data-v-032fd8fa]{padding:8px 10px;gap:6px}.ai-chat-input[data-v-032fd8fa]{min-height:36px;font-size:0.85em}.ai-tag-review-modal[data-v-032fd8fa]{width:95vw;max-height:85vh}.ai-tag-review-actions[data-v-032fd8fa]{flex-wrap:wrap;gap:6px;padding:8px 12px}.ai-tag-review-actions .btn[data-v-032fd8fa]{flex:1;min-width:0;font-size:0.82em}.wb-status[data-v-032fd8fa]{font-size:0.72em;padding:4px 8px;gap:6px}.editor-content-area[data-v-032fd8fa]{flex:1;min-height:40vh}.content-resize-handle[data-v-032fd8fa]{display:flex;height:28px}.editor-content-block[data-v-032fd8fa]{position:relative;z-index:10;background:var(--wb-bg-root)}.content-top-drag-handle[data-v-032fd8fa]{display:flex;align-items:center;justify-content:center;height:22px;cursor:ns-resize;background:var(--wb-bg-panel);border-radius:8px 8px 0 0;touch-action:none;-webkit-user-select:none;user-select:none}.content-top-drag-grip[data-v-032fd8fa]{font-size:12px;color:var(--wb-text-dim);letter-spacing:3px;line-height:1}.text-area.compact[data-v-032fd8fa]{min-height:60px}.editor-center[data-v-032fd8fa]{padding:8px}.editor-side[data-v-032fd8fa]{padding:8px}.editor-grid.two-cols[data-v-032fd8fa]{grid-template-columns:1fr}}\n`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/worldbook_assistant_build/App.vue\"],\"names\":[],\"mappings\":\"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G,cAAe,CACf,mCAAoC,CACpC,oBAAqB,CACrB,wBACF,CAEA,2BACE,YAAa,CACb,8BAA+B,CAC/B,iBAAkB,CAClB,+CACF,CAEA,0BACE,0BAA2B,CAC3B,eAAgB,CAChB,8CAA+C,CAC/C,wBAAiB,CAAjB,gBACF,CAEA,4BACE,oBAAqB,CACrB,qBAAsB,CACtB,eAAgB,CAChB,yBACF,CAEA,+BACE,+BACF,CAEA,+BACE,+BACF,CAEA,iCACE,iCACF,CAEA,0BACE,kCACE,yBACF,CAEA,8BACE,gBAAiB,CACjB,eACF,CAEA,wCACE,yBACF,CAEA,sCACE,iBAAkB,CAClB,6CAA8C,CAC9C,gBACF,CAEA,oCACE,WACF,CAEA,mCACE,UAAW,CACX,4BAA6B,CAC7B,wBAAyB,CACzB,iBACF,CAEA,0CACE,cAAe,CACf,OAAQ,CACR,eAAgB,CAChB,aACF,CAEA,iDACE,cACF,CAEA,+DACE,YACF,CAEA,2CACE,OACF,CAEA,gDACE,cAAe,CACf,eACF,CAEA,wCACE,yBAA0B,CAC1B,eAAgB,CAChB,MAAO,CACP,YACF,CAEA,uCACE,eAAgB,CAChB,YACF,CAEA,uCACE,yBAA0B,CAC1B,gBACF,CAEA,2CACE,eAAgB,CAChB,aACF,CAEA,+CACE,gBAAiB,CACjB,0CACF,CAEA,2BACE,yBACF,CAEA,0BACE,YACF,CAEA,uCACE,cACF,CAEA,uCACE,cAAe,CACf,OAAQ,CACR,eACF,CAEA,2CACE,cACF,CACF,CAEA,0BACE,mCACE,yBACF,CAEA,mCACE,YACF,CAEA,iCACE,yBACF,CAEA,gCACE,yBACF,CAEA,gFAEE,yBACF,CAEA,8BACE,qBAAsB,CACtB,mBACF,CAEA,gCACE,0BACF,CAEA,uCACE,yBACF,CAEA,uCACE,yBACF,CAEA,+CACE,gBAAiB,CACjB,0CACF,CAEA,4BACE,qBACF,CAGA,qCACE,mCAAoC,CACpC,mBAAoB,CACpB,SACF,CACF,CAEA,kCACE,YAAa,CACb,kBAAmB,CACnB,OAAQ,CACR,iBAAkB,CAClB,gBAAiB,CACjB,6BAA8B,CAC9B,WAAY,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yC,CACzC,cACF,CAEA,yCACE,kBACF,CAEA,qDACE,cACF,CAEA,8BACE,MAAO,CACP,YAAa,CACb,qBAAsB,CACtB,OAAQ,CACR,WACF,CAEA,8BACE,eAAgB,CAChB,eAAgB,CAChB,uBACF,CAEA,iCACE,eAAgB,CAChB,wBAAyB,CACzB,oBAAqB,CACrB,oBAAqB,CACrB,eACF,CAEA,wCACE,YAAa,CACb,OAAQ,CACR,iBAAkB,CAClB,qCAAsC,CACtC,wBACF,CAEA,8BACE,4BAA6B,CAC7B,UAAW,CACX,8BACF,CAEA,oCACE,sBACF,CAEA,uCACE,WAAY,CACZ,kBACF,CAKA,yBACE,oCACE,WAAY,CACZ,OAAQ,CACR,eACF,CAGA,gCACE,eAAgB,CAChB,UACF,CAEA,uCACE,MAAO,CACP,WACF,CAEA,+BACE,UAAW,CACX,YAAa,CACb,cAAe,CACf,OACF,CAEA,oCACE,gBAAiB,CACjB,eACF,CAGA,8BACE,cAAe,CACf,OAAQ,CACR,eAAgB,CAChB,gBACF,CAGA,iCACE,wBAAyB,CACzB,gBAAiB,CACjB,SACF,CAEA,mCACE,uBACF,CAEA,4DAEE,YAAa,CACb,eACF,CAGA,qCACE,qBACF,CAEA,6BACE,UAAW,CACX,eAAgB,CAChB,gBAAiB,CACjB,iBAAkB,CAClB,wCACF,CAEA,kCACE,gBACF,CAEA,kCACE,eAAgB,CAChB,iBAAkB,CAClB,YAAa,CACb,kBAAmB,CACnB,OAAQ,CACR,eACF,CAEA,kCACE,aAAc,CACd,eAAgB,CAChB,eACF,CAEA,mCACE,YAAa,CACb,OACF,CAEA,iCACE,aACF,CAEA,oCACE,gBAAiB,CACjB,OACF,CAEA,gCACE,eAAgB,CAChB,gBACF,CAGA,sCACE,UAAW,CACX,eACF,CAEA,wCACE,cAAe,CACf,OAAQ,CACR,gBACF,CAEA,6CACE,MAAO,CACP,WAAY,CACZ,gBACF,CAGA,4BACE,gBAAiB,CACjB,eAAgB,CAChB,OACF,CAGA,sCACE,MAAO,CACP,eACF,CAEA,wCACE,YAAa,CACb,WACF,CAEA,uCACE,iBAAkB,CAClB,UAAW,CACX,4BACF,CAEA,0CACE,YAAa,CACb,kBAAmB,CACnB,sBAAuB,CACvB,WAAY,CACZ,gBAAiB,CACjB,6BAA8B,CAC9B,yBAA0B,CAC1B,iBAAkB,CAClB,wBAAiB,CAAjB,gBACF,CAEA,wCACE,cAAe,CACf,wBAAyB,CACzB,kBAAmB,CACnB,aACF,CAEA,oCACE,eACF,CAEA,gCACE,WACF,CAEA,8BACE,WACF,CAEA,uCACE,yBACF,CACF\",\"sourcesContent\":[\"<template>\\n  <div ref=\\\"rootRef\\\" class=\\\"wb-assistant-root\\\" :style=\\\"themeStyles\\\">\\n\\n    <!--  Mobile Tab View  -->\\n    <template v-if=\\\"isMobile\\\">\\n      <div class=\\\"mobile-tab-view\\\">\\n        <div class=\\\"mobile-tab-content\\\">\\n\\n          <!-- Tab:  -->\\n          <div v-show=\\\"mobileTab === 'list'\\\" class=\\\"mobile-pane\\\">\\n            <section class=\\\"wb-toolbar\\\">\\n              <label class=\\\"toolbar-label\\\">\\n                <span></span>\\n                <div ref=\\\"worldbookPickerRef\\\" class=\\\"worldbook-picker\\\">\\n                  <button class=\\\"worldbook-picker-trigger\\\" type=\\\"button\\\" @click=\\\"toggleWorldbookPicker\\\">\\n                    <span class=\\\"worldbook-picker-trigger-text\\\" :title=\\\"selectedWorldbookName || ''\\\">\\n                      {{ selectedWorldbookName || '' }}\\n                    </span>\\n                    <span class=\\\"worldbook-picker-arrow\\\"></span>\\n                  </button>\\n                  <div v-if=\\\"worldbookPickerOpen\\\" class=\\\"worldbook-picker-dropdown\\\">\\n                    <input\\n                      v-model=\\\"worldbookPickerSearchText\\\"\\n                      type=\\\"text\\\"\\n                      class=\\\"text-input worldbook-picker-search\\\"\\n                      placeholder=\\\"...\\\"\\n                      @keydown.enter.prevent=\\\"filteredSelectableWorldbookNames[0] && selectWorldbookFromPicker(filteredSelectableWorldbookNames[0])\\\"\\n                    />\\n                    <div class=\\\"worldbook-picker-list\\\">\\n                      <button\\n                        v-for=\\\"name in filteredSelectableWorldbookNames\\\"\\n                        :key=\\\"`wb-pick-m-${name}`\\\"\\n                        class=\\\"worldbook-picker-item\\\"\\n                        :class=\\\"{ active: name === selectedWorldbookName }\\\"\\n                        type=\\\"button\\\"\\n                        @click=\\\"selectWorldbookFromPicker(name)\\\"\\n                      >{{ name }}</button>\\n                      <div v-if=\\\"!filteredSelectableWorldbookNames.length\\\" class=\\\"empty-note\\\"></div>\\n                    </div>\\n                  </div>\\n                </div>\\n              </label>\\n              <div class=\\\"toolbar-btns\\\" style=\\\"display:flex;gap:6px;flex-wrap:wrap;\\\">\\n                <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!hasUnsavedChanges\\\" @click=\\\"saveCurrentWorldbook\\\" style=\\\"padding:8px 14px;font-size:13px;\\\"> </button>\\n                <button class=\\\"btn\\\" type=\\\"button\\\" @click=\\\"addEntry\\\" style=\\\"padding:8px 14px;font-size:13px;\\\">+ </button>\\n                <button class=\\\"btn\\\" type=\\\"button\\\" @click=\\\"triggerImport\\\" style=\\\"padding:8px 14px;font-size:13px;\\\"> </button>\\n                <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!selectedWorldbookName\\\" @click=\\\"exportCurrentWorldbook\\\" style=\\\"padding:8px 14px;font-size:13px;\\\"> </button>\\n                <button class=\\\"btn\\\" type=\\\"button\\\" @click=\\\"toggleGlobalMode\\\" :style=\\\"{ padding:'8px 14px', fontSize:'13px', background: globalWorldbookMode ? '#2563eb' : '', color: globalWorldbookMode ? '#fff' : '' }\\\"> </button>\\n              </div>\\n            </section>\\n            <div class=\\\"wb-bindings\\\" v-if=\\\"bindings.global.length || bindings.charPrimary || bindings.charAdditional.length || bindings.chat\\\">\\n              <span v-for=\\\"name in bindings.global\\\" :key=\\\"`bg-m-${name}`\\\" class=\\\"binding-chip global\\\" :title=\\\"name\\\">{{ name }}</span>\\n              <span v-if=\\\"bindings.charPrimary\\\" :key=\\\"`bc-m-${bindings.charPrimary}`\\\" class=\\\"binding-chip char\\\" :title=\\\"bindings.charPrimary\\\">{{ bindings.charPrimary }}</span>\\n              <span v-for=\\\"name in bindings.charAdditional\\\" :key=\\\"`bca-m-${name}`\\\" class=\\\"binding-chip char\\\" :title=\\\"name\\\">{{ name }}</span>\\n              <span v-if=\\\"bindings.chat\\\" :key=\\\"`bch-m-${bindings.chat}`\\\" class=\\\"binding-chip chat\\\" :title=\\\"bindings.chat\\\">{{ bindings.chat }}</span>\\n            </div>\\n            <!-- Global Mode Panel (mobile) -->\\n            <div v-if=\\\"globalWorldbookMode\\\" style=\\\"border:1px solid var(--wb-border-subtle);border-radius:8px;padding:10px;margin-bottom:8px;background:var(--wb-bg-card);\\\">\\n              <div style=\\\"display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;\\\">\\n                <span style=\\\"font-weight:600;font-size:13px;\\\"> {{ bindings.global.length }}</span>\\n                <button class=\\\"btn mini danger\\\" type=\\\"button\\\" :disabled=\\\"!bindings.global.length\\\" @click=\\\"clearGlobalWorldbooks\\\" style=\\\"font-size:11px;\\\"></button>\\n              </div>\\n              <label class=\\\"field\\\" style=\\\"margin-bottom:6px;\\\">\\n                <span style=\\\"font-size:12px;\\\"></span>\\n                <select v-model=\\\"selectedGlobalPresetId\\\" class=\\\"text-input\\\" @change=\\\"onGlobalPresetSelectionChanged\\\" style=\\\"font-size:12px;\\\">\\n                  <option value=\\\"\\\"></option>\\n                  <option v-for=\\\"preset in globalWorldbookPresets\\\" :key=\\\"preset.id\\\" :value=\\\"preset.id\\\">\\n                    {{ preset.name }}{{ preset.worldbooks.length }}\\n                  </option>\\n                </select>\\n              </label>\\n              <div style=\\\"display:flex;gap:4px;flex-wrap:wrap;margin-bottom:8px;\\\">\\n                <button class=\\\"btn mini\\\" type=\\\"button\\\" :disabled=\\\"!bindings.global.length\\\" @click=\\\"saveCurrentAsGlobalPreset\\\" style=\\\"font-size:11px;\\\"></button>\\n                <button class=\\\"btn mini\\\" type=\\\"button\\\" :disabled=\\\"!selectedGlobalPreset\\\" @click=\\\"overwriteSelectedGlobalPreset\\\" style=\\\"font-size:11px;\\\"></button>\\n                <button class=\\\"btn mini danger\\\" type=\\\"button\\\" :disabled=\\\"!selectedGlobalPreset\\\" @click=\\\"deleteSelectedGlobalPreset\\\" style=\\\"font-size:11px;\\\"></button>\\n              </div>\\n              <label class=\\\"field\\\" style=\\\"margin-bottom:6px;\\\">\\n                <span style=\\\"font-size:12px;\\\"></span>\\n                <input v-model=\\\"globalAddSearchText\\\" type=\\\"text\\\" class=\\\"text-input\\\" placeholder=\\\"...\\\" @keydown.enter.prevent=\\\"addFirstGlobalCandidate\\\" style=\\\"font-size:12px;\\\" />\\n              </label>\\n              <div v-if=\\\"globalAddCandidates.length\\\" style=\\\"max-height:120px;overflow-y:auto;margin-bottom:6px;\\\">\\n                <button v-for=\\\"name in globalAddCandidates\\\" :key=\\\"`m-add-${name}`\\\" type=\\\"button\\\" style=\\\"display:flex;justify-content:space-between;align-items:center;width:100%;padding:6px 8px;border:none;background:var(--wb-input-bg);border-radius:4px;color:var(--wb-text-main);font-size:12px;margin-bottom:2px;cursor:pointer;\\\" @click=\\\"addGlobalWorldbook(name)\\\">\\n                  <span>{{ name }}</span><span style=\\\"color:#22c55e;\\\">+ </span>\\n                </button>\\n              </div>\\n              <div v-if=\\\"filteredGlobalWorldbooks.length\\\" style=\\\"font-size:12px;margin-bottom:4px;opacity:0.7;\\\"></div>\\n              <div style=\\\"display:flex;flex-direction:column;gap:2px;margin-bottom:8px;\\\">\\n                <button v-for=\\\"name in filteredGlobalWorldbooks\\\" :key=\\\"`m-gl-${name}`\\\" type=\\\"button\\\" style=\\\"display:flex;justify-content:space-between;align-items:center;width:100%;padding:6px 8px;border:none;background:var(--wb-input-bg);border-radius:4px;color:var(--wb-text-main);font-size:12px;cursor:pointer;\\\" @click=\\\"removeGlobalWorldbook(name)\\\">\\n                  <span>{{ name }}</span><span style=\\\"color:#ef4444;\\\"></span>\\n                </button>\\n              </div>\\n              <!-- Role Binding Section -->\\n              <div style=\\\"border-top:1px solid var(--wb-border-subtle);padding-top:8px;margin-top:4px;\\\">\\n                <div style=\\\"font-size:12px;font-weight:600;margin-bottom:6px;\\\"></div>\\n                <div style=\\\"font-size:11px;margin-bottom:6px;opacity:0.8;\\\" :style=\\\"{ color: currentRoleContext ? '#60a5fa' : '#94a3b8' }\\\">\\n                  {{ currentRoleContext ? `: ${currentRoleContext.name}` : '' }}\\n                </div>\\n                <div style=\\\"display:flex;gap:4px;flex-wrap:wrap;margin-bottom:6px;\\\">\\n                  <button class=\\\"btn mini\\\" type=\\\"button\\\" :disabled=\\\"!selectedGlobalPreset || !currentRoleContext\\\" @click=\\\"bindCurrentRoleToSelectedPreset\\\" style=\\\"font-size:11px;\\\"></button>\\n                  <button class=\\\"btn mini\\\" type=\\\"button\\\" :disabled=\\\"!selectedGlobalPreset || !isCurrentRoleBoundToSelectedPreset\\\" @click=\\\"unbindCurrentRoleFromSelectedPreset\\\" style=\\\"font-size:11px;\\\"></button>\\n                </div>\\n                <div style=\\\"margin-bottom:6px;\\\">\\n                  <button type=\\\"button\\\" :disabled=\\\"!selectedGlobalPreset\\\" @click=\\\"toggleRolePicker\\\" style=\\\"display:flex;justify-content:space-between;align-items:center;width:100%;padding:6px 8px;border:1px solid var(--wb-border-subtle);border-radius:4px;background:var(--wb-input-bg);color:var(--wb-text-main);font-size:12px;cursor:pointer;\\\">\\n                    <span>{{ selectedGlobalPreset ? '' : '' }}</span>\\n                    <span>{{ rolePickerOpen ? '' : '' }}</span>\\n                  </button>\\n                  <div v-if=\\\"rolePickerOpen\\\" style=\\\"margin-top:4px;\\\">\\n                    <input v-model=\\\"roleBindSearchText\\\" type=\\\"text\\\" class=\\\"text-input\\\" placeholder=\\\"...\\\" style=\\\"font-size:12px;margin-bottom:4px;\\\" @keydown.enter.prevent=\\\"bindFirstRoleCandidate\\\" />\\n                    <div style=\\\"max-height:120px;overflow-y:auto;\\\">\\n                      <button v-for=\\\"candidate in roleBindingCandidates\\\" :key=\\\"`m-role-${candidate.key}`\\\" type=\\\"button\\\" :disabled=\\\"candidate.bound\\\" style=\\\"display:flex;justify-content:space-between;align-items:center;width:100%;padding:6px 8px;border:none;background:var(--wb-input-bg);border-radius:4px;color:var(--wb-text-main);font-size:12px;margin-bottom:2px;cursor:pointer;opacity: 1;\\\" :style=\\\"{ opacity: candidate.bound ? '0.5' : '1' }\\\" @click=\\\"bindRoleCandidateToSelectedPreset(candidate)\\\">\\n                        <span>{{ candidate.name }}</span><span :style=\\\"{ color: candidate.bound ? '#94a3b8' : '#22c55e' }\\\">{{ candidate.bound ? '' : '' }}</span>\\n                      </button>\\n                      <div v-if=\\\"!roleBindingCandidates.length\\\" style=\\\"font-size:11px;opacity:0.5;padding:4px;\\\"></div>\\n                    </div>\\n                  </div>\\n                </div>\\n                <div v-if=\\\"selectedGlobalPreset\\\" style=\\\"display:flex;flex-wrap:wrap;gap:4px;\\\">\\n                  <button v-for=\\\"binding in selectedGlobalPresetRoleBindings\\\" :key=\\\"`m-rb-${selectedGlobalPreset?.id}-${binding.key}`\\\" type=\\\"button\\\" style=\\\"display:inline-flex;align-items:center;gap:4px;padding:4px 8px;border:1px solid var(--wb-border-subtle);border-radius:4px;background:var(--wb-input-bg);color:var(--wb-text-main);font-size:11px;cursor:pointer;\\\" @click=\\\"removeRoleBindingFromSelectedPreset(binding.key)\\\">\\n                    {{ binding.name }} <span style=\\\"color:#ef4444;\\\"></span>\\n                  </button>\\n                  <div v-if=\\\"!selectedGlobalPresetRoleBindings.length\\\" style=\\\"font-size:11px;opacity:0.5;\\\"></div>\\n                </div>\\n                <div v-else style=\\\"font-size:11px;opacity:0.5;\\\"></div>\\n              </div>\\n            </div>\\n            <div class=\\\"mobile-entry-list\\\">\\n              <button\\n                v-for=\\\"entry in filteredEntries\\\"\\n                :key=\\\"`me-${entry.uid}`\\\"\\n                type=\\\"button\\\"\\n                class=\\\"entry-item\\\"\\n                :data-status=\\\"getEntryVisualStatus(entry)\\\"\\n                :class=\\\"{ selected: entry.uid === selectedEntryUid, disabled: !entry.enabled }\\\"\\n                @click=\\\"selectEntry(entry.uid)\\\"\\n                style=\\\"border: 1px solid var(--wb-border-subtle); border-radius: 8px; padding: 8px 10px; margin-bottom: 4px;\\\"\\n              >\\n                <div class=\\\"entry-item-head\\\">\\n                  <span class=\\\"entry-status-dot\\\" :data-status=\\\"getEntryVisualStatus(entry)\\\"></span>\\n                  <div class=\\\"entry-item-title\\\">{{ entry.name || ` ${entry.uid}` }}</div>\\n                  <span class=\\\"entry-chip uid\\\">#{{ entry.uid }}</span>\\n                </div>\\n                <div class=\\\"entry-item-keys\\\" v-if=\\\"entry.strategy.keys?.length\\\">\\n                  {{ entry.strategy.keys.join(', ') }}\\n                </div>\\n                <div style=\\\"display:flex;gap:6px;flex-wrap:wrap;margin-top:4px;font-size:10px;opacity:0.8;\\\">\\n                  <span style=\\\"background:var(--wb-input-bg);padding:2px 6px;border-radius:4px;\\\"> {{ getPositionTypeLabel(entry.position.type) }}</span>\\n                  <span style=\\\"background:var(--wb-input-bg);padding:2px 6px;border-radius:4px;\\\"> #{{ entry.position.order }}</span>\\n                  <span v-if=\\\"entry.recursion.prevent_incoming\\\" style=\\\"background:var(--wb-input-bg);padding:2px 6px;border-radius:4px;color:#f59e0b;\\\"></span>\\n                  <span v-if=\\\"entry.recursion.prevent_outgoing\\\" style=\\\"background:var(--wb-input-bg);padding:2px 6px;border-radius:4px;color:#f59e0b;\\\"></span>\\n                </div>\\n              </button>\\n              <div v-if=\\\"!filteredEntries.length\\\" class=\\\"empty-note\\\"></div>\\n            </div>\\n          </div>\\n\\n          <!-- Tab:  -->\\n          <div v-show=\\\"mobileTab === 'edit'\\\" class=\\\"mobile-pane\\\">\\n            <template v-if=\\\"selectedEntry\\\">\\n              <header class=\\\"editor-head\\\">\\n                <label class=\\\"field editor-comment\\\">\\n                  <span> (COMMENT)</span>\\n                  <input v-model=\\\"selectedEntry.name\\\" type=\\\"text\\\" class=\\\"text-input\\\" />\\n                </label>\\n                <div class=\\\"editor-badges\\\">\\n                  <span class=\\\"editor-badge\\\" :class=\\\"selectedEntry.enabled ? 'on' : 'off'\\\">{{ selectedEntry.enabled ? 'EN' : 'OFF' }}</span>\\n                  <span class=\\\"editor-badge mono\\\">#{{ selectedEntry.uid }}</span>\\n                  <span class=\\\"editor-badge mono\\\">~{{ selectedTokenEstimate }}T</span>\\n                </div>\\n              </header>\\n              <section class=\\\"editor-grid two-cols editor-keyword-grid\\\">\\n                <label class=\\\"field\\\">\\n                  <span> (KEYS)</span>\\n                  <textarea v-model=\\\"selectedKeysText\\\" class=\\\"text-area compact\\\"></textarea>\\n                </label>\\n                <label class=\\\"field\\\">\\n                  <span> (SECONDARY)</span>\\n                  <textarea v-model=\\\"selectedSecondaryKeysText\\\" class=\\\"text-area compact\\\"></textarea>\\n                </label>\\n              </section>\\n              <section class=\\\"editor-content-block\\\" ref=\\\"editorContentBlockRef\\\">\\n                <div v-if=\\\"isMobile\\\" class=\\\"content-top-drag-handle\\\" @pointerdown=\\\"startContentTopDrag\\\">\\n                  <span class=\\\"content-top-drag-grip\\\"></span>\\n                </div>\\n                <div class=\\\"editor-content-title\\\"> /  (CONTENT)</div>\\n                <textarea\\n                  ref=\\\"contentTextareaRef\\\"\\n                  v-model=\\\"selectedEntry.content\\\"\\n                  class=\\\"text-area large editor-content-area\\\"\\n                  style=\\\"min-height: calc(100vh - 500px);\\\"\\n                ></textarea>\\n                <div class=\\\"content-resize-handle\\\" @pointerdown=\\\"startContentResize\\\">\\n                  <span class=\\\"content-resize-grip\\\"></span>\\n                </div>\\n              </section>\\n            </template>\\n            <div v-else class=\\\"empty-block\\\"></div>\\n          </div>\\n\\n          <!-- Tab:  -->\\n          <div v-show=\\\"mobileTab === 'settings'\\\" class=\\\"mobile-pane\\\">\\n            <template v-if=\\\"selectedEntry\\\">\\n              <article class=\\\"editor-card\\\">\\n                <h4> (STRATEGY)</h4>\\n                <label class=\\\"field checkbox-inline\\\">\\n                  <input v-model=\\\"selectedEntry.enabled\\\" type=\\\"checkbox\\\" />\\n                  <span></span>\\n                </label>\\n                <div class=\\\"strategy-switch\\\">\\n                  <button type=\\\"button\\\" class=\\\"strategy-pill constant\\\" :class=\\\"{ active: selectedEntry.strategy.type === 'constant' }\\\" @click=\\\"selectedEntry.strategy.type = 'constant'\\\"> </button>\\n                  <button type=\\\"button\\\" class=\\\"strategy-pill vector\\\" :class=\\\"{ active: selectedEntry.strategy.type === 'vectorized' }\\\" @click=\\\"selectedEntry.strategy.type = 'vectorized'\\\"> </button>\\n                  <button type=\\\"button\\\" class=\\\"strategy-pill selective\\\" :class=\\\"{ active: selectedEntry.strategy.type === 'selective' }\\\" @click=\\\"selectedEntry.strategy.type = 'selective'\\\"> </button>\\n                </div>\\n                <details class=\\\"editor-advanced\\\">\\n                  <summary></summary>\\n                  <label class=\\\"field\\\">\\n                    <span> (LOGIC)</span>\\n                    <select v-model=\\\"selectedEntry.strategy.keys_secondary.logic\\\" class=\\\"text-input\\\">\\n                      <option v-for=\\\"item in secondaryLogicOptions\\\" :key=\\\"`ml-${item}`\\\" :value=\\\"item\\\">{{ getSecondaryLogicLabel(item) }}</option>\\n                    </select>\\n                  </label>\\n                  <label class=\\\"field\\\">\\n                    <span></span>\\n                    <input v-model=\\\"selectedScanDepthText\\\" type=\\\"text\\\" class=\\\"text-input\\\" placeholder=\\\" same_as_global\\\" />\\n                  </label>\\n                  <label class=\\\"field\\\">\\n                    <span>(0-100)</span>\\n                    <input v-model.number=\\\"selectedEntry.probability\\\" type=\\\"number\\\" class=\\\"text-input\\\" min=\\\"0\\\" max=\\\"100\\\" step=\\\"1\\\" />\\n                  </label>\\n                </details>\\n              </article>\\n              <article class=\\\"editor-card\\\">\\n                <h4> (INSERTION)</h4>\\n                <label class=\\\"field\\\">\\n                  <span> (Position)</span>\\n                  <select v-model=\\\"selectedEntry.position.type\\\" class=\\\"text-input\\\" @change=\\\"handleSelectedPositionTypeChanged\\\">\\n                    <option v-for=\\\"item in positionTypeOptions\\\" :key=\\\"`mp-${item}`\\\" :value=\\\"item\\\">{{ getPositionTypeLabel(item) }}</option>\\n                  </select>\\n                </label>\\n                <label class=\\\"field\\\">\\n                  <span> (Order)</span>\\n                  <input v-model.number=\\\"selectedEntry.position.order\\\" type=\\\"number\\\" class=\\\"text-input\\\" step=\\\"1\\\" />\\n                </label>\\n                <div class=\\\"editor-grid two-cols\\\">\\n                  <label class=\\\"field\\\" :class=\\\"{ disabled: selectedEntry.position.type !== 'at_depth' }\\\">\\n                    <span>at_depth role</span>\\n                    <select v-model=\\\"selectedEntry.position.role\\\" class=\\\"text-input\\\" :disabled=\\\"selectedEntry.position.type !== 'at_depth'\\\">\\n                      <option value=\\\"system\\\">system</option>\\n                      <option value=\\\"assistant\\\">assistant</option>\\n                      <option value=\\\"user\\\">user</option>\\n                    </select>\\n                  </label>\\n                  <label class=\\\"field\\\" :class=\\\"{ disabled: selectedEntry.position.type !== 'at_depth' }\\\">\\n                    <span>at_depth depth</span>\\n                    <input v-model.number=\\\"selectedEntry.position.depth\\\" type=\\\"number\\\" class=\\\"text-input\\\" min=\\\"1\\\" step=\\\"1\\\" :disabled=\\\"selectedEntry.position.type !== 'at_depth'\\\" />\\n                  </label>\\n                </div>\\n              </article>\\n              <article class=\\\"editor-card\\\">\\n                <h4> (RECURSION)</h4>\\n                <label class=\\\"field checkbox-inline\\\">\\n                  <input v-model=\\\"selectedEntry.recursion.prevent_incoming\\\" type=\\\"checkbox\\\" />\\n                  <span></span>\\n                </label>\\n                <label class=\\\"field checkbox-inline\\\">\\n                  <input v-model=\\\"selectedEntry.recursion.prevent_outgoing\\\" type=\\\"checkbox\\\" />\\n                  <span></span>\\n                </label>\\n              </article>\\n              <details class=\\\"editor-advanced\\\">\\n                <summary> / extra JSON</summary>\\n                <label class=\\\"field\\\">\\n                  <span>extra JSON</span>\\n                  <textarea v-model=\\\"selectedExtraText\\\" class=\\\"text-area compact\\\" placeholder=\\\"{ ... }\\\"></textarea>\\n                </label>\\n                <div class=\\\"field-actions\\\">\\n                  <button class=\\\"btn\\\" type=\\\"button\\\" @click=\\\"applyExtraJson\\\"> extra</button>\\n                  <button class=\\\"btn\\\" type=\\\"button\\\" @click=\\\"clearExtra\\\"> extra</button>\\n                </div>\\n              </details>\\n              <div class=\\\"mobile-danger-zone\\\">\\n                <button class=\\\"btn danger\\\" type=\\\"button\\\" @click=\\\"removeSelectedEntry\\\"> </button>\\n                <button class=\\\"btn\\\" type=\\\"button\\\" @click=\\\"duplicateSelectedEntry\\\"> </button>\\n              </div>\\n            </template>\\n            <div v-else class=\\\"empty-block\\\"></div>\\n          </div>\\n\\n          <!-- Tab: AI -->\\n          <div v-show=\\\"mobileTab === 'ai'\\\" class=\\\"mobile-pane\\\">\\n            <section class=\\\"ai-generator-panel mobile-ai-panel\\\">\\n              <div class=\\\"ai-chat-area\\\">\\n                <div v-if=\\\"!aiActiveSession\\\" class=\\\"ai-chat-empty\\\">\\n                  <div class=\\\"ai-chat-empty-icon\\\"></div>\\n                  <div class=\\\"ai-chat-empty-text\\\"></div>\\n                  <button class=\\\"btn\\\" type=\\\"button\\\" @click=\\\"aiCreateSession\\\">+ </button>\\n                </div>\\n                <template v-else>\\n                  <div class=\\\"ai-chat-messages\\\" ref=\\\"aiChatMessagesRef\\\">\\n                    <div v-for=\\\"(msg, idx) in aiActiveMessages\\\" :key=\\\"`mmsg-${idx}`\\\" class=\\\"ai-chat-bubble\\\" :class=\\\"msg.role\\\">\\n                      <div class=\\\"ai-chat-bubble-role\\\">{{ msg.role === 'user' ? ' ' : ' AI' }}</div>\\n                      <div class=\\\"ai-chat-bubble-content\\\">{{ msg.content }}</div>\\n                    </div>\\n                    <div v-if=\\\"aiIsGenerating && aiStreamingText\\\" class=\\\"ai-chat-bubble assistant streaming\\\">\\n                      <div class=\\\"ai-chat-bubble-role\\\"> AI</div>\\n                      <div class=\\\"ai-chat-bubble-content\\\">{{ aiStreamingText }}<span class=\\\"ai-cursor\\\"></span></div>\\n                    </div>\\n                    <div v-if=\\\"aiIsGenerating && !aiStreamingText\\\" class=\\\"ai-chat-bubble assistant streaming\\\">\\n                      <div class=\\\"ai-chat-bubble-role\\\"> AI</div>\\n                      <div class=\\\"ai-chat-bubble-content\\\"><span class=\\\"ai-thinking\\\">...</span></div>\\n                    </div>\\n                  </div>\\n                  <div class=\\\"ai-chat-input-bar\\\">\\n                    <label class=\\\"ai-context-toggle\\\" title=\\\"AI \\\">\\n                      <input v-model=\\\"aiUseContext\\\" type=\\\"checkbox\\\" />\\n                      <span>{{ aiUseContext ? ' ' : ' ' }}</span>\\n                    </label>\\n                    <textarea v-model=\\\"aiChatInputText\\\" class=\\\"text-input ai-chat-input\\\" placeholder=\\\"...\\\" rows=\\\"2\\\" :disabled=\\\"aiIsGenerating\\\" @keydown.enter.exact.prevent=\\\"aiSendMessage\\\"></textarea>\\n                    <button v-if=\\\"!aiIsGenerating\\\" class=\\\"btn ai-send-btn\\\" type=\\\"button\\\" :disabled=\\\"!aiChatInputText.trim()\\\" @click=\\\"aiSendMessage\\\"></button>\\n                    <button v-else class=\\\"btn danger ai-stop-btn\\\" type=\\\"button\\\" @click=\\\"aiStopGeneration\\\"></button>\\n                  </div>\\n                </template>\\n              </div>\\n            </section>\\n          </div>\\n\\n        </div>\\n      </div>\\n      <!-- Tab Bar: bottom, direct child of wb-assistant-root via fragment -->\\n      <div style=\\\"display:flex !important;flex-shrink:0;height:52px;background:#1e293b;border-top:1px solid #334155;z-index:99999;\\\">\\n        <button @click=\\\"mobileTab = 'list'\\\" :style=\\\"{ flex:1,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',border:'none',borderTop: mobileTab==='list' ? '2px solid #60a5fa' : '2px solid transparent',background:'transparent',color: mobileTab==='list' ? '#e2e8f0' : '#94a3b8',fontSize:'10px',padding:'4px 0',gap:'2px' }\\\">\\n          <span style=\\\"font-size:20px;\\\"></span><span></span>\\n        </button>\\n        <button @click=\\\"mobileTab = 'edit'\\\" :style=\\\"{ flex:1,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',border:'none',borderTop: mobileTab==='edit' ? '2px solid #60a5fa' : '2px solid transparent',background:'transparent',color: mobileTab==='edit' ? '#e2e8f0' : '#94a3b8',fontSize:'10px',padding:'4px 0',gap:'2px' }\\\">\\n          <span style=\\\"font-size:20px;\\\"></span><span></span>\\n        </button>\\n        <button @click=\\\"mobileTab = 'settings'\\\" :style=\\\"{ flex:1,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',border:'none',borderTop: mobileTab==='settings' ? '2px solid #60a5fa' : '2px solid transparent',background:'transparent',color: mobileTab==='settings' ? '#e2e8f0' : '#94a3b8',fontSize:'10px',padding:'4px 0',gap:'2px' }\\\">\\n          <span style=\\\"font-size:20px;\\\"></span><span></span>\\n        </button>\\n        <button @click=\\\"mobileTab = 'ai'\\\" :style=\\\"{ flex:1,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',border:'none',borderTop: mobileTab==='ai' ? '2px solid #60a5fa' : '2px solid transparent',background:'transparent',color: mobileTab==='ai' ? '#e2e8f0' : '#94a3b8',fontSize:'10px',padding:'4px 0',gap:'2px' }\\\">\\n          <span style=\\\"font-size:20px;\\\"></span><span>AI</span>\\n        </button>\\n      </div>\\n    </template>\\n\\n    <!--  Desktop Layout  -->\\n    <template v-if=\\\"!isMobile\\\">\\n    <section class=\\\"wb-toolbar\\\">\\n            <label class=\\\"toolbar-label\\\">\\n              <span></span>\\n              <div ref=\\\"worldbookPickerRef\\\" class=\\\"worldbook-picker\\\">\\n                <button class=\\\"worldbook-picker-trigger\\\" type=\\\"button\\\" @click=\\\"toggleWorldbookPicker\\\">\\n                  <span class=\\\"worldbook-picker-trigger-text\\\" :title=\\\"selectedWorldbookName || ''\\\">\\n                    {{ selectedWorldbookName || '' }}\\n                  </span>\\n                  <span class=\\\"worldbook-picker-trigger-arrow\\\">{{ worldbookPickerOpen ? '' : '' }}</span>\\n                </button>\\n                <div v-if=\\\"worldbookPickerOpen\\\" class=\\\"worldbook-picker-dropdown\\\">\\n                  <input\\n                    ref=\\\"worldbookPickerSearchInputRef\\\"\\n                    v-model=\\\"worldbookPickerSearchText\\\"\\n                    type=\\\"text\\\"\\n                    class=\\\"text-input worldbook-picker-search\\\"\\n                    placeholder=\\\"...\\\"\\n                    @keydown.enter.prevent=\\\"filteredSelectableWorldbookNames[0] && selectWorldbookFromPicker(filteredSelectableWorldbookNames[0])\\\"\\n                  />\\n                  <div class=\\\"worldbook-picker-list\\\">\\n                    <button\\n                      v-for=\\\"name in filteredSelectableWorldbookNames\\\"\\n                      :key=\\\"`worldbook-${name}`\\\"\\n                      class=\\\"worldbook-picker-item\\\"\\n                      :class=\\\"{ active: name === selectedWorldbookName }\\\"\\n                      type=\\\"button\\\"\\n                      @click=\\\"selectWorldbookFromPicker(name)\\\"\\n                    >\\n                      {{ name }}\\n                    </button>\\n                    <div v-if=\\\"!filteredSelectableWorldbookNames.length\\\" class=\\\"empty-note\\\"></div>\\n                  </div>\\n                </div>\\n              </div>\\n            </label>\\n            <button class=\\\"btn\\\" type=\\\"button\\\" @click=\\\"createNewWorldbook\\\"></button>\\n            <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!selectedWorldbookName\\\" @click=\\\"duplicateWorldbook\\\">\\n              \\n            </button>\\n            <button class=\\\"btn danger\\\" type=\\\"button\\\" :disabled=\\\"!selectedWorldbookName\\\" @click=\\\"deleteCurrentWorldbook\\\">\\n              \\n            </button>\\n            <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!selectedWorldbookName\\\" @click=\\\"exportCurrentWorldbook\\\">\\n              \\n            </button>\\n            <button class=\\\"btn\\\" type=\\\"button\\\" @click=\\\"triggerImport\\\"></button>\\n            <input\\n              ref=\\\"importFileInput\\\"\\n              class=\\\"hidden-input\\\"\\n              type=\\\"file\\\"\\n              accept=\\\".json,application/json\\\"\\n              @change=\\\"onImportChange\\\"\\n            />\\n          </section>\\n\\n          <div class=\\\"wb-scroll-area\\\">\\n          <section class=\\\"wb-bindings\\\">\\n            <div class=\\\"wb-history-shortcuts\\\">\\n              <button\\n                class=\\\"btn history-btn utility-btn\\\"\\n                type=\\\"button\\\"\\n                :class=\\\"{ active: globalWorldbookMode }\\\"\\n                @click=\\\"toggleGlobalMode\\\"\\n              >\\n                 \\n              </button>\\n              <button class=\\\"btn history-btn\\\" type=\\\"button\\\" :disabled=\\\"!selectedEntry\\\" @click=\\\"openEntryHistoryModal\\\">\\n                 \\n              </button>\\n              <button\\n                class=\\\"btn history-btn\\\"\\n                type=\\\"button\\\"\\n                :disabled=\\\"!selectedWorldbookName\\\"\\n                @click=\\\"openWorldbookHistoryModal\\\"\\n              >\\n                 \\n              </button>\\n              <button\\n                class=\\\"btn history-btn utility-btn\\\"\\n                type=\\\"button\\\"\\n                :class=\\\"{ active: floatingPanels.find.visible }\\\"\\n                :disabled=\\\"!draftEntries.length\\\"\\n                @click=\\\"toggleFloatingPanel('find')\\\"\\n              >\\n                 \\n              </button>\\n              <button\\n                class=\\\"btn history-btn utility-btn\\\"\\n                type=\\\"button\\\"\\n                :class=\\\"{ active: floatingPanels.activation.visible }\\\"\\n                @click=\\\"toggleFloatingPanel('activation')\\\"\\n              >\\n                 \\n              </button>\\n              <button\\n                class=\\\"btn history-btn utility-btn\\\"\\n                type=\\\"button\\\"\\n                :class=\\\"{ active: aiGeneratorMode }\\\"\\n                @click=\\\"aiToggleMode\\\"\\n              >\\n                 AI \\n              </button>\\n            </div>\\n            <div v-if=\\\"globalWorldbookMode\\\" class=\\\"global-mode-panel\\\">\\n              <div class=\\\"global-mode-head\\\">\\n                <span class=\\\"global-mode-title\\\">{{ bindings.global.length }}</span>\\n                <button class=\\\"btn mini danger\\\" type=\\\"button\\\" :disabled=\\\"!bindings.global.length\\\" @click=\\\"clearGlobalWorldbooks\\\">\\n                  \\n                </button>\\n              </div>\\n              <div class=\\\"global-preset-panel\\\">\\n                <label class=\\\"field\\\">\\n                  <span></span>\\n                  <select v-model=\\\"selectedGlobalPresetId\\\" class=\\\"text-input\\\" @change=\\\"onGlobalPresetSelectionChanged\\\">\\n                    <option value=\\\"\\\"></option>\\n                    <option v-for=\\\"preset in globalWorldbookPresets\\\" :key=\\\"preset.id\\\" :value=\\\"preset.id\\\">\\n                      {{ preset.name }}{{ preset.worldbooks.length }}\\n                    </option>\\n                  </select>\\n                </label>\\n                <div class=\\\"global-mode-actions\\\">\\n                  <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!bindings.global.length\\\" @click=\\\"saveCurrentAsGlobalPreset\\\">\\n                    \\n                  </button>\\n                  <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!selectedGlobalPreset\\\" @click=\\\"overwriteSelectedGlobalPreset\\\">\\n                    \\n                  </button>\\n                  <button class=\\\"btn danger\\\" type=\\\"button\\\" :disabled=\\\"!selectedGlobalPreset\\\" @click=\\\"deleteSelectedGlobalPreset\\\">\\n                    \\n                  </button>\\n                </div>\\n                <div class=\\\"preset-role-panel\\\">\\n                  <div class=\\\"preset-role-head\\\">\\n                    <span></span>\\n                    <span class=\\\"preset-role-current\\\" :class=\\\"{ empty: !currentRoleContext }\\\">\\n                      {{ currentRoleContext ? `: ${currentRoleContext.name}` : '' }}\\n                    </span>\\n                  </div>\\n                  <div class=\\\"preset-role-actions\\\">\\n                    <button\\n                      class=\\\"btn mini\\\"\\n                      type=\\\"button\\\"\\n                      :disabled=\\\"!selectedGlobalPreset || !currentRoleContext\\\"\\n                      @click=\\\"bindCurrentRoleToSelectedPreset\\\"\\n                    >\\n                      \\n                    </button>\\n                    <button\\n                      class=\\\"btn mini\\\"\\n                      type=\\\"button\\\"\\n                      :disabled=\\\"!selectedGlobalPreset || !isCurrentRoleBoundToSelectedPreset\\\"\\n                      @click=\\\"unbindCurrentRoleFromSelectedPreset\\\"\\n                    >\\n                      \\n                    </button>\\n                  </div>\\n                  <div ref=\\\"rolePickerRef\\\" class=\\\"role-picker\\\">\\n                    <button\\n                      class=\\\"role-picker-trigger\\\"\\n                      type=\\\"button\\\"\\n                      :disabled=\\\"!selectedGlobalPreset\\\"\\n                      @click=\\\"toggleRolePicker\\\"\\n                    >\\n                      <span class=\\\"role-picker-trigger-text\\\">\\n                        {{ selectedGlobalPreset ? '' : '' }}\\n                      </span>\\n                      <span class=\\\"role-picker-trigger-arrow\\\">{{ rolePickerOpen ? '' : '' }}</span>\\n                    </button>\\n                    <div v-if=\\\"rolePickerOpen\\\" class=\\\"role-picker-dropdown\\\">\\n                      <input\\n                        ref=\\\"rolePickerSearchInputRef\\\"\\n                        v-model=\\\"roleBindSearchText\\\"\\n                        type=\\\"text\\\"\\n                        class=\\\"text-input role-picker-search\\\"\\n                        placeholder=\\\" / avatar...\\\"\\n                        @keydown.enter.prevent=\\\"bindFirstRoleCandidate\\\"\\n                      />\\n                      <div class=\\\"role-picker-list\\\">\\n                        <button\\n                          v-for=\\\"candidate in roleBindingCandidates\\\"\\n                          :key=\\\"`role-candidate-${candidate.key}`\\\"\\n                          class=\\\"role-picker-item\\\"\\n                          type=\\\"button\\\"\\n                          :disabled=\\\"candidate.bound\\\"\\n                          @click=\\\"bindRoleCandidateToSelectedPreset(candidate)\\\"\\n                        >\\n                          <span class=\\\"name\\\">{{ candidate.name }}</span>\\n                          <span class=\\\"meta\\\">{{ candidate.bound ? '' : '' }}</span>\\n                        </button>\\n                        <div v-if=\\\"!roleBindingCandidates.length\\\" class=\\\"empty-note\\\"></div>\\n                      </div>\\n                    </div>\\n                  </div>\\n                  <div class=\\\"preset-role-tags\\\">\\n                    <button\\n                      v-for=\\\"binding in selectedGlobalPresetRoleBindings\\\"\\n                      :key=\\\"`binding-${selectedGlobalPreset?.id}-${binding.key}`\\\"\\n                      class=\\\"preset-role-tag\\\"\\n                      type=\\\"button\\\"\\n                      :title=\\\"`: ${binding.name}`\\\"\\n                      @click=\\\"removeRoleBindingFromSelectedPreset(binding.key)\\\"\\n                    >\\n                      <span>{{ binding.name }}</span>\\n                      <span class=\\\"remove\\\"></span>\\n                    </button>\\n                    <div v-if=\\\"selectedGlobalPreset && !selectedGlobalPresetRoleBindings.length\\\" class=\\\"empty-note\\\">\\n                      \\n                    </div>\\n                    <div v-if=\\\"!selectedGlobalPreset\\\" class=\\\"empty-note\\\"></div>\\n                  </div>\\n                </div>\\n              </div>\\n              <div class=\\\"global-mode-grid\\\">\\n                <div class=\\\"global-mode-column\\\">\\n                  <label class=\\\"field\\\">\\n                    <span></span>\\n                    <input\\n                      v-model=\\\"globalAddSearchText\\\"\\n                      type=\\\"text\\\"\\n                      class=\\\"text-input\\\"\\n                      placeholder=\\\"...\\\"\\n                      @keydown.enter.prevent=\\\"addFirstGlobalCandidate\\\"\\n                    />\\n                  </label>\\n                  <div class=\\\"global-mode-list\\\">\\n                    <button\\n                      v-for=\\\"name in globalAddCandidates\\\"\\n                      :key=\\\"`add-${name}`\\\"\\n                      class=\\\"global-mode-item add\\\"\\n                      type=\\\"button\\\"\\n                      @click=\\\"addGlobalWorldbook(name)\\\"\\n                    >\\n                      <span class=\\\"global-mode-item-name\\\">{{ name }}</span>\\n                      <span class=\\\"global-mode-item-action\\\"></span>\\n                    </button>\\n                    <div v-if=\\\"!globalAddCandidates.length\\\" class=\\\"empty-note\\\"></div>\\n                  </div>\\n                </div>\\n                <div class=\\\"global-mode-column\\\">\\n                  <label class=\\\"field\\\">\\n                    <span></span>\\n                    <input\\n                      v-model=\\\"globalFilterText\\\"\\n                      type=\\\"text\\\"\\n                      class=\\\"text-input\\\"\\n                      placeholder=\\\"...\\\"\\n                    />\\n                  </label>\\n                  <div class=\\\"global-mode-list\\\">\\n                    <button\\n                      v-for=\\\"name in filteredGlobalWorldbooks\\\"\\n                      :key=\\\"`global-${name}`\\\"\\n                      class=\\\"global-mode-item active\\\"\\n                      type=\\\"button\\\"\\n                      @click=\\\"removeGlobalWorldbook(name)\\\"\\n                    >\\n                      <span class=\\\"global-mode-item-name\\\">{{ name }}</span>\\n                      <span class=\\\"global-mode-item-action\\\"></span>\\n                    </button>\\n                    <div v-if=\\\"!filteredGlobalWorldbooks.length\\\" class=\\\"empty-note\\\">\\n                      {{ bindings.global.length ? '' : '' }}\\n                    </div>\\n                  </div>\\n                </div>\\n              </div>\\n              <div class=\\\"global-mode-actions\\\">\\n                <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!selectedWorldbookName\\\" @click=\\\"toggleGlobalBinding\\\">\\n                  {{ isGlobalBound ? '' : '' }}\\n                </button>\\n              </div>\\n            </div>\\n          </section>\\n\\n          <!--  AI Generator Panel  -->\\n          <section v-if=\\\"aiGeneratorMode\\\" class=\\\"ai-generator-panel\\\">\\n            <div class=\\\"ai-sidebar\\\">\\n              <div class=\\\"ai-sidebar-head\\\">\\n                <span class=\\\"ai-sidebar-title\\\"></span>\\n                <button class=\\\"btn mini\\\" type=\\\"button\\\" @click=\\\"aiCreateSession\\\">+ </button>\\n              </div>\\n              <div class=\\\"ai-session-list\\\">\\n                <button\\n                  v-for=\\\"session in aiSessions\\\"\\n                  :key=\\\"session.id\\\"\\n                  class=\\\"ai-session-item\\\"\\n                  :class=\\\"{ active: session.id === aiActiveSession?.id }\\\"\\n                  type=\\\"button\\\"\\n                  @click=\\\"aiSwitchSession(session.id)\\\"\\n                >\\n                  <span class=\\\"ai-session-title\\\">{{ session.title }}</span>\\n                  <span class=\\\"ai-session-meta\\\">{{ session.messages.length }} </span>\\n                  <button\\n                    class=\\\"ai-session-delete\\\"\\n                    type=\\\"button\\\"\\n                    title=\\\"\\\"\\n                    @click.stop=\\\"aiDeleteSession(session.id)\\\"\\n                  ></button>\\n                </button>\\n                <div v-if=\\\"!aiSessions.length\\\" class=\\\"empty-note\\\"></div>\\n              </div>\\n            </div>\\n            <div class=\\\"ai-chat-area\\\">\\n              <div v-if=\\\"!aiActiveSession\\\" class=\\\"ai-chat-empty\\\">\\n                <div class=\\\"ai-chat-empty-icon\\\"></div>\\n                <div class=\\\"ai-chat-empty-text\\\"></div>\\n              </div>\\n              <template v-else>\\n                <div class=\\\"ai-chat-messages\\\" ref=\\\"aiChatMessagesRef\\\">\\n                  <div\\n                    v-for=\\\"(msg, idx) in aiActiveMessages\\\"\\n                    :key=\\\"`msg-${idx}`\\\"\\n                    class=\\\"ai-chat-bubble\\\"\\n                    :class=\\\"msg.role\\\"\\n                  >\\n                    <div class=\\\"ai-chat-bubble-role\\\">{{ msg.role === 'user' ? ' ' : ' AI' }}</div>\\n                    <div class=\\\"ai-chat-bubble-content\\\">{{ msg.content }}</div>\\n                  </div>\\n                  <div v-if=\\\"aiIsGenerating && aiStreamingText\\\" class=\\\"ai-chat-bubble assistant streaming\\\">\\n                    <div class=\\\"ai-chat-bubble-role\\\"> AI</div>\\n                    <div class=\\\"ai-chat-bubble-content\\\">{{ aiStreamingText }}<span class=\\\"ai-cursor\\\"></span></div>\\n                  </div>\\n                  <div v-if=\\\"aiIsGenerating && !aiStreamingText\\\" class=\\\"ai-chat-bubble assistant streaming\\\">\\n                    <div class=\\\"ai-chat-bubble-role\\\"> AI</div>\\n                    <div class=\\\"ai-chat-bubble-content\\\"><span class=\\\"ai-thinking\\\">...</span></div>\\n                  </div>\\n                </div>\\n                <div class=\\\"ai-chat-input-bar\\\">\\n                  <label class=\\\"ai-context-toggle\\\" title=\\\"AI \\\">\\n                    <input v-model=\\\"aiUseContext\\\" type=\\\"checkbox\\\" />\\n                    <span>{{ aiUseContext ? ' ' : ' ' }}</span>\\n                  </label>\\n                  <textarea\\n                    v-model=\\\"aiChatInputText\\\"\\n                    class=\\\"text-input ai-chat-input\\\"\\n                    placeholder=\\\" AI ...\\\"\\n                    rows=\\\"2\\\"\\n                    :disabled=\\\"aiIsGenerating\\\"\\n                    @keydown.enter.exact.prevent=\\\"aiSendMessage\\\"\\n                  ></textarea>\\n                  <button\\n                    v-if=\\\"!aiIsGenerating\\\"\\n                    class=\\\"btn ai-send-btn\\\"\\n                    type=\\\"button\\\"\\n                    :disabled=\\\"!aiChatInputText.trim()\\\"\\n                    @click=\\\"aiSendMessage\\\"\\n                  ></button>\\n                  <button\\n                    v-else\\n                    class=\\\"btn danger ai-stop-btn\\\"\\n                    type=\\\"button\\\"\\n                    @click=\\\"aiStopGeneration\\\"\\n                  ></button>\\n                </div>\\n              </template>\\n            </div>\\n          </section>\\n\\n          <!--  Tag Review Modal  -->\\n          <div v-if=\\\"aiShowTagReview\\\" class=\\\"ai-tag-review-overlay\\\" @click.self=\\\"aiShowTagReview = false\\\">\\n            <div class=\\\"ai-tag-review-modal\\\">\\n              <div class=\\\"ai-tag-review-head\\\">\\n                <span class=\\\"ai-tag-review-title\\\"> {{ aiExtractedTags.length }}</span>\\n                <button class=\\\"ai-tag-review-close\\\" type=\\\"button\\\" @click=\\\"aiShowTagReview = false\\\"></button>\\n              </div>\\n              <div class=\\\"ai-tag-review-target\\\">\\n                <label class=\\\"field\\\">\\n                  <span></span>\\n                  <select v-model=\\\"aiTargetWorldbook\\\" class=\\\"text-input\\\">\\n                    <option value=\\\"\\\"></option>\\n                    <option v-for=\\\"name in worldbookNames\\\" :key=\\\"`ai-wb-${name}`\\\" :value=\\\"name\\\">{{ name }}</option>\\n                  </select>\\n                </label>\\n              </div>\\n              <div class=\\\"ai-tag-list\\\">\\n                <label\\n                  v-for=\\\"(tag, idx) in aiExtractedTags\\\"\\n                  :key=\\\"`tag-${idx}`\\\"\\n                  class=\\\"ai-tag-item\\\"\\n                >\\n                  <input v-model=\\\"tag.selected\\\" type=\\\"checkbox\\\" />\\n                  <div class=\\\"ai-tag-info\\\">\\n                    <span class=\\\"ai-tag-name\\\">{{ tag.tag }}</span>\\n                    <span class=\\\"ai-tag-preview\\\">{{ tag.content.slice(0, 120) }}{{ tag.content.length > 120 ? '...' : '' }}</span>\\n                  </div>\\n                </label>\\n              </div>\\n              <div class=\\\"ai-tag-review-actions\\\">\\n                <button class=\\\"btn\\\" type=\\\"button\\\" @click=\\\"aiExtractedTags.forEach(t => t.selected = true)\\\"></button>\\n                <button class=\\\"btn\\\" type=\\\"button\\\" @click=\\\"aiExtractedTags.forEach(t => t.selected = false)\\\"></button>\\n                <button\\n                  class=\\\"btn primary\\\"\\n                  type=\\\"button\\\"\\n                  :disabled=\\\"!aiTargetWorldbook || !aiExtractedTags.some(t => t.selected)\\\"\\n                  @click=\\\"aiCreateSelectedEntries\\\"\\n                >{{ aiExtractedTags.filter(t => t.selected).length }}</button>\\n              </div>\\n            </div>\\n          </div>\\n\\n          <section v-show=\\\"!aiGeneratorMode\\\" ref=\\\"mainLayoutRef\\\" class=\\\"wb-main-layout\\\" :style=\\\"mainLayoutStyle\\\">\\n            <aside v-show=\\\"!showMobileEditor\\\" class=\\\"wb-entry-list\\\">\\n              <div class=\\\"list-search\\\">\\n                <input v-model=\\\"searchText\\\" type=\\\"text\\\" class=\\\"text-input\\\" placeholder=\\\" /  / \\\" />\\n                <label class=\\\"checkbox-inline\\\">\\n                  <input v-model=\\\"onlyEnabled\\\" type=\\\"checkbox\\\" />\\n                  <span></span>\\n                </label>\\n              </div>\\n              <div class=\\\"list-summary\\\">\\n                 {{ filteredEntries.length }} / {{ draftEntries.length }} |  {{ enabledEntryCount }}\\n              </div>\\n              <div class=\\\"list-scroll\\\">\\n                <button\\n                  v-for=\\\"entry in filteredEntries\\\"\\n                  :key=\\\"entry.uid\\\"\\n                  type=\\\"button\\\"\\n                  class=\\\"entry-item\\\"\\n                  :data-status=\\\"getEntryVisualStatus(entry)\\\"\\n                  :class=\\\"{\\n                    selected: entry.uid === selectedEntryUid,\\n                    disabled: !entry.enabled,\\n                  }\\\"\\n                  @click=\\\"selectEntry(entry.uid)\\\"\\n                >\\n                  <div class=\\\"entry-item-head\\\">\\n                    <span class=\\\"entry-status-dot\\\" :data-status=\\\"getEntryVisualStatus(entry)\\\"></span>\\n                    <div class=\\\"entry-item-title\\\">{{ entry.name || ` ${entry.uid}` }}</div>\\n                    <span class=\\\"entry-chip uid\\\">#{{ entry.uid }}</span>\\n                  </div>\\n                  <div class=\\\"entry-item-tags\\\">\\n                    <span class=\\\"entry-chip status\\\" :data-status=\\\"getEntryVisualStatus(entry)\\\">\\n                      {{ getEntryStatusLabel(entry) }}\\n                    </span>\\n                    <span class=\\\"entry-chip\\\"> {{ entry.strategy.keys.length }}</span>\\n                    <span class=\\\"entry-chip\\\"> {{ entry.probability }}</span>\\n                    <span class=\\\"entry-chip mono\\\">#{{ entry.position.order }}</span>\\n                  </div>\\n                  <div class=\\\"entry-item-preview\\\">{{ getEntryKeyPreview(entry) }}</div>\\n                </button>\\n              </div>\\n              <div class=\\\"list-actions\\\">\\n                <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!selectedWorldbookName\\\" @click=\\\"addEntry\\\"></button>\\n                <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!selectedEntry\\\" @click=\\\"duplicateSelectedEntry\\\">\\n                  \\n                </button>\\n                <button class=\\\"btn danger\\\" type=\\\"button\\\" :disabled=\\\"!selectedEntry\\\" @click=\\\"removeSelectedEntry\\\">\\n                  \\n                </button>\\n                <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!selectedEntry\\\" @click=\\\"moveSelectedEntry(-1)\\\">\\n                  \\n                </button>\\n                <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!selectedEntry\\\" @click=\\\"moveSelectedEntry(1)\\\"></button>\\n              </div>\\n            </aside>\\n            <div\\n              v-show=\\\"!isMobile\\\"\\n              class=\\\"wb-resize-handle main\\\"\\n              :class=\\\"{ dragging: paneResizeState?.key === 'main' }\\\"\\n              @pointerdown=\\\"startPaneResize('main', $event)\\\"\\n            ></div>\\n\\n            <main v-show=\\\"!isMobile || showMobileEditor\\\" class=\\\"wb-editor\\\">\\n              <template v-if=\\\"selectedEntry\\\">\\n                <div ref=\\\"editorShellRef\\\" class=\\\"wb-editor-shell\\\" :style=\\\"editorShellStyle\\\">\\n                  <section class=\\\"editor-center\\\">\\n                    <header class=\\\"editor-head\\\">\\n                      <div v-if=\\\"isMobile\\\" class=\\\"editor-back-btn\\\" @click=\\\"goBackToList\\\">\\n                         \\n                      </div>\\n                      <label class=\\\"field editor-comment\\\">\\n                        <span> (COMMENT)</span>\\n                        <input v-model=\\\"selectedEntry.name\\\" type=\\\"text\\\" class=\\\"text-input\\\" />\\n                      </label>\\n                      <div class=\\\"editor-badges\\\">\\n                        <span class=\\\"editor-badge\\\" :class=\\\"selectedEntry.enabled ? 'on' : 'off'\\\">\\n                          {{ selectedEntry.enabled ? 'EN' : 'OFF' }}\\n                        </span>\\n                        <span class=\\\"editor-badge strategy\\\" :data-status=\\\"getEntryVisualStatus(selectedEntry)\\\">\\n                          {{ getEntryStatusLabel(selectedEntry) }}\\n                        </span>\\n                        <span class=\\\"editor-badge mono\\\">#{{ selectedEntry.uid }}</span>\\n                        <span class=\\\"editor-badge mono\\\">Chars {{ selectedContentChars }}</span>\\n                        <span class=\\\"editor-badge mono\\\">~{{ selectedTokenEstimate }}T</span>\\n                      </div>\\n                    </header>\\n\\n                    <section class=\\\"editor-grid two-cols editor-keyword-grid\\\">\\n                      <label class=\\\"field\\\">\\n                        <span> (KEYS)</span>\\n                        <textarea v-model=\\\"selectedKeysText\\\" class=\\\"text-area compact\\\"></textarea>\\n                      </label>\\n                      <label class=\\\"field\\\">\\n                        <span> (SECONDARY)</span>\\n                        <textarea v-model=\\\"selectedSecondaryKeysText\\\" class=\\\"text-area compact\\\"></textarea>\\n                      </label>\\n                    </section>\\n\\n                    <section class=\\\"editor-content-block\\\">\\n                      <div class=\\\"editor-content-title\\\"> /  (CONTENT)</div>\\n                      <textarea\\n                        ref=\\\"contentTextareaRef\\\"\\n                        v-model=\\\"selectedEntry.content\\\"\\n                        class=\\\"text-area large editor-content-area\\\"\\n                      ></textarea>\\n                      <div\\n                        class=\\\"content-resize-handle\\\"\\n                        @pointerdown=\\\"startContentResize\\\"\\n                      >\\n                        <span class=\\\"content-resize-grip\\\"></span>\\n                      </div>\\n                    </section>\\n\\n                    <details class=\\\"editor-advanced\\\">\\n                      <summary> / extra JSON</summary>\\n                      <label class=\\\"field\\\">\\n                        <span>extra JSON</span>\\n                        <textarea v-model=\\\"selectedExtraText\\\" class=\\\"text-area compact\\\" placeholder=\\\"{ ... }\\\"></textarea>\\n                      </label>\\n                      <div class=\\\"field-actions\\\">\\n                        <button class=\\\"btn\\\" type=\\\"button\\\" @click=\\\"applyExtraJson\\\"> extra</button>\\n                        <button class=\\\"btn\\\" type=\\\"button\\\" @click=\\\"clearExtra\\\"> extra</button>\\n                      </div>\\n                    </details>\\n                  </section>\\n                  <div\\n                    v-show=\\\"!isMobile\\\"\\n                    class=\\\"wb-resize-handle editor\\\"\\n                    :class=\\\"{ dragging: paneResizeState?.key === 'editor' }\\\"\\n                    @pointerdown=\\\"startPaneResize('editor', $event)\\\"\\n                  ></div>\\n\\n                  <aside class=\\\"editor-side\\\">\\n                    <article class=\\\"editor-card\\\">\\n                      <h4> (STRATEGY)</h4>\\n                      <label class=\\\"field checkbox-inline\\\">\\n                        <input v-model=\\\"selectedEntry.enabled\\\" type=\\\"checkbox\\\" />\\n                        <span></span>\\n                      </label>\\n                      <div class=\\\"strategy-switch\\\">\\n                        <button\\n                          type=\\\"button\\\"\\n                          class=\\\"strategy-pill constant\\\"\\n                          :class=\\\"{ active: selectedEntry.strategy.type === 'constant' }\\\"\\n                          @click=\\\"selectedEntry.strategy.type = 'constant'\\\"\\n                        >\\n                            (Constant)\\n                        </button>\\n                        <button\\n                          type=\\\"button\\\"\\n                          class=\\\"strategy-pill vector\\\"\\n                          :class=\\\"{ active: selectedEntry.strategy.type === 'vectorized' }\\\"\\n                          @click=\\\"selectedEntry.strategy.type = 'vectorized'\\\"\\n                        >\\n                            (Vector)\\n                        </button>\\n                        <button\\n                          type=\\\"button\\\"\\n                          class=\\\"strategy-pill selective\\\"\\n                          :class=\\\"{ active: selectedEntry.strategy.type === 'selective' }\\\"\\n                          @click=\\\"selectedEntry.strategy.type = 'selective'\\\"\\n                        >\\n                            (Selective)\\n                        </button>\\n                      </div>\\n                      <details class=\\\"editor-advanced\\\">\\n                        <summary></summary>\\n                        <label class=\\\"field\\\">\\n                          <span> (LOGIC)</span>\\n                          <select v-model=\\\"selectedEntry.strategy.keys_secondary.logic\\\" class=\\\"text-input\\\">\\n                            <option v-for=\\\"item in secondaryLogicOptions\\\" :key=\\\"item\\\" :value=\\\"item\\\">\\n                              {{ getSecondaryLogicLabel(item) }}\\n                            </option>\\n                          </select>\\n                        </label>\\n                        <label class=\\\"field\\\">\\n                          <span></span>\\n                          <input\\n                            v-model=\\\"selectedScanDepthText\\\"\\n                            type=\\\"text\\\"\\n                            class=\\\"text-input\\\"\\n                            placeholder=\\\" same_as_global\\\"\\n                          />\\n                        </label>\\n                        <label class=\\\"field\\\">\\n                          <span>(0-100)</span>\\n                          <input\\n                            v-model.number=\\\"selectedEntry.probability\\\"\\n                            type=\\\"number\\\"\\n                            class=\\\"text-input\\\"\\n                            min=\\\"0\\\"\\n                            max=\\\"100\\\"\\n                            step=\\\"1\\\"\\n                          />\\n                        </label>\\n                      </details>\\n                    </article>\\n\\n                    <article class=\\\"editor-card\\\">\\n                      <h4> (INSERTION)</h4>\\n                      <label class=\\\"field\\\">\\n                        <span> (Position)</span>\\n                        <select\\n                          v-model=\\\"selectedEntry.position.type\\\"\\n                          class=\\\"text-input\\\"\\n                          @change=\\\"handleSelectedPositionTypeChanged\\\"\\n                        >\\n                          <option v-for=\\\"item in positionTypeOptions\\\" :key=\\\"item\\\" :value=\\\"item\\\">\\n                            {{ getPositionTypeLabel(item) }}\\n                          </option>\\n                        </select>\\n                      </label>\\n                      <label class=\\\"field\\\">\\n                        <span> (Order)</span>\\n                        <input v-model.number=\\\"selectedEntry.position.order\\\" type=\\\"number\\\" class=\\\"text-input\\\" step=\\\"1\\\" />\\n                      </label>\\n                      <div class=\\\"editor-grid two-cols\\\">\\n                        <label class=\\\"field\\\" :class=\\\"{ disabled: selectedEntry.position.type !== 'at_depth' }\\\">\\n                          <span>at_depth role</span>\\n                          <select\\n                            v-model=\\\"selectedEntry.position.role\\\"\\n                            class=\\\"text-input\\\"\\n                            :disabled=\\\"selectedEntry.position.type !== 'at_depth'\\\"\\n                          >\\n                            <option value=\\\"system\\\">system</option>\\n                            <option value=\\\"assistant\\\">assistant</option>\\n                            <option value=\\\"user\\\">user</option>\\n                          </select>\\n                        </label>\\n                        <label class=\\\"field\\\" :class=\\\"{ disabled: selectedEntry.position.type !== 'at_depth' }\\\">\\n                          <span>at_depth depth</span>\\n                          <input\\n                            v-model.number=\\\"selectedEntry.position.depth\\\"\\n                            type=\\\"number\\\"\\n                            class=\\\"text-input\\\"\\n                            min=\\\"1\\\"\\n                            step=\\\"1\\\"\\n                            :disabled=\\\"selectedEntry.position.type !== 'at_depth'\\\"\\n                          />\\n                        </label>\\n                      </div>\\n                    </article>\\n\\n                    <article class=\\\"editor-card\\\">\\n                      <h4> (RECURSION)</h4>\\n                      <label class=\\\"field checkbox-inline\\\">\\n                        <input v-model=\\\"selectedEntry.recursion.prevent_incoming\\\" type=\\\"checkbox\\\" />\\n                        <span> (Exclude Incoming)</span>\\n                      </label>\\n                      <label class=\\\"field checkbox-inline\\\">\\n                        <input v-model=\\\"selectedEntry.recursion.prevent_outgoing\\\" type=\\\"checkbox\\\" />\\n                        <span> (Prevent Outgoing)</span>\\n                      </label>\\n                      <label class=\\\"field\\\">\\n                        <span></span>\\n                        <input\\n                          v-model=\\\"selectedRecursionDelayText\\\"\\n                          type=\\\"text\\\"\\n                          class=\\\"text-input\\\"\\n                          placeholder=\\\" null\\\"\\n                        />\\n                      </label>\\n                      <div class=\\\"editor-grid two-cols\\\">\\n                        <label class=\\\"field\\\">\\n                          <span>sticky</span>\\n                          <input\\n                            v-model=\\\"selectedStickyText\\\"\\n                            type=\\\"text\\\"\\n                            class=\\\"text-input\\\"\\n                            placeholder=\\\" null\\\"\\n                          />\\n                        </label>\\n                        <label class=\\\"field\\\">\\n                          <span>cooldown</span>\\n                          <input\\n                            v-model=\\\"selectedCooldownText\\\"\\n                            type=\\\"text\\\"\\n                            class=\\\"text-input\\\"\\n                            placeholder=\\\" null\\\"\\n                          />\\n                        </label>\\n                      </div>\\n                      <label class=\\\"field\\\">\\n                        <span>delay</span>\\n                        <input\\n                          v-model=\\\"selectedEffectDelayText\\\"\\n                          type=\\\"text\\\"\\n                          class=\\\"text-input\\\"\\n                          placeholder=\\\" null\\\"\\n                        />\\n                      </label>\\n                    </article>\\n                  </aside>\\n                </div>\\n              </template>\\n              <template v-else>\\n                <div class=\\\"empty-block\\\"></div>\\n              </template>\\n            </main>\\n          </section>\\n          </div>\\n\\n          <footer class=\\\"wb-status\\\">\\n            <span>{{ isBusy ? '...' : statusMessage }}</span>\\n            <span>\\n              : {{ draftEntries.length }} | : {{ totalContentChars }} |\\n              {{ hasUnsavedChanges ? '' : '' }}\\n            </span>\\n          </footer>\\n    </template>\\n    <!--  End Desktop Layout  -->\\n\\n          <div v-if=\\\"showEntryHistoryModal\\\" class=\\\"wb-modal-backdrop\\\" @click.self=\\\"showEntryHistoryModal = false\\\">\\n            <div class=\\\"wb-history-modal\\\">\\n              <div class=\\\"wb-history-modal-header\\\">\\n                <div>\\n                  <strong> </strong>\\n                  <span>{{ entryHistorySummary }}</span>\\n                </div>\\n                <div class=\\\"wb-history-modal-actions\\\">\\n                  <button class=\\\"btn mini\\\" type=\\\"button\\\" :disabled=\\\"!selectedEntry\\\" @click=\\\"createManualEntrySnapshot\\\">\\n                    \\n                  </button>\\n                  <button\\n                    class=\\\"btn mini danger\\\"\\n                    type=\\\"button\\\"\\n                    :disabled=\\\"!entrySnapshotsForSelected.length\\\"\\n                    @click=\\\"clearCurrentEntrySnapshots\\\"\\n                  >\\n                    \\n                  </button>\\n                  <button class=\\\"btn mini\\\" type=\\\"button\\\" @click=\\\"showEntryHistoryModal = false\\\"></button>\\n                </div>\\n              </div>\\n\\n              <div class=\\\"wb-history-modal-main\\\">\\n                <aside class=\\\"wb-history-versions\\\">\\n                  <div class=\\\"wb-history-versions-title\\\">L/R</div>\\n                  <div class=\\\"wb-history-versions-scroll\\\">\\n                    <div v-for=\\\"ver in entryVersionViews\\\" :key=\\\"ver.id\\\" class=\\\"wb-history-version-item\\\">\\n                      <div class=\\\"wb-history-version-line\\\">\\n                        <strong>{{ formatHistoryOptionLabel(ver.label, ver.ts, ver.isCurrent) }}</strong>\\n                        <div class=\\\"wb-history-lr\\\">\\n                          <button class=\\\"mini-lr\\\" :class=\\\"{ active: entryHistoryLeftId === ver.id }\\\" @click=\\\"entryHistoryLeftId = ver.id\\\">L</button>\\n                          <button class=\\\"mini-lr\\\" :class=\\\"{ active: entryHistoryRightId === ver.id }\\\" @click=\\\"entryHistoryRightId = ver.id\\\">R</button>\\n                        </div>\\n                      </div>\\n                      <span>{{ ver.name }}</span>\\n                    </div>\\n                    <div v-if=\\\"entryVersionViews.length <= 1\\\" class=\\\"empty-note\\\"></div>\\n                  </div>\\n                </aside>\\n\\n                <section class=\\\"wb-history-diff-wrap\\\">\\n                  <div class=\\\"wb-history-diff-head\\\">\\n                    <div>\\n                      Left: {{ selectedEntryHistoryLeft ? formatHistoryOptionLabel(selectedEntryHistoryLeft.label, selectedEntryHistoryLeft.ts, selectedEntryHistoryLeft.isCurrent) : '-' }}\\n                      |\\n                      Right: {{ selectedEntryHistoryRight ? formatHistoryOptionLabel(selectedEntryHistoryRight.label, selectedEntryHistoryRight.ts, selectedEntryHistoryRight.isCurrent) : '-' }}\\n                    </div>\\n                    <button class=\\\"btn mini\\\" type=\\\"button\\\" :disabled=\\\"!canRestoreEntryFromLeft\\\" @click=\\\"restoreEntryFromLeftHistory\\\">\\n                       Left\\n                    </button>\\n                  </div>\\n                  <div class=\\\"wb-history-diff-grid\\\">\\n                    <div>\\n                      <div class=\\\"wb-history-diff-title\\\">Left</div>\\n                      <div class=\\\"wb-history-diff-body\\\" v-html=\\\"entryHistoryDiff.leftHtml\\\"></div>\\n                    </div>\\n                    <div>\\n                      <div class=\\\"wb-history-diff-title\\\">Right</div>\\n                      <div class=\\\"wb-history-diff-body\\\" v-html=\\\"entryHistoryDiff.rightHtml\\\"></div>\\n                    </div>\\n                  </div>\\n                </section>\\n              </div>\\n            </div>\\n          </div>\\n\\n          <div v-if=\\\"showWorldbookHistoryModal\\\" class=\\\"wb-modal-backdrop\\\" @click.self=\\\"showWorldbookHistoryModal = false\\\">\\n            <div class=\\\"wb-history-modal\\\">\\n              <div class=\\\"wb-history-modal-header\\\">\\n                <div>\\n                  <strong> </strong>\\n                  <span>{{ getWorldbookVersionDiffSummary(selectedWorldbookHistoryLeft, selectedWorldbookHistoryRight) }}</span>\\n                </div>\\n                <div class=\\\"wb-history-modal-actions\\\">\\n                  <button class=\\\"btn mini\\\" type=\\\"button\\\" :disabled=\\\"!selectedWorldbookName\\\" @click=\\\"createManualSnapshot\\\">\\n                    \\n                  </button>\\n                  <button\\n                    class=\\\"btn mini danger\\\"\\n                    type=\\\"button\\\"\\n                    :disabled=\\\"!snapshotsForCurrent.length\\\"\\n                    @click=\\\"clearCurrentSnapshots\\\"\\n                  >\\n                    \\n                  </button>\\n                  <button class=\\\"btn mini\\\" type=\\\"button\\\" @click=\\\"showWorldbookHistoryModal = false\\\"></button>\\n                </div>\\n              </div>\\n\\n              <div class=\\\"wb-history-modal-main\\\">\\n                <aside class=\\\"wb-history-versions\\\">\\n                  <div class=\\\"wb-history-versions-title\\\">L/R</div>\\n                  <div class=\\\"wb-history-versions-scroll\\\">\\n                    <div v-for=\\\"ver in worldbookVersionViews\\\" :key=\\\"ver.id\\\" class=\\\"wb-history-version-item\\\">\\n                      <div class=\\\"wb-history-version-line\\\">\\n                        <strong>{{ formatHistoryOptionLabel(ver.label, ver.ts, ver.isCurrent) }}</strong>\\n                        <div class=\\\"wb-history-lr\\\">\\n                          <button class=\\\"mini-lr\\\" :class=\\\"{ active: worldbookHistoryLeftId === ver.id }\\\" @click=\\\"worldbookHistoryLeftId = ver.id\\\">L</button>\\n                          <button class=\\\"mini-lr\\\" :class=\\\"{ active: worldbookHistoryRightId === ver.id }\\\" @click=\\\"worldbookHistoryRightId = ver.id\\\">R</button>\\n                        </div>\\n                      </div>\\n                      <span>entries: {{ ver.entries.length }}</span>\\n                    </div>\\n                  </div>\\n                </aside>\\n\\n                <section class=\\\"wb-history-diff-wrap\\\">\\n                  <div class=\\\"wb-history-diff-head\\\">\\n                    <div>\\n                      Left: {{ selectedWorldbookHistoryLeft ? formatHistoryOptionLabel(selectedWorldbookHistoryLeft.label, selectedWorldbookHistoryLeft.ts, selectedWorldbookHistoryLeft.isCurrent) : '-' }}\\n                      |\\n                      Right: {{ selectedWorldbookHistoryRight ? formatHistoryOptionLabel(selectedWorldbookHistoryRight.label, selectedWorldbookHistoryRight.ts, selectedWorldbookHistoryRight.isCurrent) : '-' }}\\n                    </div>\\n                    <button\\n                      class=\\\"btn mini\\\"\\n                      type=\\\"button\\\"\\n                      :disabled=\\\"!canRestoreWorldbookFromLeft\\\"\\n                      @click=\\\"restoreWorldbookFromLeftHistory\\\"\\n                    >\\n                       Left\\n                    </button>\\n                  </div>\\n                  <div class=\\\"wb-history-diff-grid\\\">\\n                    <div>\\n                      <div class=\\\"wb-history-diff-title\\\">Left</div>\\n                      <div class=\\\"wb-history-diff-body\\\" v-html=\\\"worldbookHistoryDiff.leftHtml\\\"></div>\\n                    </div>\\n                    <div>\\n                      <div class=\\\"wb-history-diff-title\\\">Right</div>\\n                      <div class=\\\"wb-history-diff-body\\\" v-html=\\\"worldbookHistoryDiff.rightHtml\\\"></div>\\n                    </div>\\n                  </div>\\n                </section>\\n              </div>\\n            </div>\\n          </div>\\n\\n          <div\\n            v-if=\\\"floatingPanels.find.visible\\\"\\n            class=\\\"wb-floating-window find-window\\\"\\n            :style=\\\"getFloatingPanelStyle('find')\\\"\\n            @pointerdown=\\\"bringFloatingToFront('find')\\\"\\n          >\\n            <div class=\\\"wb-floating-header\\\" @pointerdown=\\\"startFloatingDrag('find', $event)\\\">\\n              <strong> </strong>\\n              <div class=\\\"wb-floating-header-actions\\\">\\n                <button\\n                  class=\\\"btn mini\\\"\\n                  type=\\\"button\\\"\\n                  :disabled=\\\"!draftEntries.length\\\"\\n                  @pointerdown.stop\\n                  @click=\\\"findFirstMatch\\\"\\n                >\\n                  \\n                </button>\\n                <button\\n                  class=\\\"btn mini\\\"\\n                  type=\\\"button\\\"\\n                  :disabled=\\\"!draftEntries.length\\\"\\n                  @pointerdown.stop\\n                  @click=\\\"findPreviousMatch\\\"\\n                >\\n                  \\n                </button>\\n                <button\\n                  class=\\\"btn mini\\\"\\n                  type=\\\"button\\\"\\n                  :disabled=\\\"!draftEntries.length\\\"\\n                  @pointerdown.stop\\n                  @click=\\\"findNextMatch\\\"\\n                >\\n                  \\n                </button>\\n                <button\\n                  class=\\\"btn mini\\\"\\n                  type=\\\"button\\\"\\n                  :disabled=\\\"!draftEntries.length\\\"\\n                  @pointerdown.stop\\n                  @click=\\\"applyBatchReplace\\\"\\n                >\\n                  \\n                </button>\\n                <button class=\\\"btn mini danger\\\" type=\\\"button\\\" @pointerdown.stop @click=\\\"closeFloatingPanel('find')\\\">\\n                  \\n                </button>\\n              </div>\\n            </div>\\n            <div class=\\\"wb-floating-body\\\">\\n              <div class=\\\"tool-line stacked\\\">\\n                <input v-model=\\\"batchFindText\\\" type=\\\"text\\\" class=\\\"text-input\\\" placeholder=\\\" / \\\" />\\n                <input v-model=\\\"batchReplaceText\\\" type=\\\"text\\\" class=\\\"text-input\\\" placeholder=\\\"\\\" />\\n                <div class=\\\"find-scope-line\\\">\\n                  <label class=\\\"checkbox-inline\\\">\\n                    <input v-model=\\\"batchSearchScope\\\" type=\\\"radio\\\" value=\\\"all\\\" />\\n                    <span></span>\\n                  </label>\\n                  <label class=\\\"checkbox-inline\\\">\\n                    <input v-model=\\\"batchSearchScope\\\" type=\\\"radio\\\" value=\\\"current\\\" :disabled=\\\"!selectedEntry\\\" />\\n                    <span></span>\\n                  </label>\\n                  <span class=\\\"find-summary-text\\\">{{ findHitSummaryText }}</span>\\n                </div>\\n                <input\\n                  v-model=\\\"batchExcludeText\\\"\\n                  type=\\\"text\\\"\\n                  class=\\\"text-input\\\"\\n                  placeholder=\\\"#UID /  /  / \\\"\\n                />\\n                <div v-if=\\\"activeFindHit\\\" class=\\\"find-active-hit\\\">\\n                  <strong>#{{ activeFindHit.entryUid }} {{ activeFindHit.entryName || ` ${activeFindHit.entryUid}` }}</strong>\\n                  <span>{{ getFindFieldLabel(activeFindHit.field) }}  {{ activeFindHit.preview }}</span>\\n                </div>\\n                <div class=\\\"batch-exclude-note\\\">\\n                  : `#12, name:, content:{{user}}, keys:`//\\n                </div>\\n                <div v-if=\\\"batchExcludeTokensPreview.length\\\" class=\\\"batch-exclude-chips\\\">\\n                  <span v-for=\\\"token in batchExcludeTokensPreview\\\" :key=\\\"token\\\" class=\\\"exclude-chip\\\">{{ token }}</span>\\n                </div>\\n                <div class=\\\"find-flags\\\">\\n                  <label class=\\\"checkbox-inline\\\">\\n                    <input v-model=\\\"batchUseRegex\\\" type=\\\"checkbox\\\" />\\n                    <span></span>\\n                  </label>\\n                  <label class=\\\"checkbox-inline\\\">\\n                    <input v-model=\\\"batchInName\\\" type=\\\"checkbox\\\" />\\n                    <span></span>\\n                  </label>\\n                  <label class=\\\"checkbox-inline\\\">\\n                    <input v-model=\\\"batchInContent\\\" type=\\\"checkbox\\\" />\\n                    <span></span>\\n                  </label>\\n                  <label class=\\\"checkbox-inline\\\">\\n                    <input v-model=\\\"batchInKeys\\\" type=\\\"checkbox\\\" />\\n                    <span></span>\\n                  </label>\\n                </div>\\n              </div>\\n              <details class=\\\"tool-details\\\">\\n                <summary></summary>\\n                <div class=\\\"tool-line\\\">\\n                  <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!draftEntries.length\\\" @click=\\\"normalizeAllEntries\\\">\\n                    \\n                  </button>\\n                  <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!draftEntries.length\\\" @click=\\\"sortEntriesByOrderDesc\\\">\\n                     order \\n                  </button>\\n                </div>\\n                <div class=\\\"tool-line\\\">\\n                  <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!draftEntries.length\\\" @click=\\\"setEnabledForAll(true)\\\">\\n                    \\n                  </button>\\n                  <button class=\\\"btn\\\" type=\\\"button\\\" :disabled=\\\"!draftEntries.length\\\" @click=\\\"setEnabledForAll(false)\\\">\\n                    \\n                  </button>\\n                </div>\\n              </details>\\n            </div>\\n          </div>\\n\\n          <div\\n            v-if=\\\"floatingPanels.activation.visible\\\"\\n            class=\\\"wb-floating-window activation-window\\\"\\n            :style=\\\"getFloatingPanelStyle('activation')\\\"\\n            @pointerdown=\\\"bringFloatingToFront('activation')\\\"\\n          >\\n            <div class=\\\"wb-floating-header\\\" @pointerdown=\\\"startFloatingDrag('activation', $event)\\\">\\n              <strong> WORLD_INFO_ACTIVATED</strong>\\n              <div class=\\\"wb-floating-header-actions\\\">\\n                <button\\n                  class=\\\"btn mini danger\\\"\\n                  type=\\\"button\\\"\\n                  :disabled=\\\"!activationLogs.length\\\"\\n                  @pointerdown.stop\\n                  @click=\\\"clearActivationLogs\\\"\\n                >\\n                  \\n                </button>\\n                <button\\n                  class=\\\"btn mini danger\\\"\\n                  type=\\\"button\\\"\\n                  @pointerdown.stop\\n                  @click=\\\"closeFloatingPanel('activation')\\\"\\n                >\\n                  \\n                </button>\\n              </div>\\n            </div>\\n            <div class=\\\"wb-floating-body\\\">\\n              <div class=\\\"tool-scroll\\\">\\n                <div v-for=\\\"log in activationLogs\\\" :key=\\\"log.id\\\" class=\\\"activation-item\\\">\\n                  <div class=\\\"activation-main\\\">\\n                    <strong>{{ log.world }}</strong>\\n                    <span>#{{ log.uid }}  {{ log.name }}</span>\\n                  </div>\\n                  <div class=\\\"activation-sub\\\">\\n                    <span>{{ formatDateTime(log.time) }}</span>\\n                    <span>{{ log.contentPreview }}</span>\\n                  </div>\\n                </div>\\n                <div v-if=\\\"!activationLogs.length\\\" class=\\\"empty-note\\\"></div>\\n              </div>\\n            </div>\\n          </div>\\n  </div>\\n</template>\\n\\n<script setup lang=\\\"ts\\\">\\nimport { diffLines } from 'https://testingcf.jsdelivr.net/npm/diff/+esm';\\nimport { klona } from 'klona';\\n\\ntype StrategyType = WorldbookEntry['strategy']['type'];\\ntype SecondaryLogic = WorldbookEntry['strategy']['keys_secondary']['logic'];\\ntype PositionType = WorldbookEntry['position']['type'];\\ntype RoleType = WorldbookEntry['position']['role'];\\ntype EntryVisualStatus = 'constant' | 'vector' | 'normal' | 'disabled';\\ntype FloatingPanelKey = 'find' | 'activation';\\ntype PaneResizeKey = 'main' | 'editor';\\ntype BatchSearchScope = 'all' | 'current';\\ntype FindFieldKey = 'name' | 'content' | 'keys';\\n\\ninterface FloatingPanelState {\\n  visible: boolean;\\n  x: number;\\n  y: number;\\n  z: number;\\n  width: number;\\n}\\n\\ninterface PaneResizeState {\\n  key: PaneResizeKey;\\n  pointerId: number;\\n  doc: Document;\\n  win: Window;\\n}\\n\\ntype ThemeKey = 'ocean' | 'nebula' | 'forest' | 'sunset' | 'coffee' | 'paper' | 'snow';\\n\\nconst THEMES: Record<ThemeKey, { name: string; label: string; colors: Record<string, string> }> = {\\n  ocean: {\\n    name: 'Ocean (Deep)',\\n    label: '',\\n    colors: {\\n      '--wb-bg-root': '#0f172a',\\n      '--wb-bg-panel': '#1e293b',\\n      '--wb-text-main': '#f1f5f9',\\n      '--wb-text-muted': '#94a3b8',\\n      '--wb-primary': '#0ea5e9',\\n      '--wb-primary-light': '#38bdf8',\\n      '--wb-primary-hover': 'rgba(56, 189, 248, 0.15)',\\n      '--wb-primary-soft': 'rgba(14, 165, 233, 0.15)',\\n      '--wb-primary-glow': 'rgba(14, 165, 233, 0.4)',\\n      '--wb-input-bg': 'rgba(0, 0, 0, 0.25)',\\n      '--wb-input-bg-hover': 'rgba(0, 0, 0, 0.35)',\\n      '--wb-input-bg-focus': 'rgba(0, 0, 0, 0.45)',\\n      '--wb-border-subtle': 'rgba(255, 255, 255, 0.08)',\\n      '--wb-border-main': 'rgba(255, 255, 255, 0.12)',\\n      '--wb-shadow-main': '0 12px 28px rgba(0, 0, 0, 0.5)',\\n      '--wb-scrollbar-thumb': 'rgba(255, 255, 255, 0.2)',\\n    },\\n  },\\n  nebula: {\\n    name: 'Nebula (Dark)',\\n    label: '',\\n    colors: {\\n      '--wb-bg-root': '#170b25',\\n      '--wb-bg-panel': '#261836',\\n      '--wb-text-main': '#f3e8ff',\\n      '--wb-text-muted': '#a855f7',\\n      '--wb-primary': '#c084fc',\\n      '--wb-primary-light': '#d8b4fe',\\n      '--wb-primary-hover': 'rgba(192, 132, 252, 0.15)',\\n      '--wb-primary-soft': 'rgba(168, 85, 247, 0.15)',\\n      '--wb-primary-glow': 'rgba(192, 132, 252, 0.4)',\\n      '--wb-input-bg': 'rgba(0, 0, 0, 0.25)',\\n      '--wb-input-bg-hover': 'rgba(0, 0, 0, 0.35)',\\n      '--wb-input-bg-focus': 'rgba(0, 0, 0, 0.45)',\\n      '--wb-border-subtle': 'rgba(255, 255, 255, 0.08)',\\n      '--wb-border-main': 'rgba(255, 255, 255, 0.12)',\\n      '--wb-shadow-main': '0 12px 28px rgba(0, 0, 0, 0.5)',\\n      '--wb-scrollbar-thumb': 'rgba(255, 255, 255, 0.2)',\\n    },\\n  },\\n  forest: {\\n    name: 'Forest',\\n    label: '',\\n    colors: {\\n      '--wb-bg-root': '#051812',\\n      '--wb-bg-panel': '#0d2b21',\\n      '--wb-text-main': '#ecfdf5',\\n      '--wb-text-muted': '#34d399',\\n      '--wb-primary': '#10b981',\\n      '--wb-primary-light': '#34d399',\\n      '--wb-primary-hover': 'rgba(16, 185, 129, 0.15)',\\n      '--wb-primary-soft': 'rgba(5, 150, 105, 0.15)',\\n      '--wb-primary-glow': 'rgba(16, 185, 129, 0.4)',\\n      '--wb-input-bg': 'rgba(0, 0, 0, 0.25)',\\n      '--wb-input-bg-hover': 'rgba(0, 0, 0, 0.35)',\\n      '--wb-input-bg-focus': 'rgba(0, 0, 0, 0.45)',\\n      '--wb-border-subtle': 'rgba(255, 255, 255, 0.08)',\\n      '--wb-border-main': 'rgba(255, 255, 255, 0.12)',\\n      '--wb-shadow-main': '0 12px 28px rgba(0, 0, 0, 0.5)',\\n      '--wb-scrollbar-thumb': 'rgba(255, 255, 255, 0.2)',\\n    },\\n  },\\n  sunset: {\\n    name: 'Sunset',\\n    label: '',\\n    colors: {\\n      '--wb-bg-root': '#1a0f0f',\\n      '--wb-bg-panel': '#2e1818',\\n      '--wb-text-main': '#fff1f2',\\n      '--wb-text-muted': '#fb7185',\\n      '--wb-primary': '#fb923c',\\n      '--wb-primary-light': '#fdba74',\\n      '--wb-primary-hover': 'rgba(251, 146, 60, 0.15)',\\n      '--wb-primary-soft': 'rgba(234, 88, 12, 0.15)',\\n      '--wb-primary-glow': 'rgba(251, 146, 60, 0.4)',\\n      '--wb-input-bg': 'rgba(0, 0, 0, 0.25)',\\n      '--wb-input-bg-hover': 'rgba(0, 0, 0, 0.35)',\\n      '--wb-input-bg-focus': 'rgba(0, 0, 0, 0.45)',\\n      '--wb-border-subtle': 'rgba(255, 255, 255, 0.08)',\\n      '--wb-border-main': 'rgba(255, 255, 255, 0.12)',\\n      '--wb-shadow-main': '0 12px 28px rgba(0, 0, 0, 0.5)',\\n      '--wb-scrollbar-thumb': 'rgba(255, 255, 255, 0.2)',\\n    },\\n  },\\n  coffee: {\\n    name: 'Coffee',\\n    label: '',\\n    colors: {\\n      '--wb-bg-root': '#161009',\\n      '--wb-bg-panel': '#291e16',\\n      '--wb-text-main': '#fffbeb',\\n      '--wb-text-muted': '#d97706',\\n      '--wb-primary': '#fbbf24',\\n      '--wb-primary-light': '#fcd34d',\\n      '--wb-primary-hover': 'rgba(251, 191, 36, 0.15)',\\n      '--wb-primary-soft': 'rgba(217, 119, 6, 0.15)',\\n      '--wb-primary-glow': 'rgba(251, 191, 36, 0.4)',\\n      '--wb-input-bg': 'rgba(0, 0, 0, 0.25)',\\n      '--wb-input-bg-hover': 'rgba(0, 0, 0, 0.35)',\\n      '--wb-input-bg-focus': 'rgba(0, 0, 0, 0.45)',\\n      '--wb-border-subtle': 'rgba(255, 255, 255, 0.08)',\\n      '--wb-border-main': 'rgba(255, 255, 255, 0.12)',\\n      '--wb-shadow-main': '0 12px 28px rgba(0, 0, 0, 0.5)',\\n      '--wb-scrollbar-thumb': 'rgba(255, 255, 255, 0.2)',\\n    },\\n  },\\n  paper: {\\n    name: 'Paper (Light)',\\n    label: '',\\n    colors: {\\n      '--wb-bg-root': '#fbf9f5',\\n      '--wb-bg-panel': '#f0eadd',\\n      '--wb-text-main': '#4a3b32',\\n      '--wb-text-muted': '#8c7b70',\\n      '--wb-primary': '#d97706',\\n      '--wb-primary-light': '#b45309',\\n      '--wb-primary-hover': 'rgba(217, 119, 6, 0.1)',\\n      '--wb-primary-soft': 'rgba(180, 83, 9, 0.1)',\\n      '--wb-primary-glow': 'rgba(217, 119, 6, 0.25)',\\n      '--wb-input-bg': '#f7f3ec',\\n      '--wb-input-bg-hover': '#f2ece2',\\n      '--wb-input-bg-focus': '#ffffff',\\n      '--wb-border-subtle': 'rgba(74, 59, 50, 0.12)',\\n      '--wb-border-main': 'rgba(74, 59, 50, 0.2)',\\n      '--wb-shadow-main': '0 8px 24px rgba(74, 59, 50, 0.12)',\\n      '--wb-scrollbar-thumb': 'rgba(74, 59, 50, 0.25)',\\n    },\\n  },\\n  snow: {\\n    name: 'Snow (Light)',\\n    label: '',\\n    colors: {\\n      '--wb-bg-root': '#ffffff',\\n      '--wb-bg-panel': '#f4f4f5',\\n      '--wb-text-main': '#18181b',\\n      '--wb-text-muted': '#71717a',\\n      '--wb-primary': '#2563eb',\\n      '--wb-primary-light': '#3b82f6',\\n      '--wb-primary-hover': 'rgba(37, 99, 235, 0.1)',\\n      '--wb-primary-soft': 'rgba(37, 99, 235, 0.08)',\\n      '--wb-primary-glow': 'rgba(37, 99, 235, 0.25)',\\n      '--wb-input-bg': '#ffffff',\\n      '--wb-input-bg-hover': '#fafafa',\\n      '--wb-input-bg-focus': '#ffffff',\\n      '--wb-border-subtle': '#e4e4e7',\\n      '--wb-border-main': '#d4d4d8',\\n      '--wb-shadow-main': '0 12px 28px rgba(0, 0, 0, 0.08)',\\n      '--wb-scrollbar-thumb': '#a1a1aa',\\n    },\\n  },\\n};\\n\\ninterface WorldbookSnapshot {\\n  id: string;\\n  label: string;\\n  ts: number;\\n  entries: WorldbookEntry[];\\n}\\n\\ninterface EntrySnapshot {\\n  id: string;\\n  label: string;\\n  ts: number;\\n  uid: number;\\n  name: string;\\n  entry: WorldbookEntry;\\n}\\n\\ninterface EntryVersionView {\\n  id: string;\\n  label: string;\\n  ts: number;\\n  name: string;\\n  entry: WorldbookEntry;\\n  isCurrent: boolean;\\n}\\n\\ninterface WorldbookVersionView {\\n  id: string;\\n  label: string;\\n  ts: number;\\n  entries: WorldbookEntry[];\\n  isCurrent: boolean;\\n}\\n\\ninterface PresetRoleBinding {\\n  key: string;\\n  name: string;\\n  avatar: string;\\n  updated_at: number;\\n}\\n\\ninterface RoleBindingCandidate extends PresetRoleBinding {\\n  bound: boolean;\\n}\\n\\ninterface GlobalWorldbookPreset {\\n  id: string;\\n  name: string;\\n  worldbooks: string[];\\n  role_bindings: PresetRoleBinding[];\\n  updated_at: number;\\n}\\n\\ninterface AIChatMessage {\\n  role: 'user' | 'assistant';\\n  content: string;\\n  timestamp: number;\\n}\\n\\ninterface AIChatSession {\\n  id: string;\\n  title: string;\\n  createdAt: number;\\n  messages: AIChatMessage[];\\n}\\n\\ninterface AIGeneratorState {\\n  sessions: AIChatSession[];\\n  activeSessionId: string | null;\\n}\\n\\ninterface ExtractedTag {\\n  tag: string;\\n  content: string;\\n  selected: boolean;\\n}\\n\\ninterface PersistedState {\\n  last_worldbook: string;\\n  history: Record<string, WorldbookSnapshot[]>;\\n  entry_history: Record<string, Record<string, EntrySnapshot[]>>;\\n  global_presets: GlobalWorldbookPreset[];\\n  last_global_preset_id: string;\\n  role_override_baseline: { preset_id: string; worldbooks: string[] } | null;\\n  theme: ThemeKey;\\n  ai_chat: AIGeneratorState;\\n}\\n\\ninterface ActivationLog {\\n  id: string;\\n  time: number;\\n  world: string;\\n  uid: number | string;\\n  name: string;\\n  contentPreview: string;\\n}\\n\\ninterface ImportedPayload {\\n  name: string;\\n  entries: WorldbookEntry[];\\n}\\n\\ninterface EventSubscription {\\n  stop: () => void;\\n}\\n\\ninterface FindHit {\\n  entryUid: number;\\n  entryName: string;\\n  field: FindFieldKey;\\n  start: number;\\n  end: number;\\n  matchedText: string;\\n  preview: string;\\n}\\n\\nconst STORAGE_KEY = 'worldbook_assistant_state_v1';\\nconst DIRTY_STATE_KEY = '__WB_ASSISTANT_HAS_UNSAVED_CHANGES__';\\nconst HISTORY_LIMIT = 12;\\nconst ENTRY_HISTORY_LIMIT = 7;\\nconst ACTIVATION_LOG_LIMIT = 120;\\nconst RESIZE_HANDLE_SIZE = 10;\\nconst MAIN_PANE_MIN = 220;\\nconst MAIN_EDITOR_MIN = 540;\\nconst EDITOR_SIDE_MIN = 280;\\nconst EDITOR_CENTER_MIN = 420;\\nconst GLOBAL_PRESET_LIMIT = 64;\\n\\nconst strategyTypeOptions: StrategyType[] = ['constant', 'selective', 'vectorized'];\\nconst secondaryLogicOptions: SecondaryLogic[] = ['and_any', 'and_all', 'not_all', 'not_any'];\\nconst positionTypeOptions: PositionType[] = [\\n  'before_character_definition',\\n  'after_character_definition',\\n  'before_example_messages',\\n  'after_example_messages',\\n  'before_author_note',\\n  'after_author_note',\\n  'at_depth',\\n];\\n\\nconst worldbookNames = ref<string[]>([]);\\nconst selectedWorldbookName = ref('');\\nconst worldbookPickerOpen = ref(false);\\nconst worldbookPickerSearchText = ref('');\\nconst worldbookPickerRef = ref<HTMLElement | null>(null);\\nconst worldbookPickerSearchInputRef = ref<HTMLInputElement | null>(null);\\nconst rolePickerOpen = ref(false);\\nconst rolePickerRef = ref<HTMLElement | null>(null);\\nconst rolePickerSearchInputRef = ref<HTMLInputElement | null>(null);\\nconst currentTheme = ref<ThemeKey>('ocean');\\nconst themePickerOpen = ref(false);\\nconst globalWorldbookMode = ref(false);\\nconst aiGeneratorMode = ref(false);\\nconst aiIsGenerating = ref(false);\\nconst aiCurrentGenerationId = ref<string | null>(null);\\nconst aiStreamingText = ref('');\\nconst aiExtractedTags = ref<ExtractedTag[]>([]);\\nconst aiShowTagReview = ref(false);\\nconst aiTargetWorldbook = ref('');\\nconst aiChatInputText = ref('');\\nconst aiUseContext = ref(true);\\nconst aiChatMessagesRef = ref<HTMLDivElement | null>(null);\\n\\nconst AI_CHAT_SESSION_LIMIT = 50;\\nconst AI_CHAT_MESSAGE_LIMIT = 200;\\nconst selectedGlobalPresetId = ref('');\\nconst currentRoleContext = ref<PresetRoleBinding | null>(null);\\nconst roleBindingSourceCandidates = ref<PresetRoleBinding[]>([]);\\nconst originalEntries = ref<WorldbookEntry[]>([]);\\nconst draftEntries = ref<WorldbookEntry[]>([]);\\nconst selectedEntryUid = ref<number | null>(null);\\n\\nconst searchText = ref('');\\nconst onlyEnabled = ref(false);\\nconst importFileInput = ref<HTMLInputElement | null>(null);\\nconst selectedExtraText = ref('');\\nconst globalAddSearchText = ref('');\\nconst globalFilterText = ref('');\\nconst roleBindSearchText = ref('');\\n\\nconst batchFindText = ref('');\\nconst batchReplaceText = ref('');\\nconst batchExcludeText = ref('');\\nconst batchUseRegex = ref(false);\\nconst batchInName = ref(true);\\nconst batchInContent = ref(true);\\nconst batchInKeys = ref(false);\\nconst batchSearchScope = ref<BatchSearchScope>('all');\\nconst findHits = ref<FindHit[]>([]);\\nconst findHitIndex = ref(-1);\\n\\nconst statusMessage = ref('');\\nconst isBusy = ref(false);\\nconst isSaving = ref(false);\\nconst showEntryHistoryModal = ref(false);\\nconst showWorldbookHistoryModal = ref(false);\\nconst entryHistoryLeftId = ref('');\\nconst entryHistoryRightId = ref('');\\nconst worldbookHistoryLeftId = ref('');\\nconst worldbookHistoryRightId = ref('');\\nconst floatingZCounter = ref(10005);\\nconst floatingPanels = reactive<Record<FloatingPanelKey, FloatingPanelState>>({\\n  find: { visible: false, x: 420, y: 170, z: 10006, width: 500 },\\n  activation: { visible: false, x: 760, y: 230, z: 10008, width: 480 },\\n});\\nconst activeFloatingDrag = ref<{\\n  key: FloatingPanelKey;\\n  pointerId: number;\\n  offsetX: number;\\n  offsetY: number;\\n  doc: Document;\\n  win: Window;\\n} | null>(null);\\nconst floatingPanelKeys: FloatingPanelKey[] = ['find', 'activation'];\\nconst viewportWidth = ref(typeof window !== 'undefined' ? window.innerWidth : 1440);\\nconst mainLayoutRef = ref<HTMLElement | null>(null);\\nconst editorShellRef = ref<HTMLElement | null>(null);\\nconst contentTextareaRef = ref<HTMLTextAreaElement | null>(null);\\nconst mainPaneWidth = ref(320);\\nconst editorSideWidth = ref(360);\\nconst paneResizeState = ref<PaneResizeState | null>(null);\\nconst hostResizeWindow = ref<Window | null>(null);\\n\\nconst screenWidth = ref(typeof window !== 'undefined' ? window.screen.width : 1440);\\nconst screenHeight = ref(typeof window !== 'undefined' ? window.screen.height : 900);\\n\\nconst isMobile = computed(() => screenWidth.value < screenHeight.value);\\n\\n// Keep screen dimensions in sync on orientation change\\nif (typeof window !== 'undefined') {\\n  const syncScreenDims = () => {\\n    screenWidth.value = window.screen.width;\\n    screenHeight.value = window.screen.height;\\n  };\\n  window.addEventListener('orientationchange', () => setTimeout(syncScreenDims, 150));\\n  window.addEventListener('resize', syncScreenDims);\\n}\\nconst showMobileEditor = computed(() => isMobile.value && selectedEntryUid.value !== null);\\nconst mobileTab = ref<'list' | 'edit' | 'settings' | 'ai'>('list');\\n\\nconst bindings = reactive({\\n  global: [] as string[],\\n  charPrimary: null as string | null,\\n  charAdditional: [] as string[],\\n  chat: null as string | null,\\n});\\n\\nconst activationLogs = ref<ActivationLog[]>([]);\\nconst persistedState = ref<PersistedState>(createDefaultPersistedState());\\n\\nconst subscriptions: EventSubscription[] = [];\\n\\nconst selectedEntry = computed(() => {\\n  if (selectedEntryUid.value === null) {\\n    return null;\\n  }\\n  return draftEntries.value.find(entry => entry.uid === selectedEntryUid.value) ?? null;\\n});\\n\\nconst selectedEntryIndex = computed(() => {\\n  if (!selectedEntry.value) {\\n    return -1;\\n  }\\n  return draftEntries.value.findIndex(entry => entry.uid === selectedEntry.value?.uid);\\n});\\n\\nconst filteredEntries = computed(() => {\\n  const keyword = searchText.value.trim().toLowerCase();\\n  return draftEntries.value.filter(entry => {\\n    if (onlyEnabled.value && !entry.enabled) {\\n      return false;\\n    }\\n    if (!keyword) {\\n      return true;\\n    }\\n    const keysJoined = entry.strategy.keys.map(stringifyKeyword).join(' ').toLowerCase();\\n    return (\\n      entry.name.toLowerCase().includes(keyword) ||\\n      entry.content.toLowerCase().includes(keyword) ||\\n      keysJoined.includes(keyword)\\n    );\\n  });\\n});\\n\\nconst enabledEntryCount = computed(() => draftEntries.value.filter(entry => entry.enabled).length);\\n\\nconst totalContentChars = computed(() =>\\n  draftEntries.value.reduce((sum, entry) => {\\n    return sum + entry.content.length;\\n  }, 0),\\n);\\n\\nconst hasUnsavedChanges = computed(() => JSON.stringify(draftEntries.value) !== JSON.stringify(originalEntries.value));\\nconst isCompactLayout = computed(() => viewportWidth.value <= 1100);\\n\\nconst mainLayoutStyle = computed<Record<string, string> | undefined>(() => {\\n  if (isMobile.value) {\\n    return {\\n      display: 'block',\\n      height: 'auto',\\n      overflow: 'visible',\\n    };\\n  }\\n  if (isCompactLayout.value) {\\n    return undefined;\\n  }\\n  return {\\n    gridTemplateColumns: `minmax(${MAIN_PANE_MIN}px, min(${mainPaneWidth.value}px, calc(100% - ${MAIN_EDITOR_MIN + RESIZE_HANDLE_SIZE}px))) ${RESIZE_HANDLE_SIZE}px minmax(0, 1fr)`,\\n  };\\n});\\n\\nconst editorShellStyle = computed<Record<string, string> | undefined>(() => {\\n  if (isCompactLayout.value) {\\n    return undefined;\\n  }\\n  return {\\n    gridTemplateColumns: `minmax(0, 1fr) ${RESIZE_HANDLE_SIZE}px minmax(${EDITOR_SIDE_MIN}px, min(${editorSideWidth.value}px, calc(100% - ${EDITOR_CENTER_MIN + RESIZE_HANDLE_SIZE}px)))`,\\n  };\\n});\\n\\nconst themeStyles = computed(() => {\\n  return THEMES[currentTheme.value].colors;\\n});\\n\\nconst selectableWorldbookNames = computed(() => {\\n  if (!globalWorldbookMode.value) {\\n    return worldbookNames.value;\\n  }\\n  return bindings.global.filter(name => worldbookNames.value.includes(name));\\n});\\n\\nconst globalWorldbookPresets = computed(() => persistedState.value.global_presets ?? []);\\n\\nconst selectedGlobalPreset = computed(() => {\\n  return globalWorldbookPresets.value.find(item => item.id === selectedGlobalPresetId.value) ?? null;\\n});\\n\\nconst selectedGlobalPresetRoleBindings = computed(() => selectedGlobalPreset.value?.role_bindings ?? []);\\n\\nconst isCurrentRoleBoundToSelectedPreset = computed(() => {\\n  const role = currentRoleContext.value;\\n  const preset = selectedGlobalPreset.value;\\n  if (!role || !preset) {\\n    return false;\\n  }\\n  return preset.role_bindings.some(item => item.key === role.key);\\n});\\n\\nconst roleBindingCandidates = computed<RoleBindingCandidate[]>(() => {\\n  const keyword = roleBindSearchText.value.trim().toLowerCase();\\n  const boundSet = new Set(selectedGlobalPresetRoleBindings.value.map(item => item.key));\\n  const list = roleBindingSourceCandidates.value;\\n  const filtered = keyword\\n    ? list.filter(item => {\\n        return (\\n          item.name.toLowerCase().includes(keyword) ||\\n          item.avatar.toLowerCase().includes(keyword) ||\\n          item.key.toLowerCase().includes(keyword)\\n        );\\n      })\\n    : list;\\n  return filtered.map(item => ({\\n    ...item,\\n    bound: boundSet.has(item.key),\\n  }));\\n});\\n\\nconst filteredSelectableWorldbookNames = computed(() => {\\n  const keyword = worldbookPickerSearchText.value.trim().toLowerCase();\\n  if (!keyword) {\\n    return selectableWorldbookNames.value;\\n  }\\n  return selectableWorldbookNames.value.filter(name => name.toLowerCase().includes(keyword));\\n});\\n\\nconst globalAddCandidates = computed(() => {\\n  const keyword = globalAddSearchText.value.trim().toLowerCase();\\n  return worldbookNames.value.filter(name => {\\n    if (bindings.global.includes(name)) {\\n      return false;\\n    }\\n    if (!keyword) {\\n      return true;\\n    }\\n    return name.toLowerCase().includes(keyword);\\n  });\\n});\\n\\nconst filteredGlobalWorldbooks = computed(() => {\\n  const keyword = globalFilterText.value.trim().toLowerCase();\\n  if (!keyword) {\\n    return bindings.global;\\n  }\\n  return bindings.global.filter(name => name.toLowerCase().includes(keyword));\\n});\\n\\nconst isGlobalBound = computed(() => {\\n  if (!selectedWorldbookName.value) {\\n    return false;\\n  }\\n  return bindings.global.includes(selectedWorldbookName.value);\\n});\\n\\nconst snapshotsForCurrent = computed(() => {\\n  if (!selectedWorldbookName.value) {\\n    return [];\\n  }\\n  return persistedState.value.history[selectedWorldbookName.value] ?? [];\\n});\\n\\nconst entrySnapshotsForSelected = computed(() => {\\n  if (!selectedWorldbookName.value || !selectedEntry.value) {\\n    return [];\\n  }\\n  const byWorldbook = persistedState.value.entry_history[selectedWorldbookName.value] ?? {};\\n  return byWorldbook[String(selectedEntry.value.uid)] ?? [];\\n});\\n\\nconst entryVersionViews = computed<EntryVersionView[]>(() => {\\n  if (!selectedEntry.value) {\\n    return [];\\n  }\\n  const baselineEntry = originalEntries.value.find(item => item.uid === selectedEntry.value?.uid) ?? null;\\n  const current: EntryVersionView = {\\n    id: '__current__',\\n    label: '',\\n    ts: Date.now(),\\n    name: selectedEntry.value.name,\\n    entry: selectedEntry.value,\\n    isCurrent: true,\\n  };\\n  const baseline = baselineEntry\\n    ? ({\\n        id: '__baseline__',\\n        label: '',\\n        ts: 0,\\n        name: baselineEntry.name,\\n        entry: baselineEntry,\\n        isCurrent: false,\\n      } satisfies EntryVersionView)\\n    : null;\\n  const history = entrySnapshotsForSelected.value.map(item => ({\\n    id: item.id,\\n    label: item.label,\\n    ts: item.ts,\\n    name: item.name,\\n    entry: item.entry,\\n    isCurrent: false,\\n  }));\\n  return [current, ...(baseline ? [baseline] : []), ...history];\\n});\\n\\nconst selectedEntryHistoryLeft = computed(() => {\\n  return entryVersionViews.value.find(item => item.id === entryHistoryLeftId.value) ?? null;\\n});\\n\\nconst selectedEntryHistoryRight = computed(() => {\\n  return entryVersionViews.value.find(item => item.id === entryHistoryRightId.value) ?? null;\\n});\\n\\nconst canRestoreEntryFromLeft = computed(() => {\\n  return Boolean(selectedEntry.value && selectedEntryHistoryLeft.value && !selectedEntryHistoryLeft.value.isCurrent);\\n});\\n\\nconst worldbookVersionViews = computed<WorldbookVersionView[]>(() => {\\n  if (!selectedWorldbookName.value) {\\n    return [];\\n  }\\n  const current: WorldbookVersionView = {\\n    id: '__current__',\\n    label: '',\\n    ts: Date.now(),\\n    entries: draftEntries.value,\\n    isCurrent: true,\\n  };\\n  const baseline: WorldbookVersionView | null = {\\n    id: '__baseline__',\\n    label: '',\\n    ts: 0,\\n    entries: originalEntries.value,\\n    isCurrent: false,\\n  };\\n  const history = snapshotsForCurrent.value.map(item => ({\\n    id: item.id,\\n    label: item.label,\\n    ts: item.ts,\\n    entries: item.entries,\\n    isCurrent: false,\\n  }));\\n  return [current, ...(originalEntries.value.length ? [baseline] : []), ...history];\\n});\\n\\nconst selectedWorldbookHistoryLeft = computed(() => {\\n  return worldbookVersionViews.value.find(item => item.id === worldbookHistoryLeftId.value) ?? null;\\n});\\n\\nconst selectedWorldbookHistoryRight = computed(() => {\\n  return worldbookVersionViews.value.find(item => item.id === worldbookHistoryRightId.value) ?? null;\\n});\\n\\nconst canRestoreWorldbookFromLeft = computed(() => {\\n  return Boolean(selectedWorldbookHistoryLeft.value && !selectedWorldbookHistoryLeft.value.isCurrent);\\n});\\n\\nconst batchExcludeTokensPreview = computed(() => parseBatchExcludeTokens(batchExcludeText.value));\\n\\nconst activeFindHit = computed(() => {\\n  if (findHitIndex.value < 0 || findHitIndex.value >= findHits.value.length) {\\n    return null;\\n  }\\n  return findHits.value[findHitIndex.value] ?? null;\\n});\\n\\nconst findHitSummaryText = computed(() => {\\n  if (!batchFindText.value.trim()) {\\n    return '';\\n  }\\n  if (!findHits.value.length) {\\n    return '';\\n  }\\n  if (!activeFindHit.value) {\\n    return ` 0 / ${findHits.value.length}`;\\n  }\\n  return ` ${findHitIndex.value + 1} / ${findHits.value.length}`;\\n});\\n\\nconst entryHistoryDiff = computed(() => {\\n  return buildDiffHtml(\\n    serializeEntryVersionForDiff(selectedEntryHistoryLeft.value),\\n    serializeEntryVersionForDiff(selectedEntryHistoryRight.value),\\n  );\\n});\\n\\nconst entryHistorySummary = computed(() => {\\n  return getEntryVersionDiffSummary(selectedEntryHistoryLeft.value, selectedEntryHistoryRight.value);\\n});\\n\\nconst worldbookHistoryDiff = computed(() => {\\n  return buildDiffHtml(\\n    serializeWorldbookVersionForDiff(selectedWorldbookHistoryLeft.value),\\n    serializeWorldbookVersionForDiff(selectedWorldbookHistoryRight.value),\\n  );\\n});\\n\\nconst selectedKeysText = computed({\\n  get: () => {\\n    if (!selectedEntry.value) {\\n      return '';\\n    }\\n    return selectedEntry.value.strategy.keys.map(stringifyKeyword).join(', ');\\n  },\\n  set: (value: string) => {\\n    if (!selectedEntry.value) {\\n      return;\\n    }\\n    selectedEntry.value.strategy.keys = parseKeywordsFromText(value);\\n  },\\n});\\n\\nconst selectedSecondaryKeysText = computed({\\n  get: () => {\\n    if (!selectedEntry.value) {\\n      return '';\\n    }\\n    return selectedEntry.value.strategy.keys_secondary.keys.map(stringifyKeyword).join(', ');\\n  },\\n  set: (value: string) => {\\n    if (!selectedEntry.value) {\\n      return;\\n    }\\n    selectedEntry.value.strategy.keys_secondary.keys = parseKeywordsFromText(value);\\n  },\\n});\\n\\nconst selectedScanDepthText = computed({\\n  get: () => {\\n    if (!selectedEntry.value) {\\n      return '';\\n    }\\n    const depth = selectedEntry.value.strategy.scan_depth;\\n    return typeof depth === 'number' ? String(depth) : 'same_as_global';\\n  },\\n  set: (value: string) => {\\n    if (!selectedEntry.value) {\\n      return;\\n    }\\n    selectedEntry.value.strategy.scan_depth = normalizeScanDepth(value);\\n  },\\n});\\n\\nconst selectedRecursionDelayText = computed({\\n  get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.recursion.delay_until) : ''),\\n  set: (value: string) => {\\n    if (!selectedEntry.value) {\\n      return;\\n    }\\n    selectedEntry.value.recursion.delay_until = parseNullableInteger(value);\\n  },\\n});\\n\\nconst selectedStickyText = computed({\\n  get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.effect.sticky) : ''),\\n  set: (value: string) => {\\n    if (!selectedEntry.value) {\\n      return;\\n    }\\n    selectedEntry.value.effect.sticky = parseNullableInteger(value);\\n  },\\n});\\n\\nconst selectedCooldownText = computed({\\n  get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.effect.cooldown) : ''),\\n  set: (value: string) => {\\n    if (!selectedEntry.value) {\\n      return;\\n    }\\n    selectedEntry.value.effect.cooldown = parseNullableInteger(value);\\n  },\\n});\\n\\nconst selectedEffectDelayText = computed({\\n  get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.effect.delay) : ''),\\n  set: (value: string) => {\\n    if (!selectedEntry.value) {\\n      return;\\n    }\\n    selectedEntry.value.effect.delay = parseNullableInteger(value);\\n  },\\n});\\n\\nconst selectedContentChars = computed(() => {\\n  return selectedEntry.value?.content.length ?? 0;\\n});\\n\\nconst selectedTokenEstimate = computed(() => {\\n  const chars = selectedContentChars.value;\\n  if (chars <= 0) {\\n    return 0;\\n  }\\n  return Math.max(1, Math.round(chars / 3.6));\\n});\\n\\nwatch(selectedWorldbookName, name => {\\n  closeWorldbookPicker();\\n  if (!name) {\\n    draftEntries.value = [];\\n    originalEntries.value = [];\\n    selectedEntryUid.value = null;\\n    return;\\n  }\\n  updatePersistedState(state => {\\n    state.last_worldbook = name;\\n  });\\n  void loadWorldbook(name);\\n});\\n\\nwatch(\\n  () => selectedEntryUid.value,\\n  () => {\\n    syncExtraTextWithSelection();\\n  },\\n);\\n\\nwatch(\\n  [\\n    batchFindText,\\n    batchReplaceText,\\n    batchExcludeText,\\n    batchUseRegex,\\n    batchInName,\\n    batchInContent,\\n    batchInKeys,\\n    batchSearchScope,\\n  ],\\n  () => {\\n    resetFindState();\\n  },\\n);\\n\\nwatch(\\n  entryVersionViews,\\n  views => {\\n    if (!views.length) {\\n      entryHistoryLeftId.value = '';\\n      entryHistoryRightId.value = '';\\n      return;\\n    }\\n\\n    const ids = new Set(views.map(item => item.id));\\n    if (!ids.has(entryHistoryRightId.value)) {\\n      entryHistoryRightId.value = '__current__';\\n    }\\n    if (!ids.has(entryHistoryLeftId.value)) {\\n      const fallback = views.find(item => !item.isCurrent) ?? views[0];\\n      entryHistoryLeftId.value = fallback.id;\\n    }\\n    if (entryHistoryLeftId.value === entryHistoryRightId.value && views.length > 1) {\\n      const fallback = views.find(item => item.id !== entryHistoryRightId.value);\\n      if (fallback) {\\n        entryHistoryLeftId.value = fallback.id;\\n      }\\n    }\\n  },\\n  { immediate: true },\\n);\\n\\nwatch(\\n  worldbookVersionViews,\\n  views => {\\n    if (!views.length) {\\n      worldbookHistoryLeftId.value = '';\\n      worldbookHistoryRightId.value = '';\\n      return;\\n    }\\n\\n    const ids = new Set(views.map(item => item.id));\\n    if (!ids.has(worldbookHistoryRightId.value)) {\\n      worldbookHistoryRightId.value = '__current__';\\n    }\\n    if (!ids.has(worldbookHistoryLeftId.value)) {\\n      const fallback = views.find(item => !item.isCurrent) ?? views[0];\\n      worldbookHistoryLeftId.value = fallback.id;\\n    }\\n    if (worldbookHistoryLeftId.value === worldbookHistoryRightId.value && views.length > 1) {\\n      const fallback = views.find(item => item.id !== worldbookHistoryRightId.value);\\n      if (fallback) {\\n        worldbookHistoryLeftId.value = fallback.id;\\n      }\\n    }\\n  },\\n  { immediate: true },\\n);\\n\\nwatch(\\n  () => selectedEntry.value?.position.type,\\n  () => {\\n    if (!selectedEntry.value) {\\n      return;\\n    }\\n    if (selectedEntry.value.position.type !== 'at_depth') {\\n      selectedEntry.value.position.role = 'system';\\n      selectedEntry.value.position.depth = 4;\\n    }\\n  },\\n);\\n\\nwatch(\\n  hasUnsavedChanges,\\n  dirty => {\\n    const target = window as unknown as Record<string, unknown>;\\n    target[DIRTY_STATE_KEY] = dirty;\\n  },\\n  { immediate: true },\\n);\\n\\nfunction createId(prefix: string): string {\\n  return `${prefix}-${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 9)}`;\\n}\\n\\nfunction asRecord(value: unknown): Record<string, unknown> | null {\\n  if (value && typeof value === 'object' && !Array.isArray(value)) {\\n    return value as Record<string, unknown>;\\n  }\\n  return null;\\n}\\n\\nfunction toStringSafe(value: unknown, fallback = ''): string {\\n  if (typeof value === 'string') {\\n    return value;\\n  }\\n  if (value === null || value === undefined) {\\n    return fallback;\\n  }\\n  return String(value);\\n}\\n\\nfunction toNumberSafe(value: unknown, fallback: number): number {\\n  if (typeof value === 'number' && Number.isFinite(value)) {\\n    return value;\\n  }\\n  if (typeof value === 'string' && value.trim()) {\\n    const parsed = Number(value);\\n    if (Number.isFinite(parsed)) {\\n      return parsed;\\n    }\\n  }\\n  return fallback;\\n}\\n\\nfunction clampNumber(value: number, min: number, max: number): number {\\n  return Math.min(max, Math.max(min, value));\\n}\\n\\nfunction parseNullableInteger(value: unknown): number | null {\\n  if (value === null || value === undefined) {\\n    return null;\\n  }\\n  if (typeof value === 'string' && !value.trim()) {\\n    return null;\\n  }\\n  const parsed = Number(value);\\n  if (!Number.isFinite(parsed)) {\\n    return null;\\n  }\\n  return Math.max(0, Math.floor(parsed));\\n}\\n\\nfunction nullableNumberToText(value: number | null): string {\\n  return value === null ? '' : String(value);\\n}\\n\\nfunction stringifyKeyword(value: string | RegExp): string {\\n  return value instanceof RegExp ? value.toString() : value;\\n}\\n\\nfunction parseKeywordToken(token: string): string | RegExp {\\n  const trimmed = token.trim();\\n  if (!trimmed) {\\n    return '';\\n  }\\n  const regexMatch = trimmed.match(/^\\\\/(.+)\\\\/([dgimsuy]*)$/);\\n  if (!regexMatch) {\\n    return trimmed;\\n  }\\n  try {\\n    return new RegExp(regexMatch[1], regexMatch[2]);\\n  } catch {\\n    return trimmed;\\n  }\\n}\\n\\nfunction normalizeKeywordList(value: unknown): (string | RegExp)[] {\\n  const sourceList = Array.isArray(value) ? value : typeof value === 'string' ? value.split(/[\\\\n,]/g) : [];\\n  const normalized: (string | RegExp)[] = [];\\n  const seen = new Set<string>();\\n\\n  for (const item of sourceList) {\\n    const token = item instanceof RegExp ? item : parseKeywordToken(toStringSafe(item).trim());\\n    const tokenString = stringifyKeyword(token);\\n    if (!tokenString) {\\n      continue;\\n    }\\n    const dedupeKey = tokenString.toLowerCase();\\n    if (seen.has(dedupeKey)) {\\n      continue;\\n    }\\n    seen.add(dedupeKey);\\n    normalized.push(token);\\n  }\\n\\n  return normalized;\\n}\\n\\nfunction parseKeywordsFromText(value: string): (string | RegExp)[] {\\n  return normalizeKeywordList(value.split(/[\\\\n,]/g));\\n}\\n\\nfunction normalizePresetRoleBindings(rawList: unknown): PresetRoleBinding[] {\\n  if (!Array.isArray(rawList)) {\\n    return [];\\n  }\\n  const normalized: PresetRoleBinding[] = [];\\n  const seen = new Set<string>();\\n  for (const item of rawList) {\\n    const record = asRecord(item);\\n    if (!record) {\\n      continue;\\n    }\\n    const key = toStringSafe(record.key).trim();\\n    if (!key || seen.has(key)) {\\n      continue;\\n    }\\n    seen.add(key);\\n    normalized.push({\\n      key,\\n      name: toStringSafe(record.name, key),\\n      avatar: toStringSafe(record.avatar),\\n      updated_at: toNumberSafe(record.updated_at, Date.now()),\\n    });\\n  }\\n  return normalized;\\n}\\n\\nfunction getStrategyTypeLabel(type: StrategyType): string {\\n  if (type === 'constant') {\\n    return '  (constant)';\\n  }\\n  if (type === 'vectorized') {\\n    return '  (vectorized)';\\n  }\\n  return '  (selective)';\\n}\\n\\nfunction getSecondaryLogicLabel(logic: SecondaryLogic): string {\\n  const map: Record<SecondaryLogic, string> = {\\n    and_any: ' (and_any)',\\n    and_all: ' (and_all)',\\n    not_all: ' (not_all)',\\n    not_any: ' (not_any)',\\n  };\\n  return map[logic];\\n}\\n\\nfunction getPositionTypeLabel(type: PositionType): string {\\n  const map: Record<PositionType, string> = {\\n    before_character_definition: '',\\n    after_character_definition: '',\\n    before_example_messages: '',\\n    after_example_messages: '',\\n    before_author_note: '',\\n    after_author_note: '',\\n    at_depth: '',\\n  };\\n  return map[type];\\n}\\n\\nfunction getEntryVisualStatus(entry: WorldbookEntry): EntryVisualStatus {\\n  if (!entry.enabled) {\\n    return 'disabled';\\n  }\\n  if (entry.strategy.type === 'constant') {\\n    return 'constant';\\n  }\\n  if (entry.strategy.type === 'vectorized') {\\n    return 'vector';\\n  }\\n  return 'normal';\\n}\\n\\nfunction getEntryStatusLabel(entry: WorldbookEntry): string {\\n  const status = getEntryVisualStatus(entry);\\n  if (status === 'disabled') {\\n    return ' ';\\n  }\\n  if (status === 'constant') {\\n    return ' ';\\n  }\\n  if (status === 'vector') {\\n    return ' ';\\n  }\\n  return ' ';\\n}\\n\\nfunction getEntryKeyPreview(entry: WorldbookEntry): string {\\n  const rendered = entry.strategy.keys\\n    .slice(0, 3)\\n    .map(key => stringifyKeyword(key))\\n    .join(' / ');\\n  if (!rendered) {\\n    return '';\\n  }\\n  if (entry.strategy.keys.length > 3) {\\n    return `${rendered} ...`;\\n  }\\n  return rendered;\\n}\\n\\nfunction normalizeSecondaryLogic(value: unknown): SecondaryLogic {\\n  if (typeof value === 'string' && secondaryLogicOptions.includes(value as SecondaryLogic)) {\\n    return value as SecondaryLogic;\\n  }\\n  if (typeof value === 'number') {\\n    const map: SecondaryLogic[] = ['and_any', 'and_all', 'not_all', 'not_any'];\\n    return map[value] ?? 'and_any';\\n  }\\n  return 'and_any';\\n}\\n\\nfunction normalizeStrategyType(\\n  raw: Record<string, unknown>,\\n  strategyRecord: Record<string, unknown> | null,\\n): StrategyType {\\n  const directType = strategyRecord?.type;\\n  if (typeof directType === 'string' && strategyTypeOptions.includes(directType as StrategyType)) {\\n    return directType as StrategyType;\\n  }\\n  if (raw.constant) {\\n    return 'constant';\\n  }\\n  if (raw.vectorized) {\\n    return 'vectorized';\\n  }\\n  return 'selective';\\n}\\n\\nfunction normalizePositionType(value: unknown): PositionType {\\n  if (typeof value === 'string') {\\n    if (positionTypeOptions.includes(value as PositionType)) {\\n      return value as PositionType;\\n    }\\n    const depthMatch = value.match(/^at_depth_as_(system|assistant|user)$/);\\n    if (depthMatch) {\\n      return 'at_depth';\\n    }\\n  }\\n  if (typeof value === 'number') {\\n    const map: Record<number, PositionType> = {\\n      0: 'before_character_definition',\\n      1: 'after_character_definition',\\n      2: 'before_example_messages',\\n      3: 'after_example_messages',\\n      4: 'before_author_note',\\n      5: 'after_author_note',\\n      6: 'at_depth',\\n    };\\n    return map[value] ?? 'after_character_definition';\\n  }\\n  return 'after_character_definition';\\n}\\n\\nfunction normalizeRole(value: unknown): RoleType {\\n  if (value === 'assistant' || value === 'user' || value === 'system') {\\n    return value;\\n  }\\n  if (typeof value === 'number') {\\n    const map: Record<number, RoleType> = {\\n      0: 'system',\\n      1: 'assistant',\\n      2: 'user',\\n    };\\n    return map[value] ?? 'system';\\n  }\\n  if (typeof value === 'string') {\\n    if (value.includes('assistant')) {\\n      return 'assistant';\\n    }\\n    if (value.includes('user')) {\\n      return 'user';\\n    }\\n  }\\n  return 'system';\\n}\\n\\nfunction normalizeScanDepth(value: unknown): 'same_as_global' | number {\\n  if (value === 'same_as_global') {\\n    return 'same_as_global';\\n  }\\n  const numeric = Math.floor(toNumberSafe(value, NaN));\\n  if (Number.isFinite(numeric) && numeric > 0) {\\n    return numeric;\\n  }\\n  return 'same_as_global';\\n}\\n\\nfunction createDefaultEntry(uid: number): WorldbookEntry {\\n  return {\\n    uid,\\n    name: ` ${uid}`,\\n    enabled: true,\\n    strategy: {\\n      type: 'selective',\\n      keys: [],\\n      keys_secondary: {\\n        logic: 'and_any',\\n        keys: [],\\n      },\\n      scan_depth: 'same_as_global',\\n    },\\n    position: {\\n      type: 'after_character_definition',\\n      role: 'system',\\n      depth: 4,\\n      order: 100,\\n    },\\n    content: '',\\n    probability: 100,\\n    recursion: {\\n      prevent_incoming: false,\\n      prevent_outgoing: false,\\n      delay_until: null,\\n    },\\n    effect: {\\n      sticky: null,\\n      cooldown: null,\\n      delay: null,\\n    },\\n  };\\n}\\n\\nfunction collectExtraFields(raw: Record<string, unknown>): Record<string, unknown> | undefined {\\n  const known = new Set([\\n    'uid',\\n    'id',\\n    'name',\\n    'comment',\\n    'enabled',\\n    'disable',\\n    'strategy',\\n    'position',\\n    'content',\\n    'probability',\\n    'recursion',\\n    'effect',\\n    'extra',\\n    'keys',\\n    'key',\\n    'secondary_keys',\\n    'keysecondary',\\n    'filters',\\n    'logic',\\n    'selectiveLogic',\\n    'scan_depth',\\n    'constant',\\n    'vectorized',\\n    'selective',\\n    'insertion_order',\\n    'order',\\n    'role',\\n    'depth',\\n    'preventRecursion',\\n    'excludeRecursion',\\n    'delayUntilRecursion',\\n    'sticky',\\n    'cooldown',\\n    'delay',\\n    'useProbability',\\n  ]);\\n\\n  const extra: Record<string, unknown> = {};\\n  for (const [key, value] of Object.entries(raw)) {\\n    if (!known.has(key)) {\\n      extra[key] = value;\\n    }\\n  }\\n  if (Object.keys(extra).length === 0) {\\n    return undefined;\\n  }\\n  return extra;\\n}\\n\\nfunction normalizeEntry(rawInput: unknown, fallbackUid: number): WorldbookEntry {\\n  const raw = asRecord(rawInput) ?? {};\\n  const base = createDefaultEntry(fallbackUid);\\n  const strategyRecord = asRecord(raw.strategy);\\n  const positionRecord = asRecord(raw.position);\\n  const recursionRecord = asRecord(raw.recursion);\\n  const effectRecord = asRecord(raw.effect);\\n  const secondaryRecord = asRecord(strategyRecord?.keys_secondary);\\n\\n  const uid = Math.max(0, Math.floor(toNumberSafe(raw.uid ?? raw.id, fallbackUid)));\\n  const name = toStringSafe(raw.name ?? raw.comment, ` ${uid}`).trim() || ` ${uid}`;\\n  const strategyType = normalizeStrategyType(raw, strategyRecord);\\n  const keys = normalizeKeywordList(strategyRecord?.keys ?? raw.keys ?? raw.key);\\n  const secondaryKeys = normalizeKeywordList(\\n    secondaryRecord?.keys ?? raw.secondary_keys ?? raw.keysecondary ?? raw.filters,\\n  );\\n  const secondaryLogic = normalizeSecondaryLogic(secondaryRecord?.logic ?? raw.logic ?? raw.selectiveLogic);\\n  const positionType = normalizePositionType(positionRecord?.type ?? raw.position);\\n  const role = normalizeRole(positionRecord?.role ?? raw.role);\\n  const depth = Math.max(1, Math.floor(toNumberSafe(positionRecord?.depth ?? raw.depth, 4)));\\n  const order = Math.floor(toNumberSafe(positionRecord?.order ?? raw.insertion_order ?? raw.order, 100));\\n  const probability = clampNumber(toNumberSafe(raw.probability, 100), 0, 100);\\n\\n  const preventIncoming = recursionRecord?.prevent_incoming ?? raw.preventRecursion;\\n  const preventOutgoing = recursionRecord?.prevent_outgoing ?? raw.excludeRecursion;\\n\\n  const entry: WorldbookEntry = {\\n    ...base,\\n    uid,\\n    name,\\n    enabled: raw.enabled === undefined ? !Boolean(raw.disable) : Boolean(raw.enabled),\\n    strategy: {\\n      type: strategyType,\\n      keys,\\n      keys_secondary: {\\n        logic: secondaryLogic,\\n        keys: secondaryKeys,\\n      },\\n      scan_depth: normalizeScanDepth(strategyRecord?.scan_depth ?? raw.scan_depth),\\n    },\\n    position: {\\n      type: positionType,\\n      role: positionType === 'at_depth' ? role : 'system',\\n      depth: positionType === 'at_depth' ? depth : 4,\\n      order,\\n    },\\n    content: toStringSafe(raw.content),\\n    probability,\\n    recursion: {\\n      prevent_incoming: Boolean(preventIncoming),\\n      prevent_outgoing: Boolean(preventOutgoing),\\n      delay_until: parseNullableInteger(recursionRecord?.delay_until ?? raw.delayUntilRecursion),\\n    },\\n    effect: {\\n      sticky: parseNullableInteger(effectRecord?.sticky ?? raw.sticky),\\n      cooldown: parseNullableInteger(effectRecord?.cooldown ?? raw.cooldown),\\n      delay: parseNullableInteger(effectRecord?.delay ?? raw.delay),\\n    },\\n  };\\n\\n  const directExtra = asRecord(raw.extra);\\n  if (directExtra && Object.keys(directExtra).length > 0) {\\n    entry.extra = klona(directExtra);\\n  } else {\\n    const extras = collectExtraFields(raw);\\n    if (extras) {\\n      entry.extra = klona(extras);\\n    }\\n  }\\n\\n  return entry;\\n}\\n\\nfunction normalizeEntryList(rawEntries: unknown[]): WorldbookEntry[] {\\n  const result: WorldbookEntry[] = [];\\n  const uidSet = new Set<number>();\\n\\n  for (let index = 0; index < rawEntries.length; index += 1) {\\n    const rawRecord = asRecord(rawEntries[index]);\\n    let uid = Math.max(0, Math.floor(toNumberSafe(rawRecord?.uid ?? rawRecord?.id, index)));\\n    while (uidSet.has(uid)) {\\n      uid += 1;\\n    }\\n    uidSet.add(uid);\\n    result.push(normalizeEntry(rawEntries[index], uid));\\n  }\\n\\n  return result;\\n}\\n\\nfunction getNextUid(entries: WorldbookEntry[]): number {\\n  if (entries.length === 0) {\\n    return 0;\\n  }\\n  return Math.max(...entries.map(entry => entry.uid)) + 1;\\n}\\n\\nfunction createDefaultPersistedState(): PersistedState {\\n  return {\\n    last_worldbook: '',\\n    history: {},\\n    entry_history: {},\\n    global_presets: [],\\n    last_global_preset_id: '',\\n    role_override_baseline: null,\\n    theme: 'ocean',\\n    ai_chat: { sessions: [], activeSessionId: null },\\n  };\\n}\\n\\nfunction normalizePersistedState(input: unknown): PersistedState {\\n  const root = asRecord(input);\\n  if (!root) {\\n    return createDefaultPersistedState();\\n  }\\n\\n  const historyRoot = asRecord(root.history) ?? {};\\n  const history: Record<string, WorldbookSnapshot[]> = {};\\n  for (const [name, rawSnapshots] of Object.entries(historyRoot)) {\\n    if (!Array.isArray(rawSnapshots)) {\\n      continue;\\n    }\\n    history[name] = rawSnapshots\\n      .map(item => {\\n        const record = asRecord(item);\\n        if (!record) {\\n          return null;\\n        }\\n        const entriesRaw = Array.isArray(record.entries) ? record.entries : [];\\n        return {\\n          id: toStringSafe(record.id, createId('snapshot')),\\n          label: toStringSafe(record.label, ''),\\n          ts: toNumberSafe(record.ts, Date.now()),\\n          entries: normalizeEntryList(entriesRaw),\\n        } satisfies WorldbookSnapshot;\\n      })\\n      .filter((item): item is WorldbookSnapshot => item !== null)\\n      .slice(0, HISTORY_LIMIT);\\n  }\\n\\n  const entryHistoryRoot = asRecord(root.entry_history) ?? {};\\n  const entryHistory: Record<string, Record<string, EntrySnapshot[]>> = {};\\n  for (const [worldbookName, rawByUid] of Object.entries(entryHistoryRoot)) {\\n    const uidRecord = asRecord(rawByUid);\\n    if (!uidRecord) {\\n      continue;\\n    }\\n    const normalizedByUid: Record<string, EntrySnapshot[]> = {};\\n    for (const [uidKey, rawItems] of Object.entries(uidRecord)) {\\n      if (!Array.isArray(rawItems)) {\\n        continue;\\n      }\\n      const uidNumber = Math.max(0, Math.floor(toNumberSafe(uidKey, 0)));\\n      normalizedByUid[uidKey] = rawItems\\n        .map(item => {\\n          const record = asRecord(item);\\n          if (!record) {\\n            return null;\\n          }\\n          return {\\n            id: toStringSafe(record.id, createId('entry-snapshot')),\\n            label: toStringSafe(record.label, ''),\\n            ts: toNumberSafe(record.ts, Date.now()),\\n            uid: uidNumber,\\n            name: toStringSafe(record.name, ` ${uidNumber}`),\\n            entry: normalizeEntry(record.entry, uidNumber),\\n          } satisfies EntrySnapshot;\\n        })\\n        .filter((item): item is EntrySnapshot => item !== null)\\n        .slice(0, ENTRY_HISTORY_LIMIT);\\n    }\\n    if (Object.keys(normalizedByUid).length > 0) {\\n      entryHistory[worldbookName] = normalizedByUid;\\n    }\\n  }\\n\\n  const globalPresetsRaw = Array.isArray(root.global_presets) ? root.global_presets : [];\\n  const globalPresets = globalPresetsRaw\\n    .map(item => {\\n      const record = asRecord(item);\\n      if (!record) {\\n        return null;\\n      }\\n      const worldbooksRaw = Array.isArray(record.worldbooks) ? record.worldbooks : [];\\n      const worldbooks = [...new Set(worldbooksRaw.map(name => toStringSafe(name).trim()).filter(Boolean))];\\n      const roleBindings = normalizePresetRoleBindings(record.role_bindings);\\n      return {\\n        id: toStringSafe(record.id, createId('global-preset')),\\n        name: toStringSafe(record.name, ''),\\n        worldbooks,\\n        role_bindings: roleBindings,\\n        updated_at: toNumberSafe(record.updated_at, Date.now()),\\n      } satisfies GlobalWorldbookPreset;\\n    })\\n    .filter((item): item is GlobalWorldbookPreset => item !== null)\\n    .slice(0, GLOBAL_PRESET_LIMIT);\\n\\n  const rawBaseline = asRecord(root.role_override_baseline);\\n  let roleOverrideBaseline: PersistedState['role_override_baseline'] = null;\\n  if (rawBaseline) {\\n    const baselineWorldbooks = Array.isArray(rawBaseline.worldbooks)\\n      ? rawBaseline.worldbooks.map(name => toStringSafe(name).trim()).filter(Boolean)\\n      : [];\\n    roleOverrideBaseline = {\\n      preset_id: toStringSafe(rawBaseline.preset_id),\\n      worldbooks: [...new Set(baselineWorldbooks)],\\n    };\\n  }\\n\\n  const aiChatRaw = asRecord(root.ai_chat);\\n  const aiChat: AIGeneratorState = { sessions: [], activeSessionId: null };\\n  if (aiChatRaw) {\\n    aiChat.activeSessionId = toStringSafe(aiChatRaw.activeSessionId) || null;\\n    if (Array.isArray(aiChatRaw.sessions)) {\\n      aiChat.sessions = aiChatRaw.sessions\\n        .map((s: unknown) => {\\n          const sr = asRecord(s);\\n          if (!sr) return null;\\n          const msgs = Array.isArray(sr.messages)\\n            ? sr.messages.map((m: unknown) => {\\n                const mr = asRecord(m);\\n                if (!mr) return null;\\n                return {\\n                  role: mr.role === 'assistant' ? 'assistant' : 'user',\\n                  content: toStringSafe(mr.content),\\n                  timestamp: toNumberSafe(mr.timestamp, Date.now()),\\n                } satisfies AIChatMessage;\\n              }).filter((m): m is AIChatMessage => m !== null)\\n            : [];\\n          return {\\n            id: toStringSafe(sr.id, createId('ai-chat')),\\n            title: toStringSafe(sr.title, ''),\\n            createdAt: toNumberSafe(sr.createdAt, Date.now()),\\n            messages: msgs.slice(0, AI_CHAT_MESSAGE_LIMIT),\\n          } satisfies AIChatSession;\\n        })\\n        .filter((s): s is AIChatSession => s !== null)\\n        .slice(0, AI_CHAT_SESSION_LIMIT);\\n    }\\n  }\\n\\n  return {\\n    last_worldbook: toStringSafe(root.last_worldbook),\\n    history,\\n    entry_history: entryHistory,\\n    global_presets: globalPresets,\\n    last_global_preset_id: toStringSafe(root.last_global_preset_id),\\n    role_override_baseline: roleOverrideBaseline,\\n    theme: (toStringSafe(root.theme) as ThemeKey) || 'ocean',\\n    ai_chat: aiChat,\\n  };\\n}\\n\\nfunction readPersistedState(): PersistedState {\\n  const vars = getVariables({ type: 'script', script_id: getScriptId() });\\n  return normalizePersistedState(vars[STORAGE_KEY]);\\n}\\n\\nfunction syncSelectedGlobalPresetFromState(): void {\\n  const presets = persistedState.value.global_presets;\\n  const byId = new Set(presets.map(item => item.id));\\n  const preferredId = persistedState.value.last_global_preset_id;\\n  if (preferredId && byId.has(preferredId)) {\\n    selectedGlobalPresetId.value = preferredId;\\n    return;\\n  }\\n  if (selectedGlobalPresetId.value && byId.has(selectedGlobalPresetId.value)) {\\n    return;\\n  }\\n  selectedGlobalPresetId.value = '';\\n}\\n\\nfunction writePersistedState(state: PersistedState): void {\\n  const vars = getVariables({ type: 'script', script_id: getScriptId() });\\n  vars[STORAGE_KEY] = state;\\n  replaceVariables(vars, { type: 'script', script_id: getScriptId() });\\n  persistedState.value = state;\\n  syncSelectedGlobalPresetFromState();\\n}\\n\\nfunction updatePersistedState(mutator: (state: PersistedState) => void): void {\\n  const state = readPersistedState();\\n  mutator(state);\\n  writePersistedState(state);\\n}\\n\\n//  AI Chat: computed \\nconst aiSessions = computed(() => persistedState.value.ai_chat.sessions);\\n\\nconst aiActiveSession = computed((): AIChatSession | null => {\\n  const id = persistedState.value.ai_chat.activeSessionId;\\n  if (!id) return null;\\n  return aiSessions.value.find(s => s.id === id) ?? null;\\n});\\n\\nconst aiActiveMessages = computed((): AIChatMessage[] => aiActiveSession.value?.messages ?? []);\\n\\n//  AI Chat: CRUD \\nfunction aiCreateSession(): void {\\n  const id = createId('ai-chat');\\n  const session: AIChatSession = {\\n    id,\\n    title: ` ${aiSessions.value.length + 1}`,\\n    createdAt: Date.now(),\\n    messages: [],\\n  };\\n  updatePersistedState(state => {\\n    state.ai_chat.sessions.unshift(session);\\n    state.ai_chat.activeSessionId = id;\\n  });\\n  setStatus('');\\n}\\n\\nfunction aiDeleteSession(id: string): void {\\n  updatePersistedState(state => {\\n    state.ai_chat.sessions = state.ai_chat.sessions.filter(s => s.id !== id);\\n    if (state.ai_chat.activeSessionId === id) {\\n      state.ai_chat.activeSessionId = state.ai_chat.sessions[0]?.id ?? null;\\n    }\\n  });\\n  setStatus('');\\n}\\n\\nfunction aiSwitchSession(id: string): void {\\n  updatePersistedState(state => {\\n    state.ai_chat.activeSessionId = id;\\n  });\\n}\\n\\nfunction aiRenameSession(id: string, title: string): void {\\n  updatePersistedState(state => {\\n    const session = state.ai_chat.sessions.find(s => s.id === id);\\n    if (session) {\\n      session.title = title.trim() || session.title;\\n    }\\n  });\\n}\\n\\nfunction aiAddMessage(role: 'user' | 'assistant', content: string): void {\\n  const sessionId = persistedState.value.ai_chat.activeSessionId;\\n  if (!sessionId) return;\\n  updatePersistedState(state => {\\n    const session = state.ai_chat.sessions.find(s => s.id === sessionId);\\n    if (session) {\\n      session.messages.push({ role, content, timestamp: Date.now() });\\n      if (session.messages.length > AI_CHAT_MESSAGE_LIMIT) {\\n        session.messages = session.messages.slice(-AI_CHAT_MESSAGE_LIMIT);\\n      }\\n    }\\n  });\\n}\\n\\n//  AI Chat: generate \\nlet aiStreamSubscription: { stop: () => void } | null = null;\\n\\nasync function aiSendMessage(): Promise<void> {\\n  const text = aiChatInputText.value.trim();\\n  if (!text || aiIsGenerating.value) return;\\n\\n  const sessionId = persistedState.value.ai_chat.activeSessionId;\\n  if (!sessionId) {\\n    aiCreateSession();\\n  }\\n\\n  aiChatInputText.value = '';\\n  aiAddMessage('user', text);\\n\\n  const session = persistedState.value.ai_chat.sessions.find(\\n    s => s.id === persistedState.value.ai_chat.activeSessionId\\n  );\\n  if (!session) return;\\n\\n  // Build prompts from session history (excluding the user message we just added since generate will use user_input)\\n  const historyPrompts: RolePrompt[] = session.messages.slice(0, -1).map(m => ({\\n    role: m.role,\\n    content: m.content,\\n  }));\\n\\n  const generationId = createId('ai-gen');\\n  aiCurrentGenerationId.value = generationId;\\n  aiIsGenerating.value = true;\\n  aiStreamingText.value = '';\\n\\n  // Subscribe to streaming events\\n  aiStreamSubscription = eventOn(\\n    iframe_events.STREAM_TOKEN_RECEIVED_FULLY,\\n    (fullText: string, genId: string) => {\\n      if (genId === generationId) {\\n        aiStreamingText.value = fullText;\\n      }\\n    }\\n  );\\n\\n  try {\\n    const generateConfig: Parameters<typeof generate>[0] = {\\n      generation_id: generationId,\\n      user_input: text,\\n      should_stream: true,\\n      should_silence: true,\\n    };\\n\\n    if (!aiUseContext.value) {\\n      // :  chat_history, \\n      generateConfig.overrides = {\\n        chat_history: { prompts: historyPrompts },\\n      };\\n    }\\n    // :  chat_history,  prompt (++)\\n\\n    const result = await generate(generateConfig);\\n\\n    aiAddMessage('assistant', result);\\n    aiStreamingText.value = '';\\n\\n    // Auto-extract tags\\n    const tags = aiExtractTags(result);\\n    if (tags.length > 0) {\\n      aiExtractedTags.value = tags;\\n      aiShowTagReview.value = true;\\n    }\\n  } catch (error) {\\n    const message = error instanceof Error ? error.message : String(error);\\n    toastr.error(`AI : ${message}`);\\n    setStatus(`AI : ${message}`);\\n  } finally {\\n    aiIsGenerating.value = false;\\n    aiCurrentGenerationId.value = null;\\n    aiStreamSubscription?.stop();\\n    aiStreamSubscription = null;\\n  }\\n}\\n\\nfunction aiStopGeneration(): void {\\n  if (aiCurrentGenerationId.value) {\\n    stopGenerationById(aiCurrentGenerationId.value);\\n  }\\n}\\n\\n//  AI Chat: tag extraction \\nfunction aiExtractTags(text: string): ExtractedTag[] {\\n  const regex = /<([^/<>\\\\s]+)>([\\\\s\\\\S]*?)<\\\\/\\\\1>/g;\\n  const results: ExtractedTag[] = [];\\n  let match: RegExpExecArray | null;\\n  while ((match = regex.exec(text)) !== null) {\\n    results.push({\\n      tag: match[1],\\n      content: match[0],\\n      selected: true,\\n    });\\n  }\\n  return results;\\n}\\n\\nasync function aiCreateSelectedEntries(): Promise<void> {\\n  const selected = aiExtractedTags.value.filter(t => t.selected);\\n  if (selected.length === 0) {\\n    toastr.warning('');\\n    return;\\n  }\\n\\n  const targetName = aiTargetWorldbook.value;\\n  if (!targetName) {\\n    toastr.warning('');\\n    return;\\n  }\\n\\n  try {\\n    const newEntries = selected.map(t => ({\\n      name: t.tag,\\n      content: t.content,\\n    }));\\n\\n    await createWorldbookEntries(targetName, newEntries);\\n    toastr.success(` ${selected.length}  \\\"${targetName}\\\"`);\\n    setStatus(` ${selected.length}  \\\"${targetName}\\\"`);\\n    aiShowTagReview.value = false;\\n    aiExtractedTags.value = [];\\n  } catch (error) {\\n    const message = error instanceof Error ? error.message : String(error);\\n    toastr.error(`: ${message}`);\\n  }\\n}\\n\\nfunction aiToggleMode(): void {\\n  aiGeneratorMode.value = !aiGeneratorMode.value;\\n  if (aiGeneratorMode.value) {\\n    globalWorldbookMode.value = false;\\n  }\\n}\\n\\nfunction setStatus(message: string): void {\\n  statusMessage.value = message;\\n}\\n\\nfunction syncExtraTextWithSelection(): void {\\n  if (!selectedEntry.value || !selectedEntry.value.extra) {\\n    selectedExtraText.value = '';\\n    return;\\n  }\\n  selectedExtraText.value = JSON.stringify(selectedEntry.value.extra, null, 2);\\n}\\n\\nfunction formatDateTime(timestamp: number): string {\\n  try {\\n    return new Date(timestamp).toLocaleString('zh-CN', { hour12: false });\\n  } catch {\\n    return String(timestamp);\\n  }\\n}\\n\\nfunction formatHistoryOptionLabel(label: string, ts: number, isCurrent: boolean): string {\\n  if (isCurrent) {\\n    return 'Current';\\n  }\\n  if (label === '' || ts <= 0) {\\n    return label;\\n  }\\n  return `${label}  ${formatDateTime(ts)}`;\\n}\\n\\nfunction getEntryVersionPreview(view: EntryVersionView | null): string {\\n  if (!view) {\\n    return '';\\n  }\\n  const content = toStringSafe(view.entry.content).replace(/\\\\s+/g, ' ').trim();\\n  if (!content) {\\n    return '()';\\n  }\\n  return content.slice(0, 160);\\n}\\n\\nfunction getWorldbookVersionDiffSummary(\\n  left: WorldbookVersionView | null,\\n  right: WorldbookVersionView | null,\\n): string {\\n  if (!left || !right) {\\n    return '';\\n  }\\n  const leftMap = new Map<number, WorldbookEntry>();\\n  const rightMap = new Map<number, WorldbookEntry>();\\n  left.entries.forEach(entry => leftMap.set(entry.uid, entry));\\n  right.entries.forEach(entry => rightMap.set(entry.uid, entry));\\n\\n  let added = 0;\\n  let removed = 0;\\n  let changed = 0;\\n\\n  for (const [uid, rightEntry] of rightMap) {\\n    const leftEntry = leftMap.get(uid);\\n    if (!leftEntry) {\\n      added += 1;\\n      continue;\\n    }\\n    if (JSON.stringify(leftEntry) !== JSON.stringify(rightEntry)) {\\n      changed += 1;\\n    }\\n  }\\n  for (const uid of leftMap.keys()) {\\n    if (!rightMap.has(uid)) {\\n      removed += 1;\\n    }\\n  }\\n\\n  return ` ${added} /  ${changed} /  ${removed}`;\\n}\\n\\nfunction getEntryVersionDiffSummary(left: EntryVersionView | null, right: EntryVersionView | null): string {\\n  if (!left || !right) {\\n    return '';\\n  }\\n  const leftText = serializeEntryVersionForDiff(left);\\n  const rightText = serializeEntryVersionForDiff(right);\\n  const parts = diffLines(leftText, rightText) as Array<{ value: string; added?: boolean; removed?: boolean }>;\\n  let addLines = 0;\\n  let delLines = 0;\\n  for (const part of parts) {\\n    const lines = part.value.split('\\\\n');\\n    if (lines.length && lines[lines.length - 1] === '') {\\n      lines.pop();\\n    }\\n    if (part.added) {\\n      addLines += lines.length;\\n    } else if (part.removed) {\\n      delLines += lines.length;\\n    }\\n  }\\n  const changed = Math.min(addLines, delLines);\\n  const added = Math.max(0, addLines - changed);\\n  const removed = Math.max(0, delLines - changed);\\n  return ` ${added} /  ${changed} /  ${removed}`;\\n}\\n\\nfunction escapeHtml(text: string): string {\\n  return text\\n    .replaceAll('&', '&amp;')\\n    .replaceAll('<', '&lt;')\\n    .replaceAll('>', '&gt;')\\n    .replaceAll('\\\"', '&quot;')\\n    .replaceAll(\\\"'\\\", '&#39;');\\n}\\n\\nfunction serializeEntryVersionForDiff(view: EntryVersionView | null): string {\\n  if (!view) {\\n    return '';\\n  }\\n  const entry = view.entry;\\n  const payload = {\\n    uid: entry.uid,\\n    name: entry.name,\\n    enabled: entry.enabled,\\n    strategy: entry.strategy,\\n    position: entry.position,\\n    probability: entry.probability,\\n    recursion: entry.recursion,\\n    effect: entry.effect,\\n    content: entry.content,\\n    extra: entry.extra ?? null,\\n  };\\n  return JSON.stringify(payload, null, 2);\\n}\\n\\nfunction serializeWorldbookVersionForDiff(view: WorldbookVersionView | null): string {\\n  if (!view) {\\n    return '';\\n  }\\n  const entries = view.entries\\n    .map(entry => ({\\n      uid: entry.uid,\\n      name: entry.name,\\n      enabled: entry.enabled,\\n      type: entry.strategy.type,\\n      keys: entry.strategy.keys.map(stringifyKeyword),\\n      position: entry.position,\\n      probability: entry.probability,\\n      content: entry.content,\\n    }))\\n    .sort((left, right) => left.uid - right.uid);\\n  return JSON.stringify({ entries }, null, 2);\\n}\\n\\nfunction buildDiffHtml(leftText: string, rightText: string): { leftHtml: string; rightHtml: string } {\\n  const leftRendered: string[] = [];\\n  const rightRendered: string[] = [];\\n  let leftLineNo = 1;\\n  let rightLineNo = 1;\\n  const parts = diffLines(leftText, rightText);\\n\\n  for (const part of parts as Array<{ value: string; added?: boolean; removed?: boolean }>) {\\n    const lines = part.value.split('\\\\n');\\n    if (lines.length && lines[lines.length - 1] === '') {\\n      lines.pop();\\n    }\\n    if (!lines.length) {\\n      continue;\\n    }\\n\\n    if (part.added) {\\n      for (const line of lines) {\\n        leftRendered.push(`<div class=\\\"diff-row empty\\\"><span class=\\\"line-no\\\"></span><span class=\\\"line-text\\\">&nbsp;</span></div>`);\\n        rightRendered.push(\\n          `<div class=\\\"diff-row add\\\"><span class=\\\"line-no\\\">${rightLineNo}</span><span class=\\\"line-text\\\">${escapeHtml(line) || '&nbsp;'}</span></div>`,\\n        );\\n        rightLineNo += 1;\\n      }\\n      continue;\\n    }\\n\\n    if (part.removed) {\\n      for (const line of lines) {\\n        leftRendered.push(\\n          `<div class=\\\"diff-row del\\\"><span class=\\\"line-no\\\">${leftLineNo}</span><span class=\\\"line-text\\\">${escapeHtml(line) || '&nbsp;'}</span></div>`,\\n        );\\n        rightRendered.push(`<div class=\\\"diff-row empty\\\"><span class=\\\"line-no\\\"></span><span class=\\\"line-text\\\">&nbsp;</span></div>`);\\n        leftLineNo += 1;\\n      }\\n      continue;\\n    }\\n\\n    for (const line of lines) {\\n      const safe = escapeHtml(line) || '&nbsp;';\\n      leftRendered.push(`<div class=\\\"diff-row\\\"><span class=\\\"line-no\\\">${leftLineNo}</span><span class=\\\"line-text\\\">${safe}</span></div>`);\\n      rightRendered.push(`<div class=\\\"diff-row\\\"><span class=\\\"line-no\\\">${rightLineNo}</span><span class=\\\"line-text\\\">${safe}</span></div>`);\\n      leftLineNo += 1;\\n      rightLineNo += 1;\\n    }\\n  }\\n\\n  return {\\n    leftHtml: leftRendered.join(''),\\n    rightHtml: rightRendered.join(''),\\n  };\\n}\\n\\nfunction parseBatchExcludeTokens(value: string): string[] {\\n  const seen = new Set<string>();\\n  const tokens: string[] = [];\\n  for (const raw of value.split(/[\\\\n,]/g)) {\\n    const token = raw.trim().toLowerCase();\\n    if (!token || seen.has(token)) {\\n      continue;\\n    }\\n    seen.add(token);\\n    tokens.push(token);\\n  }\\n  return tokens;\\n}\\n\\nfunction shouldExcludeEntryForBatch(entry: WorldbookEntry, tokens: string[]): boolean {\\n  if (!tokens.length) {\\n    return false;\\n  }\\n  const name = entry.name.toLowerCase();\\n  const content = entry.content.toLowerCase();\\n  const keys = entry.strategy.keys.map(key => stringifyKeyword(key).toLowerCase()).join(' ');\\n  const secondaryKeys = entry.strategy.keys_secondary.keys.map(key => stringifyKeyword(key).toLowerCase()).join(' ');\\n\\n  for (const token of tokens) {\\n    const uidMatch = token.match(/^(?:#|uid:)?(\\\\d+)$/);\\n    if (uidMatch && Number(uidMatch[1]) === entry.uid) {\\n      return true;\\n    }\\n\\n    const scoped = token.match(/^(name|content|keys|secondary|secondary_keys):(.+)$/);\\n    if (scoped) {\\n      const scope = scoped[1];\\n      const needle = scoped[2].trim();\\n      if (!needle) {\\n        continue;\\n      }\\n\\n      if (scope === 'name' && name.includes(needle)) {\\n        return true;\\n      }\\n      if (scope === 'content' && content.includes(needle)) {\\n        return true;\\n      }\\n      if (scope === 'keys' && keys.includes(needle)) {\\n        return true;\\n      }\\n      if ((scope === 'secondary' || scope === 'secondary_keys') && secondaryKeys.includes(needle)) {\\n        return true;\\n      }\\n      continue;\\n    }\\n\\n    const plain = token.trim();\\n    if (!plain) {\\n      continue;\\n    }\\n\\n    if (\\n      name.includes(plain) ||\\n      content.includes(plain) ||\\n      keys.includes(plain) ||\\n      secondaryKeys.includes(plain)\\n    ) {\\n      return true;\\n    }\\n  }\\n  return false;\\n}\\n\\nfunction getFindFieldLabel(field: FindFieldKey): string {\\n  if (field === 'name') {\\n    return '';\\n  }\\n  if (field === 'content') {\\n    return '';\\n  }\\n  return '';\\n}\\n\\nfunction resolveBatchRegex(findText: string): RegExp | null {\\n  if (!batchUseRegex.value) {\\n    return null;\\n  }\\n  try {\\n    return new RegExp(findText, 'g');\\n  } catch (error) {\\n    toastr.error(`: ${error instanceof Error ? error.message : String(error)}`);\\n    return null;\\n  }\\n}\\n\\nfunction getBatchTargetEntries(): WorldbookEntry[] {\\n  if (batchSearchScope.value === 'current') {\\n    return selectedEntry.value ? [selectedEntry.value] : [];\\n  }\\n  return draftEntries.value;\\n}\\n\\nfunction getEnabledFindFields(): FindFieldKey[] {\\n  const fields: FindFieldKey[] = [];\\n  if (batchInName.value) {\\n    fields.push('name');\\n  }\\n  if (batchInContent.value) {\\n    fields.push('content');\\n  }\\n  if (batchInKeys.value) {\\n    fields.push('keys');\\n  }\\n  return fields;\\n}\\n\\nfunction getEntryFieldText(entry: WorldbookEntry, field: FindFieldKey): string {\\n  if (field === 'name') {\\n    return entry.name;\\n  }\\n  if (field === 'content') {\\n    return entry.content;\\n  }\\n  return entry.strategy.keys.map(key => stringifyKeyword(key)).join(', ');\\n}\\n\\nfunction collectMatchIndexes(text: string, findText: string, regex: RegExp | null): Array<{ start: number; end: number; matchedText: string }> {\\n  const hits: Array<{ start: number; end: number; matchedText: string }> = [];\\n  if (!text || !findText) {\\n    return hits;\\n  }\\n\\n  if (!regex) {\\n    let cursor = 0;\\n    while (cursor <= text.length) {\\n      const start = text.indexOf(findText, cursor);\\n      if (start < 0) {\\n        break;\\n      }\\n      const end = start + findText.length;\\n      hits.push({\\n        start,\\n        end,\\n        matchedText: text.slice(start, end),\\n      });\\n      cursor = Math.max(end, start + 1);\\n    }\\n    return hits;\\n  }\\n\\n  const runtime = new RegExp(regex.source, regex.flags.includes('g') ? regex.flags : `${regex.flags}g`);\\n  let result: RegExpExecArray | null = null;\\n  while ((result = runtime.exec(text)) !== null) {\\n    const matched = result[0] ?? '';\\n    if (!matched) {\\n      runtime.lastIndex += 1;\\n      continue;\\n    }\\n    const start = result.index;\\n    const end = start + matched.length;\\n    hits.push({\\n      start,\\n      end,\\n      matchedText: matched,\\n    });\\n  }\\n  return hits;\\n}\\n\\nfunction buildFindPreview(text: string, start: number, end: number): string {\\n  const left = Math.max(0, start - 18);\\n  const right = Math.min(text.length, end + 22);\\n  const prefix = left > 0 ? '...' : '';\\n  const suffix = right < text.length ? '...' : '';\\n  return `${prefix}${text.slice(left, right).replace(/\\\\s+/g, ' ')}${suffix}`;\\n}\\n\\nfunction collectFindHits(findText: string, regex: RegExp | null, excludeTokens: string[]): FindHit[] {\\n  const fields = getEnabledFindFields();\\n  if (!fields.length) {\\n    return [];\\n  }\\n  const entries = getBatchTargetEntries();\\n  const hits: FindHit[] = [];\\n\\n  for (const entry of entries) {\\n    if (shouldExcludeEntryForBatch(entry, excludeTokens)) {\\n      continue;\\n    }\\n    for (const field of fields) {\\n      const text = getEntryFieldText(entry, field);\\n      const indexes = collectMatchIndexes(text, findText, regex);\\n      for (const match of indexes) {\\n        hits.push({\\n          entryUid: entry.uid,\\n          entryName: entry.name,\\n          field,\\n          start: match.start,\\n          end: match.end,\\n          matchedText: match.matchedText,\\n          preview: buildFindPreview(text, match.start, match.end),\\n        });\\n      }\\n    }\\n  }\\n\\n  return hits;\\n}\\n\\nfunction isSameFindHit(left: FindHit, right: FindHit): boolean {\\n  return (\\n    left.entryUid === right.entryUid &&\\n    left.field === right.field &&\\n    left.start === right.start &&\\n    left.end === right.end &&\\n    left.matchedText === right.matchedText\\n  );\\n}\\n\\nfunction resetFindState(): void {\\n  findHits.value = [];\\n  findHitIndex.value = -1;\\n}\\n\\nfunction getFindTargetElement(field: FindFieldKey): HTMLInputElement | HTMLTextAreaElement | null {\\n  const root = editorShellRef.value;\\n  if (!root) {\\n    return null;\\n  }\\n  if (field === 'name') {\\n    return root.querySelector('.editor-comment input.text-input');\\n  }\\n  if (field === 'content') {\\n    return root.querySelector('.editor-content-area');\\n  }\\n  return root.querySelector('.editor-keyword-grid .field textarea');\\n}\\n\\nfunction getTextareaLineHeight(element: HTMLTextAreaElement): number {\\n  const style = window.getComputedStyle(element);\\n  const lineHeight = Number.parseFloat(style.lineHeight);\\n  if (Number.isFinite(lineHeight) && lineHeight > 0) {\\n    return lineHeight;\\n  }\\n  const fontSize = Number.parseFloat(style.fontSize);\\n  if (Number.isFinite(fontSize) && fontSize > 0) {\\n    return fontSize * 1.4;\\n  }\\n  return 18;\\n}\\n\\nfunction scrollTextareaToSelection(element: HTMLTextAreaElement, start: number): void {\\n  const lineHeight = getTextareaLineHeight(element);\\n  const before = element.value.slice(0, start);\\n  const lineIndex = before.split('\\\\n').length - 1;\\n  const desiredTop = Math.max(0, lineIndex * lineHeight - element.clientHeight * 0.35);\\n  element.scrollTop = desiredTop;\\n}\\n\\nasync function revealFindHitInEditor(hit: FindHit): Promise<void> {\\n  await nextTick();\\n  let target = getFindTargetElement(hit.field);\\n  if (!target) {\\n    await nextTick();\\n    target = getFindTargetElement(hit.field);\\n    if (!target) {\\n      return;\\n    }\\n  }\\n\\n  const maxLen = target.value.length;\\n  const start = Math.max(0, Math.min(hit.start, maxLen));\\n  const end = Math.max(start, Math.min(hit.end, maxLen));\\n\\n  target.focus();\\n  target.setSelectionRange(start, end);\\n  if (target instanceof HTMLTextAreaElement) {\\n    scrollTextareaToSelection(target, start);\\n  }\\n  target.scrollIntoView({ block: 'center', inline: 'nearest' });\\n  requestAnimationFrame(() => {\\n    target?.scrollIntoView({ block: 'center', inline: 'nearest' });\\n    if (target instanceof HTMLTextAreaElement) {\\n      scrollTextareaToSelection(target, start);\\n    }\\n  });\\n}\\n\\nfunction moveToFindHit(hit: FindHit, index: number, total: number): void {\\n  findHitIndex.value = index;\\n  selectedEntryUid.value = hit.entryUid;\\n  void revealFindHitInEditor(hit);\\n  const entryLabel = hit.entryName || ` ${hit.entryUid}`;\\n  setStatus(` ${index + 1}/${total}: ${entryLabel}  ${getFindFieldLabel(hit.field)}  ${hit.preview}`);\\n}\\n\\nfunction runFind(step: -1 | 0 | 1): void {\\n  const findText = batchFindText.value;\\n  if (!findText) {\\n    toastr.warning('');\\n    return;\\n  }\\n\\n  if (!getEnabledFindFields().length) {\\n    toastr.warning('');\\n    return;\\n  }\\n\\n  if (batchSearchScope.value === 'current' && !selectedEntry.value) {\\n    toastr.warning('');\\n    return;\\n  }\\n\\n  const excludeTokens = parseBatchExcludeTokens(batchExcludeText.value);\\n  const regex = resolveBatchRegex(findText);\\n  if (batchUseRegex.value && !regex) {\\n    return;\\n  }\\n\\n  const hits = collectFindHits(findText, regex, excludeTokens);\\n  findHits.value = hits;\\n\\n  if (!hits.length) {\\n    findHitIndex.value = -1;\\n    setStatus('');\\n    toastr.info('');\\n    return;\\n  }\\n\\n  if (step === 0) {\\n    moveToFindHit(hits[0], 0, hits.length);\\n    return;\\n  }\\n\\n  const prevHit = activeFindHit.value;\\n  const currentIndex = prevHit ? hits.findIndex(item => isSameFindHit(item, prevHit)) : findHitIndex.value;\\n  let nextIndex: number;\\n  if (currentIndex < 0) {\\n    nextIndex = step > 0 ? 0 : hits.length - 1;\\n  } else {\\n    nextIndex = (currentIndex + step + hits.length) % hits.length;\\n  }\\n  moveToFindHit(hits[nextIndex], nextIndex, hits.length);\\n}\\n\\nfunction findFirstMatch(): void {\\n  runFind(0);\\n}\\n\\nfunction findNextMatch(): void {\\n  runFind(1);\\n}\\n\\nfunction findPreviousMatch(): void {\\n  runFind(-1);\\n}\\n\\nfunction ensureSelectedEntryExists(): void {\\n  if (!draftEntries.value.length) {\\n    selectedEntryUid.value = null;\\n    return;\\n  }\\n  if (selectedEntryUid.value === null) {\\n    selectedEntryUid.value = draftEntries.value[0].uid;\\n    return;\\n  }\\n  const exists = draftEntries.value.some(entry => entry.uid === selectedEntryUid.value);\\n  if (!exists) {\\n    selectedEntryUid.value = draftEntries.value[0].uid;\\n  }\\n}\\n\\nfunction selectEntry(uid: number): void {\\n  selectedEntryUid.value = uid;\\n  if (isMobile.value) {\\n    mobileTab.value = 'edit';\\n  }\\n}\\n\\nfunction goBackToList(): void {\\n  selectedEntryUid.value = null;\\n  mobileTab.value = 'list';\\n}\\n\\nfunction createEntrySnapshotRecord(\\n  label: string,\\n  uid: number,\\n  name: string,\\n  entry: WorldbookEntry,\\n): EntrySnapshot {\\n  return {\\n    id: createId('entry-snapshot'),\\n    label,\\n    ts: Date.now(),\\n    uid,\\n    name: name || ` ${uid}`,\\n    entry: normalizeEntry(klona(entry), uid),\\n  };\\n}\\n\\nfunction pushEntrySnapshotsBulk(\\n  items: Array<{\\n    label: string;\\n    uid: number;\\n    name: string;\\n    entry: WorldbookEntry;\\n  }>,\\n): number {\\n  if (!selectedWorldbookName.value || !items.length) {\\n    return 0;\\n  }\\n\\n  let added = 0;\\n  const worldbookName = selectedWorldbookName.value;\\n\\n  updatePersistedState(state => {\\n    const byWorldbook = state.entry_history[worldbookName] ?? {};\\n\\n    for (const item of items) {\\n      const uidKey = String(item.uid);\\n      const incoming = createEntrySnapshotRecord(item.label, item.uid, item.name, item.entry);\\n      const list = byWorldbook[uidKey] ?? [];\\n\\n      if (list[0] && JSON.stringify(list[0].entry) === JSON.stringify(incoming.entry)) {\\n        continue;\\n      }\\n\\n      list.unshift(incoming);\\n      if (list.length > ENTRY_HISTORY_LIMIT) {\\n        list.length = ENTRY_HISTORY_LIMIT;\\n      }\\n      byWorldbook[uidKey] = list;\\n      added += 1;\\n    }\\n\\n    state.entry_history[worldbookName] = byWorldbook;\\n  });\\n\\n  return added;\\n}\\n\\nfunction pushEntrySnapshot(label: string, entry: WorldbookEntry): boolean {\\n  const added = pushEntrySnapshotsBulk([\\n    {\\n      label,\\n      uid: entry.uid,\\n      name: entry.name,\\n      entry,\\n    },\\n  ]);\\n  return added > 0;\\n}\\n\\nfunction collectEntrySnapshotsBeforeSave(): Array<{\\n  label: string;\\n  uid: number;\\n  name: string;\\n  entry: WorldbookEntry;\\n}> {\\n  const result: Array<{\\n    label: string;\\n    uid: number;\\n    name: string;\\n    entry: WorldbookEntry;\\n  }> = [];\\n  const draftByUid = new Map<number, WorldbookEntry>();\\n  draftEntries.value.forEach(entry => {\\n    draftByUid.set(entry.uid, entry);\\n  });\\n\\n  for (const previous of originalEntries.value) {\\n    const current = draftByUid.get(previous.uid);\\n    if (!current) {\\n      result.push({\\n        label: '',\\n        uid: previous.uid,\\n        name: previous.name,\\n        entry: previous,\\n      });\\n      continue;\\n    }\\n    if (JSON.stringify(previous) !== JSON.stringify(current)) {\\n      result.push({\\n        label: '',\\n        uid: previous.uid,\\n        name: previous.name,\\n        entry: previous,\\n      });\\n    }\\n  }\\n\\n  return result;\\n}\\n\\nfunction pushSnapshot(label: string): void {\\n  if (!selectedWorldbookName.value) {\\n    return;\\n  }\\n  const worldbookName = selectedWorldbookName.value;\\n  const snapshot: WorldbookSnapshot = {\\n    id: createId('snapshot'),\\n    label,\\n    ts: Date.now(),\\n    entries: klona(draftEntries.value),\\n  };\\n\\n  updatePersistedState(state => {\\n    const list = state.history[worldbookName] ?? [];\\n    list.unshift(snapshot);\\n    if (list.length > HISTORY_LIMIT) {\\n      list.length = HISTORY_LIMIT;\\n    }\\n    state.history[worldbookName] = list;\\n  });\\n}\\n\\nfunction createManualSnapshot(): void {\\n  if (!selectedWorldbookName.value) {\\n    toastr.warning('');\\n    return;\\n  }\\n  pushSnapshot('');\\n  toastr.success('');\\n}\\n\\nfunction openEntryHistoryModal(): void {\\n  if (!selectedEntry.value) {\\n    toastr.warning('');\\n    return;\\n  }\\n  const nonCurrent = entryVersionViews.value.find(item => !item.isCurrent) ?? null;\\n  entryHistoryRightId.value = '__current__';\\n  entryHistoryLeftId.value = nonCurrent?.id ?? '__current__';\\n  showEntryHistoryModal.value = true;\\n}\\n\\nfunction openWorldbookHistoryModal(): void {\\n  if (!selectedWorldbookName.value) {\\n    toastr.warning('');\\n    return;\\n  }\\n  const nonCurrent = worldbookVersionViews.value.find(item => !item.isCurrent) ?? null;\\n  worldbookHistoryRightId.value = '__current__';\\n  worldbookHistoryLeftId.value = nonCurrent?.id ?? '__current__';\\n  showWorldbookHistoryModal.value = true;\\n}\\n\\nfunction createManualEntrySnapshot(): void {\\n  if (!selectedEntry.value) {\\n    toastr.warning('');\\n    return;\\n  }\\n  const added = pushEntrySnapshot('', selectedEntry.value);\\n  if (added) {\\n    toastr.success('');\\n  } else {\\n    toastr.info('');\\n  }\\n}\\n\\nfunction restoreSnapshot(snapshotId: string): void {\\n  const snapshot = snapshotsForCurrent.value.find(item => item.id === snapshotId);\\n  if (!snapshot) {\\n    return;\\n  }\\n  if (!confirm(` \\\"${snapshot.label}\\\" ? `)) {\\n    return;\\n  }\\n  draftEntries.value = normalizeEntryList(snapshot.entries);\\n  ensureSelectedEntryExists();\\n  setStatus(`${snapshot.label}`);\\n}\\n\\nfunction restoreWorldbookFromLeftHistory(): void {\\n  const target = selectedWorldbookHistoryLeft.value;\\n  if (!target || target.isCurrent) {\\n    return;\\n  }\\n  if (!confirm(` Left  \\\"${target.label}\\\" ? `)) {\\n    return;\\n  }\\n  draftEntries.value = normalizeEntryList(klona(target.entries));\\n  ensureSelectedEntryExists();\\n  setStatus(`${target.label}`);\\n  toastr.success(' Left ');\\n}\\n\\nfunction deleteSnapshot(snapshotId: string): void {\\n  if (!selectedWorldbookName.value) {\\n    return;\\n  }\\n  updatePersistedState(state => {\\n    const list = state.history[selectedWorldbookName.value] ?? [];\\n    state.history[selectedWorldbookName.value] = list.filter(item => item.id !== snapshotId);\\n  });\\n}\\n\\nfunction clearCurrentSnapshots(): void {\\n  if (!selectedWorldbookName.value || !snapshotsForCurrent.value.length) {\\n    return;\\n  }\\n  if (!confirm(` \\\"${selectedWorldbookName.value}\\\" `)) {\\n    return;\\n  }\\n  updatePersistedState(state => {\\n    delete state.history[selectedWorldbookName.value];\\n  });\\n}\\n\\nfunction restoreEntrySnapshot(snapshotId: string): void {\\n  if (!selectedEntry.value || selectedEntryIndex.value < 0) {\\n    return;\\n  }\\n  const snapshot = entrySnapshotsForSelected.value.find(item => item.id === snapshotId);\\n  if (!snapshot) {\\n    return;\\n  }\\n  if (!confirm(` \\\"${snapshot.label}\\\" ?`)) {\\n    return;\\n  }\\n\\n  // \\n  pushEntrySnapshot('', selectedEntry.value);\\n\\n  const restored = normalizeEntry(klona(snapshot.entry), selectedEntry.value.uid);\\n  restored.uid = selectedEntry.value.uid;\\n  draftEntries.value.splice(selectedEntryIndex.value, 1, restored);\\n  selectedEntryUid.value = restored.uid;\\n  setStatus(`${snapshot.label}`);\\n  toastr.success('');\\n}\\n\\nfunction restoreEntryFromLeftHistory(): void {\\n  const target = selectedEntryHistoryLeft.value;\\n  if (!target || target.isCurrent) {\\n    return;\\n  }\\n  if (!selectedEntry.value || selectedEntryIndex.value < 0) {\\n    return;\\n  }\\n  if (!confirm(` \\\"${target.label}\\\" ?`)) {\\n    return;\\n  }\\n  pushEntrySnapshot('', selectedEntry.value);\\n  const restored = normalizeEntry(klona(target.entry), selectedEntry.value.uid);\\n  restored.uid = selectedEntry.value.uid;\\n  draftEntries.value.splice(selectedEntryIndex.value, 1, restored);\\n  selectedEntryUid.value = restored.uid;\\n  setStatus(`${target.label}`);\\n  toastr.success(' Left ');\\n}\\n\\nfunction deleteEntrySnapshot(snapshotId: string): void {\\n  if (!selectedWorldbookName.value || !selectedEntry.value) {\\n    return;\\n  }\\n  const worldbookName = selectedWorldbookName.value;\\n  const uidKey = String(selectedEntry.value.uid);\\n  updatePersistedState(state => {\\n    const byWorldbook = state.entry_history[worldbookName] ?? {};\\n    const list = byWorldbook[uidKey] ?? [];\\n    byWorldbook[uidKey] = list.filter(item => item.id !== snapshotId);\\n    state.entry_history[worldbookName] = byWorldbook;\\n  });\\n}\\n\\nfunction clearCurrentEntrySnapshots(): void {\\n  if (!selectedWorldbookName.value || !selectedEntry.value || !entrySnapshotsForSelected.value.length) {\\n    return;\\n  }\\n  if (!confirm(` #${selectedEntry.value.uid} `)) {\\n    return;\\n  }\\n  const worldbookName = selectedWorldbookName.value;\\n  const uidKey = String(selectedEntry.value.uid);\\n  updatePersistedState(state => {\\n    const byWorldbook = state.entry_history[worldbookName] ?? {};\\n    delete byWorldbook[uidKey];\\n    state.entry_history[worldbookName] = byWorldbook;\\n  });\\n}\\n\\nfunction handleSelectedPositionTypeChanged(): void {\\n  if (!selectedEntry.value) {\\n    return;\\n  }\\n  if (selectedEntry.value.position.type !== 'at_depth') {\\n    selectedEntry.value.position.role = 'system';\\n    selectedEntry.value.position.depth = 4;\\n  }\\n}\\n\\nfunction applyExtraJson(): void {\\n  if (!selectedEntry.value) {\\n    return;\\n  }\\n  const text = selectedExtraText.value.trim();\\n  if (!text) {\\n    selectedEntry.value.extra = undefined;\\n    return;\\n  }\\n  try {\\n    const parsed = JSON.parse(text);\\n    const parsedRecord = asRecord(parsed);\\n    if (!parsedRecord) {\\n      throw new Error('extra  JSON ');\\n    }\\n    selectedEntry.value.extra = klona(parsedRecord);\\n    toastr.success('extra ');\\n  } catch (error) {\\n    toastr.error(`extra JSON : ${error instanceof Error ? error.message : String(error)}`);\\n  }\\n}\\n\\nfunction clearExtra(): void {\\n  if (!selectedEntry.value) {\\n    return;\\n  }\\n  selectedEntry.value.extra = undefined;\\n  selectedExtraText.value = '';\\n}\\n\\nfunction addEntry(): void {\\n  const uid = getNextUid(draftEntries.value);\\n  const entry = createDefaultEntry(uid);\\n  draftEntries.value.push(entry);\\n  selectedEntryUid.value = uid;\\n  setStatus(` #${uid}`);\\n}\\n\\nfunction duplicateSelectedEntry(): void {\\n  if (!selectedEntry.value || selectedEntryIndex.value < 0) {\\n    return;\\n  }\\n  const uid = getNextUid(draftEntries.value);\\n  const duplicated = normalizeEntry(klona(selectedEntry.value), uid);\\n  duplicated.uid = uid;\\n  duplicated.name = `${duplicated.name} ()`;\\n  draftEntries.value.splice(selectedEntryIndex.value + 1, 0, duplicated);\\n  selectedEntryUid.value = uid;\\n  setStatus(` #${selectedEntry.value.uid}`);\\n}\\n\\nfunction removeSelectedEntry(): void {\\n  if (!selectedEntry.value || selectedEntryIndex.value < 0) {\\n    return;\\n  }\\n  if (!confirm(` \\\"${selectedEntry.value.name}\\\" ?`)) {\\n    return;\\n  }\\n  pushEntrySnapshot('', selectedEntry.value);\\n  draftEntries.value.splice(selectedEntryIndex.value, 1);\\n  if (isMobile.value) {\\n    selectedEntryUid.value = null;\\n  } else {\\n    ensureSelectedEntryExists();\\n  }\\n  setStatus('');\\n}\\n\\nfunction moveSelectedEntry(direction: -1 | 1): void {\\n  if (selectedEntryIndex.value < 0) {\\n    return;\\n  }\\n  const target = selectedEntryIndex.value + direction;\\n  if (target < 0 || target >= draftEntries.value.length) {\\n    return;\\n  }\\n  const [entry] = draftEntries.value.splice(selectedEntryIndex.value, 1);\\n  draftEntries.value.splice(target, 0, entry);\\n  selectedEntryUid.value = entry.uid;\\n}\\n\\nfunction normalizeAllEntries(): void {\\n  draftEntries.value = normalizeEntryList(draftEntries.value.map(entry => klona(entry)));\\n  ensureSelectedEntryExists();\\n  setStatus('');\\n}\\n\\nfunction sortEntriesByOrderDesc(): void {\\n  draftEntries.value.sort((left, right) => right.position.order - left.position.order);\\n  ensureSelectedEntryExists();\\n  setStatus(' order ');\\n}\\n\\nfunction setEnabledForAll(enabled: boolean): void {\\n  draftEntries.value.forEach(entry => {\\n    entry.enabled = enabled;\\n  });\\n  setStatus(enabled ? '' : '');\\n}\\n\\nfunction applyBatchReplace(): void {\\n  const findText = batchFindText.value;\\n  if (!findText) {\\n    toastr.warning('');\\n    return;\\n  }\\n  if (!getEnabledFindFields().length) {\\n    toastr.warning('');\\n    return;\\n  }\\n  if (batchSearchScope.value === 'current' && !selectedEntry.value) {\\n    toastr.warning('');\\n    return;\\n  }\\n\\n  const targetEntries = getBatchTargetEntries();\\n  if (!targetEntries.length) {\\n    toastr.warning('');\\n    return;\\n  }\\n\\n  const excludeTokens = parseBatchExcludeTokens(batchExcludeText.value);\\n  const regex = resolveBatchRegex(findText);\\n  if (batchUseRegex.value && !regex) {\\n    return;\\n  }\\n\\n  let touched = 0;\\n  let skipped = 0;\\n  for (const entry of targetEntries) {\\n    if (shouldExcludeEntryForBatch(entry, excludeTokens)) {\\n      skipped += 1;\\n      continue;\\n    }\\n\\n    let changed = false;\\n\\n    if (batchInName.value) {\\n      const next = regex\\n        ? entry.name.replace(regex, batchReplaceText.value)\\n        : entry.name.split(findText).join(batchReplaceText.value);\\n      if (next !== entry.name) {\\n        entry.name = next;\\n        changed = true;\\n      }\\n    }\\n\\n    if (batchInContent.value) {\\n      const next = regex\\n        ? entry.content.replace(regex, batchReplaceText.value)\\n        : entry.content.split(findText).join(batchReplaceText.value);\\n      if (next !== entry.content) {\\n        entry.content = next;\\n        changed = true;\\n      }\\n    }\\n\\n    if (batchInKeys.value) {\\n      const nextKeys = entry.strategy.keys.map(key => {\\n        const text = stringifyKeyword(key);\\n        return regex ? text.replace(regex, batchReplaceText.value) : text.split(findText).join(batchReplaceText.value);\\n      });\\n      const normalized = normalizeKeywordList(nextKeys);\\n      if (\\n        JSON.stringify(normalized.map(stringifyKeyword)) !== JSON.stringify(entry.strategy.keys.map(stringifyKeyword))\\n      ) {\\n        entry.strategy.keys = normalized;\\n        changed = true;\\n      }\\n    }\\n\\n    if (changed) {\\n      touched += 1;\\n    }\\n  }\\n\\n  resetFindState();\\n  setStatus(\\n    `${batchSearchScope.value === 'current' ? '' : ''} ${touched}  ${skipped} `,\\n  );\\n}\\n\\nfunction downloadJson(filename: string, payload: unknown): void {\\n  const text = JSON.stringify(payload, null, 2);\\n  const blob = new Blob([text], { type: 'application/json' });\\n  const url = URL.createObjectURL(blob);\\n  const anchor = document.createElement('a');\\n  anchor.href = url;\\n  anchor.download = filename;\\n  document.body.appendChild(anchor);\\n  anchor.click();\\n  document.body.removeChild(anchor);\\n  URL.revokeObjectURL(url);\\n}\\n\\nfunction exportCurrentWorldbook(): void {\\n  if (!selectedWorldbookName.value) {\\n    return;\\n  }\\n  const payload = {\\n    format: 'worldbook_assistant_v1',\\n    name: selectedWorldbookName.value,\\n    exported_at: new Date().toISOString(),\\n    entries: draftEntries.value,\\n  };\\n  const filename = `${selectedWorldbookName.value.replace(/[\\\\\\\\/:*?\\\"<>|]/g, '_')}.json`;\\n  downloadJson(filename, payload);\\n}\\n\\nfunction collectRawEntries(root: Record<string, unknown>): unknown[] {\\n  if (Array.isArray(root.entries)) {\\n    return root.entries;\\n  }\\n  const entriesMap = asRecord(root.entries);\\n  if (entriesMap) {\\n    return Object.values(entriesMap);\\n  }\\n  const dataRoot = asRecord(root.data);\\n  if (dataRoot) {\\n    if (Array.isArray(dataRoot.entries)) {\\n      return dataRoot.entries;\\n    }\\n    const dataEntriesMap = asRecord(dataRoot.entries);\\n    if (dataEntriesMap) {\\n      return Object.values(dataEntriesMap);\\n    }\\n  }\\n  return [];\\n}\\n\\nfunction parseImportedPayload(fileName: string, text: string): ImportedPayload {\\n  const parsed = JSON.parse(text) as unknown;\\n  const fallbackName = fileName.replace(/\\\\.[^/.]+$/, '') || '';\\n\\n  if (Array.isArray(parsed)) {\\n    return {\\n      name: fallbackName,\\n      entries: normalizeEntryList(parsed),\\n    };\\n  }\\n\\n  const root = asRecord(parsed);\\n  if (!root) {\\n    throw new Error(' JSON ');\\n  }\\n\\n  const entries = collectRawEntries(root);\\n  if (!entries.length) {\\n    throw new Error(' entries');\\n  }\\n\\n  const dataRoot = asRecord(root.data);\\n  const nameCandidate = toStringSafe(root.name ?? dataRoot?.name, fallbackName).trim();\\n\\n  return {\\n    name: nameCandidate || fallbackName,\\n    entries: normalizeEntryList(entries),\\n  };\\n}\\n\\nfunction triggerImport(): void {\\n  importFileInput.value?.click();\\n}\\n\\nasync function onImportChange(event: Event): Promise<void> {\\n  const target = event.target as HTMLInputElement | null;\\n  const file = target?.files?.[0];\\n  if (!file) {\\n    return;\\n  }\\n\\n  const fileText = await file.text();\\n  try {\\n    const payload = parseImportedPayload(file.name, fileText);\\n    const suggested = payload.name || file.name.replace(/\\\\.[^/.]+$/, '');\\n    const newNameRaw = prompt('', suggested);\\n    const newName = toStringSafe(newNameRaw).trim();\\n    if (!newName) {\\n      return;\\n    }\\n    await createOrReplaceWorldbook(newName, payload.entries, { render: 'immediate' });\\n    await reloadWorldbookNames(newName);\\n    await refreshBindings();\\n    toastr.success(`: ${newName}`);\\n  } catch (error) {\\n    const message = error instanceof Error ? error.message : String(error);\\n    const shouldFallback = confirm(`: ${message}\\\\n`);\\n    if (!shouldFallback) {\\n      return;\\n    }\\n    const response = await importRawWorldbook(file.name, fileText);\\n    if (!response.ok) {\\n      throw new Error(`: HTTP ${response.status}`);\\n    }\\n    await hardRefresh();\\n    toastr.success('');\\n  } finally {\\n    if (target) {\\n      target.value = '';\\n    }\\n  }\\n}\\n\\nasync function refreshBindings(): Promise<void> {\\n  bindings.global = [...getGlobalWorldbookNames()];\\n  try {\\n    const charBindings = getCharWorldbookNames('current');\\n    bindings.charPrimary = charBindings.primary;\\n    bindings.charAdditional = [...charBindings.additional];\\n  } catch {\\n    bindings.charPrimary = null;\\n    bindings.charAdditional = [];\\n  }\\n\\n  try {\\n    bindings.chat = getChatWorldbookName('current');\\n  } catch {\\n    bindings.chat = null;\\n  }\\n  if (globalWorldbookMode.value) {\\n    ensureSelectionForGlobalMode();\\n  }\\n}\\n\\nfunction resolveContextWorldbookCandidate(): string | null {\\n  const available = worldbookNames.value;\\n  if (!available.length) {\\n    return null;\\n  }\\n  const chatBound = toStringSafe(bindings.chat).trim();\\n  if (chatBound && available.includes(chatBound)) {\\n    return chatBound;\\n  }\\n  const charPrimary = toStringSafe(bindings.charPrimary).trim();\\n  if (charPrimary && available.includes(charPrimary)) {\\n    return charPrimary;\\n  }\\n  const charAdditional = bindings.charAdditional.find(name => available.includes(name));\\n  return charAdditional ?? null;\\n}\\n\\nfunction ensureSelectionForGlobalMode(): void {\\n  if (!globalWorldbookMode.value) {\\n    return;\\n  }\\n  const globals = selectableWorldbookNames.value;\\n  if (!globals.length) {\\n    selectedWorldbookName.value = '';\\n    return;\\n  }\\n  if (!globals.includes(selectedWorldbookName.value)) {\\n    selectedWorldbookName.value = globals[0];\\n  }\\n}\\n\\nfunction trySelectWorldbookByContext(options: { preferWhenEmptyOnly?: boolean; force?: boolean } = {}): boolean {\\n  if (globalWorldbookMode.value) {\\n    return false;\\n  }\\n  if (options.preferWhenEmptyOnly && selectedWorldbookName.value) {\\n    return false;\\n  }\\n  const candidate = resolveContextWorldbookCandidate();\\n  if (!candidate || candidate === selectedWorldbookName.value) {\\n    return false;\\n  }\\n  if (!options.force && hasUnsavedChanges.value) {\\n    setStatus('/');\\n    return false;\\n  }\\n  selectedWorldbookName.value = candidate;\\n  setStatus(`: ${candidate}`);\\n  return true;\\n}\\n\\nfunction toggleGlobalMode(): void {\\n  globalWorldbookMode.value = !globalWorldbookMode.value;\\n  if (globalWorldbookMode.value) {\\n    aiGeneratorMode.value = false;\\n    ensureSelectionForGlobalMode();\\n    setStatus('');\\n    return;\\n  }\\n  if (!selectedWorldbookName.value) {\\n    trySelectWorldbookByContext({ force: true });\\n  }\\n  setStatus('');\\n}\\n\\nasync function applyGlobalWorldbooks(nextGlobal: string[], statusLabel = ''): Promise<boolean> {\\n  const normalized = [...new Set(nextGlobal.map(name => name.trim()).filter(Boolean))].filter(name =>\\n    worldbookNames.value.includes(name),\\n  );\\n  try {\\n    await rebindGlobalWorldbooks(normalized);\\n    await refreshBindings();\\n    ensureSelectionForGlobalMode();\\n    setStatus(`${statusLabel}${normalized.length} `);\\n    return true;\\n  } catch (error) {\\n    const message = error instanceof Error ? error.message : String(error);\\n    toastr.error(`: ${message}`);\\n    return false;\\n  }\\n}\\n\\nfunction addFirstGlobalCandidate(): void {\\n  const first = globalAddCandidates.value[0];\\n  if (!first) {\\n    return;\\n  }\\n  void addGlobalWorldbook(first);\\n}\\n\\nasync function addGlobalWorldbook(name: string): Promise<void> {\\n  if (!name || bindings.global.includes(name)) {\\n    return;\\n  }\\n  const success = await applyGlobalWorldbooks([...bindings.global, name], `: ${name}`);\\n  if (success) {\\n    globalAddSearchText.value = '';\\n    updatePersistedState(state => {\\n      state.role_override_baseline = null;\\n    });\\n  }\\n}\\n\\nasync function removeGlobalWorldbook(name: string): Promise<void> {\\n  if (!name || !bindings.global.includes(name)) {\\n    return;\\n  }\\n  const success = await applyGlobalWorldbooks(\\n    bindings.global.filter(item => item !== name),\\n    `: ${name}`,\\n  );\\n  if (success) {\\n    updatePersistedState(state => {\\n      state.role_override_baseline = null;\\n    });\\n  }\\n}\\n\\nasync function clearGlobalWorldbooks(): Promise<void> {\\n  if (!bindings.global.length) {\\n    return;\\n  }\\n  if (!confirm('')) {\\n    return;\\n  }\\n  const success = await applyGlobalWorldbooks([], '');\\n  if (success) {\\n    updatePersistedState(state => {\\n      state.role_override_baseline = null;\\n    });\\n  }\\n}\\n\\nfunction getCurrentGlobalWorldbookSet(): string[] {\\n  return [...new Set(bindings.global.map(name => name.trim()).filter(Boolean))];\\n}\\n\\nfunction normalizeWorldbookSet(input: string[]): string[] {\\n  return [...new Set(input.map(name => name.trim()).filter(Boolean))];\\n}\\n\\nfunction isSameWorldbookSet(left: string[], right: string[]): boolean {\\n  const leftSorted = [...normalizeWorldbookSet(left)].sort();\\n  const rightSorted = [...normalizeWorldbookSet(right)].sort();\\n  if (leftSorted.length !== rightSorted.length) {\\n    return false;\\n  }\\n  for (let index = 0; index < leftSorted.length; index += 1) {\\n    if (leftSorted[index] !== rightSorted[index]) {\\n      return false;\\n    }\\n  }\\n  return true;\\n}\\n\\nfunction refreshRoleBindingCandidates(): void {\\n  let names: string[] = [];\\n  try {\\n    names = typeof getCharacterNames === 'function' ? getCharacterNames() : [];\\n  } catch (error) {\\n    console.warn('[WorldbookAssistant] getCharacterNames failed:', error);\\n  }\\n\\n  const dedupe = new Set<string>();\\n  const result: PresetRoleBinding[] = [];\\n\\n  for (const charName of names) {\\n    const trimmed = charName.trim();\\n    if (!trimmed) {\\n      continue;\\n    }\\n    const key = `char:${trimmed}`;\\n    if (dedupe.has(key)) {\\n      continue;\\n    }\\n    dedupe.add(key);\\n    result.push({\\n      key,\\n      name: trimmed,\\n      avatar: '',\\n      updated_at: Date.now(),\\n    });\\n  }\\n\\n  result.sort((left, right) => left.name.localeCompare(right.name, 'zh-Hans-CN'));\\n\\n  const current = resolveCurrentRoleContext();\\n  if (current && !result.some(item => item.key === current.key)) {\\n    result.unshift(current);\\n  }\\n  roleBindingSourceCandidates.value = result;\\n}\\n\\nfunction resolveCurrentRoleContext(): PresetRoleBinding | null {\\n  let name: string | null = null;\\n  try {\\n    name = typeof getCurrentCharacterName === 'function' ? getCurrentCharacterName() : null;\\n  } catch (error) {\\n    console.warn('[WorldbookAssistant] getCurrentCharacterName failed:', error);\\n  }\\n  if (!name) {\\n    return null;\\n  }\\n  const trimmed = name.trim();\\n  if (!trimmed) {\\n    return null;\\n  }\\n  return {\\n    key: `char:${trimmed}`,\\n    name: trimmed,\\n    avatar: '',\\n    updated_at: Date.now(),\\n  };\\n}\\n\\nfunction refreshCurrentRoleContext(): void {\\n  currentRoleContext.value = resolveCurrentRoleContext();\\n}\\n\\nasync function applyPresetWorldbooks(\\n  preset: GlobalWorldbookPreset,\\n  options: { statusPrefix?: string; silentWhenSame?: boolean } = {},\\n): Promise<boolean> {\\n  const normalized = normalizeWorldbookSet(preset.worldbooks);\\n  const missing = normalized.filter(name => !worldbookNames.value.includes(name));\\n  const matched = normalized.filter(name => worldbookNames.value.includes(name));\\n\\n  if (options.silentWhenSame && isSameWorldbookSet(getCurrentGlobalWorldbookSet(), matched)) {\\n    updatePersistedState(state => {\\n      state.last_global_preset_id = preset.id;\\n    });\\n    return true;\\n  }\\n\\n  const statusPrefix = options.statusPrefix ?? '';\\n  const success = await applyGlobalWorldbooks(matched, `${statusPrefix}: ${preset.name}`);\\n  if (!success) {\\n    return false;\\n  }\\n  updatePersistedState(state => {\\n    state.last_global_preset_id = preset.id;\\n  });\\n  if (missing.length) {\\n    toastr.warning(` ${missing.length} `);\\n  }\\n  return true;\\n}\\n\\nasync function applySelectedGlobalPreset(): Promise<void> {\\n  const preset = selectedGlobalPreset.value;\\n  if (!preset) {\\n    return;\\n  }\\n  const success = await applyPresetWorldbooks(preset);\\n  if (success) {\\n    updatePersistedState(state => {\\n      state.role_override_baseline = null;\\n    });\\n  }\\n}\\n\\nfunction getRoleBoundPresetForCurrentContext(): GlobalWorldbookPreset | null {\\n  const role = currentRoleContext.value;\\n  if (!role) {\\n    return null;\\n  }\\n  return (\\n    globalWorldbookPresets.value.find(item => item.role_bindings.some(binding => binding.key === role.key)) ?? null\\n  );\\n}\\n\\nasync function autoApplyRoleBoundPreset(): Promise<void> {\\n  const rolePreset = getRoleBoundPresetForCurrentContext();\\n  if (!rolePreset) {\\n    const baseline = persistedState.value.role_override_baseline;\\n    if (baseline) {\\n      updatePersistedState(state => {\\n        state.role_override_baseline = null;\\n        state.last_global_preset_id = baseline.preset_id;\\n      });\\n      selectedGlobalPresetId.value = baseline.preset_id;\\n      if (baseline.preset_id) {\\n        const baselinePreset = globalWorldbookPresets.value.find(item => item.id === baseline.preset_id);\\n        if (baselinePreset) {\\n          await applyPresetWorldbooks(baselinePreset, {\\n            statusPrefix: '',\\n            silentWhenSame: true,\\n          });\\n        } else {\\n          await applyGlobalWorldbooks(\\n            baseline.worldbooks,\\n            '',\\n          );\\n        }\\n      } else {\\n        await applyGlobalWorldbooks(\\n          baseline.worldbooks,\\n          '',\\n        );\\n      }\\n    }\\n    return;\\n  }\\n  if (!persistedState.value.role_override_baseline) {\\n    updatePersistedState(state => {\\n      state.role_override_baseline = {\\n        preset_id: selectedGlobalPresetId.value,\\n        worldbooks: getCurrentGlobalWorldbookSet(),\\n      };\\n    });\\n  }\\n  selectedGlobalPresetId.value = rolePreset.id;\\n  await applyPresetWorldbooks(rolePreset, {\\n    statusPrefix: `${currentRoleContext.value?.name ?? ''}`,\\n    silentWhenSame: true,\\n  });\\n}\\n\\nfunction onGlobalPresetSelectionChanged(): void {\\n  closeRolePicker();\\n  if (!selectedGlobalPresetId.value) {\\n    updatePersistedState(state => {\\n      state.last_global_preset_id = '';\\n      state.role_override_baseline = null;\\n    });\\n    if (bindings.global.length) {\\n      void applyGlobalWorldbooks([], '');\\n    } else {\\n      setStatus('');\\n    }\\n    return;\\n  }\\n  void applySelectedGlobalPreset();\\n}\\n\\nfunction bindRoleToSelectedPreset(role: PresetRoleBinding): void {\\n  const preset = selectedGlobalPreset.value;\\n  if (!preset) {\\n    toastr.warning('');\\n    return;\\n  }\\n  updatePersistedState(state => {\\n    state.global_presets = (state.global_presets ?? []).map(item => {\\n      if (item.id !== preset.id) {\\n        return item;\\n      }\\n      const nextBindings = normalizePresetRoleBindings([\\n        ...item.role_bindings.filter(binding => binding.key !== role.key),\\n        {\\n          key: role.key,\\n          name: role.name,\\n          avatar: role.avatar,\\n          updated_at: Date.now(),\\n        } satisfies PresetRoleBinding,\\n      ]);\\n      return {\\n        ...item,\\n        role_bindings: nextBindings,\\n        updated_at: Date.now(),\\n      };\\n    });\\n    state.last_global_preset_id = preset.id;\\n  });\\n  setStatus(`: ${role.name}  ${preset.name}`);\\n}\\n\\nfunction bindCurrentRoleToSelectedPreset(): void {\\n  const role = currentRoleContext.value;\\n  if (!role) {\\n    toastr.warning('');\\n    return;\\n  }\\n  bindRoleToSelectedPreset(role);\\n}\\n\\nfunction bindRoleCandidateToSelectedPreset(candidate: RoleBindingCandidate): void {\\n  if (candidate.bound) {\\n    return;\\n  }\\n  bindRoleToSelectedPreset(candidate);\\n  closeRolePicker();\\n}\\n\\nfunction removeRoleBindingFromSelectedPreset(bindingKey: string): void {\\n  const preset = selectedGlobalPreset.value;\\n  if (!preset || !bindingKey) {\\n    return;\\n  }\\n  updatePersistedState(state => {\\n    state.global_presets = (state.global_presets ?? []).map(item => {\\n      if (item.id !== preset.id) {\\n        return item;\\n      }\\n      return {\\n        ...item,\\n        role_bindings: item.role_bindings.filter(binding => binding.key !== bindingKey),\\n        updated_at: Date.now(),\\n      };\\n    });\\n  });\\n}\\n\\nfunction unbindCurrentRoleFromSelectedPreset(): void {\\n  const role = currentRoleContext.value;\\n  if (!role) {\\n    toastr.warning('');\\n    return;\\n  }\\n  removeRoleBindingFromSelectedPreset(role.key);\\n  setStatus(`: ${role.name}`);\\n}\\n\\nfunction saveCurrentAsGlobalPreset(): void {\\n  const current = getCurrentGlobalWorldbookSet();\\n  if (!current.length) {\\n    toastr.warning('');\\n    return;\\n  }\\n  const defaultName = selectedGlobalPreset.value?.name || ` ${globalWorldbookPresets.value.length + 1}`;\\n  const nameRaw = prompt('', defaultName);\\n  const name = toStringSafe(nameRaw).trim();\\n  if (!name) {\\n    return;\\n  }\\n  const sameNamePreset = globalWorldbookPresets.value.find(item => item.name === name);\\n  if (sameNamePreset && !confirm(` \\\"${name}\\\" `)) {\\n    return;\\n  }\\n  const presetId = sameNamePreset?.id || createId('global-preset');\\n  const nextPreset: GlobalWorldbookPreset = {\\n    id: presetId,\\n    name,\\n    worldbooks: current,\\n    role_bindings: sameNamePreset?.role_bindings ?? [],\\n    updated_at: Date.now(),\\n  };\\n  updatePersistedState(state => {\\n    const list = (state.global_presets ?? []).filter(item => item.id !== presetId);\\n    list.unshift(nextPreset);\\n    state.global_presets = list.slice(0, GLOBAL_PRESET_LIMIT);\\n    state.last_global_preset_id = presetId;\\n  });\\n  selectedGlobalPresetId.value = presetId;\\n  setStatus(`: ${name}${current.length} `);\\n  toastr.success(`: ${name}`);\\n}\\n\\nfunction overwriteSelectedGlobalPreset(): void {\\n  const preset = selectedGlobalPreset.value;\\n  if (!preset) {\\n    return;\\n  }\\n  const current = getCurrentGlobalWorldbookSet();\\n  if (!current.length) {\\n    toastr.warning('');\\n    return;\\n  }\\n  if (!confirm(` \\\"${preset.name}\\\" `)) {\\n    return;\\n  }\\n  updatePersistedState(state => {\\n    state.global_presets = (state.global_presets ?? []).map(item => {\\n      if (item.id !== preset.id) {\\n        return item;\\n      }\\n      return {\\n        ...item,\\n        worldbooks: current,\\n        updated_at: Date.now(),\\n      };\\n    });\\n    state.last_global_preset_id = preset.id;\\n  });\\n  setStatus(`: ${preset.name}${current.length} `);\\n  toastr.success(`: ${preset.name}`);\\n}\\n\\nfunction deleteSelectedGlobalPreset(): void {\\n  const preset = selectedGlobalPreset.value;\\n  if (!preset) {\\n    return;\\n  }\\n  if (!confirm(` \\\"${preset.name}\\\" `)) {\\n    return;\\n  }\\n  updatePersistedState(state => {\\n    state.global_presets = (state.global_presets ?? []).filter(item => item.id !== preset.id);\\n    if (state.last_global_preset_id === preset.id) {\\n      state.last_global_preset_id = '';\\n    }\\n  });\\n  selectedGlobalPresetId.value = '';\\n  setStatus(`: ${preset.name}`);\\n}\\n\\nfunction closeWorldbookPicker(): void {\\n  worldbookPickerOpen.value = false;\\n}\\n\\nfunction closeRolePicker(): void {\\n  rolePickerOpen.value = false;\\n}\\n\\nfunction openWorldbookPicker(): void {\\n  worldbookPickerSearchText.value = '';\\n  worldbookPickerOpen.value = true;\\n  void nextTick(() => {\\n    worldbookPickerSearchInputRef.value?.focus();\\n  });\\n}\\n\\nfunction openRolePicker(): void {\\n  if (!selectedGlobalPreset.value) {\\n    return;\\n  }\\n  roleBindSearchText.value = '';\\n  refreshRoleBindingCandidates();\\n  rolePickerOpen.value = true;\\n  void nextTick(() => {\\n    rolePickerSearchInputRef.value?.focus();\\n  });\\n}\\n\\nfunction toggleWorldbookPicker(): void {\\n  if (worldbookPickerOpen.value) {\\n    closeWorldbookPicker();\\n    return;\\n  }\\n  openWorldbookPicker();\\n}\\n\\nfunction toggleRolePicker(): void {\\n  if (rolePickerOpen.value) {\\n    closeRolePicker();\\n    return;\\n  }\\n  void openRolePicker();\\n}\\n\\nfunction toggleTheme(): void {\\n  const keys = Object.keys(THEMES) as ThemeKey[];\\n  const index = keys.indexOf(currentTheme.value);\\n  const nextIndex = (index + 1) % keys.length;\\n  currentTheme.value = keys[nextIndex];\\n  setStatus(`: ${THEMES[currentTheme.value].name}`);\\n}\\n\\nfunction setTheme(key: ThemeKey): void {\\n  currentTheme.value = key;\\n  themePickerOpen.value = false;\\n  setStatus(`: ${THEMES[key].label}`);\\n}\\n\\nfunction onSetThemeEvent(event: Event): void {\\n  const key = (event as CustomEvent).detail as string;\\n  if (key && key in THEMES) {\\n    setTheme(key as ThemeKey);\\n  }\\n}\\n\\nfunction selectWorldbookFromPicker(name: string): void {\\n  if (!name) {\\n    return;\\n  }\\n  selectedWorldbookName.value = name;\\n  closeWorldbookPicker();\\n}\\n\\nfunction bindFirstRoleCandidate(): void {\\n  const first = roleBindingCandidates.value.find(item => !item.bound);\\n  if (!first) {\\n    return;\\n  }\\n  bindRoleCandidateToSelectedPreset(first);\\n}\\n\\nfunction onHostPointerDownForWorldbookPicker(event: PointerEvent): void {\\n  if (!worldbookPickerOpen.value && !rolePickerOpen.value && !themePickerOpen.value) {\\n    return;\\n  }\\n  const target = event.target as Node | null;\\n  if (!target) {\\n    closeWorldbookPicker();\\n    closeRolePicker();\\n    themePickerOpen.value = false;\\n    return;\\n  }\\n\\n  if (worldbookPickerOpen.value) {\\n    const worldbookRoot = worldbookPickerRef.value;\\n    if (!worldbookRoot || !worldbookRoot.contains(target)) {\\n      closeWorldbookPicker();\\n    }\\n  }\\n\\n  if (rolePickerOpen.value) {\\n    const roleRoot = rolePickerRef.value;\\n    if (!roleRoot || !roleRoot.contains(target)) {\\n      closeRolePicker();\\n    }\\n  }\\n\\n  if (themePickerOpen.value) {\\n    themePickerOpen.value = false;\\n  }\\n}\\n\\nfunction onHostKeyDownForWorldbookPicker(event: KeyboardEvent): void {\\n  if (!worldbookPickerOpen.value && !rolePickerOpen.value) {\\n    return;\\n  }\\n  if (event.key === 'Escape') {\\n    closeWorldbookPicker();\\n    closeRolePicker();\\n  }\\n}\\n\\nasync function loadWorldbook(name: string): Promise<void> {\\n  if (!name) {\\n    return;\\n  }\\n  isBusy.value = true;\\n  try {\\n    const rawEntries = await getWorldbook(name);\\n    const normalized = normalizeEntryList(rawEntries);\\n    draftEntries.value = klona(normalized);\\n    originalEntries.value = klona(normalized);\\n    ensureSelectedEntryExists();\\n    setStatus(` \\\"${name}\\\" ${normalized.length}`);\\n  } catch (error) {\\n    const message = error instanceof Error ? error.message : String(error);\\n    toastr.error(`: ${message}`);\\n    setStatus(`: ${message}`);\\n  } finally {\\n    isBusy.value = false;\\n  }\\n}\\n\\nasync function reloadWorldbookNames(preferred?: string): Promise<void> {\\n  const names = [...getWorldbookNames()].sort((left, right) => left.localeCompare(right, 'zh-Hans-CN'));\\n  worldbookNames.value = names;\\n\\n  if (!names.length) {\\n    selectedWorldbookName.value = '';\\n    draftEntries.value = [];\\n    originalEntries.value = [];\\n    selectedEntryUid.value = null;\\n    return;\\n  }\\n\\n  const fallbackName = persistedState.value.last_worldbook;\\n  const candidate =\\n    (preferred && names.includes(preferred) && preferred) ||\\n    (fallbackName && names.includes(fallbackName) && fallbackName) ||\\n    selectedWorldbookName.value ||\\n    names[0];\\n\\n  if (candidate && selectedWorldbookName.value !== candidate) {\\n    selectedWorldbookName.value = candidate;\\n    return;\\n  }\\n\\n  if (selectedWorldbookName.value && !draftEntries.value.length) {\\n    await loadWorldbook(selectedWorldbookName.value);\\n  }\\n}\\n\\nasync function hardRefresh(): Promise<void> {\\n  persistedState.value = readPersistedState();\\n  syncSelectedGlobalPresetFromState();\\n  await reloadWorldbookNames(selectedWorldbookName.value || undefined);\\n  await refreshBindings();\\n  refreshRoleBindingCandidates();\\n  refreshCurrentRoleContext();\\n  await autoApplyRoleBoundPreset();\\n  if (globalWorldbookMode.value) {\\n    ensureSelectionForGlobalMode();\\n  } else {\\n    trySelectWorldbookByContext({ preferWhenEmptyOnly: true });\\n  }\\n  setStatus('');\\n}\\n\\nasync function saveCurrentWorldbook(): Promise<void> {\\n  if (!selectedWorldbookName.value) {\\n    toastr.warning('');\\n    return;\\n  }\\n  if (!hasUnsavedChanges.value) {\\n    setStatus('');\\n    return;\\n  }\\n  isSaving.value = true;\\n  try {\\n    draftEntries.value = normalizeEntryList(draftEntries.value.map(entry => klona(entry)));\\n    const pendingEntrySnapshots = collectEntrySnapshotsBeforeSave();\\n    const savedEntrySnapshotCount = pushEntrySnapshotsBulk(pendingEntrySnapshots);\\n    await replaceWorldbook(selectedWorldbookName.value, klona(draftEntries.value), { render: 'immediate' });\\n    originalEntries.value = klona(draftEntries.value);\\n    pushSnapshot('');\\n    await refreshBindings();\\n    toastr.success(`: ${selectedWorldbookName.value}`);\\n    setStatus(`: ${selectedWorldbookName.value} +${savedEntrySnapshotCount}`);\\n  } catch (error) {\\n    const message = error instanceof Error ? error.message : String(error);\\n    toastr.error(`: ${message}`);\\n    setStatus(`: ${message}`);\\n  } finally {\\n    isSaving.value = false;\\n  }\\n}\\n\\nasync function createNewWorldbook(): Promise<void> {\\n  const nameRaw = prompt('');\\n  const name = toStringSafe(nameRaw).trim();\\n  if (!name) {\\n    return;\\n  }\\n  try {\\n    await createOrReplaceWorldbook(name, [], { render: 'immediate' });\\n    await reloadWorldbookNames(name);\\n    await refreshBindings();\\n    toastr.success(`: ${name}`);\\n  } catch (error) {\\n    const message = error instanceof Error ? error.message : String(error);\\n    toastr.error(`: ${message}`);\\n  }\\n}\\n\\nasync function duplicateWorldbook(): Promise<void> {\\n  if (!selectedWorldbookName.value) {\\n    return;\\n  }\\n  const suggested = `${selectedWorldbookName.value}_copy`;\\n  const newNameRaw = prompt('', suggested);\\n  const newName = toStringSafe(newNameRaw).trim();\\n  if (!newName) {\\n    return;\\n  }\\n  try {\\n    await createOrReplaceWorldbook(newName, klona(draftEntries.value), { render: 'immediate' });\\n    await reloadWorldbookNames(newName);\\n    await refreshBindings();\\n    toastr.success(`: ${newName}`);\\n  } catch (error) {\\n    const message = error instanceof Error ? error.message : String(error);\\n    toastr.error(`: ${message}`);\\n  }\\n}\\n\\nasync function deleteCurrentWorldbook(): Promise<void> {\\n  if (!selectedWorldbookName.value) {\\n    return;\\n  }\\n  const current = selectedWorldbookName.value;\\n  if (!confirm(` \\\"${current}\\\" ?`)) {\\n    return;\\n  }\\n  try {\\n    const success = await deleteWorldbook(current);\\n    if (!success) {\\n      throw new Error(' false');\\n    }\\n    updatePersistedState(state => {\\n      delete state.history[current];\\n      delete state.entry_history[current];\\n    });\\n    toastr.success(`: ${current}`);\\n    await reloadWorldbookNames();\\n    await refreshBindings();\\n  } catch (error) {\\n    const message = error instanceof Error ? error.message : String(error);\\n    toastr.error(`: ${message}`);\\n  }\\n}\\n\\nasync function toggleGlobalBinding(): Promise<void> {\\n  if (!selectedWorldbookName.value) {\\n    return;\\n  }\\n  const next = new Set(getGlobalWorldbookNames());\\n  if (next.has(selectedWorldbookName.value)) {\\n    next.delete(selectedWorldbookName.value);\\n  } else {\\n    next.add(selectedWorldbookName.value);\\n  }\\n  await applyGlobalWorldbooks([...next], '');\\n}\\n\\nfunction pushActivationLogs(entries: Array<{ world: string } & Record<string, unknown>>): void {\\n  const logs = entries.map(item => {\\n    const uid = item.uid ?? item.displayIndex ?? '?';\\n    const name = toStringSafe(item.name ?? item.comment, `UID ${uid}`);\\n    const content = toStringSafe(item.content).replace(/\\\\s+/g, ' ').trim().slice(0, 80);\\n    return {\\n      id: createId('activation'),\\n      time: Date.now(),\\n      world: toStringSafe(item.world, 'unknown'),\\n      uid: typeof uid === 'number' || typeof uid === 'string' ? uid : '?',\\n      name,\\n      contentPreview: content || '()',\\n    } satisfies ActivationLog;\\n  });\\n  activationLogs.value.unshift(...logs);\\n  if (activationLogs.value.length > ACTIVATION_LOG_LIMIT) {\\n    activationLogs.value.length = ACTIVATION_LOG_LIMIT;\\n  }\\n}\\n\\nfunction clearActivationLogs(): void {\\n  activationLogs.value = [];\\n}\\n\\nfunction resolveHostWindow(): Window {\\n  return mainLayoutRef.value?.ownerDocument?.defaultView ?? editorShellRef.value?.ownerDocument?.defaultView ?? window;\\n}\\n\\nfunction clampFloatingPanelToViewport(panel: FloatingPanelState): void {\\n  const hostWin = resolveHostWindow();\\n  const viewportWidth = hostWin.innerWidth;\\n  const viewportHeight = hostWin.innerHeight;\\n  const maxX = Math.max(8, viewportWidth - panel.width - 8);\\n  const maxY = Math.max(8, viewportHeight - 68);\\n  panel.x = clampNumber(panel.x, 8, maxX);\\n  panel.y = clampNumber(panel.y, 8, maxY);\\n}\\n\\nfunction handleFloatingWindowResize(): void {\\n  const hostWin = resolveHostWindow();\\n  viewportWidth.value = hostWin.innerWidth;\\n  clampPaneWidths();\\n  for (const key of floatingPanelKeys) {\\n    if (!floatingPanels[key].visible) {\\n      continue;\\n    }\\n    clampFloatingPanelToViewport(floatingPanels[key]);\\n  }\\n}\\n\\nfunction bringFloatingToFront(key: FloatingPanelKey): void {\\n  floatingZCounter.value += 1;\\n  floatingPanels[key].z = floatingZCounter.value;\\n}\\n\\nfunction openFloatingPanel(key: FloatingPanelKey): void {\\n  const panel = floatingPanels[key];\\n  panel.visible = true;\\n  clampFloatingPanelToViewport(panel);\\n  bringFloatingToFront(key);\\n}\\n\\nfunction closeFloatingPanel(key: FloatingPanelKey): void {\\n  floatingPanels[key].visible = false;\\n  if (activeFloatingDrag.value?.key === key) {\\n    stopFloatingDrag();\\n  }\\n}\\n\\nfunction toggleFloatingPanel(key: FloatingPanelKey): void {\\n  if (floatingPanels[key].visible) {\\n    closeFloatingPanel(key);\\n    return;\\n  }\\n  openFloatingPanel(key);\\n}\\n\\nfunction getFloatingPanelStyle(key: FloatingPanelKey): Record<string, string> {\\n  const panel = floatingPanels[key];\\n  return {\\n    left: `${panel.x}px`,\\n    top: `${panel.y}px`,\\n    zIndex: String(panel.z),\\n    width: `${panel.width}px`,\\n  };\\n}\\n\\nfunction startFloatingDrag(key: FloatingPanelKey, event: PointerEvent): void {\\n  if (event.pointerType === 'mouse' && event.button !== 0) {\\n    return;\\n  }\\n  const panel = floatingPanels[key];\\n  const target = event.currentTarget as HTMLElement | null;\\n  if (!target) {\\n    return;\\n  }\\n  const hostDoc = target.ownerDocument ?? document;\\n  const hostWin = hostDoc.defaultView ?? window;\\n  const rect = target.getBoundingClientRect();\\n  bringFloatingToFront(key);\\n  const dragState = {\\n    key,\\n    pointerId: event.pointerId,\\n    offsetX: event.clientX - panel.x,\\n    offsetY: event.clientY - panel.y,\\n    doc: hostDoc,\\n    win: hostWin,\\n  };\\n  activeFloatingDrag.value = dragState;\\n  target.setPointerCapture?.(event.pointerId);\\n  hostDoc.addEventListener('pointermove', onFloatingDragMove);\\n  hostDoc.addEventListener('pointerup', stopFloatingDrag);\\n  hostDoc.addEventListener('pointercancel', stopFloatingDrag);\\n  hostWin.addEventListener('blur', stopFloatingDrag);\\n  panel.x = clampNumber(event.clientX - dragState.offsetX, 8, Math.max(8, hostWin.innerWidth - panel.width - 8));\\n  panel.y = clampNumber(event.clientY - dragState.offsetY, 8, Math.max(8, hostWin.innerHeight - rect.height - 8));\\n  event.preventDefault();\\n}\\n\\nfunction onFloatingDragMove(event: PointerEvent): void {\\n  const drag = activeFloatingDrag.value;\\n  if (!drag) {\\n    return;\\n  }\\n  if (event.pointerId !== drag.pointerId) {\\n    return;\\n  }\\n  const panel = floatingPanels[drag.key];\\n  panel.x = clampNumber(event.clientX - drag.offsetX, 8, Math.max(8, drag.win.innerWidth - panel.width - 8));\\n  panel.y = clampNumber(event.clientY - drag.offsetY, 8, Math.max(8, drag.win.innerHeight - 68));\\n}\\n\\nfunction stopFloatingDrag(): void {\\n  const drag = activeFloatingDrag.value;\\n  if (drag) {\\n    drag.doc.removeEventListener('pointermove', onFloatingDragMove);\\n    drag.doc.removeEventListener('pointerup', stopFloatingDrag);\\n    drag.doc.removeEventListener('pointercancel', stopFloatingDrag);\\n    drag.win.removeEventListener('blur', stopFloatingDrag);\\n  }\\n  activeFloatingDrag.value = null;\\n}\\n\\nfunction clampPaneWidths(): void {\\n  if (isCompactLayout.value) {\\n    return;\\n  }\\n\\n  const mainRect = mainLayoutRef.value?.getBoundingClientRect();\\n  if (mainRect) {\\n    const maxLeft = Math.max(MAIN_PANE_MIN, Math.floor(mainRect.width - MAIN_EDITOR_MIN - RESIZE_HANDLE_SIZE));\\n    mainPaneWidth.value = clampNumber(mainPaneWidth.value, MAIN_PANE_MIN, maxLeft);\\n  }\\n\\n  const editorRect = editorShellRef.value?.getBoundingClientRect();\\n  if (editorRect) {\\n    const maxSide = Math.max(EDITOR_SIDE_MIN, Math.floor(editorRect.width - EDITOR_CENTER_MIN - RESIZE_HANDLE_SIZE));\\n    editorSideWidth.value = clampNumber(editorSideWidth.value, EDITOR_SIDE_MIN, maxSide);\\n  }\\n}\\n\\nfunction startContentResize(e: PointerEvent): void {\\n  e.preventDefault();\\n  const textarea = contentTextareaRef.value;\\n  if (!textarea) return;\\n\\n  const startY = e.clientY;\\n  const startHeight = textarea.offsetHeight;\\n  const target = e.currentTarget as HTMLElement;\\n  target.setPointerCapture(e.pointerId);\\n\\n  // Disable textarea interaction during drag to reduce reflow\\n  textarea.style.pointerEvents = 'none';\\n  textarea.style.willChange = 'height';\\n\\n  let rafId = 0;\\n  let pendingHeight = startHeight;\\n\\n  const applyHeight = () => {\\n    textarea.style.height = `${pendingHeight}px`;\\n    textarea.style.minHeight = `${pendingHeight}px`;\\n    rafId = 0;\\n  };\\n\\n  const onMove = (ev: PointerEvent) => {\\n    pendingHeight = Math.max(120, startHeight + (ev.clientY - startY));\\n    if (!rafId) {\\n      rafId = requestAnimationFrame(applyHeight);\\n    }\\n  };\\n\\n  const onUp = () => {\\n    if (rafId) cancelAnimationFrame(rafId);\\n    applyHeight();\\n    textarea.style.pointerEvents = '';\\n    textarea.style.willChange = '';\\n    target.removeEventListener('pointermove', onMove);\\n    target.removeEventListener('pointerup', onUp);\\n  };\\n\\n  target.addEventListener('pointermove', onMove);\\n  target.addEventListener('pointerup', onUp);\\n}\\n\\nconst editorContentBlockRef = ref<HTMLElement | null>(null);\\nlet contentTopDragOffset = 0;\\n\\nfunction startContentTopDrag(e: PointerEvent): void {\\n  e.preventDefault();\\n  const block = editorContentBlockRef.value;\\n  if (!block) return;\\n\\n  const startY = e.clientY;\\n  const startOffset = contentTopDragOffset;\\n  const target = e.currentTarget as HTMLElement;\\n  target.setPointerCapture(e.pointerId);\\n\\n  let rafId = 0;\\n  let pendingOffset = startOffset;\\n\\n  const apply = () => {\\n    block.style.marginTop = `${-pendingOffset}px`;\\n    rafId = 0;\\n  };\\n\\n  const onMove = (ev: PointerEvent) => {\\n    const delta = startY - ev.clientY; // positive = drag up\\n    pendingOffset = Math.max(0, Math.min(400, startOffset + delta));\\n    if (!rafId) {\\n      rafId = requestAnimationFrame(apply);\\n    }\\n  };\\n\\n  const onUp = () => {\\n    if (rafId) cancelAnimationFrame(rafId);\\n    contentTopDragOffset = pendingOffset;\\n    apply();\\n    target.removeEventListener('pointermove', onMove);\\n    target.removeEventListener('pointerup', onUp);\\n  };\\n\\n  target.addEventListener('pointermove', onMove);\\n  target.addEventListener('pointerup', onUp);\\n}\\n\\nfunction startPaneResize(key: PaneResizeKey, event: PointerEvent): void {\\n  if (isCompactLayout.value) {\\n    return;\\n  }\\n  if (event.pointerType === 'mouse' && event.button !== 0) {\\n    return;\\n  }\\n  const target = event.currentTarget as HTMLElement | null;\\n  const hostDoc = target?.ownerDocument ?? document;\\n  const hostWin = hostDoc.defaultView ?? window;\\n  paneResizeState.value = {\\n    key,\\n    pointerId: event.pointerId,\\n    doc: hostDoc,\\n    win: hostWin,\\n  };\\n  target?.setPointerCapture?.(event.pointerId);\\n  hostDoc.addEventListener('pointermove', onPaneResizeMove);\\n  hostDoc.addEventListener('pointerup', stopPaneResize);\\n  hostDoc.addEventListener('pointercancel', stopPaneResize);\\n  hostWin.addEventListener('blur', stopPaneResize);\\n  event.preventDefault();\\n}\\n\\nfunction onPaneResizeMove(event: PointerEvent): void {\\n  const state = paneResizeState.value;\\n  if (!state || event.pointerId !== state.pointerId) {\\n    return;\\n  }\\n  if (state.key === 'main') {\\n    const rect = mainLayoutRef.value?.getBoundingClientRect();\\n    if (!rect) {\\n      return;\\n    }\\n    const left = Math.floor(event.clientX - rect.left);\\n    const maxLeft = Math.max(MAIN_PANE_MIN, Math.floor(rect.width - MAIN_EDITOR_MIN - RESIZE_HANDLE_SIZE));\\n    mainPaneWidth.value = clampNumber(left, MAIN_PANE_MIN, maxLeft);\\n    return;\\n  }\\n\\n  const rect = editorShellRef.value?.getBoundingClientRect();\\n  if (!rect) {\\n    return;\\n  }\\n  const side = Math.floor(rect.right - event.clientX);\\n  const maxSide = Math.max(EDITOR_SIDE_MIN, Math.floor(rect.width - EDITOR_CENTER_MIN - RESIZE_HANDLE_SIZE));\\n  editorSideWidth.value = clampNumber(side, EDITOR_SIDE_MIN, maxSide);\\n}\\n\\nfunction stopPaneResize(): void {\\n  const state = paneResizeState.value;\\n  if (state) {\\n    state.doc.removeEventListener('pointermove', onPaneResizeMove);\\n    state.doc.removeEventListener('pointerup', stopPaneResize);\\n    state.doc.removeEventListener('pointercancel', stopPaneResize);\\n    state.win.removeEventListener('blur', stopPaneResize);\\n  }\\n  paneResizeState.value = null;\\n}\\n\\nfunction onPanelRefresh(): void {\\n  void hardRefresh();\\n}\\n\\nfunction onPanelSave(): void {\\n  void saveCurrentWorldbook();\\n}\\n\\nfunction discardUnsavedDraft(): void {\\n  if (!hasUnsavedChanges.value) {\\n    const target = window as unknown as Record<string, unknown>;\\n    target[DIRTY_STATE_KEY] = false;\\n    return;\\n  }\\n  draftEntries.value = klona(originalEntries.value);\\n  ensureSelectedEntryExists();\\n  resetFindState();\\n  setStatus('');\\n}\\n\\nfunction onPanelDiscard(): void {\\n  discardUnsavedDraft();\\n}\\n\\nconst rootRef = ref<HTMLElement | null>(null);\\nlet _rootResizeObserver: ResizeObserver | null = null;\\nlet _mobileResizeHandler: (() => void) | null = null;\\n\\nonMounted(() => {\\n  // Fix mobile height: compute exact pixel height based on viewport position\\n  if (isMobile.value && rootRef.value) {\\n    const hostWin = (() => { try { return window.parent || window; } catch { return window; } })();\\n    const el = rootRef.value;\\n\\n    const syncHeight = () => {\\n      if (!el) return;\\n      const rect = el.getBoundingClientRect();\\n      const vh = hostWin.innerHeight || window.innerHeight || 0;\\n      const available = vh - rect.top;\\n      if (available > 0) {\\n        el.style.height = available + 'px';\\n        el.style.maxHeight = available + 'px';\\n        el.style.overflow = 'hidden';\\n      }\\n    };\\n\\n    // Initial + delayed (wait for layout)\\n    syncHeight();\\n    requestAnimationFrame(syncHeight);\\n    setTimeout(syncHeight, 100);\\n    setTimeout(syncHeight, 500);\\n\\n    // Respond to resize\\n    _mobileResizeHandler = syncHeight;\\n    hostWin.addEventListener('resize', syncHeight);\\n\\n    // Also observe parent just in case\\n    const parent = el.parentElement;\\n    if (parent) {\\n      _rootResizeObserver = new ResizeObserver(syncHeight);\\n      _rootResizeObserver.observe(parent);\\n    }\\n  }\\n  persistedState.value = readPersistedState();\\n  syncSelectedGlobalPresetFromState();\\n\\n  subscriptions.push(\\n    eventOn(tavern_events.WORLD_INFO_ACTIVATED, entries => {\\n      pushActivationLogs(entries as Array<{ world: string } & Record<string, unknown>>);\\n    }),\\n  );\\n  subscriptions.push(\\n    eventOn(tavern_events.WORLDINFO_UPDATED, () => {\\n      void hardRefresh();\\n    }),\\n  );\\n  subscriptions.push(\\n    eventOn(tavern_events.CHAT_CHANGED, () => {\\n      void (async () => {\\n        await refreshBindings();\\n        refreshRoleBindingCandidates();\\n        refreshCurrentRoleContext();\\n        await autoApplyRoleBoundPreset();\\n        if (globalWorldbookMode.value) {\\n          ensureSelectionForGlobalMode();\\n          return;\\n        }\\n        trySelectWorldbookByContext();\\n      })();\\n    }),\\n  );\\n\\n  window.addEventListener('wb-helper:refresh', onPanelRefresh);\\n  window.addEventListener('wb-helper:save', onPanelSave);\\n  window.addEventListener('wb-helper:discard', onPanelDiscard);\\n  window.addEventListener('wb-helper:toggle-theme', toggleTheme);\\n  window.addEventListener('wb-helper:set-theme', onSetThemeEvent);\\n  hostResizeWindow.value = resolveHostWindow();\\n  const hostDoc = hostResizeWindow.value.document;\\n  hostDoc.addEventListener('pointerdown', onHostPointerDownForWorldbookPicker, true);\\n  hostDoc.addEventListener('keydown', onHostKeyDownForWorldbookPicker, true);\\n  hostResizeWindow.value.addEventListener('resize', handleFloatingWindowResize);\\n\\n  handleFloatingWindowResize();\\n  updateHostPanelTheme();\\n  void hardRefresh();\\n});\\n\\nonUnmounted(() => {\\n  _rootResizeObserver?.disconnect();\\n  _rootResizeObserver = null;\\n  if (_mobileResizeHandler) {\\n    try { (window.parent || window).removeEventListener('resize', _mobileResizeHandler); } catch { /* ignore */ }\\n    _mobileResizeHandler = null;\\n  }\\n  const target = window as unknown as Record<string, unknown>;\\n  target[DIRTY_STATE_KEY] = false;\\n  subscriptions.forEach(subscription => {\\n    subscription.stop();\\n  });\\n  stopFloatingDrag();\\n  stopPaneResize();\\n  window.removeEventListener('wb-helper:refresh', onPanelRefresh);\\n  window.removeEventListener('wb-helper:save', onPanelSave);\\n  window.removeEventListener('wb-helper:discard', onPanelDiscard);\\n  window.removeEventListener('wb-helper:toggle-theme', toggleTheme);\\n  window.removeEventListener('wb-helper:set-theme', onSetThemeEvent);\\n  hostResizeWindow.value?.document.removeEventListener('pointerdown', onHostPointerDownForWorldbookPicker, true);\\n  hostResizeWindow.value?.document.removeEventListener('keydown', onHostKeyDownForWorldbookPicker, true);\\n  hostResizeWindow.value?.removeEventListener('resize', handleFloatingWindowResize);\\n  hostResizeWindow.value = null;\\n});\\n\\nfunction updateHostPanelTheme() {\\n  const panel = document.getElementById('wb-assistant-panel');\\n  if (!panel) return;\\n  const theme = THEMES[currentTheme.value];\\n  const colors = theme.colors;\\n  \\n  panel.style.setProperty('--wb-host-bg', colors['--wb-bg-root']);\\n  panel.style.setProperty('--wb-host-header-bg', colors['--wb-bg-panel']);\\n  panel.style.setProperty('--wb-host-border', colors['--wb-border-main']);\\n  panel.style.setProperty('--wb-host-text', colors['--wb-text-main']);\\n  panel.style.setProperty('--wb-host-tool-bg', colors['--wb-input-bg']);\\n  panel.style.setProperty('--wb-host-tool-border', colors['--wb-border-subtle']);\\n}\\n\\nwatch(currentTheme, () => {\\n  updateHostPanelTheme();\\n});\\n</script>\\n\\n<style scoped>\\n.wb-assistant-root {\\n  flex: 1;\\n  min-height: 0;\\n  width: 100%;\\n  box-sizing: border-box;\\n  display: flex;\\n  flex-direction: column;\\n  padding: 10px;\\n  gap: 10px;\\n  background: var(--wb-bg-root);\\n  color: var(--wb-text-main);\\n  font-size: 13px;\\n  line-height: 1.35;\\n  border-radius: 10px;\\n  overflow: hidden;\\n}\\n\\n\\n.wb-scroll-area {\\n  flex: 1;\\n  min-height: 0;\\n  overflow-y: auto;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 10px;\\n}\\n\\n.wb-settings-wrapper {\\n  width: 100%;\\n}\\n\\n.wb-header {\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  border-radius: 12px;\\n  padding: 12px 16px;\\n  background: var(--wb-bg-panel);\\n  margin-bottom: 8px;\\n}\\n\\n.wb-title {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 2px;\\n}\\n\\n.wb-title strong {\\n  font-size: 16px;\\n}\\n\\n.wb-title span {\\n  color: var(--wb-text-muted);\\n}\\n\\n.wb-header-actions,\\n.list-actions,\\n.tool-line {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n}\\n\\n.wb-toolbar {\\n  display: flex;\\n  gap: 8px;\\n  flex-wrap: wrap;\\n  align-items: center;\\n  border-radius: 12px;\\n  padding: 10px 12px;\\n  background: var(--wb-bg-panel);\\n}\\n\\n.toolbar-label {\\n  display: inline-flex;\\n  align-items: center;\\n  gap: 6px;\\n  color: var(--wb-text-muted);\\n  min-width: 320px;\\n  flex: 1 1 520px;\\n}\\n\\n.toolbar-select {\\n  min-width: 200px;\\n}\\n\\n.toolbar-select.small {\\n  min-width: 160px;\\n}\\n\\n.worldbook-picker {\\n  position: relative;\\n  flex: 1 1 auto;\\n  min-width: 240px;\\n}\\n\\n.worldbook-picker-trigger {\\n  width: 100%;\\n  box-sizing: border-box;\\n  border: 1px solid transparent;\\n  border-radius: 8px;\\n  padding: 8px 10px;\\n  background: var(--wb-input-bg);\\n  color: var(--wb-text-main);\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  gap: 10px;\\n  cursor: pointer;\\n}\\n\\n.worldbook-picker-trigger:hover {\\n  border-color: var(--wb-primary-light);\\n}\\n\\n.worldbook-picker-trigger-text {\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n  white-space: nowrap;\\n  text-align: left;\\n}\\n\\n.worldbook-picker-trigger-arrow {\\n  flex-shrink: 0;\\n  color: var(--wb-text-muted);\\n}\\n\\n.worldbook-picker-dropdown {\\n  position: absolute;\\n  left: 0;\\n  right: 0;\\n  top: calc(100% + 6px);\\n  z-index: 10120;\\n  border: 1px solid var(--wb-border-subtle);\\n  border-radius: 8px;\\n  background: var(--wb-input-bg-focus);\\n  box-shadow: var(--wb-shadow-main);\\n  padding: 8px;\\n  display: grid;\\n  gap: 8px;\\n}\\n\\n.worldbook-picker-search {\\n  width: 100%;\\n}\\n\\n.worldbook-picker-list {\\n  max-height: 260px;\\n  overflow: auto;\\n  border: none;\\n  border-radius: 8px;\\n  background: var(--wb-bg-panel);\\n  display: flex;\\n  flex-direction: column;\\n}\\n\\n.worldbook-picker-item {\\n  width: 100%;\\n  border: none;\\n  border-bottom: 1px solid var(--wb-border-subtle);\\n  background: transparent;\\n  color: var(--wb-text-main);\\n  padding: 8px 10px;\\n  text-align: left;\\n  cursor: pointer;\\n}\\n\\n.worldbook-picker-item:last-child {\\n  border-bottom: none;\\n}\\n\\n.worldbook-picker-item:hover {\\n  background: var(--wb-primary-soft);\\n}\\n\\n.worldbook-picker-item.active {\\n  background: var(--wb-primary-soft);\\n  color: var(--wb-primary-light);\\n}\\n\\n.wb-bindings {\\n  border-radius: 12px;\\n  padding: 12px;\\n  display: grid;\\n  gap: 8px;\\n  background: var(--wb-bg-panel);\\n}\\n\\n.wb-history-shortcuts {\\n  display: flex;\\n  justify-content: flex-start;\\n  gap: 8px;\\n  flex-wrap: wrap;\\n  align-items: center;\\n}\\n\\n.global-mode-panel {\\n  border-radius: 12px;\\n  background: var(--wb-bg-panel);\\n  padding: 12px;\\n  display: grid;\\n  gap: 12px;\\n}\\n\\n.global-mode-head {\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  gap: 8px;\\n}\\n\\n.global-mode-title {\\n  color: var(--wb-primary-light);\\n  font-weight: 700;\\n  letter-spacing: 0.02em;\\n}\\n\\n.global-preset-panel {\\n  border-radius: 8px;\\n  background: var(--wb-bg-panel);\\n  padding: 10px;\\n  display: grid;\\n  gap: 8px;\\n}\\n\\n.preset-role-panel {\\n  border-radius: 8px;\\n  background: var(--wb-bg-panel);\\n  padding: 10px;\\n  display: grid;\\n  gap: 6px;\\n}\\n\\n.preset-role-head {\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  gap: 8px;\\n  flex-wrap: wrap;\\n}\\n\\n.preset-role-current {\\n  color: var(--wb-primary);\\n  font-size: 12px;\\n}\\n\\n.preset-role-current.empty {\\n  color: var(--wb-text-muted);\\n}\\n\\n.preset-role-actions {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n}\\n\\n.role-picker {\\n  position: relative;\\n}\\n\\n.role-picker-trigger {\\n  width: 100%;\\n  box-sizing: border-box;\\n  border: 1px solid transparent;\\n  border-radius: 8px;\\n  padding: 8px 10px;\\n  background: var(--wb-input-bg);\\n  color: var(--wb-text-main);\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  gap: 10px;\\n  cursor: pointer;\\n}\\n\\n.role-picker-trigger:disabled {\\n  opacity: 0.55;\\n  cursor: default;\\n}\\n\\n.role-picker-trigger:hover:not(:disabled) {\\n  border-color: var(--wb-primary-light);\\n}\\n\\n.role-picker-trigger-text {\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n  white-space: nowrap;\\n  text-align: left;\\n}\\n\\n.role-picker-trigger-arrow {\\n  flex-shrink: 0;\\n  color: var(--wb-text-muted);\\n}\\n\\n.role-picker-dropdown {\\n  position: absolute;\\n  left: 0;\\n  right: 0;\\n  top: calc(100% + 6px);\\n  z-index: 10130;\\n  border: 1px solid var(--wb-border-subtle);\\n  border-radius: 8px;\\n  background: var(--wb-input-bg-focus);\\n  box-shadow: var(--wb-shadow-main);\\n  padding: 8px;\\n  display: grid;\\n  gap: 8px;\\n}\\n\\n.role-picker-search {\\n  width: 100%;\\n}\\n\\n.role-picker-list {\\n  border: none;\\n  border-radius: 8px;\\n  background: var(--wb-bg-panel);\\n  max-height: 220px;\\n  overflow: auto;\\n  display: flex;\\n  flex-direction: column;\\n}\\n\\n.role-picker-item {\\n  width: 100%;\\n  border: none;\\n  border-bottom: 1px solid var(--wb-border-subtle);\\n  background: transparent;\\n  color: var(--wb-text-main);\\n  padding: 8px 10px;\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  gap: 8px;\\n  text-align: left;\\n  cursor: pointer;\\n}\\n\\n.role-picker-item:last-child {\\n  border-bottom: none;\\n}\\n\\n.role-picker-item:hover:not(:disabled) {\\n  background: var(--wb-primary-soft);\\n}\\n\\n.role-picker-item:disabled {\\n  opacity: 0.55;\\n  cursor: default;\\n}\\n\\n.role-picker-item .name {\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n  white-space: nowrap;\\n}\\n\\n.role-picker-item .meta {\\n  color: var(--wb-primary-light);\\n  flex-shrink: 0;\\n  font-size: 11px;\\n}\\n\\n.preset-role-tags {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n}\\n\\n.preset-role-tag {\\n  border: 1px solid var(--wb-border-subtle);\\n  border-radius: 999px;\\n  background: var(--wb-bg-panel);\\n  color: var(--wb-text-main);\\n  padding: 2px 10px;\\n  display: inline-flex;\\n  align-items: center;\\n  gap: 6px;\\n  cursor: pointer;\\n}\\n\\n.preset-role-tag:hover {\\n  border-color: #f43f5e;\\n}\\n\\n.preset-role-tag .remove {\\n  color: #fca5a5;\\n}\\n\\n.global-mode-grid {\\n  display: grid;\\n  grid-template-columns: repeat(2, minmax(0, 1fr));\\n  gap: 8px;\\n}\\n\\n.global-mode-column {\\n  border-radius: 8px;\\n  padding: 10px;\\n  background: var(--wb-bg-panel);\\n  display: grid;\\n  gap: 6px;\\n  min-height: 168px;\\n}\\n\\n.global-mode-list {\\n  border-radius: 8px;\\n  background: var(--wb-input-bg);\\n  max-height: 176px;\\n  min-height: 88px;\\n  overflow: auto;\\n  display: flex;\\n  flex-direction: column;\\n}\\n\\n.global-mode-item {\\n  width: 100%;\\n  border: none;\\n  border-bottom: 1px solid var(--wb-border-subtle);\\n  background: transparent;\\n  color: var(--wb-text-main);\\n  padding: 7px 8px;\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  gap: 10px;\\n  cursor: pointer;\\n  text-align: left;\\n}\\n\\n.global-mode-item:last-child {\\n  border-bottom: none;\\n}\\n\\n.global-mode-item:hover {\\n  background: var(--wb-primary-soft);\\n}\\n\\n.global-mode-item.add .global-mode-item-action {\\n  color: #86efac;\\n}\\n\\n.global-mode-item.active .global-mode-item-action {\\n  color: #fca5a5;\\n}\\n\\n.global-mode-item-name {\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n  white-space: nowrap;\\n}\\n\\n.global-mode-item-action {\\n  font-size: 12px;\\n  flex-shrink: 0;\\n}\\n\\n.global-mode-actions {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n}\\n\\n.history-btn {\\n  border-color: var(--wb-primary);\\n  background: var(--wb-primary-soft);\\n}\\n\\n.utility-btn {\\n  border-color: var(--wb-primary-light);\\n  background: var(--wb-primary-soft);\\n}\\n\\n.utility-btn.active {\\n  border-color: var(--wb-primary-light);\\n  background: var(--wb-primary-soft);\\n  color: var(--wb-primary-light);\\n}\\n\\n.wb-main-layout {\\n  flex: 1;\\n  min-height: 60vh;\\n  display: grid;\\n  grid-template-columns: 320px 10px minmax(0, 1fr);\\n  gap: 0;\\n}\\n\\n.wb-entry-list,\\n.wb-editor {\\n  border-radius: 12px;\\n  padding: 0;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 8px;\\n  background: transparent;\\n  min-height: 0;\\n}\\n\\n.list-search {\\n  display: grid;\\n  gap: 6px;\\n  padding: 0 8px;\\n}\\n\\n.list-summary {\\n  color: var(--wb-text-muted);\\n  font-size: 12px;\\n  padding: 0 8px;\\n}\\n\\n.list-scroll {\\n  flex: 1 1 auto;\\n  min-height: 210px;\\n  max-height: calc(70vh - 210px);\\n  overflow: auto;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 6px;\\n}\\n\\n.entry-item {\\n  width: 100%;\\n  text-align: left;\\n  border: none;\\n  background: transparent;\\n  color: var(--wb-text-main);\\n  border-radius: 8px;\\n  padding: 10px 12px 10px 14px;\\n  cursor: pointer;\\n  display: grid;\\n  gap: 6px;\\n  position: relative;\\n  transition: background-color 0.15s ease;\\n  margin-bottom: 4px;\\n}\\n\\n.entry-item::before {\\n  content: '';\\n  position: absolute;\\n  left: 0;\\n  top: 0;\\n  bottom: 0;\\n  width: 4px;\\n  border-radius: 8px 0 0 8px;\\n  background: linear-gradient(to bottom, #64748b, rgba(100, 116, 139, 0.05));\\n}\\n\\n.entry-item[data-status='constant']::before {\\n  background: linear-gradient(to bottom, #3b82f6, rgba(59, 130, 246, 0));\\n}\\n\\n.entry-item[data-status='vector']::before {\\n  background: linear-gradient(to bottom, #a855f7, rgba(168, 85, 247, 0));\\n}\\n\\n.entry-item[data-status='normal']::before {\\n  background: linear-gradient(to bottom, #22c55e, rgba(34, 197, 94, 0));\\n}\\n\\n.entry-item[data-status='disabled']::before {\\n  background: linear-gradient(to bottom, #6b7280, rgba(107, 114, 128, 0));\\n}\\n\\n.entry-item:hover {\\n  background: var(--wb-primary-hover);\\n  transform: none;\\n}\\n\\n.entry-item.selected {\\n  background: var(--wb-primary-soft);\\n  box-shadow: none;\\n}\\n\\n.entry-item.disabled {\\n  opacity: 0.74;\\n}\\n\\n.entry-item-head {\\n  display: flex;\\n  align-items: center;\\n  gap: 7px;\\n  min-width: 0;\\n}\\n\\n.entry-status-dot {\\n  width: 9px;\\n  height: 9px;\\n  border-radius: 999px;\\n  background: #64748b;\\n  flex-shrink: 0;\\n  box-shadow: 0 0 0 2px var(--wb-bg-panel);\\n}\\n\\n.entry-status-dot[data-status='constant'] {\\n  background: #3b82f6;\\n}\\n\\n.entry-status-dot[data-status='vector'] {\\n  background: #a855f7;\\n}\\n\\n.entry-status-dot[data-status='normal'] {\\n  background: #22c55e;\\n}\\n\\n.entry-status-dot[data-status='disabled'] {\\n  background: #6b7280;\\n}\\n\\n.entry-item-title {\\n  font-weight: 700;\\n  flex: 1;\\n  min-width: 0;\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n}\\n\\n.entry-item-tags {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n}\\n\\n.entry-chip {\\n  display: inline-flex;\\n  align-items: center;\\n  gap: 4px;\\n  border: none;\\n  border-radius: 999px;\\n  padding: 2px 8px;\\n  color: var(--wb-text-muted);\\n  font-size: 11px;\\n  background: var(--wb-bg-panel);\\n}\\n\\n.entry-chip.uid {\\n  color: var(--wb-primary-light);\\n  font-size: 10px;\\n  padding: 1px 7px;\\n}\\n\\n.entry-chip.mono {\\n  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;\\n  font-size: 10px;\\n}\\n\\n.entry-chip.status[data-status='constant'] {\\n  color: #93c5fd;\\n  background: rgba(59, 130, 246, 0.16);\\n}\\n\\n.entry-chip.status[data-status='vector'] {\\n  color: #d8b4fe;\\n  background: rgba(168, 85, 247, 0.16);\\n}\\n\\n.entry-chip.status[data-status='normal'] {\\n  color: #86efac;\\n  background: rgba(34, 197, 94, 0.16);\\n}\\n\\n.entry-chip.status[data-status='disabled'] {\\n  color: #cbd5e1;\\n  background: rgba(100, 116, 139, 0.15);\\n}\\n\\n.entry-item-preview {\\n  color: var(--wb-text-muted);\\n  font-size: 11px;\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n  padding-left: 16px;\\n  opacity: 0.85;\\n}\\n\\n.entry-item-preview::before {\\n  content: 'Keys: ';\\n  color: var(--wb-text-muted);\\n  margin-right: 4px;\\n}\\n\\n.wb-editor {\\n  max-height: 70vh;\\n  overflow: hidden;\\n}\\n\\n.wb-editor-shell {\\n  height: 100%;\\n  min-height: 0;\\n  display: grid;\\n  grid-template-columns: minmax(0, 1fr) 10px 360px;\\n  gap: 0;\\n}\\n\\n.wb-resize-handle {\\n  position: relative;\\n  width: 10px;\\n  cursor: col-resize;\\n  user-select: none;\\n  touch-action: none;\\n}\\n\\n.wb-resize-handle::before {\\n  content: '';\\n  position: absolute;\\n  left: 4px;\\n  top: 12px;\\n  bottom: 12px;\\n  width: 2px;\\n  border-radius: 999px;\\n  background: var(--wb-primary-hover);\\n  transition: background-color 0.15s ease;\\n}\\n\\n.wb-resize-handle:hover::before,\\n.wb-resize-handle.dragging::before {\\n  background: var(--wb-primary-light);\\n}\\n\\n.editor-center {\\n  border: none;\\n  border-radius: 12px;\\n  background: var(--wb-bg-panel);\\n  padding: 16px;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 10px;\\n  min-height: 0;\\n  overflow: auto;\\n}\\n\\n.editor-head {\\n  display: flex;\\n  justify-content: space-between;\\n  gap: 10px;\\n  align-items: flex-end;\\n  border-bottom: 1px solid var(--wb-border-subtle);\\n  padding-bottom: 12px;\\n}\\n\\n.editor-comment {\\n  flex: 1;\\n}\\n\\n.editor-badges {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n  justify-content: flex-end;\\n}\\n\\n.editor-badge {\\n  font-size: 10px;\\n  border: none;\\n  border-radius: 999px;\\n  padding: 2px 8px;\\n  color: var(--wb-text-muted);\\n  background: var(--wb-bg-panel);\\n  white-space: nowrap;\\n}\\n\\n.editor-badge.mono {\\n  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;\\n}\\n\\n.editor-badge.on {\\n  color: #86efac;\\n  background: rgba(34, 197, 94, 0.12);\\n}\\n\\n.editor-badge.off {\\n  color: #cbd5e1;\\n  background: rgba(100, 116, 139, 0.15);\\n}\\n\\n.editor-badge.strategy[data-status='constant'] {\\n  color: #93c5fd;\\n  background: rgba(59, 130, 246, 0.12);\\n}\\n\\n.editor-badge.strategy[data-status='vector'] {\\n  color: #d8b4fe;\\n  background: rgba(168, 85, 247, 0.12);\\n}\\n\\n.editor-badge.strategy[data-status='normal'] {\\n  color: #86efac;\\n  background: rgba(34, 197, 94, 0.12);\\n}\\n\\n.editor-badge.strategy[data-status='disabled'] {\\n  color: #cbd5e1;\\n  background: rgba(100, 116, 139, 0.12);\\n}\\n\\n.editor-keyword-grid .text-area.compact {\\n  min-height: 36px;\\n  height: 36px;\\n  line-height: 1.35;\\n}\\n\\n.editor-content-block {\\n  min-height: 0;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 6px;\\n  flex: 1;\\n}\\n\\n.editor-content-title {\\n  font-size: 12px;\\n  color: var(--wb-primary-light);\\n  letter-spacing: 0.01em;\\n}\\n\\n.editor-content-area {\\n  min-height: 320px;\\n  flex: 1;\\n  resize: none;\\n  line-height: 1.5;\\n}\\n\\n.content-resize-handle {\\n  display: none;\\n  align-items: center;\\n  justify-content: center;\\n  height: 22px;\\n  cursor: ns-resize;\\n  background: var(--wb-bg-panel);\\n  border-radius: 0 0 8px 8px;\\n  touch-action: none;\\n  user-select: none;\\n}\\n\\n.content-resize-grip {\\n  font-size: 12px;\\n  color: var(--wb-text-dim);\\n  letter-spacing: 3px;\\n  line-height: 1;\\n}\\n\\n.editor-advanced {\\n  border: none;\\n  border-radius: 8px;\\n  padding: 10px;\\n  background: var(--wb-input-bg);\\n}\\n\\n.editor-advanced > summary {\\n  cursor: pointer;\\n  font-size: 12px;\\n  color: var(--wb-text-muted);\\n}\\n\\n.editor-advanced[open] > summary {\\n  margin-bottom: 7px;\\n}\\n\\n.editor-side {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 8px;\\n  min-height: 0;\\n  overflow: auto;\\n}\\n\\n.editor-card {\\n  border: none;\\n  border-radius: 12px;\\n  padding: 12px;\\n  background: var(--wb-bg-panel);\\n  display: grid;\\n  gap: 7px;\\n}\\n\\n.editor-card h4 {\\n  margin: 0;\\n  font-size: 12px;\\n  color: var(--wb-primary);\\n}\\n\\n.strategy-switch {\\n  display: grid;\\n  gap: 6px;\\n}\\n\\n.strategy-pill {\\n  border: none;\\n  border-radius: 6px;\\n  background: var(--wb-input-bg);\\n  color: var(--wb-text-muted);\\n  padding: 6px 10px;\\n  font-size: 12px;\\n  cursor: pointer;\\n  text-align: left;\\n  transition: background-color 0.15s ease;\\n}\\n\\n.strategy-pill:hover {\\n  background: var(--wb-primary-hover);\\n}\\n\\n.strategy-pill.active.constant {\\n  background: rgba(59, 130, 246, 0.16);\\n  color: #93c5fd;\\n}\\n\\n.strategy-pill.active.vector {\\n  background: rgba(168, 85, 247, 0.16);\\n  color: #d8b4fe;\\n}\\n\\n.strategy-pill.active.selective {\\n  background: rgba(34, 197, 94, 0.16);\\n  color: #86efac;\\n}\\n\\n.editor-grid {\\n  display: grid;\\n  gap: 8px;\\n}\\n\\n.editor-grid.two-cols {\\n  grid-template-columns: 1fr 1fr;\\n}\\n\\n.editor-grid.three-cols {\\n  grid-template-columns: repeat(3, minmax(0, 1fr));\\n}\\n\\n.field {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 4px;\\n}\\n\\n.field > span {\\n  color: var(--wb-primary-light);\\n}\\n\\n.field.disabled {\\n  opacity: 0.56;\\n}\\n\\n.field-end {\\n  align-self: end;\\n}\\n\\n.field-actions {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n}\\n\\n.text-input,\\n.text-area,\\n.toolbar-select {\\n  width: 100%;\\n  box-sizing: border-box;\\n  border: 1px solid transparent;\\n  border-radius: 6px;\\n  padding: 8px 10px;\\n  color: var(--wb-text-main);\\n  background: var(--wb-input-bg);\\n  transition: all 0.2s ease;\\n}\\n\\n.text-input:hover,\\n.text-area:hover,\\n.toolbar-select:hover {\\n  background: var(--wb-input-bg-hover);\\n}\\n\\n.text-input:focus,\\n.text-area:focus,\\n.toolbar-select:focus {\\n  background: var(--wb-input-bg-focus);\\n  border-color: var(--wb-primary-glow);\\n  outline: none;\\n  box-shadow: 0 0 0 3px var(--wb-primary-soft);\\n}\\n\\n.text-area {\\n  min-height: 96px;\\n  resize: vertical;\\n}\\n\\n.text-area.compact {\\n  min-height: 84px;\\n}\\n\\n.text-area.large {\\n  min-height: 190px;\\n}\\n\\n.checkbox-inline {\\n  display: inline-flex;\\n  align-items: center;\\n  gap: 6px;\\n}\\n\\n.wb-tools-grid {\\n  display: grid;\\n  gap: 8px;\\n  grid-template-columns: repeat(2, minmax(0, 1fr));\\n}\\n\\n.tool-card {\\n  border-radius: 10px;\\n  padding: 10px;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 8px;\\n  min-height: 170px;\\n  background: var(--wb-bg-panel);\\n}\\n\\n.tool-card h4 {\\n  margin: 0;\\n  font-size: 13px;\\n  color: var(--wb-primary-light);\\n}\\n\\n.tool-line.stacked {\\n  display: grid;\\n  gap: 6px;\\n}\\n\\n.find-flags {\\n  display: flex;\\n  flex-wrap: wrap;\\n  gap: 8px;\\n}\\n\\n.find-scope-line {\\n  display: flex;\\n  align-items: center;\\n  gap: 10px;\\n  flex-wrap: wrap;\\n}\\n\\n.find-summary-text {\\n  margin-left: auto;\\n  color: var(--wb-primary-light);\\n  font-size: 12px;\\n}\\n\\n.find-active-hit {\\n  border: 1px solid var(--wb-border-main);\\n  border-radius: 7px;\\n  padding: 6px 8px;\\n  display: grid;\\n  gap: 2px;\\n  background: var(--wb-bg-panel);\\n}\\n\\n.find-active-hit strong {\\n  color: var(--wb-text-main);\\n  font-size: 12px;\\n}\\n\\n.find-active-hit span {\\n  color: var(--wb-text-muted);\\n  font-size: 11px;\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n}\\n\\n.batch-exclude-note {\\n  color: var(--wb-text-muted);\\n  font-size: 11px;\\n}\\n\\n.batch-exclude-chips {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n}\\n\\n.exclude-chip {\\n  border: 1px solid var(--wb-border-subtle);\\n  border-radius: 999px;\\n  padding: 1px 8px;\\n  font-size: 11px;\\n  color: var(--wb-text-main);\\n  background: var(--wb-bg-panel);\\n}\\n\\n.tool-details {\\n  border: 1px solid var(--wb-border-main);\\n  border-radius: 8px;\\n  padding: 6px;\\n  background: var(--wb-bg-panel);\\n}\\n\\n.tool-details > summary {\\n  cursor: pointer;\\n  color: var(--wb-text-main);\\n  font-size: 12px;\\n}\\n\\n.tool-details[open] > summary {\\n  margin-bottom: 6px;\\n}\\n\\n.history-compare {\\n  display: grid;\\n  gap: 6px;\\n}\\n\\n.history-preview-grid {\\n  display: grid;\\n  grid-template-columns: repeat(2, minmax(0, 1fr));\\n  gap: 6px;\\n}\\n\\n.history-preview-card {\\n  border: 1px solid var(--wb-border-main);\\n  border-radius: 8px;\\n  padding: 6px;\\n  display: grid;\\n  gap: 3px;\\n  background: var(--wb-bg-panel);\\n}\\n\\n.history-preview-card strong {\\n  color: var(--wb-primary-light);\\n  font-size: 11px;\\n}\\n\\n.history-preview-card span {\\n  color: var(--wb-text-muted);\\n  font-size: 11px;\\n  line-height: 1.35;\\n}\\n\\n.history-note {\\n  border: 1px dashed var(--wb-border-main);\\n  border-radius: 8px;\\n  padding: 6px;\\n  color: var(--wb-text-muted);\\n  font-size: 11px;\\n  background: var(--wb-bg-panel);\\n}\\n\\n.tool-scroll {\\n  overflow: auto;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 6px;\\n}\\n\\n.tool-list-item {\\n  border-radius: 8px;\\n  padding: 8px;\\n  display: flex;\\n  justify-content: space-between;\\n  gap: 8px;\\n  align-items: center;\\n  background: var(--wb-input-bg);\\n}\\n\\n.item-main {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 2px;\\n  min-width: 0;\\n}\\n\\n.item-main strong,\\n.activation-main strong {\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n}\\n\\n.item-main span {\\n  color: var(--wb-text-muted);\\n  font-size: 12px;\\n}\\n\\n.item-actions {\\n  display: flex;\\n  gap: 6px;\\n}\\n\\n.activation-item {\\n  border-radius: 8px;\\n  padding: 8px;\\n  display: grid;\\n  gap: 3px;\\n  background: var(--wb-input-bg);\\n}\\n\\n.activation-main,\\n.activation-sub {\\n  display: flex;\\n  justify-content: space-between;\\n  gap: 6px;\\n}\\n\\n.activation-main span,\\n.activation-sub {\\n  color: var(--wb-text-muted);\\n  font-size: 12px;\\n}\\n\\n.activation-sub span:last-child {\\n  flex: 1;\\n  text-align: right;\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n}\\n\\n.wb-floating-window {\\n  position: fixed;\\n  max-width: calc(100vw - 16px);\\n  max-height: min(74vh, 760px);\\n  border: 1px solid var(--wb-border-subtle);\\n  border-radius: 10px;\\n  background: var(--wb-bg-root);\\n  box-shadow: var(--wb-shadow-main);\\n  display: flex;\\n  flex-direction: column;\\n  overflow: hidden;\\n}\\n\\n.wb-floating-header {\\n  display: flex;\\n  justify-content: space-between;\\n  gap: 8px;\\n  align-items: center;\\n  padding: 8px 10px;\\n  border-bottom: 1px solid var(--wb-border-subtle);\\n  background: var(--wb-bg-panel);\\n  cursor: move;\\n  user-select: none;\\n  touch-action: none;\\n}\\n\\n.wb-floating-header strong {\\n  font-size: 12px;\\n  color: var(--wb-text-main);\\n}\\n\\n.wb-floating-header-actions {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n}\\n\\n.wb-floating-body {\\n  min-height: 0;\\n  padding: 8px;\\n  display: grid;\\n  gap: 8px;\\n  overflow: auto;\\n}\\n\\n.find-window .wb-floating-body {\\n  gap: 10px;\\n}\\n\\n.activation-window .tool-scroll {\\n  max-height: min(58vh, 520px);\\n}\\n\\n.wb-status {\\n  border-radius: 10px;\\n  background: var(--wb-bg-panel);\\n  padding: 10px 12px;\\n  display: flex;\\n  justify-content: space-between;\\n  gap: 8px;\\n  color: var(--wb-text-main);\\n  flex-wrap: wrap;\\n}\\n\\n.btn {\\n  border: 1px solid var(--wb-border-main);\\n  background: var(--wb-bg-panel);\\n  color: var(--wb-text-main);\\n  border-radius: 7px;\\n  padding: 5px 10px;\\n  cursor: pointer;\\n}\\n\\n.btn:hover:not(:disabled) {\\n  border-color: var(--wb-primary-light);\\n}\\n\\n.btn:disabled {\\n  opacity: 0.5;\\n  cursor: default;\\n}\\n\\n.btn.primary {\\n  background: var(--wb-primary-soft);\\n  border-color: var(--wb-primary);\\n}\\n\\n.btn.danger {\\n  background: rgba(225, 29, 72, 0.12);\\n  border-color: #e11d48;\\n  color: #e11d48;\\n}\\n\\n.btn.mini {\\n  padding: 4px 8px;\\n  font-size: 12px;\\n}\\n\\n.empty-note,\\n.empty-block {\\n  color: var(--wb-text-muted);\\n  font-size: 12px;\\n}\\n\\n.empty-block {\\n  padding: 14px;\\n  border: 1px dashed var(--wb-border-main);\\n  border-radius: 8px;\\n}\\n\\n.hidden-input {\\n  display: none;\\n}\\n\\n.wb-modal-backdrop {\\n  position: fixed;\\n  inset: 0;\\n  background: rgba(0, 0, 0, 0.55);\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  z-index: 10020;\\n  padding: 14px;\\n  box-sizing: border-box;\\n}\\n\\n.wb-history-modal {\\n  width: min(1260px, 100%);\\n  max-height: min(88vh, 940px);\\n  border: 1px solid var(--wb-border-main);\\n  border-radius: 12px;\\n  background: var(--wb-bg-root);\\n  box-shadow: var(--wb-shadow-main);\\n  display: flex;\\n  flex-direction: column;\\n  overflow: hidden;\\n  box-sizing: border-box;\\n}\\n\\n.wb-history-modal-header {\\n  display: flex;\\n  justify-content: space-between;\\n  gap: 8px;\\n  align-items: center;\\n  padding: 10px 12px;\\n  border-bottom: 1px solid var(--wb-border-main);\\n  background: var(--wb-bg-panel);\\n}\\n\\n.wb-history-modal-header strong {\\n  display: block;\\n  font-size: 14px;\\n}\\n\\n.wb-history-modal-header span {\\n  color: var(--wb-text-muted);\\n  font-size: 11px;\\n}\\n\\n.wb-history-modal-actions {\\n  display: flex;\\n  gap: 6px;\\n  flex-wrap: wrap;\\n}\\n\\n.wb-history-modal-main {\\n  min-height: 0;\\n  flex: 1;\\n  display: grid;\\n  grid-template-columns: 300px 1fr;\\n  overflow: hidden;\\n}\\n\\n.wb-history-versions {\\n  border-right: 1px solid var(--wb-border-main);\\n  background: var(--wb-bg-panel);\\n  display: flex;\\n  flex-direction: column;\\n  min-height: 0;\\n}\\n\\n.wb-history-versions-title {\\n  padding: 8px 10px;\\n  font-size: 11px;\\n  color: var(--wb-text-muted);\\n  border-bottom: 1px solid var(--wb-border-main);\\n}\\n\\n.wb-history-versions-scroll {\\n  flex: 1;\\n  min-height: 0;\\n  overflow: auto;\\n  padding: 8px;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 7px;\\n}\\n\\n.wb-history-version-item {\\n  border: 1px solid var(--wb-border-main);\\n  border-radius: 8px;\\n  padding: 6px;\\n  display: grid;\\n  gap: 4px;\\n  background: var(--wb-bg-panel);\\n}\\n\\n.wb-history-version-line {\\n  display: flex;\\n  justify-content: space-between;\\n  gap: 6px;\\n  align-items: center;\\n}\\n\\n.wb-history-version-line strong {\\n  font-size: 11px;\\n  color: var(--wb-text-main);\\n}\\n\\n.wb-history-version-item span {\\n  font-size: 11px;\\n  color: var(--wb-text-muted);\\n  word-break: break-all;\\n}\\n\\n.wb-history-lr {\\n  display: inline-flex;\\n  gap: 4px;\\n}\\n\\n.mini-lr {\\n  border: 1px solid var(--wb-border-main);\\n  background: var(--wb-input-bg);\\n  color: var(--wb-text-muted);\\n  border-radius: 6px;\\n  min-width: 24px;\\n  font-size: 10px;\\n  cursor: pointer;\\n}\\n\\n.mini-lr.active {\\n  border-color: #22d3ee;\\n  color: #67e8f9;\\n}\\n\\n.wb-history-diff-wrap {\\n  min-height: 0;\\n  flex: 1;\\n  display: flex;\\n  flex-direction: column;\\n  overflow: hidden;\\n}\\n\\n.wb-history-diff-head {\\n  border-bottom: 1px solid var(--wb-border-main);\\n  background: var(--wb-bg-panel);\\n  padding: 8px 10px;\\n  display: flex;\\n  justify-content: space-between;\\n  gap: 8px;\\n  align-items: center;\\n  font-size: 11px;\\n  color: var(--wb-text-muted);\\n}\\n\\n.wb-history-diff-grid {\\n  min-height: 0;\\n  flex: 1;\\n  display: grid;\\n  grid-template-columns: 1fr 1fr;\\n}\\n\\n.wb-history-diff-grid > div {\\n  min-height: 0;\\n  min-width: 0;\\n  display: flex;\\n  flex-direction: column;\\n  overflow: hidden;\\n}\\n\\n.wb-history-diff-grid > div + div {\\n  border-left: 1px solid var(--wb-border-main);\\n}\\n\\n.wb-history-diff-title {\\n  padding: 8px 10px;\\n  border-bottom: 1px solid var(--wb-border-main);\\n  font-size: 11px;\\n  color: var(--wb-primary-light);\\n}\\n\\n.wb-history-diff-body {\\n  min-height: 0;\\n  flex: 1;\\n  overflow: auto;\\n  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;\\n  font-size: 11px;\\n  background: var(--wb-input-bg-focus);\\n  word-break: break-all;\\n  overflow-wrap: break-word;\\n}\\n\\n.diff-row {\\n  display: grid;\\n  grid-template-columns: 54px 1fr;\\n  align-items: start;\\n  border-bottom: 1px solid var(--wb-border-subtle);\\n}\\n\\n.line-no {\\n  color: var(--wb-text-muted);\\n  padding: 2px 8px;\\n  border-right: 1px solid var(--wb-border-subtle);\\n  user-select: none;\\n}\\n\\n.line-text {\\n  white-space: pre-wrap;\\n  word-break: break-word;\\n  padding: 2px 8px;\\n  color: var(--wb-text-main);\\n}\\n\\n.diff-row.add {\\n  background: rgba(34, 197, 94, 0.18);\\n}\\n\\n.diff-row.del {\\n  background: rgba(239, 68, 68, 0.18);\\n}\\n\\n.diff-row.empty {\\n  background: rgba(100, 116, 139, 0.08);\\n}\\n\\n@media (max-width: 1380px) {\\n  .wb-editor-shell {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .editor-side {\\n    overflow: visible;\\n    max-height: none;\\n  }\\n\\n  .wb-history-modal-main {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .wb-history-versions {\\n    border-right: none;\\n    border-bottom: 1px solid var(--wb-border-main);\\n    max-height: 120px;\\n  }\\n\\n  .wb-modal-backdrop {\\n    padding: 2px;\\n  }\\n\\n  .wb-history-modal {\\n    width: 100%;\\n    max-height: calc(100vh - 4px);\\n    height: calc(100vh - 4px);\\n    border-radius: 6px;\\n  }\\n\\n  .wb-history-modal-header {\\n    flex-wrap: wrap;\\n    gap: 4px;\\n    padding: 6px 8px;\\n    flex-shrink: 0;\\n  }\\n\\n  .wb-history-modal-header strong {\\n    font-size: 12px;\\n  }\\n\\n  .wb-history-modal-header > div:first-child span {\\n    display: none;\\n  }\\n\\n  .wb-history-modal-actions {\\n    gap: 4px;\\n  }\\n\\n  .wb-history-modal-actions .btn {\\n    font-size: 10px;\\n    padding: 3px 6px;\\n  }\\n\\n  .wb-history-modal-main {\\n    grid-template-columns: 1fr;\\n    overflow-y: auto;\\n    flex: 1;\\n    min-height: 0;\\n  }\\n\\n  .wb-history-diff-wrap {\\n    overflow-y: auto;\\n    min-height: 0;\\n  }\\n\\n  .wb-history-diff-grid {\\n    grid-template-columns: 1fr;\\n    overflow: visible;\\n  }\\n\\n  .wb-history-diff-grid > div {\\n    max-height: 30vh;\\n    overflow: auto;\\n  }\\n\\n  .wb-history-diff-grid > div + div {\\n    border-left: none;\\n    border-top: 1px solid var(--wb-border-main);\\n  }\\n\\n  .diff-row {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .line-no {\\n    display: none;\\n  }\\n\\n  .wb-history-diff-body {\\n    font-size: 10px;\\n  }\\n\\n  .wb-history-diff-head {\\n    flex-wrap: wrap;\\n    gap: 4px;\\n    padding: 6px 8px;\\n  }\\n\\n  .wb-history-diff-head > div {\\n    font-size: 10px;\\n  }\\n}\\n\\n@media (max-width: 1100px) {\\n  .global-mode-grid {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .wb-resize-handle {\\n    display: none;\\n  }\\n\\n  .wb-main-layout {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .wb-tools-grid {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .editor-grid.two-cols,\\n  .editor-grid.three-cols {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .editor-head {\\n    flex-direction: column;\\n    align-items: stretch;\\n  }\\n\\n  .editor-badges {\\n    justify-content: flex-start;\\n  }\\n\\n  .history-preview-grid {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .wb-history-diff-grid {\\n    grid-template-columns: 1fr;\\n  }\\n\\n  .wb-history-diff-grid > div + div {\\n    border-left: none;\\n    border-top: 1px solid var(--wb-border-main);\\n  }\\n\\n  .wb-status {\\n    flex-direction: column;\\n  }\\n\\n\\n  .wb-floating-window {\\n    width: calc(100vw - 16px) !important;\\n    left: 8px !important;\\n    right: 8px;\\n  }\\n}\\n\\n.editor-back-btn {\\n  display: flex;\\n  align-items: center;\\n  gap: 8px;\\n  padding: 10px 12px;\\n  margin: 0 0 8px 0;\\n  background: var(--wb-bg-panel);\\n  border: none;\\n  border-radius: 6px;\\n  color: var(--wb-primary);\\n  font-weight: 600;\\n  cursor: pointer;\\n}\\n\\n.editor-back-btn:hover {\\n  background: var(--wb-primary-hover);\\n}\\n\\n/*  Mobile Tab View  */\\n.mobile-tab-view {\\n  display: flex;\\n  flex-direction: column;\\n  flex: 1;\\n  min-height: 0;\\n  overflow: hidden;\\n}\\n\\n.mobile-tab-content {\\n  flex: 1;\\n  min-height: 0;\\n  position: relative;\\n}\\n\\n.mobile-pane {\\n  position: absolute;\\n  inset: 0;\\n  overflow-y: auto;\\n  padding: 8px;\\n  -webkit-overflow-scrolling: touch;\\n}\\n\\n.mobile-entry-list {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 4px;\\n}\\n\\n.mobile-ai-panel {\\n  height: 100%;\\n  display: flex;\\n  flex-direction: column;\\n}\\n\\n.mobile-ai-panel .ai-chat-area {\\n  flex: 1;\\n  min-height: 0;\\n  display: flex;\\n  flex-direction: column;\\n}\\n\\n.mobile-danger-zone {\\n  display: flex;\\n  gap: 8px;\\n  margin-top: 16px;\\n  padding-top: 16px;\\n  border-top: 1px solid var(--wb-border);\\n}\\n\\n.mobile-danger-zone .btn {\\n  flex: 1;\\n}\\n\\n.mobile-tab-bar {\\n  position: fixed;\\n  bottom: 0;\\n  left: 0;\\n  right: 0;\\n  z-index: 10100;\\n  display: flex;\\n  border-top: 1px solid var(--wb-border);\\n  background: var(--wb-bg-secondary);\\n  height: 52px;\\n}\\n\\n.mobile-tab-bar button {\\n  flex: 1;\\n  display: flex;\\n  flex-direction: column;\\n  align-items: center;\\n  justify-content: center;\\n  gap: 2px;\\n  border: none;\\n  background: transparent;\\n  color: var(--wb-text-dim);\\n  font-size: 10px;\\n  padding: 4px 0;\\n  cursor: pointer;\\n  transition: color 0.15s, background 0.15s;\\n  -webkit-tap-highlight-color: transparent;\\n}\\n\\n.mobile-tab-bar button.active {\\n  color: var(--wb-accent);\\n  background: color-mix(in srgb, var(--wb-accent) 8%, transparent);\\n}\\n\\n.mobile-tab-bar .tab-icon {\\n  font-size: 20px;\\n  line-height: 1;\\n}\\n\\n.mobile-tab-bar .tab-label {\\n  font-weight: 500;\\n}\\n\\n@media (max-width: 768px) {\\n  .wb-assistant-root {\\n    padding: 6px;\\n    gap: 8px;\\n  }\\n\\n  .wb-header,\\n  .wb-bindings,\\n  .global-mode-panel,\\n  .wb-toolbar {\\n    padding: 6px;\\n    gap: 6px;\\n  }\\n\\n  .toolbar-label {\\n    min-width: 100%;\\n  }\\n\\n  .toolbar-select {\\n    width: 100%;\\n  }\\n\\n  .worldbook-picker-trigger {\\n    white-space: normal;\\n  }\\n\\n  .wb-main-layout {\\n    display: block !important;\\n    height: auto !important;\\n    overflow: visible !important;\\n  }\\n\\n  .wb-entry-list,\\n  .wb-editor,\\n  .wb-editor-shell,\\n  .editor-side {\\n    width: 100% !important;\\n    height: auto !important;\\n    max-height: none !important;\\n    border: none !important;\\n    padding: 0 !important;\\n  }\\n\\n  .wb-entry-list {\\n    max-height: 80vh !important;\\n    overflow-y: auto;\\n  }\\n\\n  .wb-editor-shell {\\n    display: block !important;\\n  }\\n\\n  .list-scroll {\\n    max-height: 60vh;\\n  }\\n\\n  .wb-floating-window {\\n    left: 8px !important;\\n    right: 8px !important;\\n    width: auto !important;\\n    max-width: none !important;\\n  }\\n}\\n\\n.list-actions {\\n  padding: 0 8px;\\n}\\n\\n/* \\n   Override: Force theme colors on native form elements\\n   This beats SillyTavern global dark CSS which sets\\n   background/color on textarea, input, select, etc.\\n    */\\n.wb-assistant-root input,\\n.wb-assistant-root textarea,\\n.wb-assistant-root select,\\n.wb-assistant-root option,\\n.wb-assistant-root button {\\n  color: var(--wb-text-main) !important;\\n}\\n\\n.wb-assistant-root input[type=\\\"text\\\"],\\n.wb-assistant-root input[type=\\\"number\\\"],\\n.wb-assistant-root textarea,\\n.wb-assistant-root select {\\n  background: var(--wb-input-bg) !important;\\n  border-color: transparent !important;\\n}\\n\\n.wb-assistant-root input[type=\\\"text\\\"]:hover,\\n.wb-assistant-root input[type=\\\"number\\\"]:hover,\\n.wb-assistant-root textarea:hover,\\n.wb-assistant-root select:hover {\\n  background: var(--wb-input-bg-hover) !important;\\n}\\n\\n.wb-assistant-root input[type=\\\"text\\\"]:focus,\\n.wb-assistant-root input[type=\\\"number\\\"]:focus,\\n.wb-assistant-root textarea:focus,\\n.wb-assistant-root select:focus {\\n  background: var(--wb-input-bg-focus) !important;\\n  border-color: var(--wb-primary-glow) !important;\\n  outline: none !important;\\n  box-shadow: 0 0 0 3px var(--wb-primary-soft) !important;\\n}\\n/* \\n   AI Generator Panel\\n    */\\n.ai-generator-panel {\\n  display: flex;\\n  gap: 0;\\n  flex: 1;\\n  min-height: 0;\\n  border-radius: var(--wb-radius);\\n  overflow: hidden;\\n  background: var(--wb-bg-secondary);\\n}\\n\\n/*  Sidebar  */\\n.ai-sidebar {\\n  width: 220px;\\n  min-width: 180px;\\n  border-right: 1px solid var(--wb-border);\\n  display: flex;\\n  flex-direction: column;\\n  background: var(--wb-bg-main);\\n}\\n\\n.ai-sidebar-head {\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  padding: 10px 12px;\\n  border-bottom: 1px solid var(--wb-border);\\n}\\n\\n.ai-sidebar-title {\\n  font-weight: 600;\\n  font-size: 0.9em;\\n  color: var(--wb-text-main);\\n}\\n\\n.ai-session-list {\\n  flex: 1;\\n  overflow-y: auto;\\n  padding: 6px;\\n}\\n\\n.ai-session-item {\\n  display: flex;\\n  flex-wrap: wrap;\\n  align-items: center;\\n  width: 100%;\\n  padding: 8px 10px;\\n  margin-bottom: 2px;\\n  border: none;\\n  border-radius: var(--wb-radius-sm, 6px);\\n  background: transparent;\\n  cursor: pointer;\\n  text-align: left;\\n  transition: background 0.15s;\\n  position: relative;\\n}\\n\\n.ai-session-item:hover {\\n  background: var(--wb-bg-highlight);\\n}\\n\\n.ai-session-item.active {\\n  background: var(--wb-primary-soft);\\n}\\n\\n.ai-session-title {\\n  flex: 1;\\n  font-size: 0.85em;\\n  color: var(--wb-text-main);\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n}\\n\\n.ai-session-meta {\\n  font-size: 0.72em;\\n  color: var(--wb-text-dim);\\n  width: 100%;\\n  margin-top: 2px;\\n}\\n\\n.ai-session-delete {\\n  position: absolute;\\n  top: 4px;\\n  right: 4px;\\n  width: 20px;\\n  height: 20px;\\n  border: none;\\n  background: transparent;\\n  color: var(--wb-text-dim);\\n  font-size: 1em;\\n  cursor: pointer;\\n  border-radius: 50%;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  opacity: 0;\\n  transition: opacity 0.15s, background 0.15s;\\n}\\n\\n.ai-session-item:hover .ai-session-delete {\\n  opacity: 1;\\n}\\n\\n.ai-session-delete:hover {\\n  background: var(--wb-danger, #e74c3c);\\n  color: #fff;\\n}\\n\\n/*  Chat Area  */\\n.ai-chat-area {\\n  flex: 1;\\n  display: flex;\\n  flex-direction: column;\\n  min-width: 0;\\n}\\n\\n.ai-chat-empty {\\n  flex: 1;\\n  display: flex;\\n  flex-direction: column;\\n  align-items: center;\\n  justify-content: center;\\n  gap: 12px;\\n  color: var(--wb-text-dim);\\n}\\n\\n.ai-chat-empty-icon {\\n  font-size: 3em;\\n  opacity: 0.5;\\n}\\n\\n.ai-chat-empty-text {\\n  font-size: 0.95em;\\n}\\n\\n.ai-chat-messages {\\n  flex: 1;\\n  overflow-y: auto;\\n  padding: 16px;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 12px;\\n}\\n\\n/*  Chat bubbles  */\\n.ai-chat-bubble {\\n  max-width: 85%;\\n  padding: 10px 14px;\\n  border-radius: 12px;\\n  line-height: 1.55;\\n  white-space: pre-wrap;\\n  word-break: break-word;\\n}\\n\\n.ai-chat-bubble.user {\\n  align-self: flex-end;\\n  background: var(--wb-primary-soft);\\n  border-bottom-right-radius: 4px;\\n}\\n\\n.ai-chat-bubble.assistant {\\n  align-self: flex-start;\\n  background: var(--wb-bg-main);\\n  border: 1px solid var(--wb-border);\\n  border-bottom-left-radius: 4px;\\n}\\n\\n.ai-chat-bubble-role {\\n  font-size: 0.72em;\\n  font-weight: 600;\\n  color: var(--wb-text-dim);\\n  margin-bottom: 4px;\\n}\\n\\n.ai-chat-bubble-content {\\n  font-size: 0.88em;\\n  color: var(--wb-text-main);\\n}\\n\\n.ai-cursor {\\n  animation: ai-blink 0.7s infinite;\\n  color: var(--wb-primary);\\n}\\n\\n@keyframes ai-blink {\\n  0%, 100% { opacity: 1; }\\n  50% { opacity: 0; }\\n}\\n\\n.ai-thinking {\\n  color: var(--wb-text-dim);\\n  font-style: italic;\\n}\\n\\n/*  Input bar  */\\n.ai-chat-input-bar {\\n  display: flex;\\n  flex-wrap: wrap;\\n  gap: 8px;\\n  padding: 12px 16px;\\n  border-top: 1px solid var(--wb-border);\\n  background: var(--wb-bg-main);\\n  align-items: flex-end;\\n}\\n\\n.ai-context-toggle {\\n  width: 100%;\\n  display: flex;\\n  align-items: center;\\n  gap: 6px;\\n  font-size: 0.78em;\\n  color: var(--wb-text-dim);\\n  cursor: pointer;\\n  user-select: none;\\n}\\n\\n.ai-context-toggle input {\\n  margin: 0;\\n}\\n\\n.ai-context-toggle span {\\n  white-space: nowrap;\\n}\\n\\n.ai-chat-input {\\n  flex: 1;\\n  resize: vertical;\\n  min-height: 40px;\\n  max-height: 140px;\\n  font-size: 0.88em;\\n}\\n\\n.ai-send-btn,\\n.ai-stop-btn {\\n  min-width: 64px;\\n  height: 40px;\\n}\\n\\n/* \\n   Tag Review Modal\\n    */\\n.ai-tag-review-overlay {\\n  position: fixed;\\n  inset: 0;\\n  z-index: 9999;\\n  background: rgba(0, 0, 0, 0.55);\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n}\\n\\n.ai-tag-review-modal {\\n  background: var(--wb-bg-main);\\n  border-radius: var(--wb-radius);\\n  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.35);\\n  width: 580px;\\n  max-width: 92vw;\\n  max-height: 80vh;\\n  display: flex;\\n  flex-direction: column;\\n  overflow: hidden;\\n}\\n\\n.ai-tag-review-head {\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  padding: 14px 18px;\\n  border-bottom: 1px solid var(--wb-border);\\n}\\n\\n.ai-tag-review-title {\\n  font-weight: 600;\\n  font-size: 1em;\\n  color: var(--wb-text-main);\\n}\\n\\n.ai-tag-review-close {\\n  width: 28px;\\n  height: 28px;\\n  border: none;\\n  background: transparent;\\n  color: var(--wb-text-dim);\\n  font-size: 1.2em;\\n  cursor: pointer;\\n  border-radius: 50%;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n}\\n\\n.ai-tag-review-close:hover {\\n  background: var(--wb-bg-highlight);\\n}\\n\\n.ai-tag-review-target {\\n  padding: 12px 18px;\\n  border-bottom: 1px solid var(--wb-border);\\n}\\n\\n.ai-tag-list {\\n  flex: 1;\\n  overflow-y: auto;\\n  padding: 8px 18px;\\n}\\n\\n.ai-tag-item {\\n  display: flex;\\n  align-items: flex-start;\\n  gap: 10px;\\n  padding: 10px 0;\\n  border-bottom: 1px solid var(--wb-border);\\n  cursor: pointer;\\n}\\n\\n.ai-tag-item:last-child {\\n  border-bottom: none;\\n}\\n\\n.ai-tag-item input[type=\\\"checkbox\\\"] {\\n  margin-top: 3px;\\n}\\n\\n.ai-tag-info {\\n  flex: 1;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 4px;\\n  min-width: 0;\\n}\\n\\n.ai-tag-name {\\n  font-weight: 600;\\n  font-size: 0.9em;\\n  color: var(--wb-primary);\\n}\\n\\n.ai-tag-preview {\\n  font-size: 0.8em;\\n  color: var(--wb-text-dim);\\n  white-space: pre-wrap;\\n  word-break: break-all;\\n  line-height: 1.4;\\n}\\n\\n.ai-tag-review-actions {\\n  display: flex;\\n  gap: 8px;\\n  padding: 12px 18px;\\n  border-top: 1px solid var(--wb-border);\\n  justify-content: flex-end;\\n}\\n\\n.btn.primary {\\n  background: var(--wb-primary);\\n  color: #fff;\\n  border-color: var(--wb-primary);\\n}\\n\\n.btn.primary:hover {\\n  filter: brightness(1.1);\\n}\\n\\n.btn.primary:disabled {\\n  opacity: 0.5;\\n  cursor: not-allowed;\\n}\\n\\n/* \\n   Mobile Responsive\\n    */\\n@media (max-width: 768px) {\\n  .wb-assistant-root {\\n    padding: 6px;\\n    gap: 6px;\\n    border-radius: 0;\\n  }\\n\\n  /*  Toolbar  */\\n  .toolbar-label {\\n    min-width: unset;\\n    width: 100%;\\n  }\\n\\n  .toolbar-label select {\\n    flex: 1;\\n    min-width: 0;\\n  }\\n\\n  .toolbar-btns {\\n    width: 100%;\\n    display: flex;\\n    flex-wrap: wrap;\\n    gap: 4px;\\n  }\\n\\n  .toolbar-btns .btn {\\n    font-size: 0.78em;\\n    padding: 4px 8px;\\n  }\\n\\n  /*  Bindings bar  */\\n  .wb-bindings {\\n    flex-wrap: wrap;\\n    gap: 4px;\\n    padding: 6px 8px;\\n    font-size: 0.78em;\\n  }\\n\\n  /*  Main layout  */\\n  .wb-main-layout {\\n    display: block !important;\\n    overflow: visible;\\n    flex: none;\\n  }\\n\\n  .wb-resize-handle {\\n    display: none !important;\\n  }\\n\\n  .wb-entry-list,\\n  .wb-editor {\\n    min-height: 0;\\n    max-height: none;\\n  }\\n\\n  /*  AI Generator Panel  */\\n  .ai-generator-panel {\\n    flex-direction: column;\\n  }\\n\\n  .ai-sidebar {\\n    width: 100%;\\n    min-width: unset;\\n    max-height: 110px;\\n    border-right: none;\\n    border-bottom: 1px solid var(--wb-border);\\n  }\\n\\n  .ai-sidebar-head {\\n    padding: 6px 10px;\\n  }\\n\\n  .ai-session-list {\\n    overflow-x: auto;\\n    overflow-y: hidden;\\n    display: flex;\\n    flex-direction: row;\\n    gap: 4px;\\n    padding: 4px 8px;\\n  }\\n\\n  .ai-session-item {\\n    flex-shrink: 0;\\n    min-width: 140px;\\n    max-width: 200px;\\n  }\\n\\n  .ai-chat-messages {\\n    padding: 10px;\\n    gap: 8px;\\n  }\\n\\n  .ai-chat-bubble {\\n    max-width: 95%;\\n  }\\n\\n  .ai-chat-input-bar {\\n    padding: 8px 10px;\\n    gap: 6px;\\n  }\\n\\n  .ai-chat-input {\\n    min-height: 36px;\\n    font-size: 0.85em;\\n  }\\n\\n  /*  Tag review modal  */\\n  .ai-tag-review-modal {\\n    width: 95vw;\\n    max-height: 85vh;\\n  }\\n\\n  .ai-tag-review-actions {\\n    flex-wrap: wrap;\\n    gap: 6px;\\n    padding: 8px 12px;\\n  }\\n\\n  .ai-tag-review-actions .btn {\\n    flex: 1;\\n    min-width: 0;\\n    font-size: 0.82em;\\n  }\\n\\n  /*  Status footer  */\\n  .wb-status {\\n    font-size: 0.72em;\\n    padding: 4px 8px;\\n    gap: 6px;\\n  }\\n\\n  /*  Editor content area  */\\n  .editor-content-area {\\n    flex: 1;\\n    min-height: 40vh;\\n  }\\n\\n  .content-resize-handle {\\n    display: flex;\\n    height: 28px;\\n  }\\n\\n  .editor-content-block {\\n    position: relative;\\n    z-index: 10;\\n    background: var(--wb-bg-root);\\n  }\\n\\n  .content-top-drag-handle {\\n    display: flex;\\n    align-items: center;\\n    justify-content: center;\\n    height: 22px;\\n    cursor: ns-resize;\\n    background: var(--wb-bg-panel);\\n    border-radius: 8px 8px 0 0;\\n    touch-action: none;\\n    user-select: none;\\n  }\\n\\n  .content-top-drag-grip {\\n    font-size: 12px;\\n    color: var(--wb-text-dim);\\n    letter-spacing: 3px;\\n    line-height: 1;\\n  }\\n\\n  .text-area.compact {\\n    min-height: 60px;\\n  }\\n\\n  .editor-center {\\n    padding: 8px;\\n  }\\n\\n  .editor-side {\\n    padding: 8px;\\n  }\\n\\n  .editor-grid.two-cols {\\n    grid-template-columns: 1fr;\\n  }\\n}\\n</style>\\n\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\nmodule.exports = function (cssWithMappingToString) {\n  var list = [];\n\n  // return the list of modules as css string\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = \"\";\n      var needLayer = typeof item[5] !== \"undefined\";\n      if (item[4]) {\n        content += \"@supports (\".concat(item[4], \") {\");\n      }\n      if (item[2]) {\n        content += \"@media \".concat(item[2], \" {\");\n      }\n      if (needLayer) {\n        content += \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\");\n      }\n      content += cssWithMappingToString(item);\n      if (needLayer) {\n        content += \"}\";\n      }\n      if (item[2]) {\n        content += \"}\";\n      }\n      if (item[4]) {\n        content += \"}\";\n      }\n      return content;\n    }).join(\"\");\n  };\n\n  // import a list of modules into the list\n  list.i = function i(modules, media, dedupe, supports, layer) {\n    if (typeof modules === \"string\") {\n      modules = [[null, modules, undefined]];\n    }\n    var alreadyImportedModules = {};\n    if (dedupe) {\n      for (var k = 0; k < this.length; k++) {\n        var id = this[k][0];\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n    for (var _k = 0; _k < modules.length; _k++) {\n      var item = [].concat(modules[_k]);\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        continue;\n      }\n      if (typeof layer !== \"undefined\") {\n        if (typeof item[5] === \"undefined\") {\n          item[5] = layer;\n        } else {\n          item[1] = \"@layer\".concat(item[5].length > 0 ? \" \".concat(item[5]) : \"\", \" {\").concat(item[1], \"}\");\n          item[5] = layer;\n        }\n      }\n      if (media) {\n        if (!item[2]) {\n          item[2] = media;\n        } else {\n          item[1] = \"@media \".concat(item[2], \" {\").concat(item[1], \"}\");\n          item[2] = media;\n        }\n      }\n      if (supports) {\n        if (!item[4]) {\n          item[4] = \"\".concat(supports);\n        } else {\n          item[1] = \"@supports (\".concat(item[4], \") {\").concat(item[1], \"}\");\n          item[4] = supports;\n        }\n      }\n      list.push(item);\n    }\n  };\n  return list;\n};","\"use strict\";\n\nmodule.exports = function (item) {\n  var content = item[1];\n  var cssMapping = item[3];\n  if (!cssMapping) {\n    return content;\n  }\n  if (typeof btoa === \"function\") {\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    return [content].concat([sourceMapping]).join(\"\\n\");\n  }\n  return [content].join(\"\\n\");\n};","/* unplugin-vue-components disabled */// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../node_modules/.pnpm/css-loader@7.1.3_webpack@5.105.2/node_modules/css-loader/dist/cjs.js??clonedRuleSet-16.use[1]!../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_71d7740e7607e74f4d732110d38a3681/node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/.pnpm/postcss-loader@8.2.1_postcs_4a4b9398903558e15a2a4076ed121c2a/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_71d7740e7607e74f4d732110d38a3681/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./App.vue?vue&type=style&index=0&id=032fd8fa&scoped=true&lang=css\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../node_modules/.pnpm/vue-style-loader@4.1.3/node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"70ed93b4\", content, false, {\"ssrId\":true});\n// Hot Module Replacement\nif(module.hot) {\n // When the styles change, update the <style> tags\n if(!content.locals) {\n   module.hot.accept(\"!!../../node_modules/.pnpm/css-loader@7.1.3_webpack@5.105.2/node_modules/css-loader/dist/cjs.js??clonedRuleSet-16.use[1]!../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_71d7740e7607e74f4d732110d38a3681/node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/.pnpm/postcss-loader@8.2.1_postcs_4a4b9398903558e15a2a4076ed121c2a/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_71d7740e7607e74f4d732110d38a3681/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./App.vue?vue&type=style&index=0&id=032fd8fa&scoped=true&lang=css\", function() {\n     var newContent = require(\"!!../../node_modules/.pnpm/css-loader@7.1.3_webpack@5.105.2/node_modules/css-loader/dist/cjs.js??clonedRuleSet-16.use[1]!../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_71d7740e7607e74f4d732110d38a3681/node_modules/vue-loader/dist/stylePostLoader.js!../../node_modules/.pnpm/postcss-loader@8.2.1_postcs_4a4b9398903558e15a2a4076ed121c2a/node_modules/postcss-loader/dist/cjs.js!../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_71d7740e7607e74f4d732110d38a3681/node_modules/vue-loader/dist/index.js??ruleSet[1].rules[6].use[0]!./App.vue?vue&type=style&index=0&id=032fd8fa&scoped=true&lang=css\");\n     if(newContent.__esModule) newContent = newContent.default;\n     if(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n     update(newContent);\n   });\n }\n // When the module is disposed, remove the <style> tags\n module.hot.dispose(function() { update(); });\n}","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","/**\n * Translates the list format produced by css-loader into something\n * easier to manipulate.\n */\nexport default function listToStyles (parentId, list) {\n  var styles = []\n  var newStyles = {}\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i]\n    var id = item[0]\n    var css = item[1]\n    var media = item[2]\n    var sourceMap = item[3]\n    var part = {\n      id: parentId + ':' + i,\n      css: css,\n      media: media,\n      sourceMap: sourceMap\n    }\n    if (!newStyles[id]) {\n      styles.push(newStyles[id] = { id: id, parts: [part] })\n    } else {\n      newStyles[id].parts.push(part)\n    }\n  }\n  return styles\n}\n","/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n  Modified by Evan You @yyx990803\n*/\n\nimport listToStyles from './listToStyles'\n\nvar hasDocument = typeof document !== 'undefined'\n\nif (typeof DEBUG !== 'undefined' && DEBUG) {\n  if (!hasDocument) {\n    throw new Error(\n    'vue-style-loader cannot be used in a non-browser environment. ' +\n    \"Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.\"\n  ) }\n}\n\n/*\ntype StyleObject = {\n  id: number;\n  parts: Array<StyleObjectPart>\n}\n\ntype StyleObjectPart = {\n  css: string;\n  media: string;\n  sourceMap: ?string\n}\n*/\n\nvar stylesInDom = {/*\n  [id: number]: {\n    id: number,\n    refs: number,\n    parts: Array<(obj?: StyleObjectPart) => void>\n  }\n*/}\n\nvar head = hasDocument && (document.head || document.getElementsByTagName('head')[0])\nvar singletonElement = null\nvar singletonCounter = 0\nvar isProduction = false\nvar noop = function () {}\nvar options = null\nvar ssrIdKey = 'data-vue-ssr-id'\n\n// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n// tags it will allow on a page\nvar isOldIE = typeof navigator !== 'undefined' && /msie [6-9]\\b/.test(navigator.userAgent.toLowerCase())\n\nexport default function addStylesClient (parentId, list, _isProduction, _options) {\n  isProduction = _isProduction\n\n  options = _options || {}\n\n  var styles = listToStyles(parentId, list)\n  addStylesToDom(styles)\n\n  return function update (newList) {\n    var mayRemove = []\n    for (var i = 0; i < styles.length; i++) {\n      var item = styles[i]\n      var domStyle = stylesInDom[item.id]\n      domStyle.refs--\n      mayRemove.push(domStyle)\n    }\n    if (newList) {\n      styles = listToStyles(parentId, newList)\n      addStylesToDom(styles)\n    } else {\n      styles = []\n    }\n    for (var i = 0; i < mayRemove.length; i++) {\n      var domStyle = mayRemove[i]\n      if (domStyle.refs === 0) {\n        for (var j = 0; j < domStyle.parts.length; j++) {\n          domStyle.parts[j]()\n        }\n        delete stylesInDom[domStyle.id]\n      }\n    }\n  }\n}\n\nfunction addStylesToDom (styles /* Array<StyleObject> */) {\n  for (var i = 0; i < styles.length; i++) {\n    var item = styles[i]\n    var domStyle = stylesInDom[item.id]\n    if (domStyle) {\n      domStyle.refs++\n      for (var j = 0; j < domStyle.parts.length; j++) {\n        domStyle.parts[j](item.parts[j])\n      }\n      for (; j < item.parts.length; j++) {\n        domStyle.parts.push(addStyle(item.parts[j]))\n      }\n      if (domStyle.parts.length > item.parts.length) {\n        domStyle.parts.length = item.parts.length\n      }\n    } else {\n      var parts = []\n      for (var j = 0; j < item.parts.length; j++) {\n        parts.push(addStyle(item.parts[j]))\n      }\n      stylesInDom[item.id] = { id: item.id, refs: 1, parts: parts }\n    }\n  }\n}\n\nfunction createStyleElement () {\n  var styleElement = document.createElement('style')\n  styleElement.type = 'text/css'\n  head.appendChild(styleElement)\n  return styleElement\n}\n\nfunction addStyle (obj /* StyleObjectPart */) {\n  var update, remove\n  var styleElement = document.querySelector('style[' + ssrIdKey + '~=\"' + obj.id + '\"]')\n\n  if (styleElement) {\n    if (isProduction) {\n      // has SSR styles and in production mode.\n      // simply do nothing.\n      return noop\n    } else {\n      // has SSR styles but in dev mode.\n      // for some reason Chrome can't handle source map in server-rendered\n      // style tags - source maps in <style> only works if the style tag is\n      // created and inserted dynamically. So we remove the server rendered\n      // styles and inject new ones.\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  if (isOldIE) {\n    // use singleton mode for IE9.\n    var styleIndex = singletonCounter++\n    styleElement = singletonElement || (singletonElement = createStyleElement())\n    update = applyToSingletonTag.bind(null, styleElement, styleIndex, false)\n    remove = applyToSingletonTag.bind(null, styleElement, styleIndex, true)\n  } else {\n    // use multi-style-tag mode in all other cases\n    styleElement = createStyleElement()\n    update = applyToTag.bind(null, styleElement)\n    remove = function () {\n      styleElement.parentNode.removeChild(styleElement)\n    }\n  }\n\n  update(obj)\n\n  return function updateStyle (newObj /* StyleObjectPart */) {\n    if (newObj) {\n      if (newObj.css === obj.css &&\n          newObj.media === obj.media &&\n          newObj.sourceMap === obj.sourceMap) {\n        return\n      }\n      update(obj = newObj)\n    } else {\n      remove()\n    }\n  }\n}\n\nvar replaceText = (function () {\n  var textStore = []\n\n  return function (index, replacement) {\n    textStore[index] = replacement\n    return textStore.filter(Boolean).join('\\n')\n  }\n})()\n\nfunction applyToSingletonTag (styleElement, index, remove, obj) {\n  var css = remove ? '' : obj.css\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = replaceText(index, css)\n  } else {\n    var cssNode = document.createTextNode(css)\n    var childNodes = styleElement.childNodes\n    if (childNodes[index]) styleElement.removeChild(childNodes[index])\n    if (childNodes.length) {\n      styleElement.insertBefore(cssNode, childNodes[index])\n    } else {\n      styleElement.appendChild(cssNode)\n    }\n  }\n}\n\nfunction applyToTag (styleElement, obj) {\n  var css = obj.css\n  var media = obj.media\n  var sourceMap = obj.sourceMap\n\n  if (media) {\n    styleElement.setAttribute('media', media)\n  }\n  if (options.ssrId) {\n    styleElement.setAttribute(ssrIdKey, obj.id)\n  }\n\n  if (sourceMap) {\n    // https://developer.chrome.com/devtools/docs/javascript-debugging\n    // this makes source maps inside style tags work properly in Chrome\n    css += '\\n/*# sourceURL=' + sourceMap.sources[0] + ' */'\n    // http://stackoverflow.com/a/26603875\n    css += '\\n/*# sourceMappingURL=data:application/json;base64,' + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + ' */'\n  }\n\n  if (styleElement.styleSheet) {\n    styleElement.styleSheet.cssText = css\n  } else {\n    while (styleElement.firstChild) {\n      styleElement.removeChild(styleElement.firstChild)\n    }\n    styleElement.appendChild(document.createTextNode(css))\n  }\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import { defineComponent as _defineComponent } from 'vue';\nimport { unref as _unref, createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, isRef as _isRef, vModelText as _vModelText, withModifiers as _withModifiers, withKeys as _withKeys, withDirectives as _withDirectives, renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, normalizeClass as _normalizeClass, normalizeStyle as _normalizeStyle, vModelSelect as _vModelSelect, createTextVNode as _createTextVNode, vShow as _vShow, vModelCheckbox as _vModelCheckbox, vModelRadio as _vModelRadio } from \"vue\";\nconst _hoisted_1 = { class: \"mobile-tab-view\" };\nconst _hoisted_2 = { class: \"mobile-tab-content\" };\nconst _hoisted_3 = { class: \"mobile-pane\" };\nconst _hoisted_4 = { class: \"wb-toolbar\" };\nconst _hoisted_5 = { class: \"toolbar-label\" };\nconst _hoisted_6 = [\"title\"];\nconst _hoisted_7 = {\n    key: 0,\n    class: \"worldbook-picker-dropdown\"\n};\nconst _hoisted_8 = { class: \"worldbook-picker-list\" };\nconst _hoisted_9 = [\"onClick\"];\nconst _hoisted_10 = {\n    key: 0,\n    class: \"empty-note\"\n};\nconst _hoisted_11 = {\n    class: \"toolbar-btns\",\n    style: { \"display\": \"flex\", \"gap\": \"6px\", \"flex-wrap\": \"wrap\" }\n};\nconst _hoisted_12 = [\"disabled\"];\nconst _hoisted_13 = [\"disabled\"];\nconst _hoisted_14 = {\n    key: 0,\n    class: \"wb-bindings\"\n};\nconst _hoisted_15 = [\"title\"];\nconst _hoisted_16 = [\"title\"];\nconst _hoisted_17 = [\"title\"];\nconst _hoisted_18 = [\"title\"];\nconst _hoisted_19 = {\n    key: 1,\n    style: { \"border\": \"1px solid var(--wb-border-subtle)\", \"border-radius\": \"8px\", \"padding\": \"10px\", \"margin-bottom\": \"8px\", \"background\": \"var(--wb-bg-card)\" }\n};\nconst _hoisted_20 = { style: { \"display\": \"flex\", \"justify-content\": \"space-between\", \"align-items\": \"center\", \"margin-bottom\": \"8px\" } };\nconst _hoisted_21 = { style: { \"font-weight\": \"600\", \"font-size\": \"13px\" } };\nconst _hoisted_22 = [\"disabled\"];\nconst _hoisted_23 = {\n    class: \"field\",\n    style: { \"margin-bottom\": \"6px\" }\n};\nconst _hoisted_24 = [\"value\"];\nconst _hoisted_25 = { style: { \"display\": \"flex\", \"gap\": \"4px\", \"flex-wrap\": \"wrap\", \"margin-bottom\": \"8px\" } };\nconst _hoisted_26 = [\"disabled\"];\nconst _hoisted_27 = [\"disabled\"];\nconst _hoisted_28 = [\"disabled\"];\nconst _hoisted_29 = {\n    class: \"field\",\n    style: { \"margin-bottom\": \"6px\" }\n};\nconst _hoisted_30 = [\"onKeydown\"];\nconst _hoisted_31 = {\n    key: 0,\n    style: { \"max-height\": \"120px\", \"overflow-y\": \"auto\", \"margin-bottom\": \"6px\" }\n};\nconst _hoisted_32 = [\"onClick\"];\nconst _hoisted_33 = {\n    key: 1,\n    style: { \"font-size\": \"12px\", \"margin-bottom\": \"4px\", \"opacity\": \"0.7\" }\n};\nconst _hoisted_34 = { style: { \"display\": \"flex\", \"flex-direction\": \"column\", \"gap\": \"2px\", \"margin-bottom\": \"8px\" } };\nconst _hoisted_35 = [\"onClick\"];\nconst _hoisted_36 = { style: { \"border-top\": \"1px solid var(--wb-border-subtle)\", \"padding-top\": \"8px\", \"margin-top\": \"4px\" } };\nconst _hoisted_37 = { style: { \"display\": \"flex\", \"gap\": \"4px\", \"flex-wrap\": \"wrap\", \"margin-bottom\": \"6px\" } };\nconst _hoisted_38 = [\"disabled\"];\nconst _hoisted_39 = [\"disabled\"];\nconst _hoisted_40 = { style: { \"margin-bottom\": \"6px\" } };\nconst _hoisted_41 = [\"disabled\"];\nconst _hoisted_42 = {\n    key: 0,\n    style: { \"margin-top\": \"4px\" }\n};\nconst _hoisted_43 = [\"onKeydown\"];\nconst _hoisted_44 = { style: { \"max-height\": \"120px\", \"overflow-y\": \"auto\" } };\nconst _hoisted_45 = [\"disabled\", \"onClick\"];\nconst _hoisted_46 = {\n    key: 0,\n    style: { \"font-size\": \"11px\", \"opacity\": \"0.5\", \"padding\": \"4px\" }\n};\nconst _hoisted_47 = {\n    key: 0,\n    style: { \"display\": \"flex\", \"flex-wrap\": \"wrap\", \"gap\": \"4px\" }\n};\nconst _hoisted_48 = [\"onClick\"];\nconst _hoisted_49 = {\n    key: 0,\n    style: { \"font-size\": \"11px\", \"opacity\": \"0.5\" }\n};\nconst _hoisted_50 = {\n    key: 1,\n    style: { \"font-size\": \"11px\", \"opacity\": \"0.5\" }\n};\nconst _hoisted_51 = { class: \"mobile-entry-list\" };\nconst _hoisted_52 = [\"data-status\", \"onClick\"];\nconst _hoisted_53 = { class: \"entry-item-head\" };\nconst _hoisted_54 = [\"data-status\"];\nconst _hoisted_55 = { class: \"entry-item-title\" };\nconst _hoisted_56 = { class: \"entry-chip uid\" };\nconst _hoisted_57 = {\n    key: 0,\n    class: \"entry-item-keys\"\n};\nconst _hoisted_58 = { style: { \"display\": \"flex\", \"gap\": \"6px\", \"flex-wrap\": \"wrap\", \"margin-top\": \"4px\", \"font-size\": \"10px\", \"opacity\": \"0.8\" } };\nconst _hoisted_59 = { style: { \"background\": \"var(--wb-input-bg)\", \"padding\": \"2px 6px\", \"border-radius\": \"4px\" } };\nconst _hoisted_60 = { style: { \"background\": \"var(--wb-input-bg)\", \"padding\": \"2px 6px\", \"border-radius\": \"4px\" } };\nconst _hoisted_61 = {\n    key: 0,\n    style: { \"background\": \"var(--wb-input-bg)\", \"padding\": \"2px 6px\", \"border-radius\": \"4px\", \"color\": \"#f59e0b\" }\n};\nconst _hoisted_62 = {\n    key: 1,\n    style: { \"background\": \"var(--wb-input-bg)\", \"padding\": \"2px 6px\", \"border-radius\": \"4px\", \"color\": \"#f59e0b\" }\n};\nconst _hoisted_63 = {\n    key: 0,\n    class: \"empty-note\"\n};\nconst _hoisted_64 = { class: \"mobile-pane\" };\nconst _hoisted_65 = { class: \"editor-head\" };\nconst _hoisted_66 = { class: \"field editor-comment\" };\nconst _hoisted_67 = { class: \"editor-badges\" };\nconst _hoisted_68 = { class: \"editor-badge mono\" };\nconst _hoisted_69 = { class: \"editor-badge mono\" };\nconst _hoisted_70 = { class: \"editor-grid two-cols editor-keyword-grid\" };\nconst _hoisted_71 = { class: \"field\" };\nconst _hoisted_72 = { class: \"field\" };\nconst _hoisted_73 = {\n    key: 1,\n    class: \"empty-block\"\n};\nconst _hoisted_74 = { class: \"mobile-pane\" };\nconst _hoisted_75 = { class: \"editor-card\" };\nconst _hoisted_76 = { class: \"field checkbox-inline\" };\nconst _hoisted_77 = { class: \"strategy-switch\" };\nconst _hoisted_78 = { class: \"editor-advanced\" };\nconst _hoisted_79 = { class: \"field\" };\nconst _hoisted_80 = [\"value\"];\nconst _hoisted_81 = { class: \"field\" };\nconst _hoisted_82 = { class: \"field\" };\nconst _hoisted_83 = { class: \"editor-card\" };\nconst _hoisted_84 = { class: \"field\" };\nconst _hoisted_85 = [\"value\"];\nconst _hoisted_86 = { class: \"field\" };\nconst _hoisted_87 = { class: \"editor-grid two-cols\" };\nconst _hoisted_88 = [\"disabled\"];\nconst _hoisted_89 = [\"disabled\"];\nconst _hoisted_90 = { class: \"editor-card\" };\nconst _hoisted_91 = { class: \"field checkbox-inline\" };\nconst _hoisted_92 = { class: \"field checkbox-inline\" };\nconst _hoisted_93 = { class: \"editor-advanced\" };\nconst _hoisted_94 = { class: \"field\" };\nconst _hoisted_95 = {\n    key: 1,\n    class: \"empty-block\"\n};\nconst _hoisted_96 = { class: \"mobile-pane\" };\nconst _hoisted_97 = { class: \"ai-generator-panel mobile-ai-panel\" };\nconst _hoisted_98 = { class: \"ai-chat-area\" };\nconst _hoisted_99 = {\n    key: 0,\n    class: \"ai-chat-empty\"\n};\nconst _hoisted_100 = { class: \"ai-chat-bubble-role\" };\nconst _hoisted_101 = { class: \"ai-chat-bubble-content\" };\nconst _hoisted_102 = {\n    key: 0,\n    class: \"ai-chat-bubble assistant streaming\"\n};\nconst _hoisted_103 = { class: \"ai-chat-bubble-content\" };\nconst _hoisted_104 = {\n    key: 1,\n    class: \"ai-chat-bubble assistant streaming\"\n};\nconst _hoisted_105 = { class: \"ai-chat-input-bar\" };\nconst _hoisted_106 = {\n    class: \"ai-context-toggle\",\n    title: \"AI \"\n};\nconst _hoisted_107 = [\"disabled\", \"onKeydown\"];\nconst _hoisted_108 = [\"disabled\"];\nconst _hoisted_109 = { style: { \"display\": \"flex !important\", \"flex-shrink\": \"0\", \"height\": \"52px\", \"background\": \"#1e293b\", \"border-top\": \"1px solid #334155\", \"z-index\": \"99999\" } };\nconst _hoisted_110 = { class: \"wb-toolbar\" };\nconst _hoisted_111 = { class: \"toolbar-label\" };\nconst _hoisted_112 = [\"title\"];\nconst _hoisted_113 = { class: \"worldbook-picker-trigger-arrow\" };\nconst _hoisted_114 = {\n    key: 0,\n    class: \"worldbook-picker-dropdown\"\n};\nconst _hoisted_115 = { class: \"worldbook-picker-list\" };\nconst _hoisted_116 = [\"onClick\"];\nconst _hoisted_117 = {\n    key: 0,\n    class: \"empty-note\"\n};\nconst _hoisted_118 = [\"disabled\"];\nconst _hoisted_119 = [\"disabled\"];\nconst _hoisted_120 = [\"disabled\"];\nconst _hoisted_121 = { class: \"wb-scroll-area\" };\nconst _hoisted_122 = { class: \"wb-bindings\" };\nconst _hoisted_123 = { class: \"wb-history-shortcuts\" };\nconst _hoisted_124 = [\"disabled\"];\nconst _hoisted_125 = [\"disabled\"];\nconst _hoisted_126 = [\"disabled\"];\nconst _hoisted_127 = {\n    key: 0,\n    class: \"global-mode-panel\"\n};\nconst _hoisted_128 = { class: \"global-mode-head\" };\nconst _hoisted_129 = { class: \"global-mode-title\" };\nconst _hoisted_130 = [\"disabled\"];\nconst _hoisted_131 = { class: \"global-preset-panel\" };\nconst _hoisted_132 = { class: \"field\" };\nconst _hoisted_133 = [\"value\"];\nconst _hoisted_134 = { class: \"global-mode-actions\" };\nconst _hoisted_135 = [\"disabled\"];\nconst _hoisted_136 = [\"disabled\"];\nconst _hoisted_137 = [\"disabled\"];\nconst _hoisted_138 = { class: \"preset-role-panel\" };\nconst _hoisted_139 = { class: \"preset-role-head\" };\nconst _hoisted_140 = { class: \"preset-role-actions\" };\nconst _hoisted_141 = [\"disabled\"];\nconst _hoisted_142 = [\"disabled\"];\nconst _hoisted_143 = [\"disabled\"];\nconst _hoisted_144 = { class: \"role-picker-trigger-text\" };\nconst _hoisted_145 = { class: \"role-picker-trigger-arrow\" };\nconst _hoisted_146 = {\n    key: 0,\n    class: \"role-picker-dropdown\"\n};\nconst _hoisted_147 = [\"onKeydown\"];\nconst _hoisted_148 = { class: \"role-picker-list\" };\nconst _hoisted_149 = [\"disabled\", \"onClick\"];\nconst _hoisted_150 = { class: \"name\" };\nconst _hoisted_151 = { class: \"meta\" };\nconst _hoisted_152 = {\n    key: 0,\n    class: \"empty-note\"\n};\nconst _hoisted_153 = { class: \"preset-role-tags\" };\nconst _hoisted_154 = [\"title\", \"onClick\"];\nconst _hoisted_155 = {\n    key: 0,\n    class: \"empty-note\"\n};\nconst _hoisted_156 = {\n    key: 1,\n    class: \"empty-note\"\n};\nconst _hoisted_157 = { class: \"global-mode-grid\" };\nconst _hoisted_158 = { class: \"global-mode-column\" };\nconst _hoisted_159 = { class: \"field\" };\nconst _hoisted_160 = [\"onKeydown\"];\nconst _hoisted_161 = { class: \"global-mode-list\" };\nconst _hoisted_162 = [\"onClick\"];\nconst _hoisted_163 = { class: \"global-mode-item-name\" };\nconst _hoisted_164 = {\n    key: 0,\n    class: \"empty-note\"\n};\nconst _hoisted_165 = { class: \"global-mode-column\" };\nconst _hoisted_166 = { class: \"field\" };\nconst _hoisted_167 = { class: \"global-mode-list\" };\nconst _hoisted_168 = [\"onClick\"];\nconst _hoisted_169 = { class: \"global-mode-item-name\" };\nconst _hoisted_170 = {\n    key: 0,\n    class: \"empty-note\"\n};\nconst _hoisted_171 = { class: \"global-mode-actions\" };\nconst _hoisted_172 = [\"disabled\"];\nconst _hoisted_173 = {\n    key: 0,\n    class: \"ai-generator-panel\"\n};\nconst _hoisted_174 = { class: \"ai-sidebar\" };\nconst _hoisted_175 = { class: \"ai-session-list\" };\nconst _hoisted_176 = [\"onClick\"];\nconst _hoisted_177 = { class: \"ai-session-title\" };\nconst _hoisted_178 = { class: \"ai-session-meta\" };\nconst _hoisted_179 = [\"onClick\"];\nconst _hoisted_180 = {\n    key: 0,\n    class: \"empty-note\"\n};\nconst _hoisted_181 = { class: \"ai-chat-area\" };\nconst _hoisted_182 = {\n    key: 0,\n    class: \"ai-chat-empty\"\n};\nconst _hoisted_183 = { class: \"ai-chat-bubble-role\" };\nconst _hoisted_184 = { class: \"ai-chat-bubble-content\" };\nconst _hoisted_185 = {\n    key: 0,\n    class: \"ai-chat-bubble assistant streaming\"\n};\nconst _hoisted_186 = { class: \"ai-chat-bubble-content\" };\nconst _hoisted_187 = {\n    key: 1,\n    class: \"ai-chat-bubble assistant streaming\"\n};\nconst _hoisted_188 = { class: \"ai-chat-input-bar\" };\nconst _hoisted_189 = {\n    class: \"ai-context-toggle\",\n    title: \"AI \"\n};\nconst _hoisted_190 = [\"disabled\", \"onKeydown\"];\nconst _hoisted_191 = [\"disabled\"];\nconst _hoisted_192 = { class: \"ai-tag-review-modal\" };\nconst _hoisted_193 = { class: \"ai-tag-review-head\" };\nconst _hoisted_194 = { class: \"ai-tag-review-title\" };\nconst _hoisted_195 = { class: \"ai-tag-review-target\" };\nconst _hoisted_196 = { class: \"field\" };\nconst _hoisted_197 = [\"value\"];\nconst _hoisted_198 = { class: \"ai-tag-list\" };\nconst _hoisted_199 = [\"onUpdate:modelValue\"];\nconst _hoisted_200 = { class: \"ai-tag-info\" };\nconst _hoisted_201 = { class: \"ai-tag-name\" };\nconst _hoisted_202 = { class: \"ai-tag-preview\" };\nconst _hoisted_203 = { class: \"ai-tag-review-actions\" };\nconst _hoisted_204 = [\"disabled\"];\nconst _hoisted_205 = { class: \"wb-entry-list\" };\nconst _hoisted_206 = { class: \"list-search\" };\nconst _hoisted_207 = { class: \"checkbox-inline\" };\nconst _hoisted_208 = { class: \"list-summary\" };\nconst _hoisted_209 = { class: \"list-scroll\" };\nconst _hoisted_210 = [\"data-status\", \"onClick\"];\nconst _hoisted_211 = { class: \"entry-item-head\" };\nconst _hoisted_212 = [\"data-status\"];\nconst _hoisted_213 = { class: \"entry-item-title\" };\nconst _hoisted_214 = { class: \"entry-chip uid\" };\nconst _hoisted_215 = { class: \"entry-item-tags\" };\nconst _hoisted_216 = [\"data-status\"];\nconst _hoisted_217 = { class: \"entry-chip\" };\nconst _hoisted_218 = { class: \"entry-chip\" };\nconst _hoisted_219 = { class: \"entry-chip mono\" };\nconst _hoisted_220 = { class: \"entry-item-preview\" };\nconst _hoisted_221 = { class: \"list-actions\" };\nconst _hoisted_222 = [\"disabled\"];\nconst _hoisted_223 = [\"disabled\"];\nconst _hoisted_224 = [\"disabled\"];\nconst _hoisted_225 = [\"disabled\"];\nconst _hoisted_226 = [\"disabled\"];\nconst _hoisted_227 = { class: \"wb-editor\" };\nconst _hoisted_228 = { class: \"editor-center\" };\nconst _hoisted_229 = { class: \"editor-head\" };\nconst _hoisted_230 = { class: \"field editor-comment\" };\nconst _hoisted_231 = { class: \"editor-badges\" };\nconst _hoisted_232 = [\"data-status\"];\nconst _hoisted_233 = { class: \"editor-badge mono\" };\nconst _hoisted_234 = { class: \"editor-badge mono\" };\nconst _hoisted_235 = { class: \"editor-badge mono\" };\nconst _hoisted_236 = { class: \"editor-grid two-cols editor-keyword-grid\" };\nconst _hoisted_237 = { class: \"field\" };\nconst _hoisted_238 = { class: \"field\" };\nconst _hoisted_239 = { class: \"editor-content-block\" };\nconst _hoisted_240 = { class: \"editor-advanced\" };\nconst _hoisted_241 = { class: \"field\" };\nconst _hoisted_242 = { class: \"editor-side\" };\nconst _hoisted_243 = { class: \"editor-card\" };\nconst _hoisted_244 = { class: \"field checkbox-inline\" };\nconst _hoisted_245 = { class: \"strategy-switch\" };\nconst _hoisted_246 = { class: \"editor-advanced\" };\nconst _hoisted_247 = { class: \"field\" };\nconst _hoisted_248 = [\"value\"];\nconst _hoisted_249 = { class: \"field\" };\nconst _hoisted_250 = { class: \"field\" };\nconst _hoisted_251 = { class: \"editor-card\" };\nconst _hoisted_252 = { class: \"field\" };\nconst _hoisted_253 = [\"value\"];\nconst _hoisted_254 = { class: \"field\" };\nconst _hoisted_255 = { class: \"editor-grid two-cols\" };\nconst _hoisted_256 = [\"disabled\"];\nconst _hoisted_257 = [\"disabled\"];\nconst _hoisted_258 = { class: \"editor-card\" };\nconst _hoisted_259 = { class: \"field checkbox-inline\" };\nconst _hoisted_260 = { class: \"field checkbox-inline\" };\nconst _hoisted_261 = { class: \"field\" };\nconst _hoisted_262 = { class: \"editor-grid two-cols\" };\nconst _hoisted_263 = { class: \"field\" };\nconst _hoisted_264 = { class: \"field\" };\nconst _hoisted_265 = { class: \"field\" };\nconst _hoisted_266 = {\n    key: 1,\n    class: \"empty-block\"\n};\nconst _hoisted_267 = { class: \"wb-status\" };\nconst _hoisted_268 = { class: \"wb-history-modal\" };\nconst _hoisted_269 = { class: \"wb-history-modal-header\" };\nconst _hoisted_270 = { class: \"wb-history-modal-actions\" };\nconst _hoisted_271 = [\"disabled\"];\nconst _hoisted_272 = [\"disabled\"];\nconst _hoisted_273 = { class: \"wb-history-modal-main\" };\nconst _hoisted_274 = { class: \"wb-history-versions\" };\nconst _hoisted_275 = { class: \"wb-history-versions-scroll\" };\nconst _hoisted_276 = { class: \"wb-history-version-line\" };\nconst _hoisted_277 = { class: \"wb-history-lr\" };\nconst _hoisted_278 = [\"onClick\"];\nconst _hoisted_279 = [\"onClick\"];\nconst _hoisted_280 = {\n    key: 0,\n    class: \"empty-note\"\n};\nconst _hoisted_281 = { class: \"wb-history-diff-wrap\" };\nconst _hoisted_282 = { class: \"wb-history-diff-head\" };\nconst _hoisted_283 = [\"disabled\"];\nconst _hoisted_284 = { class: \"wb-history-diff-grid\" };\nconst _hoisted_285 = [\"innerHTML\"];\nconst _hoisted_286 = [\"innerHTML\"];\nconst _hoisted_287 = { class: \"wb-history-modal\" };\nconst _hoisted_288 = { class: \"wb-history-modal-header\" };\nconst _hoisted_289 = { class: \"wb-history-modal-actions\" };\nconst _hoisted_290 = [\"disabled\"];\nconst _hoisted_291 = [\"disabled\"];\nconst _hoisted_292 = { class: \"wb-history-modal-main\" };\nconst _hoisted_293 = { class: \"wb-history-versions\" };\nconst _hoisted_294 = { class: \"wb-history-versions-scroll\" };\nconst _hoisted_295 = { class: \"wb-history-version-line\" };\nconst _hoisted_296 = { class: \"wb-history-lr\" };\nconst _hoisted_297 = [\"onClick\"];\nconst _hoisted_298 = [\"onClick\"];\nconst _hoisted_299 = { class: \"wb-history-diff-wrap\" };\nconst _hoisted_300 = { class: \"wb-history-diff-head\" };\nconst _hoisted_301 = [\"disabled\"];\nconst _hoisted_302 = { class: \"wb-history-diff-grid\" };\nconst _hoisted_303 = [\"innerHTML\"];\nconst _hoisted_304 = [\"innerHTML\"];\nconst _hoisted_305 = { class: \"wb-floating-header-actions\" };\nconst _hoisted_306 = [\"disabled\"];\nconst _hoisted_307 = [\"disabled\"];\nconst _hoisted_308 = [\"disabled\"];\nconst _hoisted_309 = [\"disabled\"];\nconst _hoisted_310 = { class: \"wb-floating-body\" };\nconst _hoisted_311 = { class: \"tool-line stacked\" };\nconst _hoisted_312 = { class: \"find-scope-line\" };\nconst _hoisted_313 = { class: \"checkbox-inline\" };\nconst _hoisted_314 = { class: \"checkbox-inline\" };\nconst _hoisted_315 = [\"disabled\"];\nconst _hoisted_316 = { class: \"find-summary-text\" };\nconst _hoisted_317 = {\n    key: 0,\n    class: \"find-active-hit\"\n};\nconst _hoisted_318 = { class: \"batch-exclude-note\" };\nconst _hoisted_319 = {\n    key: 1,\n    class: \"batch-exclude-chips\"\n};\nconst _hoisted_320 = { class: \"find-flags\" };\nconst _hoisted_321 = { class: \"checkbox-inline\" };\nconst _hoisted_322 = { class: \"checkbox-inline\" };\nconst _hoisted_323 = { class: \"checkbox-inline\" };\nconst _hoisted_324 = { class: \"checkbox-inline\" };\nconst _hoisted_325 = { class: \"tool-details\" };\nconst _hoisted_326 = { class: \"tool-line\" };\nconst _hoisted_327 = [\"disabled\"];\nconst _hoisted_328 = [\"disabled\"];\nconst _hoisted_329 = { class: \"tool-line\" };\nconst _hoisted_330 = [\"disabled\"];\nconst _hoisted_331 = [\"disabled\"];\nconst _hoisted_332 = { class: \"wb-floating-header-actions\" };\nconst _hoisted_333 = [\"disabled\"];\nconst _hoisted_334 = { class: \"wb-floating-body\" };\nconst _hoisted_335 = { class: \"tool-scroll\" };\nconst _hoisted_336 = { class: \"activation-main\" };\nconst _hoisted_337 = { class: \"activation-sub\" };\nconst _hoisted_338 = {\n    key: 0,\n    class: \"empty-note\"\n};\nimport { diffLines } from 'https://testingcf.jsdelivr.net/npm/diff/+esm';\nimport { klona } from 'klona';\n\nimport { ref, reactive, computed, watch, nextTick, onMounted, onUnmounted } from 'vue';\nconst STORAGE_KEY = 'worldbook_assistant_state_v1';\nconst DIRTY_STATE_KEY = '__WB_ASSISTANT_HAS_UNSAVED_CHANGES__';\nconst HISTORY_LIMIT = 12;\nconst ENTRY_HISTORY_LIMIT = 7;\nconst ACTIVATION_LOG_LIMIT = 120;\nconst RESIZE_HANDLE_SIZE = 10;\nconst MAIN_PANE_MIN = 220;\nconst MAIN_EDITOR_MIN = 540;\nconst EDITOR_SIDE_MIN = 280;\nconst EDITOR_CENTER_MIN = 420;\nconst GLOBAL_PRESET_LIMIT = 64;\nconst AI_CHAT_SESSION_LIMIT = 50;\nconst AI_CHAT_MESSAGE_LIMIT = 200;\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'App',\n    setup(__props) {\n        const THEMES = {\n            ocean: {\n                name: 'Ocean (Deep)',\n                label: '',\n                colors: {\n                    '--wb-bg-root': '#0f172a',\n                    '--wb-bg-panel': '#1e293b',\n                    '--wb-text-main': '#f1f5f9',\n                    '--wb-text-muted': '#94a3b8',\n                    '--wb-primary': '#0ea5e9',\n                    '--wb-primary-light': '#38bdf8',\n                    '--wb-primary-hover': 'rgba(56, 189, 248, 0.15)',\n                    '--wb-primary-soft': 'rgba(14, 165, 233, 0.15)',\n                    '--wb-primary-glow': 'rgba(14, 165, 233, 0.4)',\n                    '--wb-input-bg': 'rgba(0, 0, 0, 0.25)',\n                    '--wb-input-bg-hover': 'rgba(0, 0, 0, 0.35)',\n                    '--wb-input-bg-focus': 'rgba(0, 0, 0, 0.45)',\n                    '--wb-border-subtle': 'rgba(255, 255, 255, 0.08)',\n                    '--wb-border-main': 'rgba(255, 255, 255, 0.12)',\n                    '--wb-shadow-main': '0 12px 28px rgba(0, 0, 0, 0.5)',\n                    '--wb-scrollbar-thumb': 'rgba(255, 255, 255, 0.2)',\n                },\n            },\n            nebula: {\n                name: 'Nebula (Dark)',\n                label: '',\n                colors: {\n                    '--wb-bg-root': '#170b25',\n                    '--wb-bg-panel': '#261836',\n                    '--wb-text-main': '#f3e8ff',\n                    '--wb-text-muted': '#a855f7',\n                    '--wb-primary': '#c084fc',\n                    '--wb-primary-light': '#d8b4fe',\n                    '--wb-primary-hover': 'rgba(192, 132, 252, 0.15)',\n                    '--wb-primary-soft': 'rgba(168, 85, 247, 0.15)',\n                    '--wb-primary-glow': 'rgba(192, 132, 252, 0.4)',\n                    '--wb-input-bg': 'rgba(0, 0, 0, 0.25)',\n                    '--wb-input-bg-hover': 'rgba(0, 0, 0, 0.35)',\n                    '--wb-input-bg-focus': 'rgba(0, 0, 0, 0.45)',\n                    '--wb-border-subtle': 'rgba(255, 255, 255, 0.08)',\n                    '--wb-border-main': 'rgba(255, 255, 255, 0.12)',\n                    '--wb-shadow-main': '0 12px 28px rgba(0, 0, 0, 0.5)',\n                    '--wb-scrollbar-thumb': 'rgba(255, 255, 255, 0.2)',\n                },\n            },\n            forest: {\n                name: 'Forest',\n                label: '',\n                colors: {\n                    '--wb-bg-root': '#051812',\n                    '--wb-bg-panel': '#0d2b21',\n                    '--wb-text-main': '#ecfdf5',\n                    '--wb-text-muted': '#34d399',\n                    '--wb-primary': '#10b981',\n                    '--wb-primary-light': '#34d399',\n                    '--wb-primary-hover': 'rgba(16, 185, 129, 0.15)',\n                    '--wb-primary-soft': 'rgba(5, 150, 105, 0.15)',\n                    '--wb-primary-glow': 'rgba(16, 185, 129, 0.4)',\n                    '--wb-input-bg': 'rgba(0, 0, 0, 0.25)',\n                    '--wb-input-bg-hover': 'rgba(0, 0, 0, 0.35)',\n                    '--wb-input-bg-focus': 'rgba(0, 0, 0, 0.45)',\n                    '--wb-border-subtle': 'rgba(255, 255, 255, 0.08)',\n                    '--wb-border-main': 'rgba(255, 255, 255, 0.12)',\n                    '--wb-shadow-main': '0 12px 28px rgba(0, 0, 0, 0.5)',\n                    '--wb-scrollbar-thumb': 'rgba(255, 255, 255, 0.2)',\n                },\n            },\n            sunset: {\n                name: 'Sunset',\n                label: '',\n                colors: {\n                    '--wb-bg-root': '#1a0f0f',\n                    '--wb-bg-panel': '#2e1818',\n                    '--wb-text-main': '#fff1f2',\n                    '--wb-text-muted': '#fb7185',\n                    '--wb-primary': '#fb923c',\n                    '--wb-primary-light': '#fdba74',\n                    '--wb-primary-hover': 'rgba(251, 146, 60, 0.15)',\n                    '--wb-primary-soft': 'rgba(234, 88, 12, 0.15)',\n                    '--wb-primary-glow': 'rgba(251, 146, 60, 0.4)',\n                    '--wb-input-bg': 'rgba(0, 0, 0, 0.25)',\n                    '--wb-input-bg-hover': 'rgba(0, 0, 0, 0.35)',\n                    '--wb-input-bg-focus': 'rgba(0, 0, 0, 0.45)',\n                    '--wb-border-subtle': 'rgba(255, 255, 255, 0.08)',\n                    '--wb-border-main': 'rgba(255, 255, 255, 0.12)',\n                    '--wb-shadow-main': '0 12px 28px rgba(0, 0, 0, 0.5)',\n                    '--wb-scrollbar-thumb': 'rgba(255, 255, 255, 0.2)',\n                },\n            },\n            coffee: {\n                name: 'Coffee',\n                label: '',\n                colors: {\n                    '--wb-bg-root': '#161009',\n                    '--wb-bg-panel': '#291e16',\n                    '--wb-text-main': '#fffbeb',\n                    '--wb-text-muted': '#d97706',\n                    '--wb-primary': '#fbbf24',\n                    '--wb-primary-light': '#fcd34d',\n                    '--wb-primary-hover': 'rgba(251, 191, 36, 0.15)',\n                    '--wb-primary-soft': 'rgba(217, 119, 6, 0.15)',\n                    '--wb-primary-glow': 'rgba(251, 191, 36, 0.4)',\n                    '--wb-input-bg': 'rgba(0, 0, 0, 0.25)',\n                    '--wb-input-bg-hover': 'rgba(0, 0, 0, 0.35)',\n                    '--wb-input-bg-focus': 'rgba(0, 0, 0, 0.45)',\n                    '--wb-border-subtle': 'rgba(255, 255, 255, 0.08)',\n                    '--wb-border-main': 'rgba(255, 255, 255, 0.12)',\n                    '--wb-shadow-main': '0 12px 28px rgba(0, 0, 0, 0.5)',\n                    '--wb-scrollbar-thumb': 'rgba(255, 255, 255, 0.2)',\n                },\n            },\n            paper: {\n                name: 'Paper (Light)',\n                label: '',\n                colors: {\n                    '--wb-bg-root': '#fbf9f5',\n                    '--wb-bg-panel': '#f0eadd',\n                    '--wb-text-main': '#4a3b32',\n                    '--wb-text-muted': '#8c7b70',\n                    '--wb-primary': '#d97706',\n                    '--wb-primary-light': '#b45309',\n                    '--wb-primary-hover': 'rgba(217, 119, 6, 0.1)',\n                    '--wb-primary-soft': 'rgba(180, 83, 9, 0.1)',\n                    '--wb-primary-glow': 'rgba(217, 119, 6, 0.25)',\n                    '--wb-input-bg': '#f7f3ec',\n                    '--wb-input-bg-hover': '#f2ece2',\n                    '--wb-input-bg-focus': '#ffffff',\n                    '--wb-border-subtle': 'rgba(74, 59, 50, 0.12)',\n                    '--wb-border-main': 'rgba(74, 59, 50, 0.2)',\n                    '--wb-shadow-main': '0 8px 24px rgba(74, 59, 50, 0.12)',\n                    '--wb-scrollbar-thumb': 'rgba(74, 59, 50, 0.25)',\n                },\n            },\n            snow: {\n                name: 'Snow (Light)',\n                label: '',\n                colors: {\n                    '--wb-bg-root': '#ffffff',\n                    '--wb-bg-panel': '#f4f4f5',\n                    '--wb-text-main': '#18181b',\n                    '--wb-text-muted': '#71717a',\n                    '--wb-primary': '#2563eb',\n                    '--wb-primary-light': '#3b82f6',\n                    '--wb-primary-hover': 'rgba(37, 99, 235, 0.1)',\n                    '--wb-primary-soft': 'rgba(37, 99, 235, 0.08)',\n                    '--wb-primary-glow': 'rgba(37, 99, 235, 0.25)',\n                    '--wb-input-bg': '#ffffff',\n                    '--wb-input-bg-hover': '#fafafa',\n                    '--wb-input-bg-focus': '#ffffff',\n                    '--wb-border-subtle': '#e4e4e7',\n                    '--wb-border-main': '#d4d4d8',\n                    '--wb-shadow-main': '0 12px 28px rgba(0, 0, 0, 0.08)',\n                    '--wb-scrollbar-thumb': '#a1a1aa',\n                },\n            },\n        };\n        const strategyTypeOptions = ['constant', 'selective', 'vectorized'];\n        const secondaryLogicOptions = ['and_any', 'and_all', 'not_all', 'not_any'];\n        const positionTypeOptions = [\n            'before_character_definition',\n            'after_character_definition',\n            'before_example_messages',\n            'after_example_messages',\n            'before_author_note',\n            'after_author_note',\n            'at_depth',\n        ];\n        const worldbookNames = ref([]);\n        const selectedWorldbookName = ref('');\n        const worldbookPickerOpen = ref(false);\n        const worldbookPickerSearchText = ref('');\n        const worldbookPickerRef = ref(null);\n        const worldbookPickerSearchInputRef = ref(null);\n        const rolePickerOpen = ref(false);\n        const rolePickerRef = ref(null);\n        const rolePickerSearchInputRef = ref(null);\n        const currentTheme = ref('ocean');\n        const themePickerOpen = ref(false);\n        const globalWorldbookMode = ref(false);\n        const aiGeneratorMode = ref(false);\n        const aiIsGenerating = ref(false);\n        const aiCurrentGenerationId = ref(null);\n        const aiStreamingText = ref('');\n        const aiExtractedTags = ref([]);\n        const aiShowTagReview = ref(false);\n        const aiTargetWorldbook = ref('');\n        const aiChatInputText = ref('');\n        const aiUseContext = ref(true);\n        const aiChatMessagesRef = ref(null);\n        const selectedGlobalPresetId = ref('');\n        const currentRoleContext = ref(null);\n        const roleBindingSourceCandidates = ref([]);\n        const originalEntries = ref([]);\n        const draftEntries = ref([]);\n        const selectedEntryUid = ref(null);\n        const searchText = ref('');\n        const onlyEnabled = ref(false);\n        const importFileInput = ref(null);\n        const selectedExtraText = ref('');\n        const globalAddSearchText = ref('');\n        const globalFilterText = ref('');\n        const roleBindSearchText = ref('');\n        const batchFindText = ref('');\n        const batchReplaceText = ref('');\n        const batchExcludeText = ref('');\n        const batchUseRegex = ref(false);\n        const batchInName = ref(true);\n        const batchInContent = ref(true);\n        const batchInKeys = ref(false);\n        const batchSearchScope = ref('all');\n        const findHits = ref([]);\n        const findHitIndex = ref(-1);\n        const statusMessage = ref('');\n        const isBusy = ref(false);\n        const isSaving = ref(false);\n        const showEntryHistoryModal = ref(false);\n        const showWorldbookHistoryModal = ref(false);\n        const entryHistoryLeftId = ref('');\n        const entryHistoryRightId = ref('');\n        const worldbookHistoryLeftId = ref('');\n        const worldbookHistoryRightId = ref('');\n        const floatingZCounter = ref(10005);\n        const floatingPanels = reactive({\n            find: { visible: false, x: 420, y: 170, z: 10006, width: 500 },\n            activation: { visible: false, x: 760, y: 230, z: 10008, width: 480 },\n        });\n        const activeFloatingDrag = ref(null);\n        const floatingPanelKeys = ['find', 'activation'];\n        const viewportWidth = ref(typeof window !== 'undefined' ? window.innerWidth : 1440);\n        const mainLayoutRef = ref(null);\n        const editorShellRef = ref(null);\n        const contentTextareaRef = ref(null);\n        const mainPaneWidth = ref(320);\n        const editorSideWidth = ref(360);\n        const paneResizeState = ref(null);\n        const hostResizeWindow = ref(null);\n        const screenWidth = ref(typeof window !== 'undefined' ? window.screen.width : 1440);\n        const screenHeight = ref(typeof window !== 'undefined' ? window.screen.height : 900);\n        const isMobile = computed(() => screenWidth.value < screenHeight.value);\n        // Keep screen dimensions in sync on orientation change\n        if (typeof window !== 'undefined') {\n            const syncScreenDims = () => {\n                screenWidth.value = window.screen.width;\n                screenHeight.value = window.screen.height;\n            };\n            window.addEventListener('orientationchange', () => setTimeout(syncScreenDims, 150));\n            window.addEventListener('resize', syncScreenDims);\n        }\n        const showMobileEditor = computed(() => isMobile.value && selectedEntryUid.value !== null);\n        const mobileTab = ref('list');\n        const bindings = reactive({\n            global: [],\n            charPrimary: null,\n            charAdditional: [],\n            chat: null,\n        });\n        const activationLogs = ref([]);\n        const persistedState = ref(createDefaultPersistedState());\n        const subscriptions = [];\n        const selectedEntry = computed(() => {\n            if (selectedEntryUid.value === null) {\n                return null;\n            }\n            return draftEntries.value.find(entry => entry.uid === selectedEntryUid.value) ?? null;\n        });\n        const selectedEntryIndex = computed(() => {\n            if (!selectedEntry.value) {\n                return -1;\n            }\n            return draftEntries.value.findIndex(entry => entry.uid === selectedEntry.value?.uid);\n        });\n        const filteredEntries = computed(() => {\n            const keyword = searchText.value.trim().toLowerCase();\n            return draftEntries.value.filter(entry => {\n                if (onlyEnabled.value && !entry.enabled) {\n                    return false;\n                }\n                if (!keyword) {\n                    return true;\n                }\n                const keysJoined = entry.strategy.keys.map(stringifyKeyword).join(' ').toLowerCase();\n                return (entry.name.toLowerCase().includes(keyword) ||\n                    entry.content.toLowerCase().includes(keyword) ||\n                    keysJoined.includes(keyword));\n            });\n        });\n        const enabledEntryCount = computed(() => draftEntries.value.filter(entry => entry.enabled).length);\n        const totalContentChars = computed(() => draftEntries.value.reduce((sum, entry) => {\n            return sum + entry.content.length;\n        }, 0));\n        const hasUnsavedChanges = computed(() => JSON.stringify(draftEntries.value) !== JSON.stringify(originalEntries.value));\n        const isCompactLayout = computed(() => viewportWidth.value <= 1100);\n        const mainLayoutStyle = computed(() => {\n            if (isMobile.value) {\n                return {\n                    display: 'block',\n                    height: 'auto',\n                    overflow: 'visible',\n                };\n            }\n            if (isCompactLayout.value) {\n                return undefined;\n            }\n            return {\n                gridTemplateColumns: `minmax(${MAIN_PANE_MIN}px, min(${mainPaneWidth.value}px, calc(100% - ${MAIN_EDITOR_MIN + RESIZE_HANDLE_SIZE}px))) ${RESIZE_HANDLE_SIZE}px minmax(0, 1fr)`,\n            };\n        });\n        const editorShellStyle = computed(() => {\n            if (isCompactLayout.value) {\n                return undefined;\n            }\n            return {\n                gridTemplateColumns: `minmax(0, 1fr) ${RESIZE_HANDLE_SIZE}px minmax(${EDITOR_SIDE_MIN}px, min(${editorSideWidth.value}px, calc(100% - ${EDITOR_CENTER_MIN + RESIZE_HANDLE_SIZE}px)))`,\n            };\n        });\n        const themeStyles = computed(() => {\n            return THEMES[currentTheme.value].colors;\n        });\n        const selectableWorldbookNames = computed(() => {\n            if (!globalWorldbookMode.value) {\n                return worldbookNames.value;\n            }\n            return bindings.global.filter(name => worldbookNames.value.includes(name));\n        });\n        const globalWorldbookPresets = computed(() => persistedState.value.global_presets ?? []);\n        const selectedGlobalPreset = computed(() => {\n            return globalWorldbookPresets.value.find(item => item.id === selectedGlobalPresetId.value) ?? null;\n        });\n        const selectedGlobalPresetRoleBindings = computed(() => selectedGlobalPreset.value?.role_bindings ?? []);\n        const isCurrentRoleBoundToSelectedPreset = computed(() => {\n            const role = currentRoleContext.value;\n            const preset = selectedGlobalPreset.value;\n            if (!role || !preset) {\n                return false;\n            }\n            return preset.role_bindings.some(item => item.key === role.key);\n        });\n        const roleBindingCandidates = computed(() => {\n            const keyword = roleBindSearchText.value.trim().toLowerCase();\n            const boundSet = new Set(selectedGlobalPresetRoleBindings.value.map(item => item.key));\n            const list = roleBindingSourceCandidates.value;\n            const filtered = keyword\n                ? list.filter(item => {\n                    return (item.name.toLowerCase().includes(keyword) ||\n                        item.avatar.toLowerCase().includes(keyword) ||\n                        item.key.toLowerCase().includes(keyword));\n                })\n                : list;\n            return filtered.map(item => ({\n                ...item,\n                bound: boundSet.has(item.key),\n            }));\n        });\n        const filteredSelectableWorldbookNames = computed(() => {\n            const keyword = worldbookPickerSearchText.value.trim().toLowerCase();\n            if (!keyword) {\n                return selectableWorldbookNames.value;\n            }\n            return selectableWorldbookNames.value.filter(name => name.toLowerCase().includes(keyword));\n        });\n        const globalAddCandidates = computed(() => {\n            const keyword = globalAddSearchText.value.trim().toLowerCase();\n            return worldbookNames.value.filter(name => {\n                if (bindings.global.includes(name)) {\n                    return false;\n                }\n                if (!keyword) {\n                    return true;\n                }\n                return name.toLowerCase().includes(keyword);\n            });\n        });\n        const filteredGlobalWorldbooks = computed(() => {\n            const keyword = globalFilterText.value.trim().toLowerCase();\n            if (!keyword) {\n                return bindings.global;\n            }\n            return bindings.global.filter(name => name.toLowerCase().includes(keyword));\n        });\n        const isGlobalBound = computed(() => {\n            if (!selectedWorldbookName.value) {\n                return false;\n            }\n            return bindings.global.includes(selectedWorldbookName.value);\n        });\n        const snapshotsForCurrent = computed(() => {\n            if (!selectedWorldbookName.value) {\n                return [];\n            }\n            return persistedState.value.history[selectedWorldbookName.value] ?? [];\n        });\n        const entrySnapshotsForSelected = computed(() => {\n            if (!selectedWorldbookName.value || !selectedEntry.value) {\n                return [];\n            }\n            const byWorldbook = persistedState.value.entry_history[selectedWorldbookName.value] ?? {};\n            return byWorldbook[String(selectedEntry.value.uid)] ?? [];\n        });\n        const entryVersionViews = computed(() => {\n            if (!selectedEntry.value) {\n                return [];\n            }\n            const baselineEntry = originalEntries.value.find(item => item.uid === selectedEntry.value?.uid) ?? null;\n            const current = {\n                id: '__current__',\n                label: '',\n                ts: Date.now(),\n                name: selectedEntry.value.name,\n                entry: selectedEntry.value,\n                isCurrent: true,\n            };\n            const baseline = baselineEntry\n                ? {\n                    id: '__baseline__',\n                    label: '',\n                    ts: 0,\n                    name: baselineEntry.name,\n                    entry: baselineEntry,\n                    isCurrent: false,\n                }\n                : null;\n            const history = entrySnapshotsForSelected.value.map(item => ({\n                id: item.id,\n                label: item.label,\n                ts: item.ts,\n                name: item.name,\n                entry: item.entry,\n                isCurrent: false,\n            }));\n            return [current, ...(baseline ? [baseline] : []), ...history];\n        });\n        const selectedEntryHistoryLeft = computed(() => {\n            return entryVersionViews.value.find(item => item.id === entryHistoryLeftId.value) ?? null;\n        });\n        const selectedEntryHistoryRight = computed(() => {\n            return entryVersionViews.value.find(item => item.id === entryHistoryRightId.value) ?? null;\n        });\n        const canRestoreEntryFromLeft = computed(() => {\n            return Boolean(selectedEntry.value && selectedEntryHistoryLeft.value && !selectedEntryHistoryLeft.value.isCurrent);\n        });\n        const worldbookVersionViews = computed(() => {\n            if (!selectedWorldbookName.value) {\n                return [];\n            }\n            const current = {\n                id: '__current__',\n                label: '',\n                ts: Date.now(),\n                entries: draftEntries.value,\n                isCurrent: true,\n            };\n            const baseline = {\n                id: '__baseline__',\n                label: '',\n                ts: 0,\n                entries: originalEntries.value,\n                isCurrent: false,\n            };\n            const history = snapshotsForCurrent.value.map(item => ({\n                id: item.id,\n                label: item.label,\n                ts: item.ts,\n                entries: item.entries,\n                isCurrent: false,\n            }));\n            return [current, ...(originalEntries.value.length ? [baseline] : []), ...history];\n        });\n        const selectedWorldbookHistoryLeft = computed(() => {\n            return worldbookVersionViews.value.find(item => item.id === worldbookHistoryLeftId.value) ?? null;\n        });\n        const selectedWorldbookHistoryRight = computed(() => {\n            return worldbookVersionViews.value.find(item => item.id === worldbookHistoryRightId.value) ?? null;\n        });\n        const canRestoreWorldbookFromLeft = computed(() => {\n            return Boolean(selectedWorldbookHistoryLeft.value && !selectedWorldbookHistoryLeft.value.isCurrent);\n        });\n        const batchExcludeTokensPreview = computed(() => parseBatchExcludeTokens(batchExcludeText.value));\n        const activeFindHit = computed(() => {\n            if (findHitIndex.value < 0 || findHitIndex.value >= findHits.value.length) {\n                return null;\n            }\n            return findHits.value[findHitIndex.value] ?? null;\n        });\n        const findHitSummaryText = computed(() => {\n            if (!batchFindText.value.trim()) {\n                return '';\n            }\n            if (!findHits.value.length) {\n                return '';\n            }\n            if (!activeFindHit.value) {\n                return ` 0 / ${findHits.value.length}`;\n            }\n            return ` ${findHitIndex.value + 1} / ${findHits.value.length}`;\n        });\n        const entryHistoryDiff = computed(() => {\n            return buildDiffHtml(serializeEntryVersionForDiff(selectedEntryHistoryLeft.value), serializeEntryVersionForDiff(selectedEntryHistoryRight.value));\n        });\n        const entryHistorySummary = computed(() => {\n            return getEntryVersionDiffSummary(selectedEntryHistoryLeft.value, selectedEntryHistoryRight.value);\n        });\n        const worldbookHistoryDiff = computed(() => {\n            return buildDiffHtml(serializeWorldbookVersionForDiff(selectedWorldbookHistoryLeft.value), serializeWorldbookVersionForDiff(selectedWorldbookHistoryRight.value));\n        });\n        const selectedKeysText = computed({\n            get: () => {\n                if (!selectedEntry.value) {\n                    return '';\n                }\n                return selectedEntry.value.strategy.keys.map(stringifyKeyword).join(', ');\n            },\n            set: (value) => {\n                if (!selectedEntry.value) {\n                    return;\n                }\n                selectedEntry.value.strategy.keys = parseKeywordsFromText(value);\n            },\n        });\n        const selectedSecondaryKeysText = computed({\n            get: () => {\n                if (!selectedEntry.value) {\n                    return '';\n                }\n                return selectedEntry.value.strategy.keys_secondary.keys.map(stringifyKeyword).join(', ');\n            },\n            set: (value) => {\n                if (!selectedEntry.value) {\n                    return;\n                }\n                selectedEntry.value.strategy.keys_secondary.keys = parseKeywordsFromText(value);\n            },\n        });\n        const selectedScanDepthText = computed({\n            get: () => {\n                if (!selectedEntry.value) {\n                    return '';\n                }\n                const depth = selectedEntry.value.strategy.scan_depth;\n                return typeof depth === 'number' ? String(depth) : 'same_as_global';\n            },\n            set: (value) => {\n                if (!selectedEntry.value) {\n                    return;\n                }\n                selectedEntry.value.strategy.scan_depth = normalizeScanDepth(value);\n            },\n        });\n        const selectedRecursionDelayText = computed({\n            get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.recursion.delay_until) : ''),\n            set: (value) => {\n                if (!selectedEntry.value) {\n                    return;\n                }\n                selectedEntry.value.recursion.delay_until = parseNullableInteger(value);\n            },\n        });\n        const selectedStickyText = computed({\n            get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.effect.sticky) : ''),\n            set: (value) => {\n                if (!selectedEntry.value) {\n                    return;\n                }\n                selectedEntry.value.effect.sticky = parseNullableInteger(value);\n            },\n        });\n        const selectedCooldownText = computed({\n            get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.effect.cooldown) : ''),\n            set: (value) => {\n                if (!selectedEntry.value) {\n                    return;\n                }\n                selectedEntry.value.effect.cooldown = parseNullableInteger(value);\n            },\n        });\n        const selectedEffectDelayText = computed({\n            get: () => (selectedEntry.value ? nullableNumberToText(selectedEntry.value.effect.delay) : ''),\n            set: (value) => {\n                if (!selectedEntry.value) {\n                    return;\n                }\n                selectedEntry.value.effect.delay = parseNullableInteger(value);\n            },\n        });\n        const selectedContentChars = computed(() => {\n            return selectedEntry.value?.content.length ?? 0;\n        });\n        const selectedTokenEstimate = computed(() => {\n            const chars = selectedContentChars.value;\n            if (chars <= 0) {\n                return 0;\n            }\n            return Math.max(1, Math.round(chars / 3.6));\n        });\n        watch(selectedWorldbookName, name => {\n            closeWorldbookPicker();\n            if (!name) {\n                draftEntries.value = [];\n                originalEntries.value = [];\n                selectedEntryUid.value = null;\n                return;\n            }\n            updatePersistedState(state => {\n                state.last_worldbook = name;\n            });\n            void loadWorldbook(name);\n        });\n        watch(() => selectedEntryUid.value, () => {\n            syncExtraTextWithSelection();\n        });\n        watch([\n            batchFindText,\n            batchReplaceText,\n            batchExcludeText,\n            batchUseRegex,\n            batchInName,\n            batchInContent,\n            batchInKeys,\n            batchSearchScope,\n        ], () => {\n            resetFindState();\n        });\n        watch(entryVersionViews, views => {\n            if (!views.length) {\n                entryHistoryLeftId.value = '';\n                entryHistoryRightId.value = '';\n                return;\n            }\n            const ids = new Set(views.map(item => item.id));\n            if (!ids.has(entryHistoryRightId.value)) {\n                entryHistoryRightId.value = '__current__';\n            }\n            if (!ids.has(entryHistoryLeftId.value)) {\n                const fallback = views.find(item => !item.isCurrent) ?? views[0];\n                entryHistoryLeftId.value = fallback.id;\n            }\n            if (entryHistoryLeftId.value === entryHistoryRightId.value && views.length > 1) {\n                const fallback = views.find(item => item.id !== entryHistoryRightId.value);\n                if (fallback) {\n                    entryHistoryLeftId.value = fallback.id;\n                }\n            }\n        }, { immediate: true });\n        watch(worldbookVersionViews, views => {\n            if (!views.length) {\n                worldbookHistoryLeftId.value = '';\n                worldbookHistoryRightId.value = '';\n                return;\n            }\n            const ids = new Set(views.map(item => item.id));\n            if (!ids.has(worldbookHistoryRightId.value)) {\n                worldbookHistoryRightId.value = '__current__';\n            }\n            if (!ids.has(worldbookHistoryLeftId.value)) {\n                const fallback = views.find(item => !item.isCurrent) ?? views[0];\n                worldbookHistoryLeftId.value = fallback.id;\n            }\n            if (worldbookHistoryLeftId.value === worldbookHistoryRightId.value && views.length > 1) {\n                const fallback = views.find(item => item.id !== worldbookHistoryRightId.value);\n                if (fallback) {\n                    worldbookHistoryLeftId.value = fallback.id;\n                }\n            }\n        }, { immediate: true });\n        watch(() => selectedEntry.value?.position.type, () => {\n            if (!selectedEntry.value) {\n                return;\n            }\n            if (selectedEntry.value.position.type !== 'at_depth') {\n                selectedEntry.value.position.role = 'system';\n                selectedEntry.value.position.depth = 4;\n            }\n        });\n        watch(hasUnsavedChanges, dirty => {\n            const target = window;\n            target[DIRTY_STATE_KEY] = dirty;\n        }, { immediate: true });\n        function createId(prefix) {\n            return `${prefix}-${Date.now().toString(36)}-${Math.random().toString(36).slice(2, 9)}`;\n        }\n        function asRecord(value) {\n            if (value && typeof value === 'object' && !Array.isArray(value)) {\n                return value;\n            }\n            return null;\n        }\n        function toStringSafe(value, fallback = '') {\n            if (typeof value === 'string') {\n                return value;\n            }\n            if (value === null || value === undefined) {\n                return fallback;\n            }\n            return String(value);\n        }\n        function toNumberSafe(value, fallback) {\n            if (typeof value === 'number' && Number.isFinite(value)) {\n                return value;\n            }\n            if (typeof value === 'string' && value.trim()) {\n                const parsed = Number(value);\n                if (Number.isFinite(parsed)) {\n                    return parsed;\n                }\n            }\n            return fallback;\n        }\n        function clampNumber(value, min, max) {\n            return Math.min(max, Math.max(min, value));\n        }\n        function parseNullableInteger(value) {\n            if (value === null || value === undefined) {\n                return null;\n            }\n            if (typeof value === 'string' && !value.trim()) {\n                return null;\n            }\n            const parsed = Number(value);\n            if (!Number.isFinite(parsed)) {\n                return null;\n            }\n            return Math.max(0, Math.floor(parsed));\n        }\n        function nullableNumberToText(value) {\n            return value === null ? '' : String(value);\n        }\n        function stringifyKeyword(value) {\n            return value instanceof RegExp ? value.toString() : value;\n        }\n        function parseKeywordToken(token) {\n            const trimmed = token.trim();\n            if (!trimmed) {\n                return '';\n            }\n            const regexMatch = trimmed.match(/^\\/(.+)\\/([dgimsuy]*)$/);\n            if (!regexMatch) {\n                return trimmed;\n            }\n            try {\n                return new RegExp(regexMatch[1], regexMatch[2]);\n            }\n            catch {\n                return trimmed;\n            }\n        }\n        function normalizeKeywordList(value) {\n            const sourceList = Array.isArray(value) ? value : typeof value === 'string' ? value.split(/[\\n,]/g) : [];\n            const normalized = [];\n            const seen = new Set();\n            for (const item of sourceList) {\n                const token = item instanceof RegExp ? item : parseKeywordToken(toStringSafe(item).trim());\n                const tokenString = stringifyKeyword(token);\n                if (!tokenString) {\n                    continue;\n                }\n                const dedupeKey = tokenString.toLowerCase();\n                if (seen.has(dedupeKey)) {\n                    continue;\n                }\n                seen.add(dedupeKey);\n                normalized.push(token);\n            }\n            return normalized;\n        }\n        function parseKeywordsFromText(value) {\n            return normalizeKeywordList(value.split(/[\\n,]/g));\n        }\n        function normalizePresetRoleBindings(rawList) {\n            if (!Array.isArray(rawList)) {\n                return [];\n            }\n            const normalized = [];\n            const seen = new Set();\n            for (const item of rawList) {\n                const record = asRecord(item);\n                if (!record) {\n                    continue;\n                }\n                const key = toStringSafe(record.key).trim();\n                if (!key || seen.has(key)) {\n                    continue;\n                }\n                seen.add(key);\n                normalized.push({\n                    key,\n                    name: toStringSafe(record.name, key),\n                    avatar: toStringSafe(record.avatar),\n                    updated_at: toNumberSafe(record.updated_at, Date.now()),\n                });\n            }\n            return normalized;\n        }\n        function getStrategyTypeLabel(type) {\n            if (type === 'constant') {\n                return '  (constant)';\n            }\n            if (type === 'vectorized') {\n                return '  (vectorized)';\n            }\n            return '  (selective)';\n        }\n        function getSecondaryLogicLabel(logic) {\n            const map = {\n                and_any: ' (and_any)',\n                and_all: ' (and_all)',\n                not_all: ' (not_all)',\n                not_any: ' (not_any)',\n            };\n            return map[logic];\n        }\n        function getPositionTypeLabel(type) {\n            const map = {\n                before_character_definition: '',\n                after_character_definition: '',\n                before_example_messages: '',\n                after_example_messages: '',\n                before_author_note: '',\n                after_author_note: '',\n                at_depth: '',\n            };\n            return map[type];\n        }\n        function getEntryVisualStatus(entry) {\n            if (!entry.enabled) {\n                return 'disabled';\n            }\n            if (entry.strategy.type === 'constant') {\n                return 'constant';\n            }\n            if (entry.strategy.type === 'vectorized') {\n                return 'vector';\n            }\n            return 'normal';\n        }\n        function getEntryStatusLabel(entry) {\n            const status = getEntryVisualStatus(entry);\n            if (status === 'disabled') {\n                return ' ';\n            }\n            if (status === 'constant') {\n                return ' ';\n            }\n            if (status === 'vector') {\n                return ' ';\n            }\n            return ' ';\n        }\n        function getEntryKeyPreview(entry) {\n            const rendered = entry.strategy.keys\n                .slice(0, 3)\n                .map(key => stringifyKeyword(key))\n                .join(' / ');\n            if (!rendered) {\n                return '';\n            }\n            if (entry.strategy.keys.length > 3) {\n                return `${rendered} ...`;\n            }\n            return rendered;\n        }\n        function normalizeSecondaryLogic(value) {\n            if (typeof value === 'string' && secondaryLogicOptions.includes(value)) {\n                return value;\n            }\n            if (typeof value === 'number') {\n                const map = ['and_any', 'and_all', 'not_all', 'not_any'];\n                return map[value] ?? 'and_any';\n            }\n            return 'and_any';\n        }\n        function normalizeStrategyType(raw, strategyRecord) {\n            const directType = strategyRecord?.type;\n            if (typeof directType === 'string' && strategyTypeOptions.includes(directType)) {\n                return directType;\n            }\n            if (raw.constant) {\n                return 'constant';\n            }\n            if (raw.vectorized) {\n                return 'vectorized';\n            }\n            return 'selective';\n        }\n        function normalizePositionType(value) {\n            if (typeof value === 'string') {\n                if (positionTypeOptions.includes(value)) {\n                    return value;\n                }\n                const depthMatch = value.match(/^at_depth_as_(system|assistant|user)$/);\n                if (depthMatch) {\n                    return 'at_depth';\n                }\n            }\n            if (typeof value === 'number') {\n                const map = {\n                    0: 'before_character_definition',\n                    1: 'after_character_definition',\n                    2: 'before_example_messages',\n                    3: 'after_example_messages',\n                    4: 'before_author_note',\n                    5: 'after_author_note',\n                    6: 'at_depth',\n                };\n                return map[value] ?? 'after_character_definition';\n            }\n            return 'after_character_definition';\n        }\n        function normalizeRole(value) {\n            if (value === 'assistant' || value === 'user' || value === 'system') {\n                return value;\n            }\n            if (typeof value === 'number') {\n                const map = {\n                    0: 'system',\n                    1: 'assistant',\n                    2: 'user',\n                };\n                return map[value] ?? 'system';\n            }\n            if (typeof value === 'string') {\n                if (value.includes('assistant')) {\n                    return 'assistant';\n                }\n                if (value.includes('user')) {\n                    return 'user';\n                }\n            }\n            return 'system';\n        }\n        function normalizeScanDepth(value) {\n            if (value === 'same_as_global') {\n                return 'same_as_global';\n            }\n            const numeric = Math.floor(toNumberSafe(value, NaN));\n            if (Number.isFinite(numeric) && numeric > 0) {\n                return numeric;\n            }\n            return 'same_as_global';\n        }\n        function createDefaultEntry(uid) {\n            return {\n                uid,\n                name: ` ${uid}`,\n                enabled: true,\n                strategy: {\n                    type: 'selective',\n                    keys: [],\n                    keys_secondary: {\n                        logic: 'and_any',\n                        keys: [],\n                    },\n                    scan_depth: 'same_as_global',\n                },\n                position: {\n                    type: 'after_character_definition',\n                    role: 'system',\n                    depth: 4,\n                    order: 100,\n                },\n                content: '',\n                probability: 100,\n                recursion: {\n                    prevent_incoming: false,\n                    prevent_outgoing: false,\n                    delay_until: null,\n                },\n                effect: {\n                    sticky: null,\n                    cooldown: null,\n                    delay: null,\n                },\n            };\n        }\n        function collectExtraFields(raw) {\n            const known = new Set([\n                'uid',\n                'id',\n                'name',\n                'comment',\n                'enabled',\n                'disable',\n                'strategy',\n                'position',\n                'content',\n                'probability',\n                'recursion',\n                'effect',\n                'extra',\n                'keys',\n                'key',\n                'secondary_keys',\n                'keysecondary',\n                'filters',\n                'logic',\n                'selectiveLogic',\n                'scan_depth',\n                'constant',\n                'vectorized',\n                'selective',\n                'insertion_order',\n                'order',\n                'role',\n                'depth',\n                'preventRecursion',\n                'excludeRecursion',\n                'delayUntilRecursion',\n                'sticky',\n                'cooldown',\n                'delay',\n                'useProbability',\n            ]);\n            const extra = {};\n            for (const [key, value] of Object.entries(raw)) {\n                if (!known.has(key)) {\n                    extra[key] = value;\n                }\n            }\n            if (Object.keys(extra).length === 0) {\n                return undefined;\n            }\n            return extra;\n        }\n        function normalizeEntry(rawInput, fallbackUid) {\n            const raw = asRecord(rawInput) ?? {};\n            const base = createDefaultEntry(fallbackUid);\n            const strategyRecord = asRecord(raw.strategy);\n            const positionRecord = asRecord(raw.position);\n            const recursionRecord = asRecord(raw.recursion);\n            const effectRecord = asRecord(raw.effect);\n            const secondaryRecord = asRecord(strategyRecord?.keys_secondary);\n            const uid = Math.max(0, Math.floor(toNumberSafe(raw.uid ?? raw.id, fallbackUid)));\n            const name = toStringSafe(raw.name ?? raw.comment, ` ${uid}`).trim() || ` ${uid}`;\n            const strategyType = normalizeStrategyType(raw, strategyRecord);\n            const keys = normalizeKeywordList(strategyRecord?.keys ?? raw.keys ?? raw.key);\n            const secondaryKeys = normalizeKeywordList(secondaryRecord?.keys ?? raw.secondary_keys ?? raw.keysecondary ?? raw.filters);\n            const secondaryLogic = normalizeSecondaryLogic(secondaryRecord?.logic ?? raw.logic ?? raw.selectiveLogic);\n            const positionType = normalizePositionType(positionRecord?.type ?? raw.position);\n            const role = normalizeRole(positionRecord?.role ?? raw.role);\n            const depth = Math.max(1, Math.floor(toNumberSafe(positionRecord?.depth ?? raw.depth, 4)));\n            const order = Math.floor(toNumberSafe(positionRecord?.order ?? raw.insertion_order ?? raw.order, 100));\n            const probability = clampNumber(toNumberSafe(raw.probability, 100), 0, 100);\n            const preventIncoming = recursionRecord?.prevent_incoming ?? raw.preventRecursion;\n            const preventOutgoing = recursionRecord?.prevent_outgoing ?? raw.excludeRecursion;\n            const entry = {\n                ...base,\n                uid,\n                name,\n                enabled: raw.enabled === undefined ? !Boolean(raw.disable) : Boolean(raw.enabled),\n                strategy: {\n                    type: strategyType,\n                    keys,\n                    keys_secondary: {\n                        logic: secondaryLogic,\n                        keys: secondaryKeys,\n                    },\n                    scan_depth: normalizeScanDepth(strategyRecord?.scan_depth ?? raw.scan_depth),\n                },\n                position: {\n                    type: positionType,\n                    role: positionType === 'at_depth' ? role : 'system',\n                    depth: positionType === 'at_depth' ? depth : 4,\n                    order,\n                },\n                content: toStringSafe(raw.content),\n                probability,\n                recursion: {\n                    prevent_incoming: Boolean(preventIncoming),\n                    prevent_outgoing: Boolean(preventOutgoing),\n                    delay_until: parseNullableInteger(recursionRecord?.delay_until ?? raw.delayUntilRecursion),\n                },\n                effect: {\n                    sticky: parseNullableInteger(effectRecord?.sticky ?? raw.sticky),\n                    cooldown: parseNullableInteger(effectRecord?.cooldown ?? raw.cooldown),\n                    delay: parseNullableInteger(effectRecord?.delay ?? raw.delay),\n                },\n            };\n            const directExtra = asRecord(raw.extra);\n            if (directExtra && Object.keys(directExtra).length > 0) {\n                entry.extra = klona(directExtra);\n            }\n            else {\n                const extras = collectExtraFields(raw);\n                if (extras) {\n                    entry.extra = klona(extras);\n                }\n            }\n            return entry;\n        }\n        function normalizeEntryList(rawEntries) {\n            const result = [];\n            const uidSet = new Set();\n            for (let index = 0; index < rawEntries.length; index += 1) {\n                const rawRecord = asRecord(rawEntries[index]);\n                let uid = Math.max(0, Math.floor(toNumberSafe(rawRecord?.uid ?? rawRecord?.id, index)));\n                while (uidSet.has(uid)) {\n                    uid += 1;\n                }\n                uidSet.add(uid);\n                result.push(normalizeEntry(rawEntries[index], uid));\n            }\n            return result;\n        }\n        function getNextUid(entries) {\n            if (entries.length === 0) {\n                return 0;\n            }\n            return Math.max(...entries.map(entry => entry.uid)) + 1;\n        }\n        function createDefaultPersistedState() {\n            return {\n                last_worldbook: '',\n                history: {},\n                entry_history: {},\n                global_presets: [],\n                last_global_preset_id: '',\n                role_override_baseline: null,\n                theme: 'ocean',\n                ai_chat: { sessions: [], activeSessionId: null },\n            };\n        }\n        function normalizePersistedState(input) {\n            const root = asRecord(input);\n            if (!root) {\n                return createDefaultPersistedState();\n            }\n            const historyRoot = asRecord(root.history) ?? {};\n            const history = {};\n            for (const [name, rawSnapshots] of Object.entries(historyRoot)) {\n                if (!Array.isArray(rawSnapshots)) {\n                    continue;\n                }\n                history[name] = rawSnapshots\n                    .map(item => {\n                    const record = asRecord(item);\n                    if (!record) {\n                        return null;\n                    }\n                    const entriesRaw = Array.isArray(record.entries) ? record.entries : [];\n                    return {\n                        id: toStringSafe(record.id, createId('snapshot')),\n                        label: toStringSafe(record.label, ''),\n                        ts: toNumberSafe(record.ts, Date.now()),\n                        entries: normalizeEntryList(entriesRaw),\n                    };\n                })\n                    .filter((item) => item !== null)\n                    .slice(0, HISTORY_LIMIT);\n            }\n            const entryHistoryRoot = asRecord(root.entry_history) ?? {};\n            const entryHistory = {};\n            for (const [worldbookName, rawByUid] of Object.entries(entryHistoryRoot)) {\n                const uidRecord = asRecord(rawByUid);\n                if (!uidRecord) {\n                    continue;\n                }\n                const normalizedByUid = {};\n                for (const [uidKey, rawItems] of Object.entries(uidRecord)) {\n                    if (!Array.isArray(rawItems)) {\n                        continue;\n                    }\n                    const uidNumber = Math.max(0, Math.floor(toNumberSafe(uidKey, 0)));\n                    normalizedByUid[uidKey] = rawItems\n                        .map(item => {\n                        const record = asRecord(item);\n                        if (!record) {\n                            return null;\n                        }\n                        return {\n                            id: toStringSafe(record.id, createId('entry-snapshot')),\n                            label: toStringSafe(record.label, ''),\n                            ts: toNumberSafe(record.ts, Date.now()),\n                            uid: uidNumber,\n                            name: toStringSafe(record.name, ` ${uidNumber}`),\n                            entry: normalizeEntry(record.entry, uidNumber),\n                        };\n                    })\n                        .filter((item) => item !== null)\n                        .slice(0, ENTRY_HISTORY_LIMIT);\n                }\n                if (Object.keys(normalizedByUid).length > 0) {\n                    entryHistory[worldbookName] = normalizedByUid;\n                }\n            }\n            const globalPresetsRaw = Array.isArray(root.global_presets) ? root.global_presets : [];\n            const globalPresets = globalPresetsRaw\n                .map(item => {\n                const record = asRecord(item);\n                if (!record) {\n                    return null;\n                }\n                const worldbooksRaw = Array.isArray(record.worldbooks) ? record.worldbooks : [];\n                const worldbooks = [...new Set(worldbooksRaw.map(name => toStringSafe(name).trim()).filter(Boolean))];\n                const roleBindings = normalizePresetRoleBindings(record.role_bindings);\n                return {\n                    id: toStringSafe(record.id, createId('global-preset')),\n                    name: toStringSafe(record.name, ''),\n                    worldbooks,\n                    role_bindings: roleBindings,\n                    updated_at: toNumberSafe(record.updated_at, Date.now()),\n                };\n            })\n                .filter((item) => item !== null)\n                .slice(0, GLOBAL_PRESET_LIMIT);\n            const rawBaseline = asRecord(root.role_override_baseline);\n            let roleOverrideBaseline = null;\n            if (rawBaseline) {\n                const baselineWorldbooks = Array.isArray(rawBaseline.worldbooks)\n                    ? rawBaseline.worldbooks.map(name => toStringSafe(name).trim()).filter(Boolean)\n                    : [];\n                roleOverrideBaseline = {\n                    preset_id: toStringSafe(rawBaseline.preset_id),\n                    worldbooks: [...new Set(baselineWorldbooks)],\n                };\n            }\n            const aiChatRaw = asRecord(root.ai_chat);\n            const aiChat = { sessions: [], activeSessionId: null };\n            if (aiChatRaw) {\n                aiChat.activeSessionId = toStringSafe(aiChatRaw.activeSessionId) || null;\n                if (Array.isArray(aiChatRaw.sessions)) {\n                    aiChat.sessions = aiChatRaw.sessions\n                        .map((s) => {\n                        const sr = asRecord(s);\n                        if (!sr)\n                            return null;\n                        const msgs = Array.isArray(sr.messages)\n                            ? sr.messages.map((m) => {\n                                const mr = asRecord(m);\n                                if (!mr)\n                                    return null;\n                                return {\n                                    role: mr.role === 'assistant' ? 'assistant' : 'user',\n                                    content: toStringSafe(mr.content),\n                                    timestamp: toNumberSafe(mr.timestamp, Date.now()),\n                                };\n                            }).filter((m) => m !== null)\n                            : [];\n                        return {\n                            id: toStringSafe(sr.id, createId('ai-chat')),\n                            title: toStringSafe(sr.title, ''),\n                            createdAt: toNumberSafe(sr.createdAt, Date.now()),\n                            messages: msgs.slice(0, AI_CHAT_MESSAGE_LIMIT),\n                        };\n                    })\n                        .filter((s) => s !== null)\n                        .slice(0, AI_CHAT_SESSION_LIMIT);\n                }\n            }\n            return {\n                last_worldbook: toStringSafe(root.last_worldbook),\n                history,\n                entry_history: entryHistory,\n                global_presets: globalPresets,\n                last_global_preset_id: toStringSafe(root.last_global_preset_id),\n                role_override_baseline: roleOverrideBaseline,\n                theme: toStringSafe(root.theme) || 'ocean',\n                ai_chat: aiChat,\n            };\n        }\n        function readPersistedState() {\n            const vars = getVariables({ type: 'script', script_id: getScriptId() });\n            return normalizePersistedState(vars[STORAGE_KEY]);\n        }\n        function syncSelectedGlobalPresetFromState() {\n            const presets = persistedState.value.global_presets;\n            const byId = new Set(presets.map(item => item.id));\n            const preferredId = persistedState.value.last_global_preset_id;\n            if (preferredId && byId.has(preferredId)) {\n                selectedGlobalPresetId.value = preferredId;\n                return;\n            }\n            if (selectedGlobalPresetId.value && byId.has(selectedGlobalPresetId.value)) {\n                return;\n            }\n            selectedGlobalPresetId.value = '';\n        }\n        function writePersistedState(state) {\n            const vars = getVariables({ type: 'script', script_id: getScriptId() });\n            vars[STORAGE_KEY] = state;\n            replaceVariables(vars, { type: 'script', script_id: getScriptId() });\n            persistedState.value = state;\n            syncSelectedGlobalPresetFromState();\n        }\n        function updatePersistedState(mutator) {\n            const state = readPersistedState();\n            mutator(state);\n            writePersistedState(state);\n        }\n        //  AI Chat: computed \n        const aiSessions = computed(() => persistedState.value.ai_chat.sessions);\n        const aiActiveSession = computed(() => {\n            const id = persistedState.value.ai_chat.activeSessionId;\n            if (!id)\n                return null;\n            return aiSessions.value.find(s => s.id === id) ?? null;\n        });\n        const aiActiveMessages = computed(() => aiActiveSession.value?.messages ?? []);\n        //  AI Chat: CRUD \n        function aiCreateSession() {\n            const id = createId('ai-chat');\n            const session = {\n                id,\n                title: ` ${aiSessions.value.length + 1}`,\n                createdAt: Date.now(),\n                messages: [],\n            };\n            updatePersistedState(state => {\n                state.ai_chat.sessions.unshift(session);\n                state.ai_chat.activeSessionId = id;\n            });\n            setStatus('');\n        }\n        function aiDeleteSession(id) {\n            updatePersistedState(state => {\n                state.ai_chat.sessions = state.ai_chat.sessions.filter(s => s.id !== id);\n                if (state.ai_chat.activeSessionId === id) {\n                    state.ai_chat.activeSessionId = state.ai_chat.sessions[0]?.id ?? null;\n                }\n            });\n            setStatus('');\n        }\n        function aiSwitchSession(id) {\n            updatePersistedState(state => {\n                state.ai_chat.activeSessionId = id;\n            });\n        }\n        function aiRenameSession(id, title) {\n            updatePersistedState(state => {\n                const session = state.ai_chat.sessions.find(s => s.id === id);\n                if (session) {\n                    session.title = title.trim() || session.title;\n                }\n            });\n        }\n        function aiAddMessage(role, content) {\n            const sessionId = persistedState.value.ai_chat.activeSessionId;\n            if (!sessionId)\n                return;\n            updatePersistedState(state => {\n                const session = state.ai_chat.sessions.find(s => s.id === sessionId);\n                if (session) {\n                    session.messages.push({ role, content, timestamp: Date.now() });\n                    if (session.messages.length > AI_CHAT_MESSAGE_LIMIT) {\n                        session.messages = session.messages.slice(-AI_CHAT_MESSAGE_LIMIT);\n                    }\n                }\n            });\n        }\n        //  AI Chat: generate \n        let aiStreamSubscription = null;\n        async function aiSendMessage() {\n            const text = aiChatInputText.value.trim();\n            if (!text || aiIsGenerating.value)\n                return;\n            const sessionId = persistedState.value.ai_chat.activeSessionId;\n            if (!sessionId) {\n                aiCreateSession();\n            }\n            aiChatInputText.value = '';\n            aiAddMessage('user', text);\n            const session = persistedState.value.ai_chat.sessions.find(s => s.id === persistedState.value.ai_chat.activeSessionId);\n            if (!session)\n                return;\n            // Build prompts from session history (excluding the user message we just added since generate will use user_input)\n            const historyPrompts = session.messages.slice(0, -1).map(m => ({\n                role: m.role,\n                content: m.content,\n            }));\n            const generationId = createId('ai-gen');\n            aiCurrentGenerationId.value = generationId;\n            aiIsGenerating.value = true;\n            aiStreamingText.value = '';\n            // Subscribe to streaming events\n            aiStreamSubscription = eventOn(iframe_events.STREAM_TOKEN_RECEIVED_FULLY, (fullText, genId) => {\n                if (genId === generationId) {\n                    aiStreamingText.value = fullText;\n                }\n            });\n            try {\n                const generateConfig = {\n                    generation_id: generationId,\n                    user_input: text,\n                    should_stream: true,\n                    should_silence: true,\n                };\n                if (!aiUseContext.value) {\n                    // :  chat_history, \n                    generateConfig.overrides = {\n                        chat_history: { prompts: historyPrompts },\n                    };\n                }\n                // :  chat_history,  prompt (++)\n                const result = await generate(generateConfig);\n                aiAddMessage('assistant', result);\n                aiStreamingText.value = '';\n                // Auto-extract tags\n                const tags = aiExtractTags(result);\n                if (tags.length > 0) {\n                    aiExtractedTags.value = tags;\n                    aiShowTagReview.value = true;\n                }\n            }\n            catch (error) {\n                const message = error instanceof Error ? error.message : String(error);\n                toastr.error(`AI : ${message}`);\n                setStatus(`AI : ${message}`);\n            }\n            finally {\n                aiIsGenerating.value = false;\n                aiCurrentGenerationId.value = null;\n                aiStreamSubscription?.stop();\n                aiStreamSubscription = null;\n            }\n        }\n        function aiStopGeneration() {\n            if (aiCurrentGenerationId.value) {\n                stopGenerationById(aiCurrentGenerationId.value);\n            }\n        }\n        //  AI Chat: tag extraction \n        function aiExtractTags(text) {\n            const regex = /<([^/<>\\s]+)>([\\s\\S]*?)<\\/\\1>/g;\n            const results = [];\n            let match;\n            while ((match = regex.exec(text)) !== null) {\n                results.push({\n                    tag: match[1],\n                    content: match[0],\n                    selected: true,\n                });\n            }\n            return results;\n        }\n        async function aiCreateSelectedEntries() {\n            const selected = aiExtractedTags.value.filter(t => t.selected);\n            if (selected.length === 0) {\n                toastr.warning('');\n                return;\n            }\n            const targetName = aiTargetWorldbook.value;\n            if (!targetName) {\n                toastr.warning('');\n                return;\n            }\n            try {\n                const newEntries = selected.map(t => ({\n                    name: t.tag,\n                    content: t.content,\n                }));\n                await createWorldbookEntries(targetName, newEntries);\n                toastr.success(` ${selected.length}  \"${targetName}\"`);\n                setStatus(` ${selected.length}  \"${targetName}\"`);\n                aiShowTagReview.value = false;\n                aiExtractedTags.value = [];\n            }\n            catch (error) {\n                const message = error instanceof Error ? error.message : String(error);\n                toastr.error(`: ${message}`);\n            }\n        }\n        function aiToggleMode() {\n            aiGeneratorMode.value = !aiGeneratorMode.value;\n            if (aiGeneratorMode.value) {\n                globalWorldbookMode.value = false;\n            }\n        }\n        function setStatus(message) {\n            statusMessage.value = message;\n        }\n        function syncExtraTextWithSelection() {\n            if (!selectedEntry.value || !selectedEntry.value.extra) {\n                selectedExtraText.value = '';\n                return;\n            }\n            selectedExtraText.value = JSON.stringify(selectedEntry.value.extra, null, 2);\n        }\n        function formatDateTime(timestamp) {\n            try {\n                return new Date(timestamp).toLocaleString('zh-CN', { hour12: false });\n            }\n            catch {\n                return String(timestamp);\n            }\n        }\n        function formatHistoryOptionLabel(label, ts, isCurrent) {\n            if (isCurrent) {\n                return 'Current';\n            }\n            if (label === '' || ts <= 0) {\n                return label;\n            }\n            return `${label}  ${formatDateTime(ts)}`;\n        }\n        function getEntryVersionPreview(view) {\n            if (!view) {\n                return '';\n            }\n            const content = toStringSafe(view.entry.content).replace(/\\s+/g, ' ').trim();\n            if (!content) {\n                return '()';\n            }\n            return content.slice(0, 160);\n        }\n        function getWorldbookVersionDiffSummary(left, right) {\n            if (!left || !right) {\n                return '';\n            }\n            const leftMap = new Map();\n            const rightMap = new Map();\n            left.entries.forEach(entry => leftMap.set(entry.uid, entry));\n            right.entries.forEach(entry => rightMap.set(entry.uid, entry));\n            let added = 0;\n            let removed = 0;\n            let changed = 0;\n            for (const [uid, rightEntry] of rightMap) {\n                const leftEntry = leftMap.get(uid);\n                if (!leftEntry) {\n                    added += 1;\n                    continue;\n                }\n                if (JSON.stringify(leftEntry) !== JSON.stringify(rightEntry)) {\n                    changed += 1;\n                }\n            }\n            for (const uid of leftMap.keys()) {\n                if (!rightMap.has(uid)) {\n                    removed += 1;\n                }\n            }\n            return ` ${added} /  ${changed} /  ${removed}`;\n        }\n        function getEntryVersionDiffSummary(left, right) {\n            if (!left || !right) {\n                return '';\n            }\n            const leftText = serializeEntryVersionForDiff(left);\n            const rightText = serializeEntryVersionForDiff(right);\n            const parts = diffLines(leftText, rightText);\n            let addLines = 0;\n            let delLines = 0;\n            for (const part of parts) {\n                const lines = part.value.split('\\n');\n                if (lines.length && lines[lines.length - 1] === '') {\n                    lines.pop();\n                }\n                if (part.added) {\n                    addLines += lines.length;\n                }\n                else if (part.removed) {\n                    delLines += lines.length;\n                }\n            }\n            const changed = Math.min(addLines, delLines);\n            const added = Math.max(0, addLines - changed);\n            const removed = Math.max(0, delLines - changed);\n            return ` ${added} /  ${changed} /  ${removed}`;\n        }\n        function escapeHtml(text) {\n            return text\n                .replaceAll('&', '&amp;')\n                .replaceAll('<', '&lt;')\n                .replaceAll('>', '&gt;')\n                .replaceAll('\"', '&quot;')\n                .replaceAll(\"'\", '&#39;');\n        }\n        function serializeEntryVersionForDiff(view) {\n            if (!view) {\n                return '';\n            }\n            const entry = view.entry;\n            const payload = {\n                uid: entry.uid,\n                name: entry.name,\n                enabled: entry.enabled,\n                strategy: entry.strategy,\n                position: entry.position,\n                probability: entry.probability,\n                recursion: entry.recursion,\n                effect: entry.effect,\n                content: entry.content,\n                extra: entry.extra ?? null,\n            };\n            return JSON.stringify(payload, null, 2);\n        }\n        function serializeWorldbookVersionForDiff(view) {\n            if (!view) {\n                return '';\n            }\n            const entries = view.entries\n                .map(entry => ({\n                uid: entry.uid,\n                name: entry.name,\n                enabled: entry.enabled,\n                type: entry.strategy.type,\n                keys: entry.strategy.keys.map(stringifyKeyword),\n                position: entry.position,\n                probability: entry.probability,\n                content: entry.content,\n            }))\n                .sort((left, right) => left.uid - right.uid);\n            return JSON.stringify({ entries }, null, 2);\n        }\n        function buildDiffHtml(leftText, rightText) {\n            const leftRendered = [];\n            const rightRendered = [];\n            let leftLineNo = 1;\n            let rightLineNo = 1;\n            const parts = diffLines(leftText, rightText);\n            for (const part of parts) {\n                const lines = part.value.split('\\n');\n                if (lines.length && lines[lines.length - 1] === '') {\n                    lines.pop();\n                }\n                if (!lines.length) {\n                    continue;\n                }\n                if (part.added) {\n                    for (const line of lines) {\n                        leftRendered.push(`<div class=\"diff-row empty\"><span class=\"line-no\"></span><span class=\"line-text\">&nbsp;</span></div>`);\n                        rightRendered.push(`<div class=\"diff-row add\"><span class=\"line-no\">${rightLineNo}</span><span class=\"line-text\">${escapeHtml(line) || '&nbsp;'}</span></div>`);\n                        rightLineNo += 1;\n                    }\n                    continue;\n                }\n                if (part.removed) {\n                    for (const line of lines) {\n                        leftRendered.push(`<div class=\"diff-row del\"><span class=\"line-no\">${leftLineNo}</span><span class=\"line-text\">${escapeHtml(line) || '&nbsp;'}</span></div>`);\n                        rightRendered.push(`<div class=\"diff-row empty\"><span class=\"line-no\"></span><span class=\"line-text\">&nbsp;</span></div>`);\n                        leftLineNo += 1;\n                    }\n                    continue;\n                }\n                for (const line of lines) {\n                    const safe = escapeHtml(line) || '&nbsp;';\n                    leftRendered.push(`<div class=\"diff-row\"><span class=\"line-no\">${leftLineNo}</span><span class=\"line-text\">${safe}</span></div>`);\n                    rightRendered.push(`<div class=\"diff-row\"><span class=\"line-no\">${rightLineNo}</span><span class=\"line-text\">${safe}</span></div>`);\n                    leftLineNo += 1;\n                    rightLineNo += 1;\n                }\n            }\n            return {\n                leftHtml: leftRendered.join(''),\n                rightHtml: rightRendered.join(''),\n            };\n        }\n        function parseBatchExcludeTokens(value) {\n            const seen = new Set();\n            const tokens = [];\n            for (const raw of value.split(/[\\n,]/g)) {\n                const token = raw.trim().toLowerCase();\n                if (!token || seen.has(token)) {\n                    continue;\n                }\n                seen.add(token);\n                tokens.push(token);\n            }\n            return tokens;\n        }\n        function shouldExcludeEntryForBatch(entry, tokens) {\n            if (!tokens.length) {\n                return false;\n            }\n            const name = entry.name.toLowerCase();\n            const content = entry.content.toLowerCase();\n            const keys = entry.strategy.keys.map(key => stringifyKeyword(key).toLowerCase()).join(' ');\n            const secondaryKeys = entry.strategy.keys_secondary.keys.map(key => stringifyKeyword(key).toLowerCase()).join(' ');\n            for (const token of tokens) {\n                const uidMatch = token.match(/^(?:#|uid:)?(\\d+)$/);\n                if (uidMatch && Number(uidMatch[1]) === entry.uid) {\n                    return true;\n                }\n                const scoped = token.match(/^(name|content|keys|secondary|secondary_keys):(.+)$/);\n                if (scoped) {\n                    const scope = scoped[1];\n                    const needle = scoped[2].trim();\n                    if (!needle) {\n                        continue;\n                    }\n                    if (scope === 'name' && name.includes(needle)) {\n                        return true;\n                    }\n                    if (scope === 'content' && content.includes(needle)) {\n                        return true;\n                    }\n                    if (scope === 'keys' && keys.includes(needle)) {\n                        return true;\n                    }\n                    if ((scope === 'secondary' || scope === 'secondary_keys') && secondaryKeys.includes(needle)) {\n                        return true;\n                    }\n                    continue;\n                }\n                const plain = token.trim();\n                if (!plain) {\n                    continue;\n                }\n                if (name.includes(plain) ||\n                    content.includes(plain) ||\n                    keys.includes(plain) ||\n                    secondaryKeys.includes(plain)) {\n                    return true;\n                }\n            }\n            return false;\n        }\n        function getFindFieldLabel(field) {\n            if (field === 'name') {\n                return '';\n            }\n            if (field === 'content') {\n                return '';\n            }\n            return '';\n        }\n        function resolveBatchRegex(findText) {\n            if (!batchUseRegex.value) {\n                return null;\n            }\n            try {\n                return new RegExp(findText, 'g');\n            }\n            catch (error) {\n                toastr.error(`: ${error instanceof Error ? error.message : String(error)}`);\n                return null;\n            }\n        }\n        function getBatchTargetEntries() {\n            if (batchSearchScope.value === 'current') {\n                return selectedEntry.value ? [selectedEntry.value] : [];\n            }\n            return draftEntries.value;\n        }\n        function getEnabledFindFields() {\n            const fields = [];\n            if (batchInName.value) {\n                fields.push('name');\n            }\n            if (batchInContent.value) {\n                fields.push('content');\n            }\n            if (batchInKeys.value) {\n                fields.push('keys');\n            }\n            return fields;\n        }\n        function getEntryFieldText(entry, field) {\n            if (field === 'name') {\n                return entry.name;\n            }\n            if (field === 'content') {\n                return entry.content;\n            }\n            return entry.strategy.keys.map(key => stringifyKeyword(key)).join(', ');\n        }\n        function collectMatchIndexes(text, findText, regex) {\n            const hits = [];\n            if (!text || !findText) {\n                return hits;\n            }\n            if (!regex) {\n                let cursor = 0;\n                while (cursor <= text.length) {\n                    const start = text.indexOf(findText, cursor);\n                    if (start < 0) {\n                        break;\n                    }\n                    const end = start + findText.length;\n                    hits.push({\n                        start,\n                        end,\n                        matchedText: text.slice(start, end),\n                    });\n                    cursor = Math.max(end, start + 1);\n                }\n                return hits;\n            }\n            const runtime = new RegExp(regex.source, regex.flags.includes('g') ? regex.flags : `${regex.flags}g`);\n            let result = null;\n            while ((result = runtime.exec(text)) !== null) {\n                const matched = result[0] ?? '';\n                if (!matched) {\n                    runtime.lastIndex += 1;\n                    continue;\n                }\n                const start = result.index;\n                const end = start + matched.length;\n                hits.push({\n                    start,\n                    end,\n                    matchedText: matched,\n                });\n            }\n            return hits;\n        }\n        function buildFindPreview(text, start, end) {\n            const left = Math.max(0, start - 18);\n            const right = Math.min(text.length, end + 22);\n            const prefix = left > 0 ? '...' : '';\n            const suffix = right < text.length ? '...' : '';\n            return `${prefix}${text.slice(left, right).replace(/\\s+/g, ' ')}${suffix}`;\n        }\n        function collectFindHits(findText, regex, excludeTokens) {\n            const fields = getEnabledFindFields();\n            if (!fields.length) {\n                return [];\n            }\n            const entries = getBatchTargetEntries();\n            const hits = [];\n            for (const entry of entries) {\n                if (shouldExcludeEntryForBatch(entry, excludeTokens)) {\n                    continue;\n                }\n                for (const field of fields) {\n                    const text = getEntryFieldText(entry, field);\n                    const indexes = collectMatchIndexes(text, findText, regex);\n                    for (const match of indexes) {\n                        hits.push({\n                            entryUid: entry.uid,\n                            entryName: entry.name,\n                            field,\n                            start: match.start,\n                            end: match.end,\n                            matchedText: match.matchedText,\n                            preview: buildFindPreview(text, match.start, match.end),\n                        });\n                    }\n                }\n            }\n            return hits;\n        }\n        function isSameFindHit(left, right) {\n            return (left.entryUid === right.entryUid &&\n                left.field === right.field &&\n                left.start === right.start &&\n                left.end === right.end &&\n                left.matchedText === right.matchedText);\n        }\n        function resetFindState() {\n            findHits.value = [];\n            findHitIndex.value = -1;\n        }\n        function getFindTargetElement(field) {\n            const root = editorShellRef.value;\n            if (!root) {\n                return null;\n            }\n            if (field === 'name') {\n                return root.querySelector('.editor-comment input.text-input');\n            }\n            if (field === 'content') {\n                return root.querySelector('.editor-content-area');\n            }\n            return root.querySelector('.editor-keyword-grid .field textarea');\n        }\n        function getTextareaLineHeight(element) {\n            const style = window.getComputedStyle(element);\n            const lineHeight = Number.parseFloat(style.lineHeight);\n            if (Number.isFinite(lineHeight) && lineHeight > 0) {\n                return lineHeight;\n            }\n            const fontSize = Number.parseFloat(style.fontSize);\n            if (Number.isFinite(fontSize) && fontSize > 0) {\n                return fontSize * 1.4;\n            }\n            return 18;\n        }\n        function scrollTextareaToSelection(element, start) {\n            const lineHeight = getTextareaLineHeight(element);\n            const before = element.value.slice(0, start);\n            const lineIndex = before.split('\\n').length - 1;\n            const desiredTop = Math.max(0, lineIndex * lineHeight - element.clientHeight * 0.35);\n            element.scrollTop = desiredTop;\n        }\n        async function revealFindHitInEditor(hit) {\n            await nextTick();\n            let target = getFindTargetElement(hit.field);\n            if (!target) {\n                await nextTick();\n                target = getFindTargetElement(hit.field);\n                if (!target) {\n                    return;\n                }\n            }\n            const maxLen = target.value.length;\n            const start = Math.max(0, Math.min(hit.start, maxLen));\n            const end = Math.max(start, Math.min(hit.end, maxLen));\n            target.focus();\n            target.setSelectionRange(start, end);\n            if (target instanceof HTMLTextAreaElement) {\n                scrollTextareaToSelection(target, start);\n            }\n            target.scrollIntoView({ block: 'center', inline: 'nearest' });\n            requestAnimationFrame(() => {\n                target?.scrollIntoView({ block: 'center', inline: 'nearest' });\n                if (target instanceof HTMLTextAreaElement) {\n                    scrollTextareaToSelection(target, start);\n                }\n            });\n        }\n        function moveToFindHit(hit, index, total) {\n            findHitIndex.value = index;\n            selectedEntryUid.value = hit.entryUid;\n            void revealFindHitInEditor(hit);\n            const entryLabel = hit.entryName || ` ${hit.entryUid}`;\n            setStatus(` ${index + 1}/${total}: ${entryLabel}  ${getFindFieldLabel(hit.field)}  ${hit.preview}`);\n        }\n        function runFind(step) {\n            const findText = batchFindText.value;\n            if (!findText) {\n                toastr.warning('');\n                return;\n            }\n            if (!getEnabledFindFields().length) {\n                toastr.warning('');\n                return;\n            }\n            if (batchSearchScope.value === 'current' && !selectedEntry.value) {\n                toastr.warning('');\n                return;\n            }\n            const excludeTokens = parseBatchExcludeTokens(batchExcludeText.value);\n            const regex = resolveBatchRegex(findText);\n            if (batchUseRegex.value && !regex) {\n                return;\n            }\n            const hits = collectFindHits(findText, regex, excludeTokens);\n            findHits.value = hits;\n            if (!hits.length) {\n                findHitIndex.value = -1;\n                setStatus('');\n                toastr.info('');\n                return;\n            }\n            if (step === 0) {\n                moveToFindHit(hits[0], 0, hits.length);\n                return;\n            }\n            const prevHit = activeFindHit.value;\n            const currentIndex = prevHit ? hits.findIndex(item => isSameFindHit(item, prevHit)) : findHitIndex.value;\n            let nextIndex;\n            if (currentIndex < 0) {\n                nextIndex = step > 0 ? 0 : hits.length - 1;\n            }\n            else {\n                nextIndex = (currentIndex + step + hits.length) % hits.length;\n            }\n            moveToFindHit(hits[nextIndex], nextIndex, hits.length);\n        }\n        function findFirstMatch() {\n            runFind(0);\n        }\n        function findNextMatch() {\n            runFind(1);\n        }\n        function findPreviousMatch() {\n            runFind(-1);\n        }\n        function ensureSelectedEntryExists() {\n            if (!draftEntries.value.length) {\n                selectedEntryUid.value = null;\n                return;\n            }\n            if (selectedEntryUid.value === null) {\n                selectedEntryUid.value = draftEntries.value[0].uid;\n                return;\n            }\n            const exists = draftEntries.value.some(entry => entry.uid === selectedEntryUid.value);\n            if (!exists) {\n                selectedEntryUid.value = draftEntries.value[0].uid;\n            }\n        }\n        function selectEntry(uid) {\n            selectedEntryUid.value = uid;\n            if (isMobile.value) {\n                mobileTab.value = 'edit';\n            }\n        }\n        function goBackToList() {\n            selectedEntryUid.value = null;\n            mobileTab.value = 'list';\n        }\n        function createEntrySnapshotRecord(label, uid, name, entry) {\n            return {\n                id: createId('entry-snapshot'),\n                label,\n                ts: Date.now(),\n                uid,\n                name: name || ` ${uid}`,\n                entry: normalizeEntry(klona(entry), uid),\n            };\n        }\n        function pushEntrySnapshotsBulk(items) {\n            if (!selectedWorldbookName.value || !items.length) {\n                return 0;\n            }\n            let added = 0;\n            const worldbookName = selectedWorldbookName.value;\n            updatePersistedState(state => {\n                const byWorldbook = state.entry_history[worldbookName] ?? {};\n                for (const item of items) {\n                    const uidKey = String(item.uid);\n                    const incoming = createEntrySnapshotRecord(item.label, item.uid, item.name, item.entry);\n                    const list = byWorldbook[uidKey] ?? [];\n                    if (list[0] && JSON.stringify(list[0].entry) === JSON.stringify(incoming.entry)) {\n                        continue;\n                    }\n                    list.unshift(incoming);\n                    if (list.length > ENTRY_HISTORY_LIMIT) {\n                        list.length = ENTRY_HISTORY_LIMIT;\n                    }\n                    byWorldbook[uidKey] = list;\n                    added += 1;\n                }\n                state.entry_history[worldbookName] = byWorldbook;\n            });\n            return added;\n        }\n        function pushEntrySnapshot(label, entry) {\n            const added = pushEntrySnapshotsBulk([\n                {\n                    label,\n                    uid: entry.uid,\n                    name: entry.name,\n                    entry,\n                },\n            ]);\n            return added > 0;\n        }\n        function collectEntrySnapshotsBeforeSave() {\n            const result = [];\n            const draftByUid = new Map();\n            draftEntries.value.forEach(entry => {\n                draftByUid.set(entry.uid, entry);\n            });\n            for (const previous of originalEntries.value) {\n                const current = draftByUid.get(previous.uid);\n                if (!current) {\n                    result.push({\n                        label: '',\n                        uid: previous.uid,\n                        name: previous.name,\n                        entry: previous,\n                    });\n                    continue;\n                }\n                if (JSON.stringify(previous) !== JSON.stringify(current)) {\n                    result.push({\n                        label: '',\n                        uid: previous.uid,\n                        name: previous.name,\n                        entry: previous,\n                    });\n                }\n            }\n            return result;\n        }\n        function pushSnapshot(label) {\n            if (!selectedWorldbookName.value) {\n                return;\n            }\n            const worldbookName = selectedWorldbookName.value;\n            const snapshot = {\n                id: createId('snapshot'),\n                label,\n                ts: Date.now(),\n                entries: klona(draftEntries.value),\n            };\n            updatePersistedState(state => {\n                const list = state.history[worldbookName] ?? [];\n                list.unshift(snapshot);\n                if (list.length > HISTORY_LIMIT) {\n                    list.length = HISTORY_LIMIT;\n                }\n                state.history[worldbookName] = list;\n            });\n        }\n        function createManualSnapshot() {\n            if (!selectedWorldbookName.value) {\n                toastr.warning('');\n                return;\n            }\n            pushSnapshot('');\n            toastr.success('');\n        }\n        function openEntryHistoryModal() {\n            if (!selectedEntry.value) {\n                toastr.warning('');\n                return;\n            }\n            const nonCurrent = entryVersionViews.value.find(item => !item.isCurrent) ?? null;\n            entryHistoryRightId.value = '__current__';\n            entryHistoryLeftId.value = nonCurrent?.id ?? '__current__';\n            showEntryHistoryModal.value = true;\n        }\n        function openWorldbookHistoryModal() {\n            if (!selectedWorldbookName.value) {\n                toastr.warning('');\n                return;\n            }\n            const nonCurrent = worldbookVersionViews.value.find(item => !item.isCurrent) ?? null;\n            worldbookHistoryRightId.value = '__current__';\n            worldbookHistoryLeftId.value = nonCurrent?.id ?? '__current__';\n            showWorldbookHistoryModal.value = true;\n        }\n        function createManualEntrySnapshot() {\n            if (!selectedEntry.value) {\n                toastr.warning('');\n                return;\n            }\n            const added = pushEntrySnapshot('', selectedEntry.value);\n            if (added) {\n                toastr.success('');\n            }\n            else {\n                toastr.info('');\n            }\n        }\n        function restoreSnapshot(snapshotId) {\n            const snapshot = snapshotsForCurrent.value.find(item => item.id === snapshotId);\n            if (!snapshot) {\n                return;\n            }\n            if (!confirm(` \"${snapshot.label}\" ? `)) {\n                return;\n            }\n            draftEntries.value = normalizeEntryList(snapshot.entries);\n            ensureSelectedEntryExists();\n            setStatus(`${snapshot.label}`);\n        }\n        function restoreWorldbookFromLeftHistory() {\n            const target = selectedWorldbookHistoryLeft.value;\n            if (!target || target.isCurrent) {\n                return;\n            }\n            if (!confirm(` Left  \"${target.label}\" ? `)) {\n                return;\n            }\n            draftEntries.value = normalizeEntryList(klona(target.entries));\n            ensureSelectedEntryExists();\n            setStatus(`${target.label}`);\n            toastr.success(' Left ');\n        }\n        function deleteSnapshot(snapshotId) {\n            if (!selectedWorldbookName.value) {\n                return;\n            }\n            updatePersistedState(state => {\n                const list = state.history[selectedWorldbookName.value] ?? [];\n                state.history[selectedWorldbookName.value] = list.filter(item => item.id !== snapshotId);\n            });\n        }\n        function clearCurrentSnapshots() {\n            if (!selectedWorldbookName.value || !snapshotsForCurrent.value.length) {\n                return;\n            }\n            if (!confirm(` \"${selectedWorldbookName.value}\" `)) {\n                return;\n            }\n            updatePersistedState(state => {\n                delete state.history[selectedWorldbookName.value];\n            });\n        }\n        function restoreEntrySnapshot(snapshotId) {\n            if (!selectedEntry.value || selectedEntryIndex.value < 0) {\n                return;\n            }\n            const snapshot = entrySnapshotsForSelected.value.find(item => item.id === snapshotId);\n            if (!snapshot) {\n                return;\n            }\n            if (!confirm(` \"${snapshot.label}\" ?`)) {\n                return;\n            }\n            // \n            pushEntrySnapshot('', selectedEntry.value);\n            const restored = normalizeEntry(klona(snapshot.entry), selectedEntry.value.uid);\n            restored.uid = selectedEntry.value.uid;\n            draftEntries.value.splice(selectedEntryIndex.value, 1, restored);\n            selectedEntryUid.value = restored.uid;\n            setStatus(`${snapshot.label}`);\n            toastr.success('');\n        }\n        function restoreEntryFromLeftHistory() {\n            const target = selectedEntryHistoryLeft.value;\n            if (!target || target.isCurrent) {\n                return;\n            }\n            if (!selectedEntry.value || selectedEntryIndex.value < 0) {\n                return;\n            }\n            if (!confirm(` \"${target.label}\" ?`)) {\n                return;\n            }\n            pushEntrySnapshot('', selectedEntry.value);\n            const restored = normalizeEntry(klona(target.entry), selectedEntry.value.uid);\n            restored.uid = selectedEntry.value.uid;\n            draftEntries.value.splice(selectedEntryIndex.value, 1, restored);\n            selectedEntryUid.value = restored.uid;\n            setStatus(`${target.label}`);\n            toastr.success(' Left ');\n        }\n        function deleteEntrySnapshot(snapshotId) {\n            if (!selectedWorldbookName.value || !selectedEntry.value) {\n                return;\n            }\n            const worldbookName = selectedWorldbookName.value;\n            const uidKey = String(selectedEntry.value.uid);\n            updatePersistedState(state => {\n                const byWorldbook = state.entry_history[worldbookName] ?? {};\n                const list = byWorldbook[uidKey] ?? [];\n                byWorldbook[uidKey] = list.filter(item => item.id !== snapshotId);\n                state.entry_history[worldbookName] = byWorldbook;\n            });\n        }\n        function clearCurrentEntrySnapshots() {\n            if (!selectedWorldbookName.value || !selectedEntry.value || !entrySnapshotsForSelected.value.length) {\n                return;\n            }\n            if (!confirm(` #${selectedEntry.value.uid} `)) {\n                return;\n            }\n            const worldbookName = selectedWorldbookName.value;\n            const uidKey = String(selectedEntry.value.uid);\n            updatePersistedState(state => {\n                const byWorldbook = state.entry_history[worldbookName] ?? {};\n                delete byWorldbook[uidKey];\n                state.entry_history[worldbookName] = byWorldbook;\n            });\n        }\n        function handleSelectedPositionTypeChanged() {\n            if (!selectedEntry.value) {\n                return;\n            }\n            if (selectedEntry.value.position.type !== 'at_depth') {\n                selectedEntry.value.position.role = 'system';\n                selectedEntry.value.position.depth = 4;\n            }\n        }\n        function applyExtraJson() {\n            if (!selectedEntry.value) {\n                return;\n            }\n            const text = selectedExtraText.value.trim();\n            if (!text) {\n                selectedEntry.value.extra = undefined;\n                return;\n            }\n            try {\n                const parsed = JSON.parse(text);\n                const parsedRecord = asRecord(parsed);\n                if (!parsedRecord) {\n                    throw new Error('extra  JSON ');\n                }\n                selectedEntry.value.extra = klona(parsedRecord);\n                toastr.success('extra ');\n            }\n            catch (error) {\n                toastr.error(`extra JSON : ${error instanceof Error ? error.message : String(error)}`);\n            }\n        }\n        function clearExtra() {\n            if (!selectedEntry.value) {\n                return;\n            }\n            selectedEntry.value.extra = undefined;\n            selectedExtraText.value = '';\n        }\n        function addEntry() {\n            const uid = getNextUid(draftEntries.value);\n            const entry = createDefaultEntry(uid);\n            draftEntries.value.push(entry);\n            selectedEntryUid.value = uid;\n            setStatus(` #${uid}`);\n        }\n        function duplicateSelectedEntry() {\n            if (!selectedEntry.value || selectedEntryIndex.value < 0) {\n                return;\n            }\n            const uid = getNextUid(draftEntries.value);\n            const duplicated = normalizeEntry(klona(selectedEntry.value), uid);\n            duplicated.uid = uid;\n            duplicated.name = `${duplicated.name} ()`;\n            draftEntries.value.splice(selectedEntryIndex.value + 1, 0, duplicated);\n            selectedEntryUid.value = uid;\n            setStatus(` #${selectedEntry.value.uid}`);\n        }\n        function removeSelectedEntry() {\n            if (!selectedEntry.value || selectedEntryIndex.value < 0) {\n                return;\n            }\n            if (!confirm(` \"${selectedEntry.value.name}\" ?`)) {\n                return;\n            }\n            pushEntrySnapshot('', selectedEntry.value);\n            draftEntries.value.splice(selectedEntryIndex.value, 1);\n            if (isMobile.value) {\n                selectedEntryUid.value = null;\n            }\n            else {\n                ensureSelectedEntryExists();\n            }\n            setStatus('');\n        }\n        function moveSelectedEntry(direction) {\n            if (selectedEntryIndex.value < 0) {\n                return;\n            }\n            const target = selectedEntryIndex.value + direction;\n            if (target < 0 || target >= draftEntries.value.length) {\n                return;\n            }\n            const [entry] = draftEntries.value.splice(selectedEntryIndex.value, 1);\n            draftEntries.value.splice(target, 0, entry);\n            selectedEntryUid.value = entry.uid;\n        }\n        function normalizeAllEntries() {\n            draftEntries.value = normalizeEntryList(draftEntries.value.map(entry => klona(entry)));\n            ensureSelectedEntryExists();\n            setStatus('');\n        }\n        function sortEntriesByOrderDesc() {\n            draftEntries.value.sort((left, right) => right.position.order - left.position.order);\n            ensureSelectedEntryExists();\n            setStatus(' order ');\n        }\n        function setEnabledForAll(enabled) {\n            draftEntries.value.forEach(entry => {\n                entry.enabled = enabled;\n            });\n            setStatus(enabled ? '' : '');\n        }\n        function applyBatchReplace() {\n            const findText = batchFindText.value;\n            if (!findText) {\n                toastr.warning('');\n                return;\n            }\n            if (!getEnabledFindFields().length) {\n                toastr.warning('');\n                return;\n            }\n            if (batchSearchScope.value === 'current' && !selectedEntry.value) {\n                toastr.warning('');\n                return;\n            }\n            const targetEntries = getBatchTargetEntries();\n            if (!targetEntries.length) {\n                toastr.warning('');\n                return;\n            }\n            const excludeTokens = parseBatchExcludeTokens(batchExcludeText.value);\n            const regex = resolveBatchRegex(findText);\n            if (batchUseRegex.value && !regex) {\n                return;\n            }\n            let touched = 0;\n            let skipped = 0;\n            for (const entry of targetEntries) {\n                if (shouldExcludeEntryForBatch(entry, excludeTokens)) {\n                    skipped += 1;\n                    continue;\n                }\n                let changed = false;\n                if (batchInName.value) {\n                    const next = regex\n                        ? entry.name.replace(regex, batchReplaceText.value)\n                        : entry.name.split(findText).join(batchReplaceText.value);\n                    if (next !== entry.name) {\n                        entry.name = next;\n                        changed = true;\n                    }\n                }\n                if (batchInContent.value) {\n                    const next = regex\n                        ? entry.content.replace(regex, batchReplaceText.value)\n                        : entry.content.split(findText).join(batchReplaceText.value);\n                    if (next !== entry.content) {\n                        entry.content = next;\n                        changed = true;\n                    }\n                }\n                if (batchInKeys.value) {\n                    const nextKeys = entry.strategy.keys.map(key => {\n                        const text = stringifyKeyword(key);\n                        return regex ? text.replace(regex, batchReplaceText.value) : text.split(findText).join(batchReplaceText.value);\n                    });\n                    const normalized = normalizeKeywordList(nextKeys);\n                    if (JSON.stringify(normalized.map(stringifyKeyword)) !== JSON.stringify(entry.strategy.keys.map(stringifyKeyword))) {\n                        entry.strategy.keys = normalized;\n                        changed = true;\n                    }\n                }\n                if (changed) {\n                    touched += 1;\n                }\n            }\n            resetFindState();\n            setStatus(`${batchSearchScope.value === 'current' ? '' : ''} ${touched}  ${skipped} `);\n        }\n        function downloadJson(filename, payload) {\n            const text = JSON.stringify(payload, null, 2);\n            const blob = new Blob([text], { type: 'application/json' });\n            const url = URL.createObjectURL(blob);\n            const anchor = document.createElement('a');\n            anchor.href = url;\n            anchor.download = filename;\n            document.body.appendChild(anchor);\n            anchor.click();\n            document.body.removeChild(anchor);\n            URL.revokeObjectURL(url);\n        }\n        function exportCurrentWorldbook() {\n            if (!selectedWorldbookName.value) {\n                return;\n            }\n            const payload = {\n                format: 'worldbook_assistant_v1',\n                name: selectedWorldbookName.value,\n                exported_at: new Date().toISOString(),\n                entries: draftEntries.value,\n            };\n            const filename = `${selectedWorldbookName.value.replace(/[\\\\/:*?\"<>|]/g, '_')}.json`;\n            downloadJson(filename, payload);\n        }\n        function collectRawEntries(root) {\n            if (Array.isArray(root.entries)) {\n                return root.entries;\n            }\n            const entriesMap = asRecord(root.entries);\n            if (entriesMap) {\n                return Object.values(entriesMap);\n            }\n            const dataRoot = asRecord(root.data);\n            if (dataRoot) {\n                if (Array.isArray(dataRoot.entries)) {\n                    return dataRoot.entries;\n                }\n                const dataEntriesMap = asRecord(dataRoot.entries);\n                if (dataEntriesMap) {\n                    return Object.values(dataEntriesMap);\n                }\n            }\n            return [];\n        }\n        function parseImportedPayload(fileName, text) {\n            const parsed = JSON.parse(text);\n            const fallbackName = fileName.replace(/\\.[^/.]+$/, '') || '';\n            if (Array.isArray(parsed)) {\n                return {\n                    name: fallbackName,\n                    entries: normalizeEntryList(parsed),\n                };\n            }\n            const root = asRecord(parsed);\n            if (!root) {\n                throw new Error(' JSON ');\n            }\n            const entries = collectRawEntries(root);\n            if (!entries.length) {\n                throw new Error(' entries');\n            }\n            const dataRoot = asRecord(root.data);\n            const nameCandidate = toStringSafe(root.name ?? dataRoot?.name, fallbackName).trim();\n            return {\n                name: nameCandidate || fallbackName,\n                entries: normalizeEntryList(entries),\n            };\n        }\n        function triggerImport() {\n            importFileInput.value?.click();\n        }\n        async function onImportChange(event) {\n            const target = event.target;\n            const file = target?.files?.[0];\n            if (!file) {\n                return;\n            }\n            const fileText = await file.text();\n            try {\n                const payload = parseImportedPayload(file.name, fileText);\n                const suggested = payload.name || file.name.replace(/\\.[^/.]+$/, '');\n                const newNameRaw = prompt('', suggested);\n                const newName = toStringSafe(newNameRaw).trim();\n                if (!newName) {\n                    return;\n                }\n                await createOrReplaceWorldbook(newName, payload.entries, { render: 'immediate' });\n                await reloadWorldbookNames(newName);\n                await refreshBindings();\n                toastr.success(`: ${newName}`);\n            }\n            catch (error) {\n                const message = error instanceof Error ? error.message : String(error);\n                const shouldFallback = confirm(`: ${message}\\n`);\n                if (!shouldFallback) {\n                    return;\n                }\n                const response = await importRawWorldbook(file.name, fileText);\n                if (!response.ok) {\n                    throw new Error(`: HTTP ${response.status}`);\n                }\n                await hardRefresh();\n                toastr.success('');\n            }\n            finally {\n                if (target) {\n                    target.value = '';\n                }\n            }\n        }\n        async function refreshBindings() {\n            bindings.global = [...getGlobalWorldbookNames()];\n            try {\n                const charBindings = getCharWorldbookNames('current');\n                bindings.charPrimary = charBindings.primary;\n                bindings.charAdditional = [...charBindings.additional];\n            }\n            catch {\n                bindings.charPrimary = null;\n                bindings.charAdditional = [];\n            }\n            try {\n                bindings.chat = getChatWorldbookName('current');\n            }\n            catch {\n                bindings.chat = null;\n            }\n            if (globalWorldbookMode.value) {\n                ensureSelectionForGlobalMode();\n            }\n        }\n        function resolveContextWorldbookCandidate() {\n            const available = worldbookNames.value;\n            if (!available.length) {\n                return null;\n            }\n            const chatBound = toStringSafe(bindings.chat).trim();\n            if (chatBound && available.includes(chatBound)) {\n                return chatBound;\n            }\n            const charPrimary = toStringSafe(bindings.charPrimary).trim();\n            if (charPrimary && available.includes(charPrimary)) {\n                return charPrimary;\n            }\n            const charAdditional = bindings.charAdditional.find(name => available.includes(name));\n            return charAdditional ?? null;\n        }\n        function ensureSelectionForGlobalMode() {\n            if (!globalWorldbookMode.value) {\n                return;\n            }\n            const globals = selectableWorldbookNames.value;\n            if (!globals.length) {\n                selectedWorldbookName.value = '';\n                return;\n            }\n            if (!globals.includes(selectedWorldbookName.value)) {\n                selectedWorldbookName.value = globals[0];\n            }\n        }\n        function trySelectWorldbookByContext(options = {}) {\n            if (globalWorldbookMode.value) {\n                return false;\n            }\n            if (options.preferWhenEmptyOnly && selectedWorldbookName.value) {\n                return false;\n            }\n            const candidate = resolveContextWorldbookCandidate();\n            if (!candidate || candidate === selectedWorldbookName.value) {\n                return false;\n            }\n            if (!options.force && hasUnsavedChanges.value) {\n                setStatus('/');\n                return false;\n            }\n            selectedWorldbookName.value = candidate;\n            setStatus(`: ${candidate}`);\n            return true;\n        }\n        function toggleGlobalMode() {\n            globalWorldbookMode.value = !globalWorldbookMode.value;\n            if (globalWorldbookMode.value) {\n                aiGeneratorMode.value = false;\n                ensureSelectionForGlobalMode();\n                setStatus('');\n                return;\n            }\n            if (!selectedWorldbookName.value) {\n                trySelectWorldbookByContext({ force: true });\n            }\n            setStatus('');\n        }\n        async function applyGlobalWorldbooks(nextGlobal, statusLabel = '') {\n            const normalized = [...new Set(nextGlobal.map(name => name.trim()).filter(Boolean))].filter(name => worldbookNames.value.includes(name));\n            try {\n                await rebindGlobalWorldbooks(normalized);\n                await refreshBindings();\n                ensureSelectionForGlobalMode();\n                setStatus(`${statusLabel}${normalized.length} `);\n                return true;\n            }\n            catch (error) {\n                const message = error instanceof Error ? error.message : String(error);\n                toastr.error(`: ${message}`);\n                return false;\n            }\n        }\n        function addFirstGlobalCandidate() {\n            const first = globalAddCandidates.value[0];\n            if (!first) {\n                return;\n            }\n            void addGlobalWorldbook(first);\n        }\n        async function addGlobalWorldbook(name) {\n            if (!name || bindings.global.includes(name)) {\n                return;\n            }\n            const success = await applyGlobalWorldbooks([...bindings.global, name], `: ${name}`);\n            if (success) {\n                globalAddSearchText.value = '';\n                updatePersistedState(state => {\n                    state.role_override_baseline = null;\n                });\n            }\n        }\n        async function removeGlobalWorldbook(name) {\n            if (!name || !bindings.global.includes(name)) {\n                return;\n            }\n            const success = await applyGlobalWorldbooks(bindings.global.filter(item => item !== name), `: ${name}`);\n            if (success) {\n                updatePersistedState(state => {\n                    state.role_override_baseline = null;\n                });\n            }\n        }\n        async function clearGlobalWorldbooks() {\n            if (!bindings.global.length) {\n                return;\n            }\n            if (!confirm('')) {\n                return;\n            }\n            const success = await applyGlobalWorldbooks([], '');\n            if (success) {\n                updatePersistedState(state => {\n                    state.role_override_baseline = null;\n                });\n            }\n        }\n        function getCurrentGlobalWorldbookSet() {\n            return [...new Set(bindings.global.map(name => name.trim()).filter(Boolean))];\n        }\n        function normalizeWorldbookSet(input) {\n            return [...new Set(input.map(name => name.trim()).filter(Boolean))];\n        }\n        function isSameWorldbookSet(left, right) {\n            const leftSorted = [...normalizeWorldbookSet(left)].sort();\n            const rightSorted = [...normalizeWorldbookSet(right)].sort();\n            if (leftSorted.length !== rightSorted.length) {\n                return false;\n            }\n            for (let index = 0; index < leftSorted.length; index += 1) {\n                if (leftSorted[index] !== rightSorted[index]) {\n                    return false;\n                }\n            }\n            return true;\n        }\n        function refreshRoleBindingCandidates() {\n            let names = [];\n            try {\n                names = typeof getCharacterNames === 'function' ? getCharacterNames() : [];\n            }\n            catch (error) {\n                console.warn('[WorldbookAssistant] getCharacterNames failed:', error);\n            }\n            const dedupe = new Set();\n            const result = [];\n            for (const charName of names) {\n                const trimmed = charName.trim();\n                if (!trimmed) {\n                    continue;\n                }\n                const key = `char:${trimmed}`;\n                if (dedupe.has(key)) {\n                    continue;\n                }\n                dedupe.add(key);\n                result.push({\n                    key,\n                    name: trimmed,\n                    avatar: '',\n                    updated_at: Date.now(),\n                });\n            }\n            result.sort((left, right) => left.name.localeCompare(right.name, 'zh-Hans-CN'));\n            const current = resolveCurrentRoleContext();\n            if (current && !result.some(item => item.key === current.key)) {\n                result.unshift(current);\n            }\n            roleBindingSourceCandidates.value = result;\n        }\n        function resolveCurrentRoleContext() {\n            let name = null;\n            try {\n                name = typeof getCurrentCharacterName === 'function' ? getCurrentCharacterName() : null;\n            }\n            catch (error) {\n                console.warn('[WorldbookAssistant] getCurrentCharacterName failed:', error);\n            }\n            if (!name) {\n                return null;\n            }\n            const trimmed = name.trim();\n            if (!trimmed) {\n                return null;\n            }\n            return {\n                key: `char:${trimmed}`,\n                name: trimmed,\n                avatar: '',\n                updated_at: Date.now(),\n            };\n        }\n        function refreshCurrentRoleContext() {\n            currentRoleContext.value = resolveCurrentRoleContext();\n        }\n        async function applyPresetWorldbooks(preset, options = {}) {\n            const normalized = normalizeWorldbookSet(preset.worldbooks);\n            const missing = normalized.filter(name => !worldbookNames.value.includes(name));\n            const matched = normalized.filter(name => worldbookNames.value.includes(name));\n            if (options.silentWhenSame && isSameWorldbookSet(getCurrentGlobalWorldbookSet(), matched)) {\n                updatePersistedState(state => {\n                    state.last_global_preset_id = preset.id;\n                });\n                return true;\n            }\n            const statusPrefix = options.statusPrefix ?? '';\n            const success = await applyGlobalWorldbooks(matched, `${statusPrefix}: ${preset.name}`);\n            if (!success) {\n                return false;\n            }\n            updatePersistedState(state => {\n                state.last_global_preset_id = preset.id;\n            });\n            if (missing.length) {\n                toastr.warning(` ${missing.length} `);\n            }\n            return true;\n        }\n        async function applySelectedGlobalPreset() {\n            const preset = selectedGlobalPreset.value;\n            if (!preset) {\n                return;\n            }\n            const success = await applyPresetWorldbooks(preset);\n            if (success) {\n                updatePersistedState(state => {\n                    state.role_override_baseline = null;\n                });\n            }\n        }\n        function getRoleBoundPresetForCurrentContext() {\n            const role = currentRoleContext.value;\n            if (!role) {\n                return null;\n            }\n            return (globalWorldbookPresets.value.find(item => item.role_bindings.some(binding => binding.key === role.key)) ?? null);\n        }\n        async function autoApplyRoleBoundPreset() {\n            const rolePreset = getRoleBoundPresetForCurrentContext();\n            if (!rolePreset) {\n                const baseline = persistedState.value.role_override_baseline;\n                if (baseline) {\n                    updatePersistedState(state => {\n                        state.role_override_baseline = null;\n                        state.last_global_preset_id = baseline.preset_id;\n                    });\n                    selectedGlobalPresetId.value = baseline.preset_id;\n                    if (baseline.preset_id) {\n                        const baselinePreset = globalWorldbookPresets.value.find(item => item.id === baseline.preset_id);\n                        if (baselinePreset) {\n                            await applyPresetWorldbooks(baselinePreset, {\n                                statusPrefix: '',\n                                silentWhenSame: true,\n                            });\n                        }\n                        else {\n                            await applyGlobalWorldbooks(baseline.worldbooks, '');\n                        }\n                    }\n                    else {\n                        await applyGlobalWorldbooks(baseline.worldbooks, '');\n                    }\n                }\n                return;\n            }\n            if (!persistedState.value.role_override_baseline) {\n                updatePersistedState(state => {\n                    state.role_override_baseline = {\n                        preset_id: selectedGlobalPresetId.value,\n                        worldbooks: getCurrentGlobalWorldbookSet(),\n                    };\n                });\n            }\n            selectedGlobalPresetId.value = rolePreset.id;\n            await applyPresetWorldbooks(rolePreset, {\n                statusPrefix: `${currentRoleContext.value?.name ?? ''}`,\n                silentWhenSame: true,\n            });\n        }\n        function onGlobalPresetSelectionChanged() {\n            closeRolePicker();\n            if (!selectedGlobalPresetId.value) {\n                updatePersistedState(state => {\n                    state.last_global_preset_id = '';\n                    state.role_override_baseline = null;\n                });\n                if (bindings.global.length) {\n                    void applyGlobalWorldbooks([], '');\n                }\n                else {\n                    setStatus('');\n                }\n                return;\n            }\n            void applySelectedGlobalPreset();\n        }\n        function bindRoleToSelectedPreset(role) {\n            const preset = selectedGlobalPreset.value;\n            if (!preset) {\n                toastr.warning('');\n                return;\n            }\n            updatePersistedState(state => {\n                state.global_presets = (state.global_presets ?? []).map(item => {\n                    if (item.id !== preset.id) {\n                        return item;\n                    }\n                    const nextBindings = normalizePresetRoleBindings([\n                        ...item.role_bindings.filter(binding => binding.key !== role.key),\n                        {\n                            key: role.key,\n                            name: role.name,\n                            avatar: role.avatar,\n                            updated_at: Date.now(),\n                        },\n                    ]);\n                    return {\n                        ...item,\n                        role_bindings: nextBindings,\n                        updated_at: Date.now(),\n                    };\n                });\n                state.last_global_preset_id = preset.id;\n            });\n            setStatus(`: ${role.name}  ${preset.name}`);\n        }\n        function bindCurrentRoleToSelectedPreset() {\n            const role = currentRoleContext.value;\n            if (!role) {\n                toastr.warning('');\n                return;\n            }\n            bindRoleToSelectedPreset(role);\n        }\n        function bindRoleCandidateToSelectedPreset(candidate) {\n            if (candidate.bound) {\n                return;\n            }\n            bindRoleToSelectedPreset(candidate);\n            closeRolePicker();\n        }\n        function removeRoleBindingFromSelectedPreset(bindingKey) {\n            const preset = selectedGlobalPreset.value;\n            if (!preset || !bindingKey) {\n                return;\n            }\n            updatePersistedState(state => {\n                state.global_presets = (state.global_presets ?? []).map(item => {\n                    if (item.id !== preset.id) {\n                        return item;\n                    }\n                    return {\n                        ...item,\n                        role_bindings: item.role_bindings.filter(binding => binding.key !== bindingKey),\n                        updated_at: Date.now(),\n                    };\n                });\n            });\n        }\n        function unbindCurrentRoleFromSelectedPreset() {\n            const role = currentRoleContext.value;\n            if (!role) {\n                toastr.warning('');\n                return;\n            }\n            removeRoleBindingFromSelectedPreset(role.key);\n            setStatus(`: ${role.name}`);\n        }\n        function saveCurrentAsGlobalPreset() {\n            const current = getCurrentGlobalWorldbookSet();\n            if (!current.length) {\n                toastr.warning('');\n                return;\n            }\n            const defaultName = selectedGlobalPreset.value?.name || ` ${globalWorldbookPresets.value.length + 1}`;\n            const nameRaw = prompt('', defaultName);\n            const name = toStringSafe(nameRaw).trim();\n            if (!name) {\n                return;\n            }\n            const sameNamePreset = globalWorldbookPresets.value.find(item => item.name === name);\n            if (sameNamePreset && !confirm(` \"${name}\" `)) {\n                return;\n            }\n            const presetId = sameNamePreset?.id || createId('global-preset');\n            const nextPreset = {\n                id: presetId,\n                name,\n                worldbooks: current,\n                role_bindings: sameNamePreset?.role_bindings ?? [],\n                updated_at: Date.now(),\n            };\n            updatePersistedState(state => {\n                const list = (state.global_presets ?? []).filter(item => item.id !== presetId);\n                list.unshift(nextPreset);\n                state.global_presets = list.slice(0, GLOBAL_PRESET_LIMIT);\n                state.last_global_preset_id = presetId;\n            });\n            selectedGlobalPresetId.value = presetId;\n            setStatus(`: ${name}${current.length} `);\n            toastr.success(`: ${name}`);\n        }\n        function overwriteSelectedGlobalPreset() {\n            const preset = selectedGlobalPreset.value;\n            if (!preset) {\n                return;\n            }\n            const current = getCurrentGlobalWorldbookSet();\n            if (!current.length) {\n                toastr.warning('');\n                return;\n            }\n            if (!confirm(` \"${preset.name}\" `)) {\n                return;\n            }\n            updatePersistedState(state => {\n                state.global_presets = (state.global_presets ?? []).map(item => {\n                    if (item.id !== preset.id) {\n                        return item;\n                    }\n                    return {\n                        ...item,\n                        worldbooks: current,\n                        updated_at: Date.now(),\n                    };\n                });\n                state.last_global_preset_id = preset.id;\n            });\n            setStatus(`: ${preset.name}${current.length} `);\n            toastr.success(`: ${preset.name}`);\n        }\n        function deleteSelectedGlobalPreset() {\n            const preset = selectedGlobalPreset.value;\n            if (!preset) {\n                return;\n            }\n            if (!confirm(` \"${preset.name}\" `)) {\n                return;\n            }\n            updatePersistedState(state => {\n                state.global_presets = (state.global_presets ?? []).filter(item => item.id !== preset.id);\n                if (state.last_global_preset_id === preset.id) {\n                    state.last_global_preset_id = '';\n                }\n            });\n            selectedGlobalPresetId.value = '';\n            setStatus(`: ${preset.name}`);\n        }\n        function closeWorldbookPicker() {\n            worldbookPickerOpen.value = false;\n        }\n        function closeRolePicker() {\n            rolePickerOpen.value = false;\n        }\n        function openWorldbookPicker() {\n            worldbookPickerSearchText.value = '';\n            worldbookPickerOpen.value = true;\n            void nextTick(() => {\n                worldbookPickerSearchInputRef.value?.focus();\n            });\n        }\n        function openRolePicker() {\n            if (!selectedGlobalPreset.value) {\n                return;\n            }\n            roleBindSearchText.value = '';\n            refreshRoleBindingCandidates();\n            rolePickerOpen.value = true;\n            void nextTick(() => {\n                rolePickerSearchInputRef.value?.focus();\n            });\n        }\n        function toggleWorldbookPicker() {\n            if (worldbookPickerOpen.value) {\n                closeWorldbookPicker();\n                return;\n            }\n            openWorldbookPicker();\n        }\n        function toggleRolePicker() {\n            if (rolePickerOpen.value) {\n                closeRolePicker();\n                return;\n            }\n            void openRolePicker();\n        }\n        function toggleTheme() {\n            const keys = Object.keys(THEMES);\n            const index = keys.indexOf(currentTheme.value);\n            const nextIndex = (index + 1) % keys.length;\n            currentTheme.value = keys[nextIndex];\n            setStatus(`: ${THEMES[currentTheme.value].name}`);\n        }\n        function setTheme(key) {\n            currentTheme.value = key;\n            themePickerOpen.value = false;\n            setStatus(`: ${THEMES[key].label}`);\n        }\n        function onSetThemeEvent(event) {\n            const key = event.detail;\n            if (key && key in THEMES) {\n                setTheme(key);\n            }\n        }\n        function selectWorldbookFromPicker(name) {\n            if (!name) {\n                return;\n            }\n            selectedWorldbookName.value = name;\n            closeWorldbookPicker();\n        }\n        function bindFirstRoleCandidate() {\n            const first = roleBindingCandidates.value.find(item => !item.bound);\n            if (!first) {\n                return;\n            }\n            bindRoleCandidateToSelectedPreset(first);\n        }\n        function onHostPointerDownForWorldbookPicker(event) {\n            if (!worldbookPickerOpen.value && !rolePickerOpen.value && !themePickerOpen.value) {\n                return;\n            }\n            const target = event.target;\n            if (!target) {\n                closeWorldbookPicker();\n                closeRolePicker();\n                themePickerOpen.value = false;\n                return;\n            }\n            if (worldbookPickerOpen.value) {\n                const worldbookRoot = worldbookPickerRef.value;\n                if (!worldbookRoot || !worldbookRoot.contains(target)) {\n                    closeWorldbookPicker();\n                }\n            }\n            if (rolePickerOpen.value) {\n                const roleRoot = rolePickerRef.value;\n                if (!roleRoot || !roleRoot.contains(target)) {\n                    closeRolePicker();\n                }\n            }\n            if (themePickerOpen.value) {\n                themePickerOpen.value = false;\n            }\n        }\n        function onHostKeyDownForWorldbookPicker(event) {\n            if (!worldbookPickerOpen.value && !rolePickerOpen.value) {\n                return;\n            }\n            if (event.key === 'Escape') {\n                closeWorldbookPicker();\n                closeRolePicker();\n            }\n        }\n        async function loadWorldbook(name) {\n            if (!name) {\n                return;\n            }\n            isBusy.value = true;\n            try {\n                const rawEntries = await getWorldbook(name);\n                const normalized = normalizeEntryList(rawEntries);\n                draftEntries.value = klona(normalized);\n                originalEntries.value = klona(normalized);\n                ensureSelectedEntryExists();\n                setStatus(` \"${name}\" ${normalized.length}`);\n            }\n            catch (error) {\n                const message = error instanceof Error ? error.message : String(error);\n                toastr.error(`: ${message}`);\n                setStatus(`: ${message}`);\n            }\n            finally {\n                isBusy.value = false;\n            }\n        }\n        async function reloadWorldbookNames(preferred) {\n            const names = [...getWorldbookNames()].sort((left, right) => left.localeCompare(right, 'zh-Hans-CN'));\n            worldbookNames.value = names;\n            if (!names.length) {\n                selectedWorldbookName.value = '';\n                draftEntries.value = [];\n                originalEntries.value = [];\n                selectedEntryUid.value = null;\n                return;\n            }\n            const fallbackName = persistedState.value.last_worldbook;\n            const candidate = (preferred && names.includes(preferred) && preferred) ||\n                (fallbackName && names.includes(fallbackName) && fallbackName) ||\n                selectedWorldbookName.value ||\n                names[0];\n            if (candidate && selectedWorldbookName.value !== candidate) {\n                selectedWorldbookName.value = candidate;\n                return;\n            }\n            if (selectedWorldbookName.value && !draftEntries.value.length) {\n                await loadWorldbook(selectedWorldbookName.value);\n            }\n        }\n        async function hardRefresh() {\n            persistedState.value = readPersistedState();\n            syncSelectedGlobalPresetFromState();\n            await reloadWorldbookNames(selectedWorldbookName.value || undefined);\n            await refreshBindings();\n            refreshRoleBindingCandidates();\n            refreshCurrentRoleContext();\n            await autoApplyRoleBoundPreset();\n            if (globalWorldbookMode.value) {\n                ensureSelectionForGlobalMode();\n            }\n            else {\n                trySelectWorldbookByContext({ preferWhenEmptyOnly: true });\n            }\n            setStatus('');\n        }\n        async function saveCurrentWorldbook() {\n            if (!selectedWorldbookName.value) {\n                toastr.warning('');\n                return;\n            }\n            if (!hasUnsavedChanges.value) {\n                setStatus('');\n                return;\n            }\n            isSaving.value = true;\n            try {\n                draftEntries.value = normalizeEntryList(draftEntries.value.map(entry => klona(entry)));\n                const pendingEntrySnapshots = collectEntrySnapshotsBeforeSave();\n                const savedEntrySnapshotCount = pushEntrySnapshotsBulk(pendingEntrySnapshots);\n                await replaceWorldbook(selectedWorldbookName.value, klona(draftEntries.value), { render: 'immediate' });\n                originalEntries.value = klona(draftEntries.value);\n                pushSnapshot('');\n                await refreshBindings();\n                toastr.success(`: ${selectedWorldbookName.value}`);\n                setStatus(`: ${selectedWorldbookName.value} +${savedEntrySnapshotCount}`);\n            }\n            catch (error) {\n                const message = error instanceof Error ? error.message : String(error);\n                toastr.error(`: ${message}`);\n                setStatus(`: ${message}`);\n            }\n            finally {\n                isSaving.value = false;\n            }\n        }\n        async function createNewWorldbook() {\n            const nameRaw = prompt('');\n            const name = toStringSafe(nameRaw).trim();\n            if (!name) {\n                return;\n            }\n            try {\n                await createOrReplaceWorldbook(name, [], { render: 'immediate' });\n                await reloadWorldbookNames(name);\n                await refreshBindings();\n                toastr.success(`: ${name}`);\n            }\n            catch (error) {\n                const message = error instanceof Error ? error.message : String(error);\n                toastr.error(`: ${message}`);\n            }\n        }\n        async function duplicateWorldbook() {\n            if (!selectedWorldbookName.value) {\n                return;\n            }\n            const suggested = `${selectedWorldbookName.value}_copy`;\n            const newNameRaw = prompt('', suggested);\n            const newName = toStringSafe(newNameRaw).trim();\n            if (!newName) {\n                return;\n            }\n            try {\n                await createOrReplaceWorldbook(newName, klona(draftEntries.value), { render: 'immediate' });\n                await reloadWorldbookNames(newName);\n                await refreshBindings();\n                toastr.success(`: ${newName}`);\n            }\n            catch (error) {\n                const message = error instanceof Error ? error.message : String(error);\n                toastr.error(`: ${message}`);\n            }\n        }\n        async function deleteCurrentWorldbook() {\n            if (!selectedWorldbookName.value) {\n                return;\n            }\n            const current = selectedWorldbookName.value;\n            if (!confirm(` \"${current}\" ?`)) {\n                return;\n            }\n            try {\n                const success = await deleteWorldbook(current);\n                if (!success) {\n                    throw new Error(' false');\n                }\n                updatePersistedState(state => {\n                    delete state.history[current];\n                    delete state.entry_history[current];\n                });\n                toastr.success(`: ${current}`);\n                await reloadWorldbookNames();\n                await refreshBindings();\n            }\n            catch (error) {\n                const message = error instanceof Error ? error.message : String(error);\n                toastr.error(`: ${message}`);\n            }\n        }\n        async function toggleGlobalBinding() {\n            if (!selectedWorldbookName.value) {\n                return;\n            }\n            const next = new Set(getGlobalWorldbookNames());\n            if (next.has(selectedWorldbookName.value)) {\n                next.delete(selectedWorldbookName.value);\n            }\n            else {\n                next.add(selectedWorldbookName.value);\n            }\n            await applyGlobalWorldbooks([...next], '');\n        }\n        function pushActivationLogs(entries) {\n            const logs = entries.map(item => {\n                const uid = item.uid ?? item.displayIndex ?? '?';\n                const name = toStringSafe(item.name ?? item.comment, `UID ${uid}`);\n                const content = toStringSafe(item.content).replace(/\\s+/g, ' ').trim().slice(0, 80);\n                return {\n                    id: createId('activation'),\n                    time: Date.now(),\n                    world: toStringSafe(item.world, 'unknown'),\n                    uid: typeof uid === 'number' || typeof uid === 'string' ? uid : '?',\n                    name,\n                    contentPreview: content || '()',\n                };\n            });\n            activationLogs.value.unshift(...logs);\n            if (activationLogs.value.length > ACTIVATION_LOG_LIMIT) {\n                activationLogs.value.length = ACTIVATION_LOG_LIMIT;\n            }\n        }\n        function clearActivationLogs() {\n            activationLogs.value = [];\n        }\n        function resolveHostWindow() {\n            return mainLayoutRef.value?.ownerDocument?.defaultView ?? editorShellRef.value?.ownerDocument?.defaultView ?? window;\n        }\n        function clampFloatingPanelToViewport(panel) {\n            const hostWin = resolveHostWindow();\n            const viewportWidth = hostWin.innerWidth;\n            const viewportHeight = hostWin.innerHeight;\n            const maxX = Math.max(8, viewportWidth - panel.width - 8);\n            const maxY = Math.max(8, viewportHeight - 68);\n            panel.x = clampNumber(panel.x, 8, maxX);\n            panel.y = clampNumber(panel.y, 8, maxY);\n        }\n        function handleFloatingWindowResize() {\n            const hostWin = resolveHostWindow();\n            viewportWidth.value = hostWin.innerWidth;\n            clampPaneWidths();\n            for (const key of floatingPanelKeys) {\n                if (!floatingPanels[key].visible) {\n                    continue;\n                }\n                clampFloatingPanelToViewport(floatingPanels[key]);\n            }\n        }\n        function bringFloatingToFront(key) {\n            floatingZCounter.value += 1;\n            floatingPanels[key].z = floatingZCounter.value;\n        }\n        function openFloatingPanel(key) {\n            const panel = floatingPanels[key];\n            panel.visible = true;\n            clampFloatingPanelToViewport(panel);\n            bringFloatingToFront(key);\n        }\n        function closeFloatingPanel(key) {\n            floatingPanels[key].visible = false;\n            if (activeFloatingDrag.value?.key === key) {\n                stopFloatingDrag();\n            }\n        }\n        function toggleFloatingPanel(key) {\n            if (floatingPanels[key].visible) {\n                closeFloatingPanel(key);\n                return;\n            }\n            openFloatingPanel(key);\n        }\n        function getFloatingPanelStyle(key) {\n            const panel = floatingPanels[key];\n            return {\n                left: `${panel.x}px`,\n                top: `${panel.y}px`,\n                zIndex: String(panel.z),\n                width: `${panel.width}px`,\n            };\n        }\n        function startFloatingDrag(key, event) {\n            if (event.pointerType === 'mouse' && event.button !== 0) {\n                return;\n            }\n            const panel = floatingPanels[key];\n            const target = event.currentTarget;\n            if (!target) {\n                return;\n            }\n            const hostDoc = target.ownerDocument ?? document;\n            const hostWin = hostDoc.defaultView ?? window;\n            const rect = target.getBoundingClientRect();\n            bringFloatingToFront(key);\n            const dragState = {\n                key,\n                pointerId: event.pointerId,\n                offsetX: event.clientX - panel.x,\n                offsetY: event.clientY - panel.y,\n                doc: hostDoc,\n                win: hostWin,\n            };\n            activeFloatingDrag.value = dragState;\n            target.setPointerCapture?.(event.pointerId);\n            hostDoc.addEventListener('pointermove', onFloatingDragMove);\n            hostDoc.addEventListener('pointerup', stopFloatingDrag);\n            hostDoc.addEventListener('pointercancel', stopFloatingDrag);\n            hostWin.addEventListener('blur', stopFloatingDrag);\n            panel.x = clampNumber(event.clientX - dragState.offsetX, 8, Math.max(8, hostWin.innerWidth - panel.width - 8));\n            panel.y = clampNumber(event.clientY - dragState.offsetY, 8, Math.max(8, hostWin.innerHeight - rect.height - 8));\n            event.preventDefault();\n        }\n        function onFloatingDragMove(event) {\n            const drag = activeFloatingDrag.value;\n            if (!drag) {\n                return;\n            }\n            if (event.pointerId !== drag.pointerId) {\n                return;\n            }\n            const panel = floatingPanels[drag.key];\n            panel.x = clampNumber(event.clientX - drag.offsetX, 8, Math.max(8, drag.win.innerWidth - panel.width - 8));\n            panel.y = clampNumber(event.clientY - drag.offsetY, 8, Math.max(8, drag.win.innerHeight - 68));\n        }\n        function stopFloatingDrag() {\n            const drag = activeFloatingDrag.value;\n            if (drag) {\n                drag.doc.removeEventListener('pointermove', onFloatingDragMove);\n                drag.doc.removeEventListener('pointerup', stopFloatingDrag);\n                drag.doc.removeEventListener('pointercancel', stopFloatingDrag);\n                drag.win.removeEventListener('blur', stopFloatingDrag);\n            }\n            activeFloatingDrag.value = null;\n        }\n        function clampPaneWidths() {\n            if (isCompactLayout.value) {\n                return;\n            }\n            const mainRect = mainLayoutRef.value?.getBoundingClientRect();\n            if (mainRect) {\n                const maxLeft = Math.max(MAIN_PANE_MIN, Math.floor(mainRect.width - MAIN_EDITOR_MIN - RESIZE_HANDLE_SIZE));\n                mainPaneWidth.value = clampNumber(mainPaneWidth.value, MAIN_PANE_MIN, maxLeft);\n            }\n            const editorRect = editorShellRef.value?.getBoundingClientRect();\n            if (editorRect) {\n                const maxSide = Math.max(EDITOR_SIDE_MIN, Math.floor(editorRect.width - EDITOR_CENTER_MIN - RESIZE_HANDLE_SIZE));\n                editorSideWidth.value = clampNumber(editorSideWidth.value, EDITOR_SIDE_MIN, maxSide);\n            }\n        }\n        function startContentResize(e) {\n            e.preventDefault();\n            const textarea = contentTextareaRef.value;\n            if (!textarea)\n                return;\n            const startY = e.clientY;\n            const startHeight = textarea.offsetHeight;\n            const target = e.currentTarget;\n            target.setPointerCapture(e.pointerId);\n            // Disable textarea interaction during drag to reduce reflow\n            textarea.style.pointerEvents = 'none';\n            textarea.style.willChange = 'height';\n            let rafId = 0;\n            let pendingHeight = startHeight;\n            const applyHeight = () => {\n                textarea.style.height = `${pendingHeight}px`;\n                textarea.style.minHeight = `${pendingHeight}px`;\n                rafId = 0;\n            };\n            const onMove = (ev) => {\n                pendingHeight = Math.max(120, startHeight + (ev.clientY - startY));\n                if (!rafId) {\n                    rafId = requestAnimationFrame(applyHeight);\n                }\n            };\n            const onUp = () => {\n                if (rafId)\n                    cancelAnimationFrame(rafId);\n                applyHeight();\n                textarea.style.pointerEvents = '';\n                textarea.style.willChange = '';\n                target.removeEventListener('pointermove', onMove);\n                target.removeEventListener('pointerup', onUp);\n            };\n            target.addEventListener('pointermove', onMove);\n            target.addEventListener('pointerup', onUp);\n        }\n        const editorContentBlockRef = ref(null);\n        let contentTopDragOffset = 0;\n        function startContentTopDrag(e) {\n            e.preventDefault();\n            const block = editorContentBlockRef.value;\n            if (!block)\n                return;\n            const startY = e.clientY;\n            const startOffset = contentTopDragOffset;\n            const target = e.currentTarget;\n            target.setPointerCapture(e.pointerId);\n            let rafId = 0;\n            let pendingOffset = startOffset;\n            const apply = () => {\n                block.style.marginTop = `${-pendingOffset}px`;\n                rafId = 0;\n            };\n            const onMove = (ev) => {\n                const delta = startY - ev.clientY; // positive = drag up\n                pendingOffset = Math.max(0, Math.min(400, startOffset + delta));\n                if (!rafId) {\n                    rafId = requestAnimationFrame(apply);\n                }\n            };\n            const onUp = () => {\n                if (rafId)\n                    cancelAnimationFrame(rafId);\n                contentTopDragOffset = pendingOffset;\n                apply();\n                target.removeEventListener('pointermove', onMove);\n                target.removeEventListener('pointerup', onUp);\n            };\n            target.addEventListener('pointermove', onMove);\n            target.addEventListener('pointerup', onUp);\n        }\n        function startPaneResize(key, event) {\n            if (isCompactLayout.value) {\n                return;\n            }\n            if (event.pointerType === 'mouse' && event.button !== 0) {\n                return;\n            }\n            const target = event.currentTarget;\n            const hostDoc = target?.ownerDocument ?? document;\n            const hostWin = hostDoc.defaultView ?? window;\n            paneResizeState.value = {\n                key,\n                pointerId: event.pointerId,\n                doc: hostDoc,\n                win: hostWin,\n            };\n            target?.setPointerCapture?.(event.pointerId);\n            hostDoc.addEventListener('pointermove', onPaneResizeMove);\n            hostDoc.addEventListener('pointerup', stopPaneResize);\n            hostDoc.addEventListener('pointercancel', stopPaneResize);\n            hostWin.addEventListener('blur', stopPaneResize);\n            event.preventDefault();\n        }\n        function onPaneResizeMove(event) {\n            const state = paneResizeState.value;\n            if (!state || event.pointerId !== state.pointerId) {\n                return;\n            }\n            if (state.key === 'main') {\n                const rect = mainLayoutRef.value?.getBoundingClientRect();\n                if (!rect) {\n                    return;\n                }\n                const left = Math.floor(event.clientX - rect.left);\n                const maxLeft = Math.max(MAIN_PANE_MIN, Math.floor(rect.width - MAIN_EDITOR_MIN - RESIZE_HANDLE_SIZE));\n                mainPaneWidth.value = clampNumber(left, MAIN_PANE_MIN, maxLeft);\n                return;\n            }\n            const rect = editorShellRef.value?.getBoundingClientRect();\n            if (!rect) {\n                return;\n            }\n            const side = Math.floor(rect.right - event.clientX);\n            const maxSide = Math.max(EDITOR_SIDE_MIN, Math.floor(rect.width - EDITOR_CENTER_MIN - RESIZE_HANDLE_SIZE));\n            editorSideWidth.value = clampNumber(side, EDITOR_SIDE_MIN, maxSide);\n        }\n        function stopPaneResize() {\n            const state = paneResizeState.value;\n            if (state) {\n                state.doc.removeEventListener('pointermove', onPaneResizeMove);\n                state.doc.removeEventListener('pointerup', stopPaneResize);\n                state.doc.removeEventListener('pointercancel', stopPaneResize);\n                state.win.removeEventListener('blur', stopPaneResize);\n            }\n            paneResizeState.value = null;\n        }\n        function onPanelRefresh() {\n            void hardRefresh();\n        }\n        function onPanelSave() {\n            void saveCurrentWorldbook();\n        }\n        function discardUnsavedDraft() {\n            if (!hasUnsavedChanges.value) {\n                const target = window;\n                target[DIRTY_STATE_KEY] = false;\n                return;\n            }\n            draftEntries.value = klona(originalEntries.value);\n            ensureSelectedEntryExists();\n            resetFindState();\n            setStatus('');\n        }\n        function onPanelDiscard() {\n            discardUnsavedDraft();\n        }\n        const rootRef = ref(null);\n        let _rootResizeObserver = null;\n        let _mobileResizeHandler = null;\n        onMounted(() => {\n            // Fix mobile height: compute exact pixel height based on viewport position\n            if (isMobile.value && rootRef.value) {\n                const hostWin = (() => { try {\n                    return window.parent || window;\n                }\n                catch {\n                    return window;\n                } })();\n                const el = rootRef.value;\n                const syncHeight = () => {\n                    if (!el)\n                        return;\n                    const rect = el.getBoundingClientRect();\n                    const vh = hostWin.innerHeight || window.innerHeight || 0;\n                    const available = vh - rect.top;\n                    if (available > 0) {\n                        el.style.height = available + 'px';\n                        el.style.maxHeight = available + 'px';\n                        el.style.overflow = 'hidden';\n                    }\n                };\n                // Initial + delayed (wait for layout)\n                syncHeight();\n                requestAnimationFrame(syncHeight);\n                setTimeout(syncHeight, 100);\n                setTimeout(syncHeight, 500);\n                // Respond to resize\n                _mobileResizeHandler = syncHeight;\n                hostWin.addEventListener('resize', syncHeight);\n                // Also observe parent just in case\n                const parent = el.parentElement;\n                if (parent) {\n                    _rootResizeObserver = new ResizeObserver(syncHeight);\n                    _rootResizeObserver.observe(parent);\n                }\n            }\n            persistedState.value = readPersistedState();\n            syncSelectedGlobalPresetFromState();\n            subscriptions.push(eventOn(tavern_events.WORLD_INFO_ACTIVATED, entries => {\n                pushActivationLogs(entries);\n            }));\n            subscriptions.push(eventOn(tavern_events.WORLDINFO_UPDATED, () => {\n                void hardRefresh();\n            }));\n            subscriptions.push(eventOn(tavern_events.CHAT_CHANGED, () => {\n                void (async () => {\n                    await refreshBindings();\n                    refreshRoleBindingCandidates();\n                    refreshCurrentRoleContext();\n                    await autoApplyRoleBoundPreset();\n                    if (globalWorldbookMode.value) {\n                        ensureSelectionForGlobalMode();\n                        return;\n                    }\n                    trySelectWorldbookByContext();\n                })();\n            }));\n            window.addEventListener('wb-helper:refresh', onPanelRefresh);\n            window.addEventListener('wb-helper:save', onPanelSave);\n            window.addEventListener('wb-helper:discard', onPanelDiscard);\n            window.addEventListener('wb-helper:toggle-theme', toggleTheme);\n            window.addEventListener('wb-helper:set-theme', onSetThemeEvent);\n            hostResizeWindow.value = resolveHostWindow();\n            const hostDoc = hostResizeWindow.value.document;\n            hostDoc.addEventListener('pointerdown', onHostPointerDownForWorldbookPicker, true);\n            hostDoc.addEventListener('keydown', onHostKeyDownForWorldbookPicker, true);\n            hostResizeWindow.value.addEventListener('resize', handleFloatingWindowResize);\n            handleFloatingWindowResize();\n            updateHostPanelTheme();\n            void hardRefresh();\n        });\n        onUnmounted(() => {\n            _rootResizeObserver?.disconnect();\n            _rootResizeObserver = null;\n            if (_mobileResizeHandler) {\n                try {\n                    (window.parent || window).removeEventListener('resize', _mobileResizeHandler);\n                }\n                catch { /* ignore */ }\n                _mobileResizeHandler = null;\n            }\n            const target = window;\n            target[DIRTY_STATE_KEY] = false;\n            subscriptions.forEach(subscription => {\n                subscription.stop();\n            });\n            stopFloatingDrag();\n            stopPaneResize();\n            window.removeEventListener('wb-helper:refresh', onPanelRefresh);\n            window.removeEventListener('wb-helper:save', onPanelSave);\n            window.removeEventListener('wb-helper:discard', onPanelDiscard);\n            window.removeEventListener('wb-helper:toggle-theme', toggleTheme);\n            window.removeEventListener('wb-helper:set-theme', onSetThemeEvent);\n            hostResizeWindow.value?.document.removeEventListener('pointerdown', onHostPointerDownForWorldbookPicker, true);\n            hostResizeWindow.value?.document.removeEventListener('keydown', onHostKeyDownForWorldbookPicker, true);\n            hostResizeWindow.value?.removeEventListener('resize', handleFloatingWindowResize);\n            hostResizeWindow.value = null;\n        });\n        function updateHostPanelTheme() {\n            const panel = document.getElementById('wb-assistant-panel');\n            if (!panel)\n                return;\n            const theme = THEMES[currentTheme.value];\n            const colors = theme.colors;\n            panel.style.setProperty('--wb-host-bg', colors['--wb-bg-root']);\n            panel.style.setProperty('--wb-host-header-bg', colors['--wb-bg-panel']);\n            panel.style.setProperty('--wb-host-border', colors['--wb-border-main']);\n            panel.style.setProperty('--wb-host-text', colors['--wb-text-main']);\n            panel.style.setProperty('--wb-host-tool-bg', colors['--wb-input-bg']);\n            panel.style.setProperty('--wb-host-tool-border', colors['--wb-border-subtle']);\n        }\n        watch(currentTheme, () => {\n            updateHostPanelTheme();\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                ref_key: \"rootRef\",\n                ref: rootRef,\n                class: \"wb-assistant-root\",\n                style: _normalizeStyle(_unref(themeStyles))\n            }, [\n                _createCommentVNode(\"  Mobile Tab View  \"),\n                (_unref(isMobile))\n                    ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                        _createElementVNode(\"div\", _hoisted_1, [\n                            _createElementVNode(\"div\", _hoisted_2, [\n                                _createCommentVNode(\" Tab:  \"),\n                                _withDirectives(_createElementVNode(\"div\", _hoisted_3, [\n                                    _createElementVNode(\"section\", _hoisted_4, [\n                                        _createElementVNode(\"label\", _hoisted_5, [\n                                            _cache[101] || (_cache[101] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                            _createElementVNode(\"div\", {\n                                                ref_key: \"worldbookPickerRef\",\n                                                ref: worldbookPickerRef,\n                                                class: \"worldbook-picker\"\n                                            }, [\n                                                _createElementVNode(\"button\", {\n                                                    class: \"worldbook-picker-trigger\",\n                                                    type: \"button\",\n                                                    onClick: toggleWorldbookPicker\n                                                }, [\n                                                    _createElementVNode(\"span\", {\n                                                        class: \"worldbook-picker-trigger-text\",\n                                                        title: _unref(selectedWorldbookName) || ''\n                                                    }, _toDisplayString(_unref(selectedWorldbookName) || ''), 9 /* TEXT, PROPS */, _hoisted_6),\n                                                    _cache[100] || (_cache[100] = _createElementVNode(\"span\", { class: \"worldbook-picker-arrow\" }, \"\", -1 /* CACHED */))\n                                                ]),\n                                                (_unref(worldbookPickerOpen))\n                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_7, [\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            \"onUpdate:modelValue\": _cache[0] || (_cache[0] = ($event) => (_isRef(worldbookPickerSearchText) ? (worldbookPickerSearchText).value = $event : null)),\n                                                            type: \"text\",\n                                                            class: \"text-input worldbook-picker-search\",\n                                                            placeholder: \"...\",\n                                                            onKeydown: _cache[1] || (_cache[1] = _withKeys(_withModifiers(($event) => (_unref(filteredSelectableWorldbookNames)[0] && selectWorldbookFromPicker(_unref(filteredSelectableWorldbookNames)[0])), [\"prevent\"]), [\"enter\"]))\n                                                        }, null, 544 /* NEED_HYDRATION, NEED_PATCH */), [\n                                                            [_vModelText, _unref(worldbookPickerSearchText)]\n                                                        ]),\n                                                        _createElementVNode(\"div\", _hoisted_8, [\n                                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(filteredSelectableWorldbookNames), (name) => {\n                                                                return (_openBlock(), _createElementBlock(\"button\", {\n                                                                    key: `wb-pick-m-${name}`,\n                                                                    class: _normalizeClass([\"worldbook-picker-item\", { active: name === _unref(selectedWorldbookName) }]),\n                                                                    type: \"button\",\n                                                                    onClick: ($event) => (selectWorldbookFromPicker(name))\n                                                                }, _toDisplayString(name), 11 /* TEXT, CLASS, PROPS */, _hoisted_9));\n                                                            }), 128 /* KEYED_FRAGMENT */)),\n                                                            (!_unref(filteredSelectableWorldbookNames).length)\n                                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_10, \"\"))\n                                                                : _createCommentVNode(\"v-if\", true)\n                                                        ])\n                                                    ]))\n                                                    : _createCommentVNode(\"v-if\", true)\n                                            ], 512 /* NEED_PATCH */)\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_11, [\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn\",\n                                                type: \"button\",\n                                                disabled: !_unref(hasUnsavedChanges),\n                                                onClick: saveCurrentWorldbook,\n                                                style: { \"padding\": \"8px 14px\", \"font-size\": \"13px\" }\n                                            }, \" \", 8 /* PROPS */, _hoisted_12),\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn\",\n                                                type: \"button\",\n                                                onClick: addEntry,\n                                                style: { \"padding\": \"8px 14px\", \"font-size\": \"13px\" }\n                                            }, \"+ \"),\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn\",\n                                                type: \"button\",\n                                                onClick: triggerImport,\n                                                style: { \"padding\": \"8px 14px\", \"font-size\": \"13px\" }\n                                            }, \" \"),\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn\",\n                                                type: \"button\",\n                                                disabled: !_unref(selectedWorldbookName),\n                                                onClick: exportCurrentWorldbook,\n                                                style: { \"padding\": \"8px 14px\", \"font-size\": \"13px\" }\n                                            }, \" \", 8 /* PROPS */, _hoisted_13),\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn\",\n                                                type: \"button\",\n                                                onClick: toggleGlobalMode,\n                                                style: _normalizeStyle({ padding: '8px 14px', fontSize: '13px', background: _unref(globalWorldbookMode) ? '#2563eb' : '', color: _unref(globalWorldbookMode) ? '#fff' : '' })\n                                            }, \" \", 4 /* STYLE */)\n                                        ])\n                                    ]),\n                                    (_unref(bindings).global.length || _unref(bindings).charPrimary || _unref(bindings).charAdditional.length || _unref(bindings).chat)\n                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_14, [\n                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(bindings).global, (name) => {\n                                                return (_openBlock(), _createElementBlock(\"span\", {\n                                                    key: `bg-m-${name}`,\n                                                    class: \"binding-chip global\",\n                                                    title: name\n                                                }, _toDisplayString(name), 9 /* TEXT, PROPS */, _hoisted_15));\n                                            }), 128 /* KEYED_FRAGMENT */)),\n                                            (_unref(bindings).charPrimary)\n                                                ? (_openBlock(), _createElementBlock(\"span\", {\n                                                    key: `bc-m-${_unref(bindings).charPrimary}`,\n                                                    class: \"binding-chip char\",\n                                                    title: _unref(bindings).charPrimary\n                                                }, _toDisplayString(_unref(bindings).charPrimary), 9 /* TEXT, PROPS */, _hoisted_16))\n                                                : _createCommentVNode(\"v-if\", true),\n                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(bindings).charAdditional, (name) => {\n                                                return (_openBlock(), _createElementBlock(\"span\", {\n                                                    key: `bca-m-${name}`,\n                                                    class: \"binding-chip char\",\n                                                    title: name\n                                                }, _toDisplayString(name), 9 /* TEXT, PROPS */, _hoisted_17));\n                                            }), 128 /* KEYED_FRAGMENT */)),\n                                            (_unref(bindings).chat)\n                                                ? (_openBlock(), _createElementBlock(\"span\", {\n                                                    key: `bch-m-${_unref(bindings).chat}`,\n                                                    class: \"binding-chip chat\",\n                                                    title: _unref(bindings).chat\n                                                }, _toDisplayString(_unref(bindings).chat), 9 /* TEXT, PROPS */, _hoisted_18))\n                                                : _createCommentVNode(\"v-if\", true)\n                                        ]))\n                                        : _createCommentVNode(\"v-if\", true),\n                                    _createCommentVNode(\" Global Mode Panel (mobile) \"),\n                                    (_unref(globalWorldbookMode))\n                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_19, [\n                                            _createElementVNode(\"div\", _hoisted_20, [\n                                                _createElementVNode(\"span\", _hoisted_21, \" \" + _toDisplayString(_unref(bindings).global.length) + \"\", 1 /* TEXT */),\n                                                _createElementVNode(\"button\", {\n                                                    class: \"btn mini danger\",\n                                                    type: \"button\",\n                                                    disabled: !_unref(bindings).global.length,\n                                                    onClick: clearGlobalWorldbooks,\n                                                    style: { \"font-size\": \"11px\" }\n                                                }, \"\", 8 /* PROPS */, _hoisted_22)\n                                            ]),\n                                            _createElementVNode(\"label\", _hoisted_23, [\n                                                _cache[103] || (_cache[103] = _createElementVNode(\"span\", { style: { \"font-size\": \"12px\" } }, \"\", -1 /* CACHED */)),\n                                                _withDirectives(_createElementVNode(\"select\", {\n                                                    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = ($event) => (_isRef(selectedGlobalPresetId) ? (selectedGlobalPresetId).value = $event : null)),\n                                                    class: \"text-input\",\n                                                    onChange: onGlobalPresetSelectionChanged,\n                                                    style: { \"font-size\": \"12px\" }\n                                                }, [\n                                                    _cache[102] || (_cache[102] = _createElementVNode(\"option\", { value: \"\" }, \"\", -1 /* CACHED */)),\n                                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(globalWorldbookPresets), (preset) => {\n                                                        return (_openBlock(), _createElementBlock(\"option\", {\n                                                            key: preset.id,\n                                                            value: preset.id\n                                                        }, _toDisplayString(preset.name) + \"\" + _toDisplayString(preset.worldbooks.length) + \" \", 9 /* TEXT, PROPS */, _hoisted_24));\n                                                    }), 128 /* KEYED_FRAGMENT */))\n                                                ], 544 /* NEED_HYDRATION, NEED_PATCH */), [\n                                                    [_vModelSelect, _unref(selectedGlobalPresetId)]\n                                                ])\n                                            ]),\n                                            _createElementVNode(\"div\", _hoisted_25, [\n                                                _createElementVNode(\"button\", {\n                                                    class: \"btn mini\",\n                                                    type: \"button\",\n                                                    disabled: !_unref(bindings).global.length,\n                                                    onClick: saveCurrentAsGlobalPreset,\n                                                    style: { \"font-size\": \"11px\" }\n                                                }, \"\", 8 /* PROPS */, _hoisted_26),\n                                                _createElementVNode(\"button\", {\n                                                    class: \"btn mini\",\n                                                    type: \"button\",\n                                                    disabled: !_unref(selectedGlobalPreset),\n                                                    onClick: overwriteSelectedGlobalPreset,\n                                                    style: { \"font-size\": \"11px\" }\n                                                }, \"\", 8 /* PROPS */, _hoisted_27),\n                                                _createElementVNode(\"button\", {\n                                                    class: \"btn mini danger\",\n                                                    type: \"button\",\n                                                    disabled: !_unref(selectedGlobalPreset),\n                                                    onClick: deleteSelectedGlobalPreset,\n                                                    style: { \"font-size\": \"11px\" }\n                                                }, \"\", 8 /* PROPS */, _hoisted_28)\n                                            ]),\n                                            _createElementVNode(\"label\", _hoisted_29, [\n                                                _cache[104] || (_cache[104] = _createElementVNode(\"span\", { style: { \"font-size\": \"12px\" } }, \"\", -1 /* CACHED */)),\n                                                _withDirectives(_createElementVNode(\"input\", {\n                                                    \"onUpdate:modelValue\": _cache[3] || (_cache[3] = ($event) => (_isRef(globalAddSearchText) ? (globalAddSearchText).value = $event : null)),\n                                                    type: \"text\",\n                                                    class: \"text-input\",\n                                                    placeholder: \"...\",\n                                                    onKeydown: _withKeys(_withModifiers(addFirstGlobalCandidate, [\"prevent\"]), [\"enter\"]),\n                                                    style: { \"font-size\": \"12px\" }\n                                                }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_30), [\n                                                    [_vModelText, _unref(globalAddSearchText)]\n                                                ])\n                                            ]),\n                                            (_unref(globalAddCandidates).length)\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_31, [\n                                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(globalAddCandidates), (name) => {\n                                                        return (_openBlock(), _createElementBlock(\"button\", {\n                                                            key: `m-add-${name}`,\n                                                            type: \"button\",\n                                                            style: { \"display\": \"flex\", \"justify-content\": \"space-between\", \"align-items\": \"center\", \"width\": \"100%\", \"padding\": \"6px 8px\", \"border\": \"none\", \"background\": \"var(--wb-input-bg)\", \"border-radius\": \"4px\", \"color\": \"var(--wb-text-main)\", \"font-size\": \"12px\", \"margin-bottom\": \"2px\", \"cursor\": \"pointer\" },\n                                                            onClick: ($event) => (addGlobalWorldbook(name))\n                                                        }, [\n                                                            _createElementVNode(\"span\", null, _toDisplayString(name), 1 /* TEXT */),\n                                                            _cache[105] || (_cache[105] = _createElementVNode(\"span\", { style: { \"color\": \"#22c55e\" } }, \"+ \", -1 /* CACHED */))\n                                                        ], 8 /* PROPS */, _hoisted_32));\n                                                    }), 128 /* KEYED_FRAGMENT */))\n                                                ]))\n                                                : _createCommentVNode(\"v-if\", true),\n                                            (_unref(filteredGlobalWorldbooks).length)\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_33, \"\"))\n                                                : _createCommentVNode(\"v-if\", true),\n                                            _createElementVNode(\"div\", _hoisted_34, [\n                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(filteredGlobalWorldbooks), (name) => {\n                                                    return (_openBlock(), _createElementBlock(\"button\", {\n                                                        key: `m-gl-${name}`,\n                                                        type: \"button\",\n                                                        style: { \"display\": \"flex\", \"justify-content\": \"space-between\", \"align-items\": \"center\", \"width\": \"100%\", \"padding\": \"6px 8px\", \"border\": \"none\", \"background\": \"var(--wb-input-bg)\", \"border-radius\": \"4px\", \"color\": \"var(--wb-text-main)\", \"font-size\": \"12px\", \"cursor\": \"pointer\" },\n                                                        onClick: ($event) => (removeGlobalWorldbook(name))\n                                                    }, [\n                                                        _createElementVNode(\"span\", null, _toDisplayString(name), 1 /* TEXT */),\n                                                        _cache[106] || (_cache[106] = _createElementVNode(\"span\", { style: { \"color\": \"#ef4444\" } }, \"\", -1 /* CACHED */))\n                                                    ], 8 /* PROPS */, _hoisted_35));\n                                                }), 128 /* KEYED_FRAGMENT */))\n                                            ]),\n                                            _createCommentVNode(\" Role Binding Section \"),\n                                            _createElementVNode(\"div\", _hoisted_36, [\n                                                _cache[108] || (_cache[108] = _createElementVNode(\"div\", { style: { \"font-size\": \"12px\", \"font-weight\": \"600\", \"margin-bottom\": \"6px\" } }, \"\", -1 /* CACHED */)),\n                                                _createElementVNode(\"div\", {\n                                                    style: _normalizeStyle([{ \"font-size\": \"11px\", \"margin-bottom\": \"6px\", \"opacity\": \"0.8\" }, { color: _unref(currentRoleContext) ? '#60a5fa' : '#94a3b8' }])\n                                                }, _toDisplayString(_unref(currentRoleContext) ? `: ${_unref(currentRoleContext).name}` : ''), 5 /* TEXT, STYLE */),\n                                                _createElementVNode(\"div\", _hoisted_37, [\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"btn mini\",\n                                                        type: \"button\",\n                                                        disabled: !_unref(selectedGlobalPreset) || !_unref(currentRoleContext),\n                                                        onClick: bindCurrentRoleToSelectedPreset,\n                                                        style: { \"font-size\": \"11px\" }\n                                                    }, \"\", 8 /* PROPS */, _hoisted_38),\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"btn mini\",\n                                                        type: \"button\",\n                                                        disabled: !_unref(selectedGlobalPreset) || !_unref(isCurrentRoleBoundToSelectedPreset),\n                                                        onClick: unbindCurrentRoleFromSelectedPreset,\n                                                        style: { \"font-size\": \"11px\" }\n                                                    }, \"\", 8 /* PROPS */, _hoisted_39)\n                                                ]),\n                                                _createElementVNode(\"div\", _hoisted_40, [\n                                                    _createElementVNode(\"button\", {\n                                                        type: \"button\",\n                                                        disabled: !_unref(selectedGlobalPreset),\n                                                        onClick: toggleRolePicker,\n                                                        style: { \"display\": \"flex\", \"justify-content\": \"space-between\", \"align-items\": \"center\", \"width\": \"100%\", \"padding\": \"6px 8px\", \"border\": \"1px solid var(--wb-border-subtle)\", \"border-radius\": \"4px\", \"background\": \"var(--wb-input-bg)\", \"color\": \"var(--wb-text-main)\", \"font-size\": \"12px\", \"cursor\": \"pointer\" }\n                                                    }, [\n                                                        _createElementVNode(\"span\", null, _toDisplayString(_unref(selectedGlobalPreset) ? '' : ''), 1 /* TEXT */),\n                                                        _createElementVNode(\"span\", null, _toDisplayString(_unref(rolePickerOpen) ? '' : ''), 1 /* TEXT */)\n                                                    ], 8 /* PROPS */, _hoisted_41),\n                                                    (_unref(rolePickerOpen))\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_42, [\n                                                            _withDirectives(_createElementVNode(\"input\", {\n                                                                \"onUpdate:modelValue\": _cache[4] || (_cache[4] = ($event) => (_isRef(roleBindSearchText) ? (roleBindSearchText).value = $event : null)),\n                                                                type: \"text\",\n                                                                class: \"text-input\",\n                                                                placeholder: \"...\",\n                                                                style: { \"font-size\": \"12px\", \"margin-bottom\": \"4px\" },\n                                                                onKeydown: _withKeys(_withModifiers(bindFirstRoleCandidate, [\"prevent\"]), [\"enter\"])\n                                                            }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_43), [\n                                                                [_vModelText, _unref(roleBindSearchText)]\n                                                            ]),\n                                                            _createElementVNode(\"div\", _hoisted_44, [\n                                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(roleBindingCandidates), (candidate) => {\n                                                                    return (_openBlock(), _createElementBlock(\"button\", {\n                                                                        key: `m-role-${candidate.key}`,\n                                                                        type: \"button\",\n                                                                        disabled: candidate.bound,\n                                                                        style: _normalizeStyle([{ \"display\": \"flex\", \"justify-content\": \"space-between\", \"align-items\": \"center\", \"width\": \"100%\", \"padding\": \"6px 8px\", \"border\": \"none\", \"background\": \"var(--wb-input-bg)\", \"border-radius\": \"4px\", \"color\": \"var(--wb-text-main)\", \"font-size\": \"12px\", \"margin-bottom\": \"2px\", \"cursor\": \"pointer\", \"opacity\": \"1\" }, { opacity: candidate.bound ? '0.5' : '1' }]),\n                                                                        onClick: ($event) => (bindRoleCandidateToSelectedPreset(candidate))\n                                                                    }, [\n                                                                        _createElementVNode(\"span\", null, _toDisplayString(candidate.name), 1 /* TEXT */),\n                                                                        _createElementVNode(\"span\", {\n                                                                            style: _normalizeStyle({ color: candidate.bound ? '#94a3b8' : '#22c55e' })\n                                                                        }, _toDisplayString(candidate.bound ? '' : ''), 5 /* TEXT, STYLE */)\n                                                                    ], 12 /* STYLE, PROPS */, _hoisted_45));\n                                                                }), 128 /* KEYED_FRAGMENT */)),\n                                                                (!_unref(roleBindingCandidates).length)\n                                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_46, \"\"))\n                                                                    : _createCommentVNode(\"v-if\", true)\n                                                            ])\n                                                        ]))\n                                                        : _createCommentVNode(\"v-if\", true)\n                                                ]),\n                                                (_unref(selectedGlobalPreset))\n                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_47, [\n                                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(selectedGlobalPresetRoleBindings), (binding) => {\n                                                            return (_openBlock(), _createElementBlock(\"button\", {\n                                                                key: `m-rb-${_unref(selectedGlobalPreset)?.id}-${binding.key}`,\n                                                                type: \"button\",\n                                                                style: { \"display\": \"inline-flex\", \"align-items\": \"center\", \"gap\": \"4px\", \"padding\": \"4px 8px\", \"border\": \"1px solid var(--wb-border-subtle)\", \"border-radius\": \"4px\", \"background\": \"var(--wb-input-bg)\", \"color\": \"var(--wb-text-main)\", \"font-size\": \"11px\", \"cursor\": \"pointer\" },\n                                                                onClick: ($event) => (removeRoleBindingFromSelectedPreset(binding.key))\n                                                            }, [\n                                                                _createTextVNode(_toDisplayString(binding.name) + \" \", 1 /* TEXT */),\n                                                                _cache[107] || (_cache[107] = _createElementVNode(\"span\", { style: { \"color\": \"#ef4444\" } }, \"\", -1 /* CACHED */))\n                                                            ], 8 /* PROPS */, _hoisted_48));\n                                                        }), 128 /* KEYED_FRAGMENT */)),\n                                                        (!_unref(selectedGlobalPresetRoleBindings).length)\n                                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_49, \"\"))\n                                                            : _createCommentVNode(\"v-if\", true)\n                                                    ]))\n                                                    : (_openBlock(), _createElementBlock(\"div\", _hoisted_50, \"\"))\n                                            ])\n                                        ]))\n                                        : _createCommentVNode(\"v-if\", true),\n                                    _createElementVNode(\"div\", _hoisted_51, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(filteredEntries), (entry) => {\n                                            return (_openBlock(), _createElementBlock(\"button\", {\n                                                key: `me-${entry.uid}`,\n                                                type: \"button\",\n                                                class: _normalizeClass([\"entry-item\", { selected: entry.uid === _unref(selectedEntryUid), disabled: !entry.enabled }]),\n                                                \"data-status\": getEntryVisualStatus(entry),\n                                                onClick: ($event) => (selectEntry(entry.uid)),\n                                                style: { \"border\": \"1px solid var(--wb-border-subtle)\", \"border-radius\": \"8px\", \"padding\": \"8px 10px\", \"margin-bottom\": \"4px\" }\n                                            }, [\n                                                _createElementVNode(\"div\", _hoisted_53, [\n                                                    _createElementVNode(\"span\", {\n                                                        class: \"entry-status-dot\",\n                                                        \"data-status\": getEntryVisualStatus(entry)\n                                                    }, null, 8 /* PROPS */, _hoisted_54),\n                                                    _createElementVNode(\"div\", _hoisted_55, _toDisplayString(entry.name || ` ${entry.uid}`), 1 /* TEXT */),\n                                                    _createElementVNode(\"span\", _hoisted_56, \"#\" + _toDisplayString(entry.uid), 1 /* TEXT */)\n                                                ]),\n                                                (entry.strategy.keys?.length)\n                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_57, _toDisplayString(entry.strategy.keys.join(', ')), 1 /* TEXT */))\n                                                    : _createCommentVNode(\"v-if\", true),\n                                                _createElementVNode(\"div\", _hoisted_58, [\n                                                    _createElementVNode(\"span\", _hoisted_59, \" \" + _toDisplayString(getPositionTypeLabel(entry.position.type)), 1 /* TEXT */),\n                                                    _createElementVNode(\"span\", _hoisted_60, \" #\" + _toDisplayString(entry.position.order), 1 /* TEXT */),\n                                                    (entry.recursion.prevent_incoming)\n                                                        ? (_openBlock(), _createElementBlock(\"span\", _hoisted_61, \"\"))\n                                                        : _createCommentVNode(\"v-if\", true),\n                                                    (entry.recursion.prevent_outgoing)\n                                                        ? (_openBlock(), _createElementBlock(\"span\", _hoisted_62, \"\"))\n                                                        : _createCommentVNode(\"v-if\", true)\n                                                ])\n                                            ], 10 /* CLASS, PROPS */, _hoisted_52));\n                                        }), 128 /* KEYED_FRAGMENT */)),\n                                        (!_unref(filteredEntries).length)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_63, \"\"))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ])\n                                ], 512 /* NEED_PATCH */), [\n                                    [_vShow, _unref(mobileTab) === 'list']\n                                ]),\n                                _createCommentVNode(\" Tab:  \"),\n                                _withDirectives(_createElementVNode(\"div\", _hoisted_64, [\n                                    (_unref(selectedEntry))\n                                        ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                                            _createElementVNode(\"header\", _hoisted_65, [\n                                                _createElementVNode(\"label\", _hoisted_66, [\n                                                    _cache[109] || (_cache[109] = _createElementVNode(\"span\", null, \" (COMMENT)\", -1 /* CACHED */)),\n                                                    _withDirectives(_createElementVNode(\"input\", {\n                                                        \"onUpdate:modelValue\": _cache[5] || (_cache[5] = ($event) => ((_unref(selectedEntry).name) = $event)),\n                                                        type: \"text\",\n                                                        class: \"text-input\"\n                                                    }, null, 512 /* NEED_PATCH */), [\n                                                        [_vModelText, _unref(selectedEntry).name]\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"div\", _hoisted_67, [\n                                                    _createElementVNode(\"span\", {\n                                                        class: _normalizeClass([\"editor-badge\", _unref(selectedEntry).enabled ? 'on' : 'off'])\n                                                    }, _toDisplayString(_unref(selectedEntry).enabled ? 'EN' : 'OFF'), 3 /* TEXT, CLASS */),\n                                                    _createElementVNode(\"span\", _hoisted_68, \"#\" + _toDisplayString(_unref(selectedEntry).uid), 1 /* TEXT */),\n                                                    _createElementVNode(\"span\", _hoisted_69, \"~\" + _toDisplayString(_unref(selectedTokenEstimate)) + \"T\", 1 /* TEXT */)\n                                                ])\n                                            ]),\n                                            _createElementVNode(\"section\", _hoisted_70, [\n                                                _createElementVNode(\"label\", _hoisted_71, [\n                                                    _cache[110] || (_cache[110] = _createElementVNode(\"span\", null, \" (KEYS)\", -1 /* CACHED */)),\n                                                    _withDirectives(_createElementVNode(\"textarea\", {\n                                                        \"onUpdate:modelValue\": _cache[6] || (_cache[6] = ($event) => (_isRef(selectedKeysText) ? (selectedKeysText).value = $event : null)),\n                                                        class: \"text-area compact\"\n                                                    }, null, 512 /* NEED_PATCH */), [\n                                                        [_vModelText, _unref(selectedKeysText)]\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"label\", _hoisted_72, [\n                                                    _cache[111] || (_cache[111] = _createElementVNode(\"span\", null, \" (SECONDARY)\", -1 /* CACHED */)),\n                                                    _withDirectives(_createElementVNode(\"textarea\", {\n                                                        \"onUpdate:modelValue\": _cache[7] || (_cache[7] = ($event) => (_isRef(selectedSecondaryKeysText) ? (selectedSecondaryKeysText).value = $event : null)),\n                                                        class: \"text-area compact\"\n                                                    }, null, 512 /* NEED_PATCH */), [\n                                                        [_vModelText, _unref(selectedSecondaryKeysText)]\n                                                    ])\n                                                ])\n                                            ]),\n                                            _createElementVNode(\"section\", {\n                                                class: \"editor-content-block\",\n                                                ref_key: \"editorContentBlockRef\",\n                                                ref: editorContentBlockRef\n                                            }, [\n                                                (_unref(isMobile))\n                                                    ? (_openBlock(), _createElementBlock(\"div\", {\n                                                        key: 0,\n                                                        class: \"content-top-drag-handle\",\n                                                        onPointerdown: startContentTopDrag\n                                                    }, [...(_cache[112] || (_cache[112] = [\n                                                            _createElementVNode(\"span\", { class: \"content-top-drag-grip\" }, \"\", -1 /* CACHED */)\n                                                        ]))], 32 /* NEED_HYDRATION */))\n                                                    : _createCommentVNode(\"v-if\", true),\n                                                _cache[114] || (_cache[114] = _createElementVNode(\"div\", { class: \"editor-content-title\" }, \" /  (CONTENT)\", -1 /* CACHED */)),\n                                                _withDirectives(_createElementVNode(\"textarea\", {\n                                                    ref_key: \"contentTextareaRef\",\n                                                    ref: contentTextareaRef,\n                                                    \"onUpdate:modelValue\": _cache[8] || (_cache[8] = ($event) => ((_unref(selectedEntry).content) = $event)),\n                                                    class: \"text-area large editor-content-area\",\n                                                    style: { \"min-height\": \"calc(100vh - 500px)\" }\n                                                }, null, 512 /* NEED_PATCH */), [\n                                                    [_vModelText, _unref(selectedEntry).content]\n                                                ]),\n                                                _createElementVNode(\"div\", {\n                                                    class: \"content-resize-handle\",\n                                                    onPointerdown: startContentResize\n                                                }, [...(_cache[113] || (_cache[113] = [\n                                                        _createElementVNode(\"span\", { class: \"content-resize-grip\" }, \"\", -1 /* CACHED */)\n                                                    ]))], 32 /* NEED_HYDRATION */)\n                                            ], 512 /* NEED_PATCH */)\n                                        ], 64 /* STABLE_FRAGMENT */))\n                                        : (_openBlock(), _createElementBlock(\"div\", _hoisted_73, \"\"))\n                                ], 512 /* NEED_PATCH */), [\n                                    [_vShow, _unref(mobileTab) === 'edit']\n                                ]),\n                                _createCommentVNode(\" Tab:  \"),\n                                _withDirectives(_createElementVNode(\"div\", _hoisted_74, [\n                                    (_unref(selectedEntry))\n                                        ? (_openBlock(), _createElementBlock(_Fragment, { key: 0 }, [\n                                            _createElementVNode(\"article\", _hoisted_75, [\n                                                _cache[120] || (_cache[120] = _createElementVNode(\"h4\", null, \" (STRATEGY)\", -1 /* CACHED */)),\n                                                _createElementVNode(\"label\", _hoisted_76, [\n                                                    _withDirectives(_createElementVNode(\"input\", {\n                                                        \"onUpdate:modelValue\": _cache[9] || (_cache[9] = ($event) => ((_unref(selectedEntry).enabled) = $event)),\n                                                        type: \"checkbox\"\n                                                    }, null, 512 /* NEED_PATCH */), [\n                                                        [_vModelCheckbox, _unref(selectedEntry).enabled]\n                                                    ]),\n                                                    _cache[115] || (_cache[115] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n                                                ]),\n                                                _createElementVNode(\"div\", _hoisted_77, [\n                                                    _createElementVNode(\"button\", {\n                                                        type: \"button\",\n                                                        class: _normalizeClass([\"strategy-pill constant\", { active: _unref(selectedEntry).strategy.type === 'constant' }]),\n                                                        onClick: _cache[10] || (_cache[10] = ($event) => (_unref(selectedEntry).strategy.type = 'constant'))\n                                                    }, \" \", 2 /* CLASS */),\n                                                    _createElementVNode(\"button\", {\n                                                        type: \"button\",\n                                                        class: _normalizeClass([\"strategy-pill vector\", { active: _unref(selectedEntry).strategy.type === 'vectorized' }]),\n                                                        onClick: _cache[11] || (_cache[11] = ($event) => (_unref(selectedEntry).strategy.type = 'vectorized'))\n                                                    }, \" \", 2 /* CLASS */),\n                                                    _createElementVNode(\"button\", {\n                                                        type: \"button\",\n                                                        class: _normalizeClass([\"strategy-pill selective\", { active: _unref(selectedEntry).strategy.type === 'selective' }]),\n                                                        onClick: _cache[12] || (_cache[12] = ($event) => (_unref(selectedEntry).strategy.type = 'selective'))\n                                                    }, \" \", 2 /* CLASS */)\n                                                ]),\n                                                _createElementVNode(\"details\", _hoisted_78, [\n                                                    _cache[119] || (_cache[119] = _createElementVNode(\"summary\", null, \"\", -1 /* CACHED */)),\n                                                    _createElementVNode(\"label\", _hoisted_79, [\n                                                        _cache[116] || (_cache[116] = _createElementVNode(\"span\", null, \" (LOGIC)\", -1 /* CACHED */)),\n                                                        _withDirectives(_createElementVNode(\"select\", {\n                                                            \"onUpdate:modelValue\": _cache[13] || (_cache[13] = ($event) => ((_unref(selectedEntry).strategy.keys_secondary.logic) = $event)),\n                                                            class: \"text-input\"\n                                                        }, [\n                                                            (_openBlock(), _createElementBlock(_Fragment, null, _renderList(secondaryLogicOptions, (item) => {\n                                                                return _createElementVNode(\"option\", {\n                                                                    key: `ml-${item}`,\n                                                                    value: item\n                                                                }, _toDisplayString(getSecondaryLogicLabel(item)), 9 /* TEXT, PROPS */, _hoisted_80);\n                                                            }), 64 /* STABLE_FRAGMENT */))\n                                                        ], 512 /* NEED_PATCH */), [\n                                                            [_vModelSelect, _unref(selectedEntry).strategy.keys_secondary.logic]\n                                                        ])\n                                                    ]),\n                                                    _createElementVNode(\"label\", _hoisted_81, [\n                                                        _cache[117] || (_cache[117] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            \"onUpdate:modelValue\": _cache[14] || (_cache[14] = ($event) => (_isRef(selectedScanDepthText) ? (selectedScanDepthText).value = $event : null)),\n                                                            type: \"text\",\n                                                            class: \"text-input\",\n                                                            placeholder: \" same_as_global\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelText, _unref(selectedScanDepthText)]\n                                                        ])\n                                                    ]),\n                                                    _createElementVNode(\"label\", _hoisted_82, [\n                                                        _cache[118] || (_cache[118] = _createElementVNode(\"span\", null, \"(0-100)\", -1 /* CACHED */)),\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            \"onUpdate:modelValue\": _cache[15] || (_cache[15] = ($event) => ((_unref(selectedEntry).probability) = $event)),\n                                                            type: \"number\",\n                                                            class: \"text-input\",\n                                                            min: \"0\",\n                                                            max: \"100\",\n                                                            step: \"1\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [\n                                                                _vModelText,\n                                                                _unref(selectedEntry).probability,\n                                                                void 0,\n                                                                { number: true }\n                                                            ]\n                                                        ])\n                                                    ])\n                                                ])\n                                            ]),\n                                            _createElementVNode(\"article\", _hoisted_83, [\n                                                _cache[126] || (_cache[126] = _createElementVNode(\"h4\", null, \" (INSERTION)\", -1 /* CACHED */)),\n                                                _createElementVNode(\"label\", _hoisted_84, [\n                                                    _cache[121] || (_cache[121] = _createElementVNode(\"span\", null, \" (Position)\", -1 /* CACHED */)),\n                                                    _withDirectives(_createElementVNode(\"select\", {\n                                                        \"onUpdate:modelValue\": _cache[16] || (_cache[16] = ($event) => ((_unref(selectedEntry).position.type) = $event)),\n                                                        class: \"text-input\",\n                                                        onChange: handleSelectedPositionTypeChanged\n                                                    }, [\n                                                        (_openBlock(), _createElementBlock(_Fragment, null, _renderList(positionTypeOptions, (item) => {\n                                                            return _createElementVNode(\"option\", {\n                                                                key: `mp-${item}`,\n                                                                value: item\n                                                            }, _toDisplayString(getPositionTypeLabel(item)), 9 /* TEXT, PROPS */, _hoisted_85);\n                                                        }), 64 /* STABLE_FRAGMENT */))\n                                                    ], 544 /* NEED_HYDRATION, NEED_PATCH */), [\n                                                        [_vModelSelect, _unref(selectedEntry).position.type]\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"label\", _hoisted_86, [\n                                                    _cache[122] || (_cache[122] = _createElementVNode(\"span\", null, \" (Order)\", -1 /* CACHED */)),\n                                                    _withDirectives(_createElementVNode(\"input\", {\n                                                        \"onUpdate:modelValue\": _cache[17] || (_cache[17] = ($event) => ((_unref(selectedEntry).position.order) = $event)),\n                                                        type: \"number\",\n                                                        class: \"text-input\",\n                                                        step: \"1\"\n                                                    }, null, 512 /* NEED_PATCH */), [\n                                                        [\n                                                            _vModelText,\n                                                            _unref(selectedEntry).position.order,\n                                                            void 0,\n                                                            { number: true }\n                                                        ]\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"div\", _hoisted_87, [\n                                                    _createElementVNode(\"label\", {\n                                                        class: _normalizeClass([\"field\", { disabled: _unref(selectedEntry).position.type !== 'at_depth' }])\n                                                    }, [\n                                                        _cache[124] || (_cache[124] = _createElementVNode(\"span\", null, \"at_depth role\", -1 /* CACHED */)),\n                                                        _withDirectives(_createElementVNode(\"select\", {\n                                                            \"onUpdate:modelValue\": _cache[18] || (_cache[18] = ($event) => ((_unref(selectedEntry).position.role) = $event)),\n                                                            class: \"text-input\",\n                                                            disabled: _unref(selectedEntry).position.type !== 'at_depth'\n                                                        }, [...(_cache[123] || (_cache[123] = [\n                                                                _createElementVNode(\"option\", { value: \"system\" }, \"system\", -1 /* CACHED */),\n                                                                _createElementVNode(\"option\", { value: \"assistant\" }, \"assistant\", -1 /* CACHED */),\n                                                                _createElementVNode(\"option\", { value: \"user\" }, \"user\", -1 /* CACHED */)\n                                                            ]))], 8 /* PROPS */, _hoisted_88), [\n                                                            [_vModelSelect, _unref(selectedEntry).position.role]\n                                                        ])\n                                                    ], 2 /* CLASS */),\n                                                    _createElementVNode(\"label\", {\n                                                        class: _normalizeClass([\"field\", { disabled: _unref(selectedEntry).position.type !== 'at_depth' }])\n                                                    }, [\n                                                        _cache[125] || (_cache[125] = _createElementVNode(\"span\", null, \"at_depth depth\", -1 /* CACHED */)),\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            \"onUpdate:modelValue\": _cache[19] || (_cache[19] = ($event) => ((_unref(selectedEntry).position.depth) = $event)),\n                                                            type: \"number\",\n                                                            class: \"text-input\",\n                                                            min: \"1\",\n                                                            step: \"1\",\n                                                            disabled: _unref(selectedEntry).position.type !== 'at_depth'\n                                                        }, null, 8 /* PROPS */, _hoisted_89), [\n                                                            [\n                                                                _vModelText,\n                                                                _unref(selectedEntry).position.depth,\n                                                                void 0,\n                                                                { number: true }\n                                                            ]\n                                                        ])\n                                                    ], 2 /* CLASS */)\n                                                ])\n                                            ]),\n                                            _createElementVNode(\"article\", _hoisted_90, [\n                                                _cache[129] || (_cache[129] = _createElementVNode(\"h4\", null, \" (RECURSION)\", -1 /* CACHED */)),\n                                                _createElementVNode(\"label\", _hoisted_91, [\n                                                    _withDirectives(_createElementVNode(\"input\", {\n                                                        \"onUpdate:modelValue\": _cache[20] || (_cache[20] = ($event) => ((_unref(selectedEntry).recursion.prevent_incoming) = $event)),\n                                                        type: \"checkbox\"\n                                                    }, null, 512 /* NEED_PATCH */), [\n                                                        [_vModelCheckbox, _unref(selectedEntry).recursion.prevent_incoming]\n                                                    ]),\n                                                    _cache[127] || (_cache[127] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n                                                ]),\n                                                _createElementVNode(\"label\", _hoisted_92, [\n                                                    _withDirectives(_createElementVNode(\"input\", {\n                                                        \"onUpdate:modelValue\": _cache[21] || (_cache[21] = ($event) => ((_unref(selectedEntry).recursion.prevent_outgoing) = $event)),\n                                                        type: \"checkbox\"\n                                                    }, null, 512 /* NEED_PATCH */), [\n                                                        [_vModelCheckbox, _unref(selectedEntry).recursion.prevent_outgoing]\n                                                    ]),\n                                                    _cache[128] || (_cache[128] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n                                                ])\n                                            ]),\n                                            _createElementVNode(\"details\", _hoisted_93, [\n                                                _cache[131] || (_cache[131] = _createElementVNode(\"summary\", null, \" / extra JSON\", -1 /* CACHED */)),\n                                                _createElementVNode(\"label\", _hoisted_94, [\n                                                    _cache[130] || (_cache[130] = _createElementVNode(\"span\", null, \"extra JSON\", -1 /* CACHED */)),\n                                                    _withDirectives(_createElementVNode(\"textarea\", {\n                                                        \"onUpdate:modelValue\": _cache[22] || (_cache[22] = ($event) => (_isRef(selectedExtraText) ? (selectedExtraText).value = $event : null)),\n                                                        class: \"text-area compact\",\n                                                        placeholder: \"{ ... }\"\n                                                    }, null, 512 /* NEED_PATCH */), [\n                                                        [_vModelText, _unref(selectedExtraText)]\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"div\", { class: \"field-actions\" }, [\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"btn\",\n                                                        type: \"button\",\n                                                        onClick: applyExtraJson\n                                                    }, \" extra\"),\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"btn\",\n                                                        type: \"button\",\n                                                        onClick: clearExtra\n                                                    }, \" extra\")\n                                                ])\n                                            ]),\n                                            _createElementVNode(\"div\", { class: \"mobile-danger-zone\" }, [\n                                                _createElementVNode(\"button\", {\n                                                    class: \"btn danger\",\n                                                    type: \"button\",\n                                                    onClick: removeSelectedEntry\n                                                }, \" \"),\n                                                _createElementVNode(\"button\", {\n                                                    class: \"btn\",\n                                                    type: \"button\",\n                                                    onClick: duplicateSelectedEntry\n                                                }, \" \")\n                                            ])\n                                        ], 64 /* STABLE_FRAGMENT */))\n                                        : (_openBlock(), _createElementBlock(\"div\", _hoisted_95, \"\"))\n                                ], 512 /* NEED_PATCH */), [\n                                    [_vShow, _unref(mobileTab) === 'settings']\n                                ]),\n                                _createCommentVNode(\" Tab: AI \"),\n                                _withDirectives(_createElementVNode(\"div\", _hoisted_96, [\n                                    _createElementVNode(\"section\", _hoisted_97, [\n                                        _createElementVNode(\"div\", _hoisted_98, [\n                                            (!_unref(aiActiveSession))\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_99, [\n                                                    _cache[132] || (_cache[132] = _createElementVNode(\"div\", { class: \"ai-chat-empty-icon\" }, \"\", -1 /* CACHED */)),\n                                                    _cache[133] || (_cache[133] = _createElementVNode(\"div\", { class: \"ai-chat-empty-text\" }, \"\", -1 /* CACHED */)),\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"btn\",\n                                                        type: \"button\",\n                                                        onClick: aiCreateSession\n                                                    }, \"+ \")\n                                                ]))\n                                                : (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                                                    _createElementVNode(\"div\", {\n                                                        class: \"ai-chat-messages\",\n                                                        ref_key: \"aiChatMessagesRef\",\n                                                        ref: aiChatMessagesRef\n                                                    }, [\n                                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(aiActiveMessages), (msg, idx) => {\n                                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                                key: `mmsg-${idx}`,\n                                                                class: _normalizeClass([\"ai-chat-bubble\", msg.role])\n                                                            }, [\n                                                                _createElementVNode(\"div\", _hoisted_100, _toDisplayString(msg.role === 'user' ? ' ' : ' AI'), 1 /* TEXT */),\n                                                                _createElementVNode(\"div\", _hoisted_101, _toDisplayString(msg.content), 1 /* TEXT */)\n                                                            ], 2 /* CLASS */));\n                                                        }), 128 /* KEYED_FRAGMENT */)),\n                                                        (_unref(aiIsGenerating) && _unref(aiStreamingText))\n                                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_102, [\n                                                                _cache[135] || (_cache[135] = _createElementVNode(\"div\", { class: \"ai-chat-bubble-role\" }, \" AI\", -1 /* CACHED */)),\n                                                                _createElementVNode(\"div\", _hoisted_103, [\n                                                                    _createTextVNode(_toDisplayString(_unref(aiStreamingText)), 1 /* TEXT */),\n                                                                    _cache[134] || (_cache[134] = _createElementVNode(\"span\", { class: \"ai-cursor\" }, \"\", -1 /* CACHED */))\n                                                                ])\n                                                            ]))\n                                                            : _createCommentVNode(\"v-if\", true),\n                                                        (_unref(aiIsGenerating) && !_unref(aiStreamingText))\n                                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_104, [...(_cache[136] || (_cache[136] = [\n                                                                    _createElementVNode(\"div\", { class: \"ai-chat-bubble-role\" }, \" AI\", -1 /* CACHED */),\n                                                                    _createElementVNode(\"div\", { class: \"ai-chat-bubble-content\" }, [\n                                                                        _createElementVNode(\"span\", { class: \"ai-thinking\" }, \"...\")\n                                                                    ], -1 /* CACHED */)\n                                                                ]))]))\n                                                            : _createCommentVNode(\"v-if\", true)\n                                                    ], 512 /* NEED_PATCH */),\n                                                    _createElementVNode(\"div\", _hoisted_105, [\n                                                        _createElementVNode(\"label\", _hoisted_106, [\n                                                            _withDirectives(_createElementVNode(\"input\", {\n                                                                \"onUpdate:modelValue\": _cache[23] || (_cache[23] = ($event) => (_isRef(aiUseContext) ? (aiUseContext).value = $event : null)),\n                                                                type: \"checkbox\"\n                                                            }, null, 512 /* NEED_PATCH */), [\n                                                                [_vModelCheckbox, _unref(aiUseContext)]\n                                                            ]),\n                                                            _createElementVNode(\"span\", null, _toDisplayString(_unref(aiUseContext) ? ' ' : ' '), 1 /* TEXT */)\n                                                        ]),\n                                                        _withDirectives(_createElementVNode(\"textarea\", {\n                                                            \"onUpdate:modelValue\": _cache[24] || (_cache[24] = ($event) => (_isRef(aiChatInputText) ? (aiChatInputText).value = $event : null)),\n                                                            class: \"text-input ai-chat-input\",\n                                                            placeholder: \"...\",\n                                                            rows: \"2\",\n                                                            disabled: _unref(aiIsGenerating),\n                                                            onKeydown: _withKeys(_withModifiers(aiSendMessage, [\"exact\", \"prevent\"]), [\"enter\"])\n                                                        }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_107), [\n                                                            [_vModelText, _unref(aiChatInputText)]\n                                                        ]),\n                                                        (!_unref(aiIsGenerating))\n                                                            ? (_openBlock(), _createElementBlock(\"button\", {\n                                                                key: 0,\n                                                                class: \"btn ai-send-btn\",\n                                                                type: \"button\",\n                                                                disabled: !_unref(aiChatInputText).trim(),\n                                                                onClick: aiSendMessage\n                                                            }, \"\", 8 /* PROPS */, _hoisted_108))\n                                                            : (_openBlock(), _createElementBlock(\"button\", {\n                                                                key: 1,\n                                                                class: \"btn danger ai-stop-btn\",\n                                                                type: \"button\",\n                                                                onClick: aiStopGeneration\n                                                            }, \"\"))\n                                                    ])\n                                                ], 64 /* STABLE_FRAGMENT */))\n                                        ])\n                                    ])\n                                ], 512 /* NEED_PATCH */), [\n                                    [_vShow, _unref(mobileTab) === 'ai']\n                                ])\n                            ])\n                        ]),\n                        _createCommentVNode(\" Tab Bar: bottom, direct child of wb-assistant-root via fragment \"),\n                        _createElementVNode(\"div\", _hoisted_109, [\n                            _createElementVNode(\"button\", {\n                                onClick: _cache[25] || (_cache[25] = ($event) => (mobileTab.value = 'list')),\n                                style: _normalizeStyle({ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', border: 'none', borderTop: _unref(mobileTab) === 'list' ? '2px solid #60a5fa' : '2px solid transparent', background: 'transparent', color: _unref(mobileTab) === 'list' ? '#e2e8f0' : '#94a3b8', fontSize: '10px', padding: '4px 0', gap: '2px' })\n                            }, [...(_cache[137] || (_cache[137] = [\n                                    _createElementVNode(\"span\", { style: { \"font-size\": \"20px\" } }, \"\", -1 /* CACHED */),\n                                    _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)\n                                ]))], 4 /* STYLE */),\n                            _createElementVNode(\"button\", {\n                                onClick: _cache[26] || (_cache[26] = ($event) => (mobileTab.value = 'edit')),\n                                style: _normalizeStyle({ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', border: 'none', borderTop: _unref(mobileTab) === 'edit' ? '2px solid #60a5fa' : '2px solid transparent', background: 'transparent', color: _unref(mobileTab) === 'edit' ? '#e2e8f0' : '#94a3b8', fontSize: '10px', padding: '4px 0', gap: '2px' })\n                            }, [...(_cache[138] || (_cache[138] = [\n                                    _createElementVNode(\"span\", { style: { \"font-size\": \"20px\" } }, \"\", -1 /* CACHED */),\n                                    _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)\n                                ]))], 4 /* STYLE */),\n                            _createElementVNode(\"button\", {\n                                onClick: _cache[27] || (_cache[27] = ($event) => (mobileTab.value = 'settings')),\n                                style: _normalizeStyle({ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', border: 'none', borderTop: _unref(mobileTab) === 'settings' ? '2px solid #60a5fa' : '2px solid transparent', background: 'transparent', color: _unref(mobileTab) === 'settings' ? '#e2e8f0' : '#94a3b8', fontSize: '10px', padding: '4px 0', gap: '2px' })\n                            }, [...(_cache[139] || (_cache[139] = [\n                                    _createElementVNode(\"span\", { style: { \"font-size\": \"20px\" } }, \"\", -1 /* CACHED */),\n                                    _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)\n                                ]))], 4 /* STYLE */),\n                            _createElementVNode(\"button\", {\n                                onClick: _cache[28] || (_cache[28] = ($event) => (mobileTab.value = 'ai')),\n                                style: _normalizeStyle({ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', border: 'none', borderTop: _unref(mobileTab) === 'ai' ? '2px solid #60a5fa' : '2px solid transparent', background: 'transparent', color: _unref(mobileTab) === 'ai' ? '#e2e8f0' : '#94a3b8', fontSize: '10px', padding: '4px 0', gap: '2px' })\n                            }, [...(_cache[140] || (_cache[140] = [\n                                    _createElementVNode(\"span\", { style: { \"font-size\": \"20px\" } }, \"\", -1 /* CACHED */),\n                                    _createElementVNode(\"span\", null, \"AI\", -1 /* CACHED */)\n                                ]))], 4 /* STYLE */)\n                        ])\n                    ], 64 /* STABLE_FRAGMENT */))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  Desktop Layout  \"),\n                (!_unref(isMobile))\n                    ? (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                        _createElementVNode(\"section\", _hoisted_110, [\n                            _createElementVNode(\"label\", _hoisted_111, [\n                                _cache[141] || (_cache[141] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                _createElementVNode(\"div\", {\n                                    ref_key: \"worldbookPickerRef\",\n                                    ref: worldbookPickerRef,\n                                    class: \"worldbook-picker\"\n                                }, [\n                                    _createElementVNode(\"button\", {\n                                        class: \"worldbook-picker-trigger\",\n                                        type: \"button\",\n                                        onClick: toggleWorldbookPicker\n                                    }, [\n                                        _createElementVNode(\"span\", {\n                                            class: \"worldbook-picker-trigger-text\",\n                                            title: _unref(selectedWorldbookName) || ''\n                                        }, _toDisplayString(_unref(selectedWorldbookName) || ''), 9 /* TEXT, PROPS */, _hoisted_112),\n                                        _createElementVNode(\"span\", _hoisted_113, _toDisplayString(_unref(worldbookPickerOpen) ? '' : ''), 1 /* TEXT */)\n                                    ]),\n                                    (_unref(worldbookPickerOpen))\n                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_114, [\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                ref_key: \"worldbookPickerSearchInputRef\",\n                                                ref: worldbookPickerSearchInputRef,\n                                                \"onUpdate:modelValue\": _cache[29] || (_cache[29] = ($event) => (_isRef(worldbookPickerSearchText) ? (worldbookPickerSearchText).value = $event : null)),\n                                                type: \"text\",\n                                                class: \"text-input worldbook-picker-search\",\n                                                placeholder: \"...\",\n                                                onKeydown: _cache[30] || (_cache[30] = _withKeys(_withModifiers(($event) => (_unref(filteredSelectableWorldbookNames)[0] && selectWorldbookFromPicker(_unref(filteredSelectableWorldbookNames)[0])), [\"prevent\"]), [\"enter\"]))\n                                            }, null, 544 /* NEED_HYDRATION, NEED_PATCH */), [\n                                                [_vModelText, _unref(worldbookPickerSearchText)]\n                                            ]),\n                                            _createElementVNode(\"div\", _hoisted_115, [\n                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(filteredSelectableWorldbookNames), (name) => {\n                                                    return (_openBlock(), _createElementBlock(\"button\", {\n                                                        key: `worldbook-${name}`,\n                                                        class: _normalizeClass([\"worldbook-picker-item\", { active: name === _unref(selectedWorldbookName) }]),\n                                                        type: \"button\",\n                                                        onClick: ($event) => (selectWorldbookFromPicker(name))\n                                                    }, _toDisplayString(name), 11 /* TEXT, CLASS, PROPS */, _hoisted_116));\n                                                }), 128 /* KEYED_FRAGMENT */)),\n                                                (!_unref(filteredSelectableWorldbookNames).length)\n                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_117, \"\"))\n                                                    : _createCommentVNode(\"v-if\", true)\n                                            ])\n                                        ]))\n                                        : _createCommentVNode(\"v-if\", true)\n                                ], 512 /* NEED_PATCH */)\n                            ]),\n                            _createElementVNode(\"button\", {\n                                class: \"btn\",\n                                type: \"button\",\n                                onClick: createNewWorldbook\n                            }, \"\"),\n                            _createElementVNode(\"button\", {\n                                class: \"btn\",\n                                type: \"button\",\n                                disabled: !_unref(selectedWorldbookName),\n                                onClick: duplicateWorldbook\n                            }, \"  \", 8 /* PROPS */, _hoisted_118),\n                            _createElementVNode(\"button\", {\n                                class: \"btn danger\",\n                                type: \"button\",\n                                disabled: !_unref(selectedWorldbookName),\n                                onClick: deleteCurrentWorldbook\n                            }, \"  \", 8 /* PROPS */, _hoisted_119),\n                            _createElementVNode(\"button\", {\n                                class: \"btn\",\n                                type: \"button\",\n                                disabled: !_unref(selectedWorldbookName),\n                                onClick: exportCurrentWorldbook\n                            }, \"  \", 8 /* PROPS */, _hoisted_120),\n                            _createElementVNode(\"button\", {\n                                class: \"btn\",\n                                type: \"button\",\n                                onClick: triggerImport\n                            }, \"\"),\n                            _createElementVNode(\"input\", {\n                                ref_key: \"importFileInput\",\n                                ref: importFileInput,\n                                class: \"hidden-input\",\n                                type: \"file\",\n                                accept: \".json,application/json\",\n                                onChange: onImportChange\n                            }, null, 544 /* NEED_HYDRATION, NEED_PATCH */)\n                        ]),\n                        _createElementVNode(\"div\", _hoisted_121, [\n                            _createElementVNode(\"section\", _hoisted_122, [\n                                _createElementVNode(\"div\", _hoisted_123, [\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"btn history-btn utility-btn\", { active: _unref(globalWorldbookMode) }]),\n                                        type: \"button\",\n                                        onClick: toggleGlobalMode\n                                    }, \"   \", 2 /* CLASS */),\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn history-btn\",\n                                        type: \"button\",\n                                        disabled: !_unref(selectedEntry),\n                                        onClick: openEntryHistoryModal\n                                    }, \"   \", 8 /* PROPS */, _hoisted_124),\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn history-btn\",\n                                        type: \"button\",\n                                        disabled: !_unref(selectedWorldbookName),\n                                        onClick: openWorldbookHistoryModal\n                                    }, \"   \", 8 /* PROPS */, _hoisted_125),\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"btn history-btn utility-btn\", { active: _unref(floatingPanels).find.visible }]),\n                                        type: \"button\",\n                                        disabled: !_unref(draftEntries).length,\n                                        onClick: _cache[31] || (_cache[31] = ($event) => (toggleFloatingPanel('find')))\n                                    }, \"   \", 10 /* CLASS, PROPS */, _hoisted_126),\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"btn history-btn utility-btn\", { active: _unref(floatingPanels).activation.visible }]),\n                                        type: \"button\",\n                                        onClick: _cache[32] || (_cache[32] = ($event) => (toggleFloatingPanel('activation')))\n                                    }, \"   \", 2 /* CLASS */),\n                                    _createElementVNode(\"button\", {\n                                        class: _normalizeClass([\"btn history-btn utility-btn\", { active: _unref(aiGeneratorMode) }]),\n                                        type: \"button\",\n                                        onClick: aiToggleMode\n                                    }, \"  AI  \", 2 /* CLASS */)\n                                ]),\n                                (_unref(globalWorldbookMode))\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_127, [\n                                        _createElementVNode(\"div\", _hoisted_128, [\n                                            _createElementVNode(\"span\", _hoisted_129, \"\" + _toDisplayString(_unref(bindings).global.length) + \"\", 1 /* TEXT */),\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn mini danger\",\n                                                type: \"button\",\n                                                disabled: !_unref(bindings).global.length,\n                                                onClick: clearGlobalWorldbooks\n                                            }, \"  \", 8 /* PROPS */, _hoisted_130)\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_131, [\n                                            _createElementVNode(\"label\", _hoisted_132, [\n                                                _cache[143] || (_cache[143] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                                _withDirectives(_createElementVNode(\"select\", {\n                                                    \"onUpdate:modelValue\": _cache[33] || (_cache[33] = ($event) => (_isRef(selectedGlobalPresetId) ? (selectedGlobalPresetId).value = $event : null)),\n                                                    class: \"text-input\",\n                                                    onChange: onGlobalPresetSelectionChanged\n                                                }, [\n                                                    _cache[142] || (_cache[142] = _createElementVNode(\"option\", { value: \"\" }, \"\", -1 /* CACHED */)),\n                                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(globalWorldbookPresets), (preset) => {\n                                                        return (_openBlock(), _createElementBlock(\"option\", {\n                                                            key: preset.id,\n                                                            value: preset.id\n                                                        }, _toDisplayString(preset.name) + \"\" + _toDisplayString(preset.worldbooks.length) + \" \", 9 /* TEXT, PROPS */, _hoisted_133));\n                                                    }), 128 /* KEYED_FRAGMENT */))\n                                                ], 544 /* NEED_HYDRATION, NEED_PATCH */), [\n                                                    [_vModelSelect, _unref(selectedGlobalPresetId)]\n                                                ])\n                                            ]),\n                                            _createElementVNode(\"div\", _hoisted_134, [\n                                                _createElementVNode(\"button\", {\n                                                    class: \"btn\",\n                                                    type: \"button\",\n                                                    disabled: !_unref(bindings).global.length,\n                                                    onClick: saveCurrentAsGlobalPreset\n                                                }, \"  \", 8 /* PROPS */, _hoisted_135),\n                                                _createElementVNode(\"button\", {\n                                                    class: \"btn\",\n                                                    type: \"button\",\n                                                    disabled: !_unref(selectedGlobalPreset),\n                                                    onClick: overwriteSelectedGlobalPreset\n                                                }, \"  \", 8 /* PROPS */, _hoisted_136),\n                                                _createElementVNode(\"button\", {\n                                                    class: \"btn danger\",\n                                                    type: \"button\",\n                                                    disabled: !_unref(selectedGlobalPreset),\n                                                    onClick: deleteSelectedGlobalPreset\n                                                }, \"  \", 8 /* PROPS */, _hoisted_137)\n                                            ]),\n                                            _createElementVNode(\"div\", _hoisted_138, [\n                                                _createElementVNode(\"div\", _hoisted_139, [\n                                                    _cache[144] || (_cache[144] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                                    _createElementVNode(\"span\", {\n                                                        class: _normalizeClass([\"preset-role-current\", { empty: !_unref(currentRoleContext) }])\n                                                    }, _toDisplayString(_unref(currentRoleContext) ? `: ${_unref(currentRoleContext).name}` : ''), 3 /* TEXT, CLASS */)\n                                                ]),\n                                                _createElementVNode(\"div\", _hoisted_140, [\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"btn mini\",\n                                                        type: \"button\",\n                                                        disabled: !_unref(selectedGlobalPreset) || !_unref(currentRoleContext),\n                                                        onClick: bindCurrentRoleToSelectedPreset\n                                                    }, \"  \", 8 /* PROPS */, _hoisted_141),\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"btn mini\",\n                                                        type: \"button\",\n                                                        disabled: !_unref(selectedGlobalPreset) || !_unref(isCurrentRoleBoundToSelectedPreset),\n                                                        onClick: unbindCurrentRoleFromSelectedPreset\n                                                    }, \"  \", 8 /* PROPS */, _hoisted_142)\n                                                ]),\n                                                _createElementVNode(\"div\", {\n                                                    ref_key: \"rolePickerRef\",\n                                                    ref: rolePickerRef,\n                                                    class: \"role-picker\"\n                                                }, [\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"role-picker-trigger\",\n                                                        type: \"button\",\n                                                        disabled: !_unref(selectedGlobalPreset),\n                                                        onClick: toggleRolePicker\n                                                    }, [\n                                                        _createElementVNode(\"span\", _hoisted_144, _toDisplayString(_unref(selectedGlobalPreset) ? '' : ''), 1 /* TEXT */),\n                                                        _createElementVNode(\"span\", _hoisted_145, _toDisplayString(_unref(rolePickerOpen) ? '' : ''), 1 /* TEXT */)\n                                                    ], 8 /* PROPS */, _hoisted_143),\n                                                    (_unref(rolePickerOpen))\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_146, [\n                                                            _withDirectives(_createElementVNode(\"input\", {\n                                                                ref_key: \"rolePickerSearchInputRef\",\n                                                                ref: rolePickerSearchInputRef,\n                                                                \"onUpdate:modelValue\": _cache[34] || (_cache[34] = ($event) => (_isRef(roleBindSearchText) ? (roleBindSearchText).value = $event : null)),\n                                                                type: \"text\",\n                                                                class: \"text-input role-picker-search\",\n                                                                placeholder: \" / avatar...\",\n                                                                onKeydown: _withKeys(_withModifiers(bindFirstRoleCandidate, [\"prevent\"]), [\"enter\"])\n                                                            }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_147), [\n                                                                [_vModelText, _unref(roleBindSearchText)]\n                                                            ]),\n                                                            _createElementVNode(\"div\", _hoisted_148, [\n                                                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(roleBindingCandidates), (candidate) => {\n                                                                    return (_openBlock(), _createElementBlock(\"button\", {\n                                                                        key: `role-candidate-${candidate.key}`,\n                                                                        class: \"role-picker-item\",\n                                                                        type: \"button\",\n                                                                        disabled: candidate.bound,\n                                                                        onClick: ($event) => (bindRoleCandidateToSelectedPreset(candidate))\n                                                                    }, [\n                                                                        _createElementVNode(\"span\", _hoisted_150, _toDisplayString(candidate.name), 1 /* TEXT */),\n                                                                        _createElementVNode(\"span\", _hoisted_151, _toDisplayString(candidate.bound ? '' : ''), 1 /* TEXT */)\n                                                                    ], 8 /* PROPS */, _hoisted_149));\n                                                                }), 128 /* KEYED_FRAGMENT */)),\n                                                                (!_unref(roleBindingCandidates).length)\n                                                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_152, \"\"))\n                                                                    : _createCommentVNode(\"v-if\", true)\n                                                            ])\n                                                        ]))\n                                                        : _createCommentVNode(\"v-if\", true)\n                                                ], 512 /* NEED_PATCH */),\n                                                _createElementVNode(\"div\", _hoisted_153, [\n                                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(selectedGlobalPresetRoleBindings), (binding) => {\n                                                        return (_openBlock(), _createElementBlock(\"button\", {\n                                                            key: `binding-${_unref(selectedGlobalPreset)?.id}-${binding.key}`,\n                                                            class: \"preset-role-tag\",\n                                                            type: \"button\",\n                                                            title: `: ${binding.name}`,\n                                                            onClick: ($event) => (removeRoleBindingFromSelectedPreset(binding.key))\n                                                        }, [\n                                                            _createElementVNode(\"span\", null, _toDisplayString(binding.name), 1 /* TEXT */),\n                                                            _cache[145] || (_cache[145] = _createElementVNode(\"span\", { class: \"remove\" }, \"\", -1 /* CACHED */))\n                                                        ], 8 /* PROPS */, _hoisted_154));\n                                                    }), 128 /* KEYED_FRAGMENT */)),\n                                                    (_unref(selectedGlobalPreset) && !_unref(selectedGlobalPresetRoleBindings).length)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_155, \"  \"))\n                                                        : _createCommentVNode(\"v-if\", true),\n                                                    (!_unref(selectedGlobalPreset))\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_156, \"\"))\n                                                        : _createCommentVNode(\"v-if\", true)\n                                                ])\n                                            ])\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_157, [\n                                            _createElementVNode(\"div\", _hoisted_158, [\n                                                _createElementVNode(\"label\", _hoisted_159, [\n                                                    _cache[146] || (_cache[146] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                                    _withDirectives(_createElementVNode(\"input\", {\n                                                        \"onUpdate:modelValue\": _cache[35] || (_cache[35] = ($event) => (_isRef(globalAddSearchText) ? (globalAddSearchText).value = $event : null)),\n                                                        type: \"text\",\n                                                        class: \"text-input\",\n                                                        placeholder: \"...\",\n                                                        onKeydown: _withKeys(_withModifiers(addFirstGlobalCandidate, [\"prevent\"]), [\"enter\"])\n                                                    }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_160), [\n                                                        [_vModelText, _unref(globalAddSearchText)]\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"div\", _hoisted_161, [\n                                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(globalAddCandidates), (name) => {\n                                                        return (_openBlock(), _createElementBlock(\"button\", {\n                                                            key: `add-${name}`,\n                                                            class: \"global-mode-item add\",\n                                                            type: \"button\",\n                                                            onClick: ($event) => (addGlobalWorldbook(name))\n                                                        }, [\n                                                            _createElementVNode(\"span\", _hoisted_163, _toDisplayString(name), 1 /* TEXT */),\n                                                            _cache[147] || (_cache[147] = _createElementVNode(\"span\", { class: \"global-mode-item-action\" }, \"\", -1 /* CACHED */))\n                                                        ], 8 /* PROPS */, _hoisted_162));\n                                                    }), 128 /* KEYED_FRAGMENT */)),\n                                                    (!_unref(globalAddCandidates).length)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_164, \"\"))\n                                                        : _createCommentVNode(\"v-if\", true)\n                                                ])\n                                            ]),\n                                            _createElementVNode(\"div\", _hoisted_165, [\n                                                _createElementVNode(\"label\", _hoisted_166, [\n                                                    _cache[148] || (_cache[148] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                                    _withDirectives(_createElementVNode(\"input\", {\n                                                        \"onUpdate:modelValue\": _cache[36] || (_cache[36] = ($event) => (_isRef(globalFilterText) ? (globalFilterText).value = $event : null)),\n                                                        type: \"text\",\n                                                        class: \"text-input\",\n                                                        placeholder: \"...\"\n                                                    }, null, 512 /* NEED_PATCH */), [\n                                                        [_vModelText, _unref(globalFilterText)]\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"div\", _hoisted_167, [\n                                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(filteredGlobalWorldbooks), (name) => {\n                                                        return (_openBlock(), _createElementBlock(\"button\", {\n                                                            key: `global-${name}`,\n                                                            class: \"global-mode-item active\",\n                                                            type: \"button\",\n                                                            onClick: ($event) => (removeGlobalWorldbook(name))\n                                                        }, [\n                                                            _createElementVNode(\"span\", _hoisted_169, _toDisplayString(name), 1 /* TEXT */),\n                                                            _cache[149] || (_cache[149] = _createElementVNode(\"span\", { class: \"global-mode-item-action\" }, \"\", -1 /* CACHED */))\n                                                        ], 8 /* PROPS */, _hoisted_168));\n                                                    }), 128 /* KEYED_FRAGMENT */)),\n                                                    (!_unref(filteredGlobalWorldbooks).length)\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_170, _toDisplayString(_unref(bindings).global.length ? '' : ''), 1 /* TEXT */))\n                                                        : _createCommentVNode(\"v-if\", true)\n                                                ])\n                                            ])\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_171, [\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn\",\n                                                type: \"button\",\n                                                disabled: !_unref(selectedWorldbookName),\n                                                onClick: toggleGlobalBinding\n                                            }, _toDisplayString(_unref(isGlobalBound) ? '' : ''), 9 /* TEXT, PROPS */, _hoisted_172)\n                                        ])\n                                    ]))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ]),\n                            _createCommentVNode(\"  AI Generator Panel  \"),\n                            (_unref(aiGeneratorMode))\n                                ? (_openBlock(), _createElementBlock(\"section\", _hoisted_173, [\n                                    _createElementVNode(\"div\", _hoisted_174, [\n                                        _createElementVNode(\"div\", { class: \"ai-sidebar-head\" }, [\n                                            _cache[150] || (_cache[150] = _createElementVNode(\"span\", { class: \"ai-sidebar-title\" }, \"\", -1 /* CACHED */)),\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn mini\",\n                                                type: \"button\",\n                                                onClick: aiCreateSession\n                                            }, \"+ \")\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_175, [\n                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(aiSessions), (session) => {\n                                                return (_openBlock(), _createElementBlock(\"button\", {\n                                                    key: session.id,\n                                                    class: _normalizeClass([\"ai-session-item\", { active: session.id === _unref(aiActiveSession)?.id }]),\n                                                    type: \"button\",\n                                                    onClick: ($event) => (aiSwitchSession(session.id))\n                                                }, [\n                                                    _createElementVNode(\"span\", _hoisted_177, _toDisplayString(session.title), 1 /* TEXT */),\n                                                    _createElementVNode(\"span\", _hoisted_178, _toDisplayString(session.messages.length) + \" \", 1 /* TEXT */),\n                                                    _createElementVNode(\"button\", {\n                                                        class: \"ai-session-delete\",\n                                                        type: \"button\",\n                                                        title: \"\",\n                                                        onClick: _withModifiers(($event) => (aiDeleteSession(session.id)), [\"stop\"])\n                                                    }, \"\", 8 /* PROPS */, _hoisted_179)\n                                                ], 10 /* CLASS, PROPS */, _hoisted_176));\n                                            }), 128 /* KEYED_FRAGMENT */)),\n                                            (!_unref(aiSessions).length)\n                                                ? (_openBlock(), _createElementBlock(\"div\", _hoisted_180, \"\"))\n                                                : _createCommentVNode(\"v-if\", true)\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_181, [\n                                        (!_unref(aiActiveSession))\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_182, [...(_cache[151] || (_cache[151] = [\n                                                    _createElementVNode(\"div\", { class: \"ai-chat-empty-icon\" }, \"\", -1 /* CACHED */),\n                                                    _createElementVNode(\"div\", { class: \"ai-chat-empty-text\" }, \"\", -1 /* CACHED */)\n                                                ]))]))\n                                            : (_openBlock(), _createElementBlock(_Fragment, { key: 1 }, [\n                                                _createElementVNode(\"div\", {\n                                                    class: \"ai-chat-messages\",\n                                                    ref_key: \"aiChatMessagesRef\",\n                                                    ref: aiChatMessagesRef\n                                                }, [\n                                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(aiActiveMessages), (msg, idx) => {\n                                                        return (_openBlock(), _createElementBlock(\"div\", {\n                                                            key: `msg-${idx}`,\n                                                            class: _normalizeClass([\"ai-chat-bubble\", msg.role])\n                                                        }, [\n                                                            _createElementVNode(\"div\", _hoisted_183, _toDisplayString(msg.role === 'user' ? ' ' : ' AI'), 1 /* TEXT */),\n                                                            _createElementVNode(\"div\", _hoisted_184, _toDisplayString(msg.content), 1 /* TEXT */)\n                                                        ], 2 /* CLASS */));\n                                                    }), 128 /* KEYED_FRAGMENT */)),\n                                                    (_unref(aiIsGenerating) && _unref(aiStreamingText))\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_185, [\n                                                            _cache[153] || (_cache[153] = _createElementVNode(\"div\", { class: \"ai-chat-bubble-role\" }, \" AI\", -1 /* CACHED */)),\n                                                            _createElementVNode(\"div\", _hoisted_186, [\n                                                                _createTextVNode(_toDisplayString(_unref(aiStreamingText)), 1 /* TEXT */),\n                                                                _cache[152] || (_cache[152] = _createElementVNode(\"span\", { class: \"ai-cursor\" }, \"\", -1 /* CACHED */))\n                                                            ])\n                                                        ]))\n                                                        : _createCommentVNode(\"v-if\", true),\n                                                    (_unref(aiIsGenerating) && !_unref(aiStreamingText))\n                                                        ? (_openBlock(), _createElementBlock(\"div\", _hoisted_187, [...(_cache[154] || (_cache[154] = [\n                                                                _createElementVNode(\"div\", { class: \"ai-chat-bubble-role\" }, \" AI\", -1 /* CACHED */),\n                                                                _createElementVNode(\"div\", { class: \"ai-chat-bubble-content\" }, [\n                                                                    _createElementVNode(\"span\", { class: \"ai-thinking\" }, \"...\")\n                                                                ], -1 /* CACHED */)\n                                                            ]))]))\n                                                        : _createCommentVNode(\"v-if\", true)\n                                                ], 512 /* NEED_PATCH */),\n                                                _createElementVNode(\"div\", _hoisted_188, [\n                                                    _createElementVNode(\"label\", _hoisted_189, [\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            \"onUpdate:modelValue\": _cache[37] || (_cache[37] = ($event) => (_isRef(aiUseContext) ? (aiUseContext).value = $event : null)),\n                                                            type: \"checkbox\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelCheckbox, _unref(aiUseContext)]\n                                                        ]),\n                                                        _createElementVNode(\"span\", null, _toDisplayString(_unref(aiUseContext) ? ' ' : ' '), 1 /* TEXT */)\n                                                    ]),\n                                                    _withDirectives(_createElementVNode(\"textarea\", {\n                                                        \"onUpdate:modelValue\": _cache[38] || (_cache[38] = ($event) => (_isRef(aiChatInputText) ? (aiChatInputText).value = $event : null)),\n                                                        class: \"text-input ai-chat-input\",\n                                                        placeholder: \" AI ...\",\n                                                        rows: \"2\",\n                                                        disabled: _unref(aiIsGenerating),\n                                                        onKeydown: _withKeys(_withModifiers(aiSendMessage, [\"exact\", \"prevent\"]), [\"enter\"])\n                                                    }, null, 40 /* PROPS, NEED_HYDRATION */, _hoisted_190), [\n                                                        [_vModelText, _unref(aiChatInputText)]\n                                                    ]),\n                                                    (!_unref(aiIsGenerating))\n                                                        ? (_openBlock(), _createElementBlock(\"button\", {\n                                                            key: 0,\n                                                            class: \"btn ai-send-btn\",\n                                                            type: \"button\",\n                                                            disabled: !_unref(aiChatInputText).trim(),\n                                                            onClick: aiSendMessage\n                                                        }, \"\", 8 /* PROPS */, _hoisted_191))\n                                                        : (_openBlock(), _createElementBlock(\"button\", {\n                                                            key: 1,\n                                                            class: \"btn danger ai-stop-btn\",\n                                                            type: \"button\",\n                                                            onClick: aiStopGeneration\n                                                        }, \"\"))\n                                                ])\n                                            ], 64 /* STABLE_FRAGMENT */))\n                                    ])\n                                ]))\n                                : _createCommentVNode(\"v-if\", true),\n                            _createCommentVNode(\"  Tag Review Modal  \"),\n                            (_unref(aiShowTagReview))\n                                ? (_openBlock(), _createElementBlock(\"div\", {\n                                    key: 1,\n                                    class: \"ai-tag-review-overlay\",\n                                    onClick: _cache[43] || (_cache[43] = _withModifiers(($event) => (aiShowTagReview.value = false), [\"self\"]))\n                                }, [\n                                    _createElementVNode(\"div\", _hoisted_192, [\n                                        _createElementVNode(\"div\", _hoisted_193, [\n                                            _createElementVNode(\"span\", _hoisted_194, \" \" + _toDisplayString(_unref(aiExtractedTags).length) + \"\", 1 /* TEXT */),\n                                            _createElementVNode(\"button\", {\n                                                class: \"ai-tag-review-close\",\n                                                type: \"button\",\n                                                onClick: _cache[39] || (_cache[39] = ($event) => (aiShowTagReview.value = false))\n                                            }, \"\")\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_195, [\n                                            _createElementVNode(\"label\", _hoisted_196, [\n                                                _cache[156] || (_cache[156] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                                _withDirectives(_createElementVNode(\"select\", {\n                                                    \"onUpdate:modelValue\": _cache[40] || (_cache[40] = ($event) => (_isRef(aiTargetWorldbook) ? (aiTargetWorldbook).value = $event : null)),\n                                                    class: \"text-input\"\n                                                }, [\n                                                    _cache[155] || (_cache[155] = _createElementVNode(\"option\", { value: \"\" }, \"\", -1 /* CACHED */)),\n                                                    (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(worldbookNames), (name) => {\n                                                        return (_openBlock(), _createElementBlock(\"option\", {\n                                                            key: `ai-wb-${name}`,\n                                                            value: name\n                                                        }, _toDisplayString(name), 9 /* TEXT, PROPS */, _hoisted_197));\n                                                    }), 128 /* KEYED_FRAGMENT */))\n                                                ], 512 /* NEED_PATCH */), [\n                                                    [_vModelSelect, _unref(aiTargetWorldbook)]\n                                                ])\n                                            ])\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_198, [\n                                            (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(aiExtractedTags), (tag, idx) => {\n                                                return (_openBlock(), _createElementBlock(\"label\", {\n                                                    key: `tag-${idx}`,\n                                                    class: \"ai-tag-item\"\n                                                }, [\n                                                    _withDirectives(_createElementVNode(\"input\", {\n                                                        \"onUpdate:modelValue\": ($event) => ((tag.selected) = $event),\n                                                        type: \"checkbox\"\n                                                    }, null, 8 /* PROPS */, _hoisted_199), [\n                                                        [_vModelCheckbox, tag.selected]\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_200, [\n                                                        _createElementVNode(\"span\", _hoisted_201, _toDisplayString(tag.tag), 1 /* TEXT */),\n                                                        _createElementVNode(\"span\", _hoisted_202, _toDisplayString(tag.content.slice(0, 120)) + _toDisplayString(tag.content.length > 120 ? '...' : ''), 1 /* TEXT */)\n                                                    ])\n                                                ]));\n                                            }), 128 /* KEYED_FRAGMENT */))\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_203, [\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn\",\n                                                type: \"button\",\n                                                onClick: _cache[41] || (_cache[41] = ($event) => (_unref(aiExtractedTags).forEach(t => t.selected = true)))\n                                            }, \"\"),\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn\",\n                                                type: \"button\",\n                                                onClick: _cache[42] || (_cache[42] = ($event) => (_unref(aiExtractedTags).forEach(t => t.selected = false)))\n                                            }, \"\"),\n                                            _createElementVNode(\"button\", {\n                                                class: \"btn primary\",\n                                                type: \"button\",\n                                                disabled: !_unref(aiTargetWorldbook) || !_unref(aiExtractedTags).some(t => t.selected),\n                                                onClick: aiCreateSelectedEntries\n                                            }, \"\" + _toDisplayString(_unref(aiExtractedTags).filter(t => t.selected).length) + \"\", 9 /* TEXT, PROPS */, _hoisted_204)\n                                        ])\n                                    ])\n                                ]))\n                                : _createCommentVNode(\"v-if\", true),\n                            _withDirectives(_createElementVNode(\"section\", {\n                                ref_key: \"mainLayoutRef\",\n                                ref: mainLayoutRef,\n                                class: \"wb-main-layout\",\n                                style: _normalizeStyle(_unref(mainLayoutStyle))\n                            }, [\n                                _withDirectives(_createElementVNode(\"aside\", _hoisted_205, [\n                                    _createElementVNode(\"div\", _hoisted_206, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[44] || (_cache[44] = ($event) => (_isRef(searchText) ? (searchText).value = $event : null)),\n                                            type: \"text\",\n                                            class: \"text-input\",\n                                            placeholder: \" /  / \"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelText, _unref(searchText)]\n                                        ]),\n                                        _createElementVNode(\"label\", _hoisted_207, [\n                                            _withDirectives(_createElementVNode(\"input\", {\n                                                \"onUpdate:modelValue\": _cache[45] || (_cache[45] = ($event) => (_isRef(onlyEnabled) ? (onlyEnabled).value = $event : null)),\n                                                type: \"checkbox\"\n                                            }, null, 512 /* NEED_PATCH */), [\n                                                [_vModelCheckbox, _unref(onlyEnabled)]\n                                            ]),\n                                            _cache[157] || (_cache[157] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n                                        ])\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_208, \"  \" + _toDisplayString(_unref(filteredEntries).length) + \" / \" + _toDisplayString(_unref(draftEntries).length) + \" |  \" + _toDisplayString(_unref(enabledEntryCount)), 1 /* TEXT */),\n                                    _createElementVNode(\"div\", _hoisted_209, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(filteredEntries), (entry) => {\n                                            return (_openBlock(), _createElementBlock(\"button\", {\n                                                key: entry.uid,\n                                                type: \"button\",\n                                                class: _normalizeClass([\"entry-item\", {\n                                                        selected: entry.uid === _unref(selectedEntryUid),\n                                                        disabled: !entry.enabled,\n                                                    }]),\n                                                \"data-status\": getEntryVisualStatus(entry),\n                                                onClick: ($event) => (selectEntry(entry.uid))\n                                            }, [\n                                                _createElementVNode(\"div\", _hoisted_211, [\n                                                    _createElementVNode(\"span\", {\n                                                        class: \"entry-status-dot\",\n                                                        \"data-status\": getEntryVisualStatus(entry)\n                                                    }, null, 8 /* PROPS */, _hoisted_212),\n                                                    _createElementVNode(\"div\", _hoisted_213, _toDisplayString(entry.name || ` ${entry.uid}`), 1 /* TEXT */),\n                                                    _createElementVNode(\"span\", _hoisted_214, \"#\" + _toDisplayString(entry.uid), 1 /* TEXT */)\n                                                ]),\n                                                _createElementVNode(\"div\", _hoisted_215, [\n                                                    _createElementVNode(\"span\", {\n                                                        class: \"entry-chip status\",\n                                                        \"data-status\": getEntryVisualStatus(entry)\n                                                    }, _toDisplayString(getEntryStatusLabel(entry)), 9 /* TEXT, PROPS */, _hoisted_216),\n                                                    _createElementVNode(\"span\", _hoisted_217, \" \" + _toDisplayString(entry.strategy.keys.length), 1 /* TEXT */),\n                                                    _createElementVNode(\"span\", _hoisted_218, \" \" + _toDisplayString(entry.probability), 1 /* TEXT */),\n                                                    _createElementVNode(\"span\", _hoisted_219, \"#\" + _toDisplayString(entry.position.order), 1 /* TEXT */)\n                                                ]),\n                                                _createElementVNode(\"div\", _hoisted_220, _toDisplayString(getEntryKeyPreview(entry)), 1 /* TEXT */)\n                                            ], 10 /* CLASS, PROPS */, _hoisted_210));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_221, [\n                                        _createElementVNode(\"button\", {\n                                            class: \"btn\",\n                                            type: \"button\",\n                                            disabled: !_unref(selectedWorldbookName),\n                                            onClick: addEntry\n                                        }, \"\", 8 /* PROPS */, _hoisted_222),\n                                        _createElementVNode(\"button\", {\n                                            class: \"btn\",\n                                            type: \"button\",\n                                            disabled: !_unref(selectedEntry),\n                                            onClick: duplicateSelectedEntry\n                                        }, \"  \", 8 /* PROPS */, _hoisted_223),\n                                        _createElementVNode(\"button\", {\n                                            class: \"btn danger\",\n                                            type: \"button\",\n                                            disabled: !_unref(selectedEntry),\n                                            onClick: removeSelectedEntry\n                                        }, \"  \", 8 /* PROPS */, _hoisted_224),\n                                        _createElementVNode(\"button\", {\n                                            class: \"btn\",\n                                            type: \"button\",\n                                            disabled: !_unref(selectedEntry),\n                                            onClick: _cache[46] || (_cache[46] = ($event) => (moveSelectedEntry(-1)))\n                                        }, \"  \", 8 /* PROPS */, _hoisted_225),\n                                        _createElementVNode(\"button\", {\n                                            class: \"btn\",\n                                            type: \"button\",\n                                            disabled: !_unref(selectedEntry),\n                                            onClick: _cache[47] || (_cache[47] = ($event) => (moveSelectedEntry(1)))\n                                        }, \"\", 8 /* PROPS */, _hoisted_226)\n                                    ])\n                                ], 512 /* NEED_PATCH */), [\n                                    [_vShow, !_unref(showMobileEditor)]\n                                ]),\n                                _withDirectives(_createElementVNode(\"div\", {\n                                    class: _normalizeClass([\"wb-resize-handle main\", { dragging: _unref(paneResizeState)?.key === 'main' }]),\n                                    onPointerdown: _cache[48] || (_cache[48] = ($event) => (startPaneResize('main', $event)))\n                                }, null, 34 /* CLASS, NEED_HYDRATION */), [\n                                    [_vShow, !_unref(isMobile)]\n                                ]),\n                                _withDirectives(_createElementVNode(\"main\", _hoisted_227, [\n                                    (_unref(selectedEntry))\n                                        ? (_openBlock(), _createElementBlock(\"div\", {\n                                            key: 0,\n                                            ref_key: \"editorShellRef\",\n                                            ref: editorShellRef,\n                                            class: \"wb-editor-shell\",\n                                            style: _normalizeStyle(_unref(editorShellStyle))\n                                        }, [\n                                            _createElementVNode(\"section\", _hoisted_228, [\n                                                _createElementVNode(\"header\", _hoisted_229, [\n                                                    (_unref(isMobile))\n                                                        ? (_openBlock(), _createElementBlock(\"div\", {\n                                                            key: 0,\n                                                            class: \"editor-back-btn\",\n                                                            onClick: goBackToList\n                                                        }, \"   \"))\n                                                        : _createCommentVNode(\"v-if\", true),\n                                                    _createElementVNode(\"label\", _hoisted_230, [\n                                                        _cache[158] || (_cache[158] = _createElementVNode(\"span\", null, \" (COMMENT)\", -1 /* CACHED */)),\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            \"onUpdate:modelValue\": _cache[49] || (_cache[49] = ($event) => ((_unref(selectedEntry).name) = $event)),\n                                                            type: \"text\",\n                                                            class: \"text-input\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelText, _unref(selectedEntry).name]\n                                                        ])\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_231, [\n                                                        _createElementVNode(\"span\", {\n                                                            class: _normalizeClass([\"editor-badge\", _unref(selectedEntry).enabled ? 'on' : 'off'])\n                                                        }, _toDisplayString(_unref(selectedEntry).enabled ? 'EN' : 'OFF'), 3 /* TEXT, CLASS */),\n                                                        _createElementVNode(\"span\", {\n                                                            class: \"editor-badge strategy\",\n                                                            \"data-status\": getEntryVisualStatus(_unref(selectedEntry))\n                                                        }, _toDisplayString(getEntryStatusLabel(_unref(selectedEntry))), 9 /* TEXT, PROPS */, _hoisted_232),\n                                                        _createElementVNode(\"span\", _hoisted_233, \"#\" + _toDisplayString(_unref(selectedEntry).uid), 1 /* TEXT */),\n                                                        _createElementVNode(\"span\", _hoisted_234, \"Chars \" + _toDisplayString(_unref(selectedContentChars)), 1 /* TEXT */),\n                                                        _createElementVNode(\"span\", _hoisted_235, \"~\" + _toDisplayString(_unref(selectedTokenEstimate)) + \"T\", 1 /* TEXT */)\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"section\", _hoisted_236, [\n                                                    _createElementVNode(\"label\", _hoisted_237, [\n                                                        _cache[159] || (_cache[159] = _createElementVNode(\"span\", null, \" (KEYS)\", -1 /* CACHED */)),\n                                                        _withDirectives(_createElementVNode(\"textarea\", {\n                                                            \"onUpdate:modelValue\": _cache[50] || (_cache[50] = ($event) => (_isRef(selectedKeysText) ? (selectedKeysText).value = $event : null)),\n                                                            class: \"text-area compact\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelText, _unref(selectedKeysText)]\n                                                        ])\n                                                    ]),\n                                                    _createElementVNode(\"label\", _hoisted_238, [\n                                                        _cache[160] || (_cache[160] = _createElementVNode(\"span\", null, \" (SECONDARY)\", -1 /* CACHED */)),\n                                                        _withDirectives(_createElementVNode(\"textarea\", {\n                                                            \"onUpdate:modelValue\": _cache[51] || (_cache[51] = ($event) => (_isRef(selectedSecondaryKeysText) ? (selectedSecondaryKeysText).value = $event : null)),\n                                                            class: \"text-area compact\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelText, _unref(selectedSecondaryKeysText)]\n                                                        ])\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"section\", _hoisted_239, [\n                                                    _cache[162] || (_cache[162] = _createElementVNode(\"div\", { class: \"editor-content-title\" }, \" /  (CONTENT)\", -1 /* CACHED */)),\n                                                    _withDirectives(_createElementVNode(\"textarea\", {\n                                                        ref_key: \"contentTextareaRef\",\n                                                        ref: contentTextareaRef,\n                                                        \"onUpdate:modelValue\": _cache[52] || (_cache[52] = ($event) => ((_unref(selectedEntry).content) = $event)),\n                                                        class: \"text-area large editor-content-area\"\n                                                    }, null, 512 /* NEED_PATCH */), [\n                                                        [_vModelText, _unref(selectedEntry).content]\n                                                    ]),\n                                                    _createElementVNode(\"div\", {\n                                                        class: \"content-resize-handle\",\n                                                        onPointerdown: startContentResize\n                                                    }, [...(_cache[161] || (_cache[161] = [\n                                                            _createElementVNode(\"span\", { class: \"content-resize-grip\" }, \"\", -1 /* CACHED */)\n                                                        ]))], 32 /* NEED_HYDRATION */)\n                                                ]),\n                                                _createElementVNode(\"details\", _hoisted_240, [\n                                                    _cache[164] || (_cache[164] = _createElementVNode(\"summary\", null, \" / extra JSON\", -1 /* CACHED */)),\n                                                    _createElementVNode(\"label\", _hoisted_241, [\n                                                        _cache[163] || (_cache[163] = _createElementVNode(\"span\", null, \"extra JSON\", -1 /* CACHED */)),\n                                                        _withDirectives(_createElementVNode(\"textarea\", {\n                                                            \"onUpdate:modelValue\": _cache[53] || (_cache[53] = ($event) => (_isRef(selectedExtraText) ? (selectedExtraText).value = $event : null)),\n                                                            class: \"text-area compact\",\n                                                            placeholder: \"{ ... }\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelText, _unref(selectedExtraText)]\n                                                        ])\n                                                    ]),\n                                                    _createElementVNode(\"div\", { class: \"field-actions\" }, [\n                                                        _createElementVNode(\"button\", {\n                                                            class: \"btn\",\n                                                            type: \"button\",\n                                                            onClick: applyExtraJson\n                                                        }, \" extra\"),\n                                                        _createElementVNode(\"button\", {\n                                                            class: \"btn\",\n                                                            type: \"button\",\n                                                            onClick: clearExtra\n                                                        }, \" extra\")\n                                                    ])\n                                                ])\n                                            ]),\n                                            _withDirectives(_createElementVNode(\"div\", {\n                                                class: _normalizeClass([\"wb-resize-handle editor\", { dragging: _unref(paneResizeState)?.key === 'editor' }]),\n                                                onPointerdown: _cache[54] || (_cache[54] = ($event) => (startPaneResize('editor', $event)))\n                                            }, null, 34 /* CLASS, NEED_HYDRATION */), [\n                                                [_vShow, !_unref(isMobile)]\n                                            ]),\n                                            _createElementVNode(\"aside\", _hoisted_242, [\n                                                _createElementVNode(\"article\", _hoisted_243, [\n                                                    _cache[170] || (_cache[170] = _createElementVNode(\"h4\", null, \" (STRATEGY)\", -1 /* CACHED */)),\n                                                    _createElementVNode(\"label\", _hoisted_244, [\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            \"onUpdate:modelValue\": _cache[55] || (_cache[55] = ($event) => ((_unref(selectedEntry).enabled) = $event)),\n                                                            type: \"checkbox\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelCheckbox, _unref(selectedEntry).enabled]\n                                                        ]),\n                                                        _cache[165] || (_cache[165] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_245, [\n                                                        _createElementVNode(\"button\", {\n                                                            type: \"button\",\n                                                            class: _normalizeClass([\"strategy-pill constant\", { active: _unref(selectedEntry).strategy.type === 'constant' }]),\n                                                            onClick: _cache[56] || (_cache[56] = ($event) => (_unref(selectedEntry).strategy.type = 'constant'))\n                                                        }, \"   (Constant) \", 2 /* CLASS */),\n                                                        _createElementVNode(\"button\", {\n                                                            type: \"button\",\n                                                            class: _normalizeClass([\"strategy-pill vector\", { active: _unref(selectedEntry).strategy.type === 'vectorized' }]),\n                                                            onClick: _cache[57] || (_cache[57] = ($event) => (_unref(selectedEntry).strategy.type = 'vectorized'))\n                                                        }, \"   (Vector) \", 2 /* CLASS */),\n                                                        _createElementVNode(\"button\", {\n                                                            type: \"button\",\n                                                            class: _normalizeClass([\"strategy-pill selective\", { active: _unref(selectedEntry).strategy.type === 'selective' }]),\n                                                            onClick: _cache[58] || (_cache[58] = ($event) => (_unref(selectedEntry).strategy.type = 'selective'))\n                                                        }, \"   (Selective) \", 2 /* CLASS */)\n                                                    ]),\n                                                    _createElementVNode(\"details\", _hoisted_246, [\n                                                        _cache[169] || (_cache[169] = _createElementVNode(\"summary\", null, \"\", -1 /* CACHED */)),\n                                                        _createElementVNode(\"label\", _hoisted_247, [\n                                                            _cache[166] || (_cache[166] = _createElementVNode(\"span\", null, \" (LOGIC)\", -1 /* CACHED */)),\n                                                            _withDirectives(_createElementVNode(\"select\", {\n                                                                \"onUpdate:modelValue\": _cache[59] || (_cache[59] = ($event) => ((_unref(selectedEntry).strategy.keys_secondary.logic) = $event)),\n                                                                class: \"text-input\"\n                                                            }, [\n                                                                (_openBlock(), _createElementBlock(_Fragment, null, _renderList(secondaryLogicOptions, (item) => {\n                                                                    return _createElementVNode(\"option\", {\n                                                                        key: item,\n                                                                        value: item\n                                                                    }, _toDisplayString(getSecondaryLogicLabel(item)), 9 /* TEXT, PROPS */, _hoisted_248);\n                                                                }), 64 /* STABLE_FRAGMENT */))\n                                                            ], 512 /* NEED_PATCH */), [\n                                                                [_vModelSelect, _unref(selectedEntry).strategy.keys_secondary.logic]\n                                                            ])\n                                                        ]),\n                                                        _createElementVNode(\"label\", _hoisted_249, [\n                                                            _cache[167] || (_cache[167] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                                            _withDirectives(_createElementVNode(\"input\", {\n                                                                \"onUpdate:modelValue\": _cache[60] || (_cache[60] = ($event) => (_isRef(selectedScanDepthText) ? (selectedScanDepthText).value = $event : null)),\n                                                                type: \"text\",\n                                                                class: \"text-input\",\n                                                                placeholder: \" same_as_global\"\n                                                            }, null, 512 /* NEED_PATCH */), [\n                                                                [_vModelText, _unref(selectedScanDepthText)]\n                                                            ])\n                                                        ]),\n                                                        _createElementVNode(\"label\", _hoisted_250, [\n                                                            _cache[168] || (_cache[168] = _createElementVNode(\"span\", null, \"(0-100)\", -1 /* CACHED */)),\n                                                            _withDirectives(_createElementVNode(\"input\", {\n                                                                \"onUpdate:modelValue\": _cache[61] || (_cache[61] = ($event) => ((_unref(selectedEntry).probability) = $event)),\n                                                                type: \"number\",\n                                                                class: \"text-input\",\n                                                                min: \"0\",\n                                                                max: \"100\",\n                                                                step: \"1\"\n                                                            }, null, 512 /* NEED_PATCH */), [\n                                                                [\n                                                                    _vModelText,\n                                                                    _unref(selectedEntry).probability,\n                                                                    void 0,\n                                                                    { number: true }\n                                                                ]\n                                                            ])\n                                                        ])\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"article\", _hoisted_251, [\n                                                    _cache[176] || (_cache[176] = _createElementVNode(\"h4\", null, \" (INSERTION)\", -1 /* CACHED */)),\n                                                    _createElementVNode(\"label\", _hoisted_252, [\n                                                        _cache[171] || (_cache[171] = _createElementVNode(\"span\", null, \" (Position)\", -1 /* CACHED */)),\n                                                        _withDirectives(_createElementVNode(\"select\", {\n                                                            \"onUpdate:modelValue\": _cache[62] || (_cache[62] = ($event) => ((_unref(selectedEntry).position.type) = $event)),\n                                                            class: \"text-input\",\n                                                            onChange: handleSelectedPositionTypeChanged\n                                                        }, [\n                                                            (_openBlock(), _createElementBlock(_Fragment, null, _renderList(positionTypeOptions, (item) => {\n                                                                return _createElementVNode(\"option\", {\n                                                                    key: item,\n                                                                    value: item\n                                                                }, _toDisplayString(getPositionTypeLabel(item)), 9 /* TEXT, PROPS */, _hoisted_253);\n                                                            }), 64 /* STABLE_FRAGMENT */))\n                                                        ], 544 /* NEED_HYDRATION, NEED_PATCH */), [\n                                                            [_vModelSelect, _unref(selectedEntry).position.type]\n                                                        ])\n                                                    ]),\n                                                    _createElementVNode(\"label\", _hoisted_254, [\n                                                        _cache[172] || (_cache[172] = _createElementVNode(\"span\", null, \" (Order)\", -1 /* CACHED */)),\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            \"onUpdate:modelValue\": _cache[63] || (_cache[63] = ($event) => ((_unref(selectedEntry).position.order) = $event)),\n                                                            type: \"number\",\n                                                            class: \"text-input\",\n                                                            step: \"1\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [\n                                                                _vModelText,\n                                                                _unref(selectedEntry).position.order,\n                                                                void 0,\n                                                                { number: true }\n                                                            ]\n                                                        ])\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_255, [\n                                                        _createElementVNode(\"label\", {\n                                                            class: _normalizeClass([\"field\", { disabled: _unref(selectedEntry).position.type !== 'at_depth' }])\n                                                        }, [\n                                                            _cache[174] || (_cache[174] = _createElementVNode(\"span\", null, \"at_depth role\", -1 /* CACHED */)),\n                                                            _withDirectives(_createElementVNode(\"select\", {\n                                                                \"onUpdate:modelValue\": _cache[64] || (_cache[64] = ($event) => ((_unref(selectedEntry).position.role) = $event)),\n                                                                class: \"text-input\",\n                                                                disabled: _unref(selectedEntry).position.type !== 'at_depth'\n                                                            }, [...(_cache[173] || (_cache[173] = [\n                                                                    _createElementVNode(\"option\", { value: \"system\" }, \"system\", -1 /* CACHED */),\n                                                                    _createElementVNode(\"option\", { value: \"assistant\" }, \"assistant\", -1 /* CACHED */),\n                                                                    _createElementVNode(\"option\", { value: \"user\" }, \"user\", -1 /* CACHED */)\n                                                                ]))], 8 /* PROPS */, _hoisted_256), [\n                                                                [_vModelSelect, _unref(selectedEntry).position.role]\n                                                            ])\n                                                        ], 2 /* CLASS */),\n                                                        _createElementVNode(\"label\", {\n                                                            class: _normalizeClass([\"field\", { disabled: _unref(selectedEntry).position.type !== 'at_depth' }])\n                                                        }, [\n                                                            _cache[175] || (_cache[175] = _createElementVNode(\"span\", null, \"at_depth depth\", -1 /* CACHED */)),\n                                                            _withDirectives(_createElementVNode(\"input\", {\n                                                                \"onUpdate:modelValue\": _cache[65] || (_cache[65] = ($event) => ((_unref(selectedEntry).position.depth) = $event)),\n                                                                type: \"number\",\n                                                                class: \"text-input\",\n                                                                min: \"1\",\n                                                                step: \"1\",\n                                                                disabled: _unref(selectedEntry).position.type !== 'at_depth'\n                                                            }, null, 8 /* PROPS */, _hoisted_257), [\n                                                                [\n                                                                    _vModelText,\n                                                                    _unref(selectedEntry).position.depth,\n                                                                    void 0,\n                                                                    { number: true }\n                                                                ]\n                                                            ])\n                                                        ], 2 /* CLASS */)\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"article\", _hoisted_258, [\n                                                    _cache[183] || (_cache[183] = _createElementVNode(\"h4\", null, \" (RECURSION)\", -1 /* CACHED */)),\n                                                    _createElementVNode(\"label\", _hoisted_259, [\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            \"onUpdate:modelValue\": _cache[66] || (_cache[66] = ($event) => ((_unref(selectedEntry).recursion.prevent_incoming) = $event)),\n                                                            type: \"checkbox\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelCheckbox, _unref(selectedEntry).recursion.prevent_incoming]\n                                                        ]),\n                                                        _cache[177] || (_cache[177] = _createElementVNode(\"span\", null, \" (Exclude Incoming)\", -1 /* CACHED */))\n                                                    ]),\n                                                    _createElementVNode(\"label\", _hoisted_260, [\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            \"onUpdate:modelValue\": _cache[67] || (_cache[67] = ($event) => ((_unref(selectedEntry).recursion.prevent_outgoing) = $event)),\n                                                            type: \"checkbox\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelCheckbox, _unref(selectedEntry).recursion.prevent_outgoing]\n                                                        ]),\n                                                        _cache[178] || (_cache[178] = _createElementVNode(\"span\", null, \" (Prevent Outgoing)\", -1 /* CACHED */))\n                                                    ]),\n                                                    _createElementVNode(\"label\", _hoisted_261, [\n                                                        _cache[179] || (_cache[179] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */)),\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            \"onUpdate:modelValue\": _cache[68] || (_cache[68] = ($event) => (_isRef(selectedRecursionDelayText) ? (selectedRecursionDelayText).value = $event : null)),\n                                                            type: \"text\",\n                                                            class: \"text-input\",\n                                                            placeholder: \" null\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelText, _unref(selectedRecursionDelayText)]\n                                                        ])\n                                                    ]),\n                                                    _createElementVNode(\"div\", _hoisted_262, [\n                                                        _createElementVNode(\"label\", _hoisted_263, [\n                                                            _cache[180] || (_cache[180] = _createElementVNode(\"span\", null, \"sticky\", -1 /* CACHED */)),\n                                                            _withDirectives(_createElementVNode(\"input\", {\n                                                                \"onUpdate:modelValue\": _cache[69] || (_cache[69] = ($event) => (_isRef(selectedStickyText) ? (selectedStickyText).value = $event : null)),\n                                                                type: \"text\",\n                                                                class: \"text-input\",\n                                                                placeholder: \" null\"\n                                                            }, null, 512 /* NEED_PATCH */), [\n                                                                [_vModelText, _unref(selectedStickyText)]\n                                                            ])\n                                                        ]),\n                                                        _createElementVNode(\"label\", _hoisted_264, [\n                                                            _cache[181] || (_cache[181] = _createElementVNode(\"span\", null, \"cooldown\", -1 /* CACHED */)),\n                                                            _withDirectives(_createElementVNode(\"input\", {\n                                                                \"onUpdate:modelValue\": _cache[70] || (_cache[70] = ($event) => (_isRef(selectedCooldownText) ? (selectedCooldownText).value = $event : null)),\n                                                                type: \"text\",\n                                                                class: \"text-input\",\n                                                                placeholder: \" null\"\n                                                            }, null, 512 /* NEED_PATCH */), [\n                                                                [_vModelText, _unref(selectedCooldownText)]\n                                                            ])\n                                                        ])\n                                                    ]),\n                                                    _createElementVNode(\"label\", _hoisted_265, [\n                                                        _cache[182] || (_cache[182] = _createElementVNode(\"span\", null, \"delay\", -1 /* CACHED */)),\n                                                        _withDirectives(_createElementVNode(\"input\", {\n                                                            \"onUpdate:modelValue\": _cache[71] || (_cache[71] = ($event) => (_isRef(selectedEffectDelayText) ? (selectedEffectDelayText).value = $event : null)),\n                                                            type: \"text\",\n                                                            class: \"text-input\",\n                                                            placeholder: \" null\"\n                                                        }, null, 512 /* NEED_PATCH */), [\n                                                            [_vModelText, _unref(selectedEffectDelayText)]\n                                                        ])\n                                                    ])\n                                                ])\n                                            ])\n                                        ], 4 /* STYLE */))\n                                        : (_openBlock(), _createElementBlock(\"div\", _hoisted_266, \"\"))\n                                ], 512 /* NEED_PATCH */), [\n                                    [_vShow, !_unref(isMobile) || _unref(showMobileEditor)]\n                                ])\n                            ], 4 /* STYLE */), [\n                                [_vShow, !_unref(aiGeneratorMode)]\n                            ])\n                        ]),\n                        _createElementVNode(\"footer\", _hoisted_267, [\n                            _createElementVNode(\"span\", null, _toDisplayString(_unref(isBusy) ? '...' : _unref(statusMessage)), 1 /* TEXT */),\n                            _createElementVNode(\"span\", null, \" : \" + _toDisplayString(_unref(draftEntries).length) + \" | : \" + _toDisplayString(_unref(totalContentChars)) + \" | \" + _toDisplayString(_unref(hasUnsavedChanges) ? '' : ''), 1 /* TEXT */)\n                        ])\n                    ], 64 /* STABLE_FRAGMENT */))\n                    : _createCommentVNode(\"v-if\", true),\n                _createCommentVNode(\"  End Desktop Layout  \"),\n                (_unref(showEntryHistoryModal))\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 2,\n                        class: \"wb-modal-backdrop\",\n                        onClick: _cache[73] || (_cache[73] = _withModifiers(($event) => (showEntryHistoryModal.value = false), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_268, [\n                            _createElementVNode(\"div\", _hoisted_269, [\n                                _createElementVNode(\"div\", null, [\n                                    _cache[184] || (_cache[184] = _createElementVNode(\"strong\", null, \" \", -1 /* CACHED */)),\n                                    _createElementVNode(\"span\", null, _toDisplayString(_unref(entryHistorySummary)), 1 /* TEXT */)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_270, [\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn mini\",\n                                        type: \"button\",\n                                        disabled: !_unref(selectedEntry),\n                                        onClick: createManualEntrySnapshot\n                                    }, \"  \", 8 /* PROPS */, _hoisted_271),\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn mini danger\",\n                                        type: \"button\",\n                                        disabled: !_unref(entrySnapshotsForSelected).length,\n                                        onClick: clearCurrentEntrySnapshots\n                                    }, \"  \", 8 /* PROPS */, _hoisted_272),\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn mini\",\n                                        type: \"button\",\n                                        onClick: _cache[72] || (_cache[72] = ($event) => (showEntryHistoryModal.value = false))\n                                    }, \"\")\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_273, [\n                                _createElementVNode(\"aside\", _hoisted_274, [\n                                    _cache[185] || (_cache[185] = _createElementVNode(\"div\", { class: \"wb-history-versions-title\" }, \"L/R\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_275, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(entryVersionViews), (ver) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: ver.id,\n                                                class: \"wb-history-version-item\"\n                                            }, [\n                                                _createElementVNode(\"div\", _hoisted_276, [\n                                                    _createElementVNode(\"strong\", null, _toDisplayString(formatHistoryOptionLabel(ver.label, ver.ts, ver.isCurrent)), 1 /* TEXT */),\n                                                    _createElementVNode(\"div\", _hoisted_277, [\n                                                        _createElementVNode(\"button\", {\n                                                            class: _normalizeClass([\"mini-lr\", { active: _unref(entryHistoryLeftId) === ver.id }]),\n                                                            onClick: ($event) => (entryHistoryLeftId.value = ver.id)\n                                                        }, \"L\", 10 /* CLASS, PROPS */, _hoisted_278),\n                                                        _createElementVNode(\"button\", {\n                                                            class: _normalizeClass([\"mini-lr\", { active: _unref(entryHistoryRightId) === ver.id }]),\n                                                            onClick: ($event) => (entryHistoryRightId.value = ver.id)\n                                                        }, \"R\", 10 /* CLASS, PROPS */, _hoisted_279)\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"span\", null, _toDisplayString(ver.name), 1 /* TEXT */)\n                                            ]));\n                                        }), 128 /* KEYED_FRAGMENT */)),\n                                        (_unref(entryVersionViews).length <= 1)\n                                            ? (_openBlock(), _createElementBlock(\"div\", _hoisted_280, \"\"))\n                                            : _createCommentVNode(\"v-if\", true)\n                                    ])\n                                ]),\n                                _createElementVNode(\"section\", _hoisted_281, [\n                                    _createElementVNode(\"div\", _hoisted_282, [\n                                        _createElementVNode(\"div\", null, \" Left: \" + _toDisplayString(_unref(selectedEntryHistoryLeft) ? formatHistoryOptionLabel(_unref(selectedEntryHistoryLeft).label, _unref(selectedEntryHistoryLeft).ts, _unref(selectedEntryHistoryLeft).isCurrent) : '-') + \" | Right: \" + _toDisplayString(_unref(selectedEntryHistoryRight) ? formatHistoryOptionLabel(_unref(selectedEntryHistoryRight).label, _unref(selectedEntryHistoryRight).ts, _unref(selectedEntryHistoryRight).isCurrent) : '-'), 1 /* TEXT */),\n                                        _createElementVNode(\"button\", {\n                                            class: \"btn mini\",\n                                            type: \"button\",\n                                            disabled: !_unref(canRestoreEntryFromLeft),\n                                            onClick: restoreEntryFromLeftHistory\n                                        }, \"  Left \", 8 /* PROPS */, _hoisted_283)\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_284, [\n                                        _createElementVNode(\"div\", null, [\n                                            _cache[186] || (_cache[186] = _createElementVNode(\"div\", { class: \"wb-history-diff-title\" }, \"Left\", -1 /* CACHED */)),\n                                            _createElementVNode(\"div\", {\n                                                class: \"wb-history-diff-body\",\n                                                innerHTML: _unref(entryHistoryDiff).leftHtml\n                                            }, null, 8 /* PROPS */, _hoisted_285)\n                                        ]),\n                                        _createElementVNode(\"div\", null, [\n                                            _cache[187] || (_cache[187] = _createElementVNode(\"div\", { class: \"wb-history-diff-title\" }, \"Right\", -1 /* CACHED */)),\n                                            _createElementVNode(\"div\", {\n                                                class: \"wb-history-diff-body\",\n                                                innerHTML: _unref(entryHistoryDiff).rightHtml\n                                            }, null, 8 /* PROPS */, _hoisted_286)\n                                        ])\n                                    ])\n                                ])\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (_unref(showWorldbookHistoryModal))\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 3,\n                        class: \"wb-modal-backdrop\",\n                        onClick: _cache[75] || (_cache[75] = _withModifiers(($event) => (showWorldbookHistoryModal.value = false), [\"self\"]))\n                    }, [\n                        _createElementVNode(\"div\", _hoisted_287, [\n                            _createElementVNode(\"div\", _hoisted_288, [\n                                _createElementVNode(\"div\", null, [\n                                    _cache[188] || (_cache[188] = _createElementVNode(\"strong\", null, \" \", -1 /* CACHED */)),\n                                    _createElementVNode(\"span\", null, _toDisplayString(getWorldbookVersionDiffSummary(_unref(selectedWorldbookHistoryLeft), _unref(selectedWorldbookHistoryRight))), 1 /* TEXT */)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_289, [\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn mini\",\n                                        type: \"button\",\n                                        disabled: !_unref(selectedWorldbookName),\n                                        onClick: createManualSnapshot\n                                    }, \"  \", 8 /* PROPS */, _hoisted_290),\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn mini danger\",\n                                        type: \"button\",\n                                        disabled: !_unref(snapshotsForCurrent).length,\n                                        onClick: clearCurrentSnapshots\n                                    }, \"  \", 8 /* PROPS */, _hoisted_291),\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn mini\",\n                                        type: \"button\",\n                                        onClick: _cache[74] || (_cache[74] = ($event) => (showWorldbookHistoryModal.value = false))\n                                    }, \"\")\n                                ])\n                            ]),\n                            _createElementVNode(\"div\", _hoisted_292, [\n                                _createElementVNode(\"aside\", _hoisted_293, [\n                                    _cache[189] || (_cache[189] = _createElementVNode(\"div\", { class: \"wb-history-versions-title\" }, \"L/R\", -1 /* CACHED */)),\n                                    _createElementVNode(\"div\", _hoisted_294, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(worldbookVersionViews), (ver) => {\n                                            return (_openBlock(), _createElementBlock(\"div\", {\n                                                key: ver.id,\n                                                class: \"wb-history-version-item\"\n                                            }, [\n                                                _createElementVNode(\"div\", _hoisted_295, [\n                                                    _createElementVNode(\"strong\", null, _toDisplayString(formatHistoryOptionLabel(ver.label, ver.ts, ver.isCurrent)), 1 /* TEXT */),\n                                                    _createElementVNode(\"div\", _hoisted_296, [\n                                                        _createElementVNode(\"button\", {\n                                                            class: _normalizeClass([\"mini-lr\", { active: _unref(worldbookHistoryLeftId) === ver.id }]),\n                                                            onClick: ($event) => (worldbookHistoryLeftId.value = ver.id)\n                                                        }, \"L\", 10 /* CLASS, PROPS */, _hoisted_297),\n                                                        _createElementVNode(\"button\", {\n                                                            class: _normalizeClass([\"mini-lr\", { active: _unref(worldbookHistoryRightId) === ver.id }]),\n                                                            onClick: ($event) => (worldbookHistoryRightId.value = ver.id)\n                                                        }, \"R\", 10 /* CLASS, PROPS */, _hoisted_298)\n                                                    ])\n                                                ]),\n                                                _createElementVNode(\"span\", null, \"entries: \" + _toDisplayString(ver.entries.length), 1 /* TEXT */)\n                                            ]));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ])\n                                ]),\n                                _createElementVNode(\"section\", _hoisted_299, [\n                                    _createElementVNode(\"div\", _hoisted_300, [\n                                        _createElementVNode(\"div\", null, \" Left: \" + _toDisplayString(_unref(selectedWorldbookHistoryLeft) ? formatHistoryOptionLabel(_unref(selectedWorldbookHistoryLeft).label, _unref(selectedWorldbookHistoryLeft).ts, _unref(selectedWorldbookHistoryLeft).isCurrent) : '-') + \" | Right: \" + _toDisplayString(_unref(selectedWorldbookHistoryRight) ? formatHistoryOptionLabel(_unref(selectedWorldbookHistoryRight).label, _unref(selectedWorldbookHistoryRight).ts, _unref(selectedWorldbookHistoryRight).isCurrent) : '-'), 1 /* TEXT */),\n                                        _createElementVNode(\"button\", {\n                                            class: \"btn mini\",\n                                            type: \"button\",\n                                            disabled: !_unref(canRestoreWorldbookFromLeft),\n                                            onClick: restoreWorldbookFromLeftHistory\n                                        }, \"  Left \", 8 /* PROPS */, _hoisted_301)\n                                    ]),\n                                    _createElementVNode(\"div\", _hoisted_302, [\n                                        _createElementVNode(\"div\", null, [\n                                            _cache[190] || (_cache[190] = _createElementVNode(\"div\", { class: \"wb-history-diff-title\" }, \"Left\", -1 /* CACHED */)),\n                                            _createElementVNode(\"div\", {\n                                                class: \"wb-history-diff-body\",\n                                                innerHTML: _unref(worldbookHistoryDiff).leftHtml\n                                            }, null, 8 /* PROPS */, _hoisted_303)\n                                        ]),\n                                        _createElementVNode(\"div\", null, [\n                                            _cache[191] || (_cache[191] = _createElementVNode(\"div\", { class: \"wb-history-diff-title\" }, \"Right\", -1 /* CACHED */)),\n                                            _createElementVNode(\"div\", {\n                                                class: \"wb-history-diff-body\",\n                                                innerHTML: _unref(worldbookHistoryDiff).rightHtml\n                                            }, null, 8 /* PROPS */, _hoisted_304)\n                                        ])\n                                    ])\n                                ])\n                            ])\n                        ])\n                    ]))\n                    : _createCommentVNode(\"v-if\", true),\n                (_unref(floatingPanels).find.visible)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 4,\n                        class: \"wb-floating-window find-window\",\n                        style: _normalizeStyle(getFloatingPanelStyle('find')),\n                        onPointerdown: _cache[94] || (_cache[94] = ($event) => (bringFloatingToFront('find')))\n                    }, [\n                        _createElementVNode(\"div\", {\n                            class: \"wb-floating-header\",\n                            onPointerdown: _cache[82] || (_cache[82] = ($event) => (startFloatingDrag('find', $event)))\n                        }, [\n                            _cache[192] || (_cache[192] = _createElementVNode(\"strong\", null, \" \", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_305, [\n                                _createElementVNode(\"button\", {\n                                    class: \"btn mini\",\n                                    type: \"button\",\n                                    disabled: !_unref(draftEntries).length,\n                                    onPointerdown: _cache[76] || (_cache[76] = _withModifiers(() => { }, [\"stop\"])),\n                                    onClick: findFirstMatch\n                                }, \"  \", 40 /* PROPS, NEED_HYDRATION */, _hoisted_306),\n                                _createElementVNode(\"button\", {\n                                    class: \"btn mini\",\n                                    type: \"button\",\n                                    disabled: !_unref(draftEntries).length,\n                                    onPointerdown: _cache[77] || (_cache[77] = _withModifiers(() => { }, [\"stop\"])),\n                                    onClick: findPreviousMatch\n                                }, \"  \", 40 /* PROPS, NEED_HYDRATION */, _hoisted_307),\n                                _createElementVNode(\"button\", {\n                                    class: \"btn mini\",\n                                    type: \"button\",\n                                    disabled: !_unref(draftEntries).length,\n                                    onPointerdown: _cache[78] || (_cache[78] = _withModifiers(() => { }, [\"stop\"])),\n                                    onClick: findNextMatch\n                                }, \"  \", 40 /* PROPS, NEED_HYDRATION */, _hoisted_308),\n                                _createElementVNode(\"button\", {\n                                    class: \"btn mini\",\n                                    type: \"button\",\n                                    disabled: !_unref(draftEntries).length,\n                                    onPointerdown: _cache[79] || (_cache[79] = _withModifiers(() => { }, [\"stop\"])),\n                                    onClick: applyBatchReplace\n                                }, \"  \", 40 /* PROPS, NEED_HYDRATION */, _hoisted_309),\n                                _createElementVNode(\"button\", {\n                                    class: \"btn mini danger\",\n                                    type: \"button\",\n                                    onPointerdown: _cache[80] || (_cache[80] = _withModifiers(() => { }, [\"stop\"])),\n                                    onClick: _cache[81] || (_cache[81] = ($event) => (closeFloatingPanel('find')))\n                                }, \"  \", 32 /* NEED_HYDRATION */)\n                            ])\n                        ], 32 /* NEED_HYDRATION */),\n                        _createElementVNode(\"div\", _hoisted_310, [\n                            _createElementVNode(\"div\", _hoisted_311, [\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[83] || (_cache[83] = ($event) => (_isRef(batchFindText) ? (batchFindText).value = $event : null)),\n                                    type: \"text\",\n                                    class: \"text-input\",\n                                    placeholder: \" / \"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, _unref(batchFindText)]\n                                ]),\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[84] || (_cache[84] = ($event) => (_isRef(batchReplaceText) ? (batchReplaceText).value = $event : null)),\n                                    type: \"text\",\n                                    class: \"text-input\",\n                                    placeholder: \"\"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, _unref(batchReplaceText)]\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_312, [\n                                    _createElementVNode(\"label\", _hoisted_313, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[85] || (_cache[85] = ($event) => (_isRef(batchSearchScope) ? (batchSearchScope).value = $event : null)),\n                                            type: \"radio\",\n                                            value: \"all\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelRadio, _unref(batchSearchScope)]\n                                        ]),\n                                        _cache[193] || (_cache[193] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n                                    ]),\n                                    _createElementVNode(\"label\", _hoisted_314, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[86] || (_cache[86] = ($event) => (_isRef(batchSearchScope) ? (batchSearchScope).value = $event : null)),\n                                            type: \"radio\",\n                                            value: \"current\",\n                                            disabled: !_unref(selectedEntry)\n                                        }, null, 8 /* PROPS */, _hoisted_315), [\n                                            [_vModelRadio, _unref(batchSearchScope)]\n                                        ]),\n                                        _cache[194] || (_cache[194] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n                                    ]),\n                                    _createElementVNode(\"span\", _hoisted_316, _toDisplayString(_unref(findHitSummaryText)), 1 /* TEXT */)\n                                ]),\n                                _withDirectives(_createElementVNode(\"input\", {\n                                    \"onUpdate:modelValue\": _cache[87] || (_cache[87] = ($event) => (_isRef(batchExcludeText) ? (batchExcludeText).value = $event : null)),\n                                    type: \"text\",\n                                    class: \"text-input\",\n                                    placeholder: \"#UID /  /  / \"\n                                }, null, 512 /* NEED_PATCH */), [\n                                    [_vModelText, _unref(batchExcludeText)]\n                                ]),\n                                (_unref(activeFindHit))\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_317, [\n                                        _createElementVNode(\"strong\", null, \"#\" + _toDisplayString(_unref(activeFindHit).entryUid) + \" \" + _toDisplayString(_unref(activeFindHit).entryName || ` ${_unref(activeFindHit).entryUid}`), 1 /* TEXT */),\n                                        _createElementVNode(\"span\", null, _toDisplayString(getFindFieldLabel(_unref(activeFindHit).field)) + \"  \" + _toDisplayString(_unref(activeFindHit).preview), 1 /* TEXT */)\n                                    ]))\n                                    : _createCommentVNode(\"v-if\", true),\n                                _createElementVNode(\"div\", _hoisted_318, \" : `#12, name:, content:\" + _toDisplayString(_ctx.user) + \", keys:`// \", 1 /* TEXT */),\n                                (_unref(batchExcludeTokensPreview).length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_319, [\n                                        (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(batchExcludeTokensPreview), (token) => {\n                                            return (_openBlock(), _createElementBlock(\"span\", {\n                                                key: token,\n                                                class: \"exclude-chip\"\n                                            }, _toDisplayString(token), 1 /* TEXT */));\n                                        }), 128 /* KEYED_FRAGMENT */))\n                                    ]))\n                                    : _createCommentVNode(\"v-if\", true),\n                                _createElementVNode(\"div\", _hoisted_320, [\n                                    _createElementVNode(\"label\", _hoisted_321, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[88] || (_cache[88] = ($event) => (_isRef(batchUseRegex) ? (batchUseRegex).value = $event : null)),\n                                            type: \"checkbox\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelCheckbox, _unref(batchUseRegex)]\n                                        ]),\n                                        _cache[195] || (_cache[195] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n                                    ]),\n                                    _createElementVNode(\"label\", _hoisted_322, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[89] || (_cache[89] = ($event) => (_isRef(batchInName) ? (batchInName).value = $event : null)),\n                                            type: \"checkbox\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelCheckbox, _unref(batchInName)]\n                                        ]),\n                                        _cache[196] || (_cache[196] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n                                    ]),\n                                    _createElementVNode(\"label\", _hoisted_323, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[90] || (_cache[90] = ($event) => (_isRef(batchInContent) ? (batchInContent).value = $event : null)),\n                                            type: \"checkbox\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelCheckbox, _unref(batchInContent)]\n                                        ]),\n                                        _cache[197] || (_cache[197] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n                                    ]),\n                                    _createElementVNode(\"label\", _hoisted_324, [\n                                        _withDirectives(_createElementVNode(\"input\", {\n                                            \"onUpdate:modelValue\": _cache[91] || (_cache[91] = ($event) => (_isRef(batchInKeys) ? (batchInKeys).value = $event : null)),\n                                            type: \"checkbox\"\n                                        }, null, 512 /* NEED_PATCH */), [\n                                            [_vModelCheckbox, _unref(batchInKeys)]\n                                        ]),\n                                        _cache[198] || (_cache[198] = _createElementVNode(\"span\", null, \"\", -1 /* CACHED */))\n                                    ])\n                                ])\n                            ]),\n                            _createElementVNode(\"details\", _hoisted_325, [\n                                _cache[199] || (_cache[199] = _createElementVNode(\"summary\", null, \"\", -1 /* CACHED */)),\n                                _createElementVNode(\"div\", _hoisted_326, [\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn\",\n                                        type: \"button\",\n                                        disabled: !_unref(draftEntries).length,\n                                        onClick: normalizeAllEntries\n                                    }, \"  \", 8 /* PROPS */, _hoisted_327),\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn\",\n                                        type: \"button\",\n                                        disabled: !_unref(draftEntries).length,\n                                        onClick: sortEntriesByOrderDesc\n                                    }, \"  order  \", 8 /* PROPS */, _hoisted_328)\n                                ]),\n                                _createElementVNode(\"div\", _hoisted_329, [\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn\",\n                                        type: \"button\",\n                                        disabled: !_unref(draftEntries).length,\n                                        onClick: _cache[92] || (_cache[92] = ($event) => (setEnabledForAll(true)))\n                                    }, \"  \", 8 /* PROPS */, _hoisted_330),\n                                    _createElementVNode(\"button\", {\n                                        class: \"btn\",\n                                        type: \"button\",\n                                        disabled: !_unref(draftEntries).length,\n                                        onClick: _cache[93] || (_cache[93] = ($event) => (setEnabledForAll(false)))\n                                    }, \"  \", 8 /* PROPS */, _hoisted_331)\n                                ])\n                            ])\n                        ])\n                    ], 36 /* STYLE, NEED_HYDRATION */))\n                    : _createCommentVNode(\"v-if\", true),\n                (_unref(floatingPanels).activation.visible)\n                    ? (_openBlock(), _createElementBlock(\"div\", {\n                        key: 5,\n                        class: \"wb-floating-window activation-window\",\n                        style: _normalizeStyle(getFloatingPanelStyle('activation')),\n                        onPointerdown: _cache[99] || (_cache[99] = ($event) => (bringFloatingToFront('activation')))\n                    }, [\n                        _createElementVNode(\"div\", {\n                            class: \"wb-floating-header\",\n                            onPointerdown: _cache[98] || (_cache[98] = ($event) => (startFloatingDrag('activation', $event)))\n                        }, [\n                            _cache[200] || (_cache[200] = _createElementVNode(\"strong\", null, \" WORLD_INFO_ACTIVATED\", -1 /* CACHED */)),\n                            _createElementVNode(\"div\", _hoisted_332, [\n                                _createElementVNode(\"button\", {\n                                    class: \"btn mini danger\",\n                                    type: \"button\",\n                                    disabled: !_unref(activationLogs).length,\n                                    onPointerdown: _cache[95] || (_cache[95] = _withModifiers(() => { }, [\"stop\"])),\n                                    onClick: clearActivationLogs\n                                }, \"  \", 40 /* PROPS, NEED_HYDRATION */, _hoisted_333),\n                                _createElementVNode(\"button\", {\n                                    class: \"btn mini danger\",\n                                    type: \"button\",\n                                    onPointerdown: _cache[96] || (_cache[96] = _withModifiers(() => { }, [\"stop\"])),\n                                    onClick: _cache[97] || (_cache[97] = ($event) => (closeFloatingPanel('activation')))\n                                }, \"  \", 32 /* NEED_HYDRATION */)\n                            ])\n                        ], 32 /* NEED_HYDRATION */),\n                        _createElementVNode(\"div\", _hoisted_334, [\n                            _createElementVNode(\"div\", _hoisted_335, [\n                                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(_unref(activationLogs), (log) => {\n                                    return (_openBlock(), _createElementBlock(\"div\", {\n                                        key: log.id,\n                                        class: \"activation-item\"\n                                    }, [\n                                        _createElementVNode(\"div\", _hoisted_336, [\n                                            _createElementVNode(\"strong\", null, _toDisplayString(log.world), 1 /* TEXT */),\n                                            _createElementVNode(\"span\", null, \"#\" + _toDisplayString(log.uid) + \"  \" + _toDisplayString(log.name), 1 /* TEXT */)\n                                        ]),\n                                        _createElementVNode(\"div\", _hoisted_337, [\n                                            _createElementVNode(\"span\", null, _toDisplayString(formatDateTime(log.time)), 1 /* TEXT */),\n                                            _createElementVNode(\"span\", null, _toDisplayString(log.contentPreview), 1 /* TEXT */)\n                                        ])\n                                    ]));\n                                }), 128 /* KEYED_FRAGMENT */)),\n                                (!_unref(activationLogs).length)\n                                    ? (_openBlock(), _createElementBlock(\"div\", _hoisted_338, \"\"))\n                                    : _createCommentVNode(\"v-if\", true)\n                            ])\n                        ])\n                    ], 36 /* STYLE, NEED_HYDRATION */))\n                    : _createCommentVNode(\"v-if\", true)\n            ], 4 /* STYLE */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./App.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=032fd8fa&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_71d7740e7607e74f4d732110d38a3681/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-032fd8fa\"]])\n\nexport default __exports__","import { createApp, type App as VueApp } from 'vue';\nimport { createScriptIdDiv, teleportStyle } from '@util/script';\nimport WorldbookAssistantApp from './App.vue';\n\nconst MENU_ID = 'wb-assistant-menu-item';\nconst PANEL_ID = 'wb-assistant-panel';\nconst FAB_ID = 'wb-assistant-fab';\nconst FAB_POS_KEY = '__WB_FAB_POS__';\nconst PANEL_STYLE_ID = 'wb-assistant-panel-style';\nconst PANEL_BODY_ID = 'wb-assistant-panel-body';\nconst EVENT_NS = '.wbAssistantMenu';\nconst DIRTY_STATE_KEY = '__WB_ASSISTANT_HAS_UNSAVED_CHANGES__';\n\nlet app: VueApp<Element> | null = null;\nlet panelRoot: JQuery<HTMLDivElement> | null = null;\nlet destroyTeleport: (() => void) | null = null;\nlet menuObserver: MutationObserver | null = null;\nlet menuRetryTimer: number | null = null;\nlet isPanelVisible = false;\n\nfunction getHostWindow(): Window {\n  return window.parent || window;\n}\n\nfunction getHostDocument(): Document {\n  return getHostWindow().document;\n}\n\nfunction ensurePanelStyle(): void {\n  const doc = getHostDocument();\n  if (doc.getElementById(PANEL_STYLE_ID)) {\n    return;\n  }\n  const style = doc.createElement('style');\n  style.id = PANEL_STYLE_ID;\n  style.textContent = `\n#${PANEL_ID} {\n  position: fixed;\n  z-index: 10020;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n  width: min(1280px, calc(100vw - 120px));\n  height: calc(100vh - 16px);\n  min-width: 920px;\n  min-height: 560px;\n  max-width: calc(100vw - 16px);\n  max-height: calc(100vh - 16px);\n  display: none;\n  border: 1px solid var(--wb-host-border, #334155);\n  border-radius: 10px;\n  background: var(--wb-host-bg, #0b1220);\n  box-shadow: 0 16px 48px rgba(0, 0, 0, 0.45);\n  overflow: hidden;\n  resize: both;\n}\n\n#${PANEL_ID}.active {\n  display: flex;\n  flex-direction: column;\n}\n\n#${PANEL_ID} .wb-assistant-header {\n  height: 44px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0 10px 0 12px;\n  background: var(--wb-host-header-bg, #111827);\n  border-bottom: 1px solid var(--wb-host-border, #334155);\n  cursor: move;\n  user-select: none;\n}\n\n#${PANEL_ID} .wb-assistant-header-title {\n  color: var(--wb-host-text, #e2e8f0);\n  font-size: 14px;\n  font-weight: 600;\n}\n\n#${PANEL_ID} .wb-assistant-header-actions {\n  display: inline-flex;\n  align-items: center;\n  gap: 6px;\n}\n\n#${PANEL_ID} .wb-assistant-tool {\n  width: 30px;\n  height: 30px;\n  border: 1px solid var(--wb-host-tool-border, #475569);\n  border-radius: 6px;\n  background: var(--wb-host-tool-bg, #1f2937);\n  color: var(--wb-host-text, #e2e8f0);\n  cursor: pointer;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 14px;\n}\n\n#${PANEL_ID} .wb-assistant-tool:hover {\n  border-color: #60a5fa;\n}\n\n#${PANEL_ID} .wb-assistant-theme:hover {\n  border-color: #a78bfa;\n}\n\n#${PANEL_ID} .wb-assistant-save:hover {\n  border-color: #34d399;\n}\n\n#${PANEL_ID} .wb-assistant-close {\n  width: 30px;\n  height: 30px;\n  border: 1px solid var(--wb-host-tool-border, #475569);\n  border-radius: 6px;\n  background: var(--wb-host-tool-bg, #1f2937);\n  color: var(--wb-host-text, #e2e8f0);\n  cursor: pointer;\n}\n\n#${PANEL_ID} .wb-assistant-close:hover {\n  border-color: #f43f5e;\n}\n\n#${PANEL_BODY_ID} {\n  flex: 1;\n  min-height: 0;\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n\n#${PANEL_BODY_ID} > div {\n  flex: 1;\n  min-height: 0;\n  display: flex;\n  flex-direction: column;\n}\n\n#${MENU_ID}.active {\n  background-color: rgba(56, 189, 248, 0.18) !important;\n}\n\n#${PANEL_ID} .wb-theme-dropdown {\n  position: absolute;\n  top: 100%;\n  right: 0;\n  z-index: 10300;\n  margin-top: 4px;\n  border: 1px solid var(--wb-host-border, #334155);\n  border-radius: 8px;\n  background: var(--wb-host-header-bg, #111827);\n  box-shadow: 0 8px 24px rgba(0,0,0,0.45);\n  padding: 4px;\n  min-width: 140px;\n}\n\n#${PANEL_ID} .wb-theme-dropdown button {\n  display: block;\n  width: 100%;\n  border: none;\n  border-radius: 6px;\n  background: transparent;\n  color: var(--wb-host-text, #e2e8f0);\n  padding: 6px 12px;\n  text-align: left;\n  cursor: pointer;\n  font-size: 13px;\n  white-space: nowrap;\n}\n\n#${PANEL_ID} .wb-theme-dropdown button:hover {\n  background: rgba(124, 58, 237, 0.15);\n}\n\n#${PANEL_ID} .wb-theme-dropdown button.active {\n  background: rgba(124, 58, 237, 0.25);\n  color: #c4b5fd;\n}\n\n@media (max-width: 768px) {\n  #${PANEL_ID} {\n    left: 0;\n    top: 0;\n    transform: none;\n    width: 100vw !important;\n    height: 100vh !important;\n    min-width: unset;\n    min-height: unset;\n    max-width: none;\n    max-height: none;\n    border-radius: 0;\n    border: none;\n    box-shadow: none;\n    resize: none;\n  }\n\n  #${PANEL_ID} .wb-assistant-header {\n    cursor: default;\n  }\n\n  #${PANEL_BODY_ID} {\n    flex: 1;\n    min-height: 0;\n    overflow: hidden;\n  }\n\n  #${PANEL_BODY_ID} > div {\n    flex: 1;\n    min-height: 0;\n    display: flex;\n    flex-direction: column;\n  }\n}\n\n#${FAB_ID} {\n  position: fixed;\n  z-index: 10019;\n  width: 48px;\n  height: 48px;\n  border-radius: 50%;\n  border: 1px solid rgba(96, 165, 250, 0.35);\n  background: rgba(15, 23, 42, 0.85);\n  backdrop-filter: blur(8px);\n  -webkit-backdrop-filter: blur(8px);\n  color: #e2e8f0;\n  font-size: 22px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  cursor: pointer;\n  box-shadow: 0 4px 16px rgba(0,0,0,0.35);\n  touch-action: none;\n  user-select: none;\n  transition: border-color 0.2s, box-shadow 0.2s;\n}\n\n#${FAB_ID}:hover {\n  border-color: #60a5fa;\n  box-shadow: 0 4px 20px rgba(96,165,250,0.3);\n}\n\n#${FAB_ID}.panel-open {\n  border-color: #f43f5e;\n  font-size: 18px;\n}\n\n#${FAB_ID}.panel-open:hover {\n  border-color: #fb7185;\n  box-shadow: 0 4px 20px rgba(244,63,94,0.3);\n}\n`;\n  doc.head.append(style);\n}\n\nfunction mountAppIntoPanel(): void {\n  if (panelRoot?.length) {\n    return;\n  }\n  const doc = getHostDocument();\n  const body = doc.getElementById(PANEL_BODY_ID);\n  if (!body) {\n    return;\n  }\n\n  panelRoot = createScriptIdDiv().appendTo(body as unknown as JQuery);\n  destroyTeleport = teleportStyle().destroy;\n  app = createApp(WorldbookAssistantApp);\n  app.mount(panelRoot[0]);\n}\n\nfunction ensurePanelElement(): JQuery {\n  const doc = getHostDocument();\n  let $panel = $(`#${PANEL_ID}`, doc);\n  if ($panel.length) {\n    return $panel;\n  }\n\n  ensurePanelStyle();\n  const panelHtml = `\n<div id=\"${PANEL_ID}\">\n  <div class=\"wb-assistant-header\">\n    <div class=\"wb-assistant-header-title\"></div>\n    <div class=\"wb-assistant-header-actions\">\n      <button type=\"button\" class=\"wb-assistant-tool wb-assistant-refresh\" title=\"\"></button>\n      <button type=\"button\" class=\"wb-assistant-tool wb-assistant-theme\" title=\"\"></button>\n      <button type=\"button\" class=\"wb-assistant-tool wb-assistant-save\" title=\"\"></button>\n      <button type=\"button\" class=\"wb-assistant-close\" title=\"\"></button>\n    </div>\n  </div>\n  <div id=\"${PANEL_BODY_ID}\"></div>\n</div>\n`;\n  $('body', doc).append(panelHtml);\n  $panel = $(`#${PANEL_ID}`, doc);\n\n  enablePanelDrag($panel[0] as HTMLDivElement);\n  $panel.off(`click${EVENT_NS}`, '.wb-assistant-refresh').on(`click${EVENT_NS}`, '.wb-assistant-refresh', () => {\n    window.dispatchEvent(new Event('wb-helper:refresh'));\n  });\n  $panel.off(`click${EVENT_NS}`, '.wb-assistant-save').on(`click${EVENT_NS}`, '.wb-assistant-save', () => {\n    window.dispatchEvent(new Event('wb-helper:save'));\n  });\n  $panel.off(`click${EVENT_NS}`, '.wb-assistant-theme').on(`click${EVENT_NS}`, '.wb-assistant-theme', (evt) => {\n    evt.stopPropagation();\n    toggleThemeDropdown($panel[0] as HTMLDivElement);\n  });\n  // Close theme dropdown on clicks elsewhere\n  getHostDocument().addEventListener('pointerdown', closeThemeDropdownOnOutside, true);\n  $panel.off(`click${EVENT_NS}`, '.wb-assistant-close').on(`click${EVENT_NS}`, '.wb-assistant-close', () => {\n    hidePanel();\n  });\n\n  return $panel;\n}\n\nconst THEME_ITEMS: { key: string; label: string }[] = [\n  { key: 'ocean', label: '' },\n  { key: 'nebula', label: '' },\n  { key: 'forest', label: '' },\n  { key: 'sunset', label: '' },\n  { key: 'coffee', label: '' },\n  { key: 'paper', label: '' },\n  { key: 'snow', label: '' },\n];\n\nfunction toggleThemeDropdown(panel: HTMLDivElement): void {\n  const existing = panel.querySelector('.wb-theme-dropdown');\n  if (existing) {\n    existing.remove();\n    return;\n  }\n\n  const themeBtn = panel.querySelector('.wb-assistant-theme') as HTMLElement;\n  if (themeBtn) {\n    themeBtn.style.position = 'relative';\n  }\n\n  const dropdown = document.createElement('div');\n  dropdown.className = 'wb-theme-dropdown';\n\n  for (const item of THEME_ITEMS) {\n    const btn = document.createElement('button');\n    btn.type = 'button';\n    btn.textContent = item.label;\n    btn.dataset.themeKey = item.key;\n    btn.addEventListener('click', () => {\n      window.dispatchEvent(new CustomEvent('wb-helper:set-theme', { detail: item.key }));\n      dropdown.remove();\n    });\n    dropdown.appendChild(btn);\n  }\n\n  if (themeBtn) {\n    themeBtn.appendChild(dropdown);\n  } else {\n    panel.querySelector('.wb-assistant-header-actions')?.appendChild(dropdown);\n  }\n}\n\nfunction closeThemeDropdownOnOutside(event: PointerEvent): void {\n  const target = event.target as HTMLElement | null;\n  if (!target) {\n    return;\n  }\n  if (target.closest('.wb-assistant-theme') || target.closest('.wb-theme-dropdown')) {\n    return;\n  }\n  const doc = getHostDocument();\n  const dropdown = doc.querySelector('.wb-theme-dropdown');\n  if (dropdown) {\n    dropdown.remove();\n  }\n}\n\nfunction enablePanelDrag(panel: HTMLDivElement): void {\n  const hostWin = getHostWindow();\n  const handle = panel.querySelector('.wb-assistant-header') as HTMLDivElement | null;\n  if (!handle) {\n    return;\n  }\n\n  let dragging = false;\n  let offsetX = 0;\n  let offsetY = 0;\n\n  const onMouseMove = (event: MouseEvent) => {\n    if (!dragging) {\n      return;\n    }\n    const rect = panel.getBoundingClientRect();\n    const maxLeft = Math.max(8, hostWin.innerWidth - rect.width - 8);\n    const maxTop = Math.max(8, hostWin.innerHeight - rect.height - 8);\n    const nextLeft = Math.min(maxLeft, Math.max(8, event.clientX - offsetX));\n    const nextTop = Math.min(maxTop, Math.max(8, event.clientY - offsetY));\n    panel.style.left = `${nextLeft}px`;\n    panel.style.top = `${nextTop}px`;\n    panel.style.right = 'auto';\n    panel.style.bottom = 'auto';\n    panel.style.transform = 'none';\n  };\n\n  const onMouseUp = () => {\n    if (!dragging) {\n      return;\n    }\n    dragging = false;\n    hostWin.document.removeEventListener('mousemove', onMouseMove, true);\n    hostWin.document.removeEventListener('mouseup', onMouseUp, true);\n  };\n\n  handle.addEventListener('mousedown', event => {\n    if (event.button !== 0) {\n      return;\n    }\n    if ((event.target as HTMLElement).closest('button')) {\n      return;\n    }\n    const rect = panel.getBoundingClientRect();\n    offsetX = event.clientX - rect.left;\n    offsetY = event.clientY - rect.top;\n    dragging = true;\n    panel.style.left = `${rect.left}px`;\n    panel.style.top = `${rect.top}px`;\n    panel.style.right = 'auto';\n    panel.style.bottom = 'auto';\n    panel.style.transform = 'none';\n    hostWin.document.addEventListener('mousemove', onMouseMove, true);\n    hostWin.document.addEventListener('mouseup', onMouseUp, true);\n    event.preventDefault();\n  });\n}\n\nfunction centerPanel(panel: HTMLDivElement): void {\n  const hostWin = getHostWindow();\n  const rect = panel.getBoundingClientRect();\n  const maxLeft = Math.max(8, hostWin.innerWidth - rect.width - 8);\n  const maxTop = Math.max(8, hostWin.innerHeight - rect.height - 8);\n  const nextLeft = Math.min(maxLeft, Math.max(8, Math.round((hostWin.innerWidth - rect.width) / 2)));\n  const nextTop = Math.min(maxTop, Math.max(8, Math.round((hostWin.innerHeight - rect.height) / 2)));\n  panel.style.left = `${nextLeft}px`;\n  panel.style.top = `${nextTop}px`;\n  panel.style.right = 'auto';\n  panel.style.bottom = 'auto';\n  panel.style.transform = 'none';\n}\n\nfunction setMenuActive(active: boolean): void {\n  const doc = getHostDocument();\n  const $menuItem = $(`#${MENU_ID}`, doc);\n  if ($menuItem.length) {\n    $menuItem.toggleClass('active', active);\n  }\n  // Sync FAB state\n  const fab = doc.getElementById(FAB_ID);\n  if (fab) {\n    fab.classList.toggle('panel-open', active);\n    fab.textContent = active ? '' : '';\n  }\n}\n\nfunction showPanel(): void {\n  const doc = getHostDocument();\n  const $panel = ensurePanelElement();\n  mountAppIntoPanel();\n  $panel.css('visibility', 'hidden');\n  $panel.addClass('active');\n  const panelElement = $panel[0] as HTMLDivElement;\n  centerPanel(panelElement);\n  $panel.css('visibility', '');\n  requestAnimationFrame(() => {\n    centerPanel(panelElement);\n  });\n  isPanelVisible = true;\n  setMenuActive(true);\n  // \n  window.dispatchEvent(new Event('wb-helper:refresh'));\n  $(`#${MENU_ID}`, doc).blur();\n}\n\nfunction hasUnsavedChanges(): boolean {\n  const current = window as unknown as Record<string, unknown>;\n  const host = getHostWindow() as unknown as Record<string, unknown>;\n  return current[DIRTY_STATE_KEY] === true || host[DIRTY_STATE_KEY] === true;\n}\n\nfunction shouldClosePanel(): boolean {\n  if (!hasUnsavedChanges()) {\n    return true;\n  }\n  return confirm('');\n}\n\nfunction hidePanel(): boolean {\n  const hadUnsavedChanges = hasUnsavedChanges();\n  if (!shouldClosePanel()) {\n    return false;\n  }\n  if (hadUnsavedChanges) {\n    window.dispatchEvent(new Event('wb-helper:discard'));\n    const current = window as unknown as Record<string, unknown>;\n    const host = getHostWindow() as unknown as Record<string, unknown>;\n    current[DIRTY_STATE_KEY] = false;\n    host[DIRTY_STATE_KEY] = false;\n  }\n  const doc = getHostDocument();\n  $(`#${PANEL_ID}`, doc).removeClass('active');\n  isPanelVisible = false;\n  setMenuActive(false);\n  return true;\n}\n\nfunction togglePanel(): void {\n  if (isPanelVisible) {\n    void hidePanel();\n  } else {\n    showPanel();\n  }\n}\n\nfunction ensureMenuItem(): boolean {\n  const doc = getHostDocument();\n  const $menu = $('#extensionsMenu', doc);\n  if (!$menu.length) {\n    return false;\n  }\n\n  const $existing = $(`#${MENU_ID}`, doc);\n  if ($existing.length && !$existing.closest('#extensionsMenu').length) {\n    $existing.remove();\n  }\n  if (!$(`#${MENU_ID}`, doc).length) {\n    const menuHtml = `\n<div id=\"${MENU_ID}\" class=\"list-group-item flex-container flexGap5 interactable\" title=\"\" tabIndex=\"0\">\n  <i class=\"fa-solid fa-book-open\"></i>\n  <span></span>\n</div>\n`;\n    $menu.append(menuHtml);\n  }\n  setMenuActive(isPanelVisible);\n  return true;\n}\n\nfunction startMenuObserver(): void {\n  const doc = getHostDocument();\n  if (menuObserver) {\n    return;\n  }\n  menuObserver = new MutationObserver(() => {\n    ensureMenuItem();\n  });\n  menuObserver.observe(doc.body, { childList: true, subtree: true });\n}\n\nfunction stopMenuObserver(): void {\n  menuObserver?.disconnect();\n  menuObserver = null;\n}\n\nfunction ensureMenuRetry(): void {\n  if (menuRetryTimer !== null) {\n    return;\n  }\n  menuRetryTimer = window.setInterval(() => {\n    if (ensureMenuItem()) {\n      window.clearInterval(menuRetryTimer as number);\n      menuRetryTimer = null;\n    }\n  }, 1000);\n}\n\nfunction stopMenuRetry(): void {\n  if (menuRetryTimer === null) {\n    return;\n  }\n  window.clearInterval(menuRetryTimer);\n  menuRetryTimer = null;\n}\n\nfunction createFab(): void {\n  const doc = getHostDocument();\n  if (doc.getElementById(FAB_ID)) return;\n\n  const fab = doc.createElement('div');\n  fab.id = FAB_ID;\n  fab.textContent = '';\n  fab.title = '';\n\n  // Restore saved position or default to bottom-right\n  let savedPos: { x: number; y: number } | null = null;\n  try {\n    const raw = localStorage.getItem(FAB_POS_KEY);\n    if (raw) savedPos = JSON.parse(raw);\n  } catch { /* ignore */ }\n\n  const hostWin = getHostWindow();\n  if (savedPos) {\n    fab.style.left = Math.min(savedPos.x, hostWin.innerWidth - 56) + 'px';\n    fab.style.top = Math.min(savedPos.y, hostWin.innerHeight - 56) + 'px';\n  } else {\n    fab.style.right = '16px';\n    fab.style.bottom = '80px';\n  }\n\n  // Drag support\n  let dragging = false;\n  let dragMoved = false;\n  let startX = 0;\n  let startY = 0;\n  let fabStartX = 0;\n  let fabStartY = 0;\n\n  fab.addEventListener('pointerdown', (e: PointerEvent) => {\n    if (e.button !== 0) return;\n    dragging = true;\n    dragMoved = false;\n    startX = e.clientX;\n    startY = e.clientY;\n    const rect = fab.getBoundingClientRect();\n    fabStartX = rect.left;\n    fabStartY = rect.top;\n    fab.setPointerCapture(e.pointerId);\n    e.preventDefault();\n  });\n\n  fab.addEventListener('pointermove', (e: PointerEvent) => {\n    if (!dragging) return;\n    const dx = e.clientX - startX;\n    const dy = e.clientY - startY;\n    if (Math.abs(dx) > 3 || Math.abs(dy) > 3) dragMoved = true;\n    const maxX = hostWin.innerWidth - 56;\n    const maxY = hostWin.innerHeight - 56;\n    const nx = Math.max(0, Math.min(maxX, fabStartX + dx));\n    const ny = Math.max(0, Math.min(maxY, fabStartY + dy));\n    fab.style.left = nx + 'px';\n    fab.style.top = ny + 'px';\n    fab.style.right = 'auto';\n    fab.style.bottom = 'auto';\n  });\n\n  fab.addEventListener('pointerup', () => {\n    if (!dragging) return;\n    dragging = false;\n    // Save position\n    try {\n      const rect = fab.getBoundingClientRect();\n      localStorage.setItem(FAB_POS_KEY, JSON.stringify({ x: rect.left, y: rect.top }));\n    } catch { /* ignore */ }\n  });\n\n  fab.addEventListener('click', () => {\n    if (dragMoved) return; // Don't toggle if was dragging\n    togglePanel();\n  });\n\n  doc.body.appendChild(fab);\n}\n\nfunction init(): void {\n  // \n  replaceScriptButtons([]);\n\n  const doc = getHostDocument();\n  $(doc).off(`click${EVENT_NS}`, `#${MENU_ID}`).on(`click${EVENT_NS}`, `#${MENU_ID}`, event => {\n    event.preventDefault();\n    togglePanel();\n  });\n\n  ensurePanelElement();\n  if (!ensureMenuItem()) {\n    ensureMenuRetry();\n  }\n  startMenuObserver();\n  createFab();\n  toastr.success('', 'Worldbook Assistant');\n}\n\nfunction cleanup(): void {\n  const doc = getHostDocument();\n  stopMenuRetry();\n  stopMenuObserver();\n  $(doc).off(EVENT_NS);\n  $(`#${MENU_ID}`, doc).remove();\n  $(`#${PANEL_ID}`, doc).remove();\n  doc.getElementById(PANEL_STYLE_ID)?.remove();\n  doc.getElementById(FAB_ID)?.remove();\n\n  app?.unmount();\n  app = null;\n  panelRoot?.remove();\n  panelRoot = null;\n  destroyTeleport?.();\n  destroyTeleport = null;\n}\n\n$(() => {\n  errorCatched(init)();\n});\n\n$(window).on('pagehide', () => {\n  cleanup();\n});\n","import iframe_srcdoc from './iframe_srcdoc.html';\n\nexport async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle(\n  append_to: JQuery.Selector | JQuery.htmlString | JQuery.TypeOrArray<Element | DocumentFragment> | JQuery = 'head',\n): { destroy: () => void } {\n  const $div = $(`<div>`)\n    .attr('script_id', getScriptId())\n    .append($(`head > style`, document).clone())\n    .appendTo(append_to);\n\n  return {\n    destroy: () => $div.remove(),\n  };\n}\n\nexport function createScriptIdIframe(): JQuery<HTMLIFrameElement> {\n  return $(`<iframe>`).attr({\n    script_id: getScriptId(),\n    frameborder: 0,\n    srcdoc: iframe_srcdoc,\n  }) as JQuery<HTMLIFrameElement>;\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n"],"names":["___CSS_LOADER_EXPORT___","push","module","id","exports","cssWithMappingToString","list","toString","this","map","item","content","needLayer","concat","length","join","i","modules","media","dedupe","supports","layer","undefined","alreadyImportedModules","k","_k","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","data","sourceMapping","__esModule","default","locals","add","sfc","props","target","__vccOpts","key","val","listToStyles","parentId","styles","newStyles","part","css","sourceMap","parts","hasDocument","document","DEBUG","Error","stylesInDom","head","getElementsByTagName","singletonElement","singletonCounter","isProduction","noop","options","ssrIdKey","isOldIE","navigator","test","userAgent","toLowerCase","addStylesClient","_isProduction","_options","addStylesToDom","newList","mayRemove","domStyle","refs","j","addStyle","createStyleElement","styleElement","createElement","type","appendChild","obj","update","remove","querySelector","parentNode","removeChild","styleIndex","applyToSingletonTag","bind","applyToTag","newObj","textStore","replaceText","index","replacement","filter","Boolean","styleSheet","cssText","cssNode","createTextNode","childNodes","insertBefore","setAttribute","ssrId","sources","firstChild","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","d","a","definition","o","Object","defineProperty","enumerable","get","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","Vue","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","style","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_16","_hoisted_17","_hoisted_18","_hoisted_19","_hoisted_20","_hoisted_21","_hoisted_22","_hoisted_23","_hoisted_24","_hoisted_25","_hoisted_26","_hoisted_27","_hoisted_28","_hoisted_29","_hoisted_30","_hoisted_31","_hoisted_32","_hoisted_33","_hoisted_34","_hoisted_35","_hoisted_36","_hoisted_37","_hoisted_38","_hoisted_39","_hoisted_40","_hoisted_41","_hoisted_42","_hoisted_43","_hoisted_44","_hoisted_45","_hoisted_46","_hoisted_47","_hoisted_48","_hoisted_49","_hoisted_50","_hoisted_51","_hoisted_52","_hoisted_53","_hoisted_54","_hoisted_55","_hoisted_56","_hoisted_57","_hoisted_58","_hoisted_59","_hoisted_60","_hoisted_61","_hoisted_62","_hoisted_63","_hoisted_64","_hoisted_65","_hoisted_66","_hoisted_67","_hoisted_68","_hoisted_69","_hoisted_70","_hoisted_71","_hoisted_72","_hoisted_73","_hoisted_74","_hoisted_75","_hoisted_76","_hoisted_77","_hoisted_78","_hoisted_79","_hoisted_80","_hoisted_81","_hoisted_82","_hoisted_83","_hoisted_84","_hoisted_85","_hoisted_86","_hoisted_87","_hoisted_88","_hoisted_89","_hoisted_90","_hoisted_91","_hoisted_92","_hoisted_93","_hoisted_94","_hoisted_95","_hoisted_96","_hoisted_97","_hoisted_98","_hoisted_99","_hoisted_100","_hoisted_101","_hoisted_102","_hoisted_103","_hoisted_104","_hoisted_105","_hoisted_106","title","_hoisted_107","_hoisted_108","_hoisted_109","_hoisted_110","_hoisted_111","_hoisted_112","_hoisted_113","_hoisted_114","_hoisted_115","_hoisted_116","_hoisted_117","_hoisted_118","_hoisted_119","_hoisted_120","_hoisted_121","_hoisted_122","_hoisted_123","_hoisted_124","_hoisted_125","_hoisted_126","_hoisted_127","_hoisted_128","_hoisted_129","_hoisted_130","_hoisted_131","_hoisted_132","_hoisted_133","_hoisted_134","_hoisted_135","_hoisted_136","_hoisted_137","_hoisted_138","_hoisted_139","_hoisted_140","_hoisted_141","_hoisted_142","_hoisted_143","_hoisted_144","_hoisted_145","_hoisted_146","_hoisted_147","_hoisted_148","_hoisted_149","_hoisted_150","_hoisted_151","_hoisted_152","_hoisted_153","_hoisted_154","_hoisted_155","_hoisted_156","_hoisted_157","_hoisted_158","_hoisted_159","_hoisted_160","_hoisted_161","_hoisted_162","_hoisted_163","_hoisted_164","_hoisted_165","_hoisted_166","_hoisted_167","_hoisted_168","_hoisted_169","_hoisted_170","_hoisted_171","_hoisted_172","_hoisted_173","_hoisted_174","_hoisted_175","_hoisted_176","_hoisted_177","_hoisted_178","_hoisted_179","_hoisted_180","_hoisted_181","_hoisted_182","_hoisted_183","_hoisted_184","_hoisted_185","_hoisted_186","_hoisted_187","_hoisted_188","_hoisted_189","_hoisted_190","_hoisted_191","_hoisted_192","_hoisted_193","_hoisted_194","_hoisted_195","_hoisted_196","_hoisted_197","_hoisted_198","_hoisted_199","_hoisted_200","_hoisted_201","_hoisted_202","_hoisted_203","_hoisted_204","_hoisted_205","_hoisted_206","_hoisted_207","_hoisted_208","_hoisted_209","_hoisted_210","_hoisted_211","_hoisted_212","_hoisted_213","_hoisted_214","_hoisted_215","_hoisted_216","_hoisted_217","_hoisted_218","_hoisted_219","_hoisted_220","_hoisted_221","_hoisted_222","_hoisted_223","_hoisted_224","_hoisted_225","_hoisted_226","_hoisted_227","_hoisted_228","_hoisted_229","_hoisted_230","_hoisted_231","_hoisted_232","_hoisted_233","_hoisted_234","_hoisted_235","_hoisted_236","_hoisted_237","_hoisted_238","_hoisted_239","_hoisted_240","_hoisted_241","_hoisted_242","_hoisted_243","_hoisted_244","_hoisted_245","_hoisted_246","_hoisted_247","_hoisted_248","_hoisted_249","_hoisted_250","_hoisted_251","_hoisted_252","_hoisted_253","_hoisted_254","_hoisted_255","_hoisted_256","_hoisted_257","_hoisted_258","_hoisted_259","_hoisted_260","_hoisted_261","_hoisted_262","_hoisted_263","_hoisted_264","_hoisted_265","_hoisted_266","_hoisted_267","_hoisted_268","_hoisted_269","_hoisted_270","_hoisted_271","_hoisted_272","_hoisted_273","_hoisted_274","_hoisted_275","_hoisted_276","_hoisted_277","_hoisted_278","_hoisted_279","_hoisted_280","_hoisted_281","_hoisted_282","_hoisted_283","_hoisted_284","_hoisted_285","_hoisted_286","_hoisted_287","_hoisted_288","_hoisted_289","_hoisted_290","_hoisted_291","_hoisted_292","_hoisted_293","_hoisted_294","_hoisted_295","_hoisted_296","_hoisted_297","_hoisted_298","_hoisted_299","_hoisted_300","_hoisted_301","_hoisted_302","_hoisted_303","_hoisted_304","_hoisted_305","_hoisted_306","_hoisted_307","_hoisted_308","_hoisted_309","_hoisted_310","_hoisted_311","_hoisted_312","_hoisted_313","_hoisted_314","_hoisted_315","_hoisted_316","_hoisted_317","_hoisted_318","_hoisted_319","_hoisted_320","_hoisted_321","_hoisted_322","_hoisted_323","_hoisted_324","_hoisted_325","_hoisted_326","_hoisted_327","_hoisted_328","_hoisted_329","_hoisted_330","_hoisted_331","_hoisted_332","_hoisted_333","_hoisted_334","_hoisted_335","_hoisted_336","_hoisted_337","_hoisted_338","STORAGE_KEY","DIRTY_STATE_KEY","RESIZE_HANDLE_SIZE","MAIN_PANE_MIN","MAIN_EDITOR_MIN","EDITOR_SIDE_MIN","EDITOR_CENTER_MIN","__name","setup","__props","THEMES","ocean","name","label","colors","nebula","forest","sunset","coffee","paper","snow","strategyTypeOptions","secondaryLogicOptions","positionTypeOptions","worldbookNames","ref","selectedWorldbookName","worldbookPickerOpen","worldbookPickerSearchText","worldbookPickerRef","worldbookPickerSearchInputRef","rolePickerOpen","rolePickerRef","rolePickerSearchInputRef","currentTheme","themePickerOpen","globalWorldbookMode","aiGeneratorMode","aiIsGenerating","aiCurrentGenerationId","aiStreamingText","aiExtractedTags","aiShowTagReview","aiTargetWorldbook","aiChatInputText","aiUseContext","aiChatMessagesRef","selectedGlobalPresetId","currentRoleContext","roleBindingSourceCandidates","originalEntries","draftEntries","selectedEntryUid","searchText","onlyEnabled","importFileInput","selectedExtraText","globalAddSearchText","globalFilterText","roleBindSearchText","batchFindText","batchReplaceText","batchExcludeText","batchUseRegex","batchInName","batchInContent","batchInKeys","batchSearchScope","findHits","findHitIndex","statusMessage","isBusy","isSaving","showEntryHistoryModal","showWorldbookHistoryModal","entryHistoryLeftId","entryHistoryRightId","worldbookHistoryLeftId","worldbookHistoryRightId","floatingZCounter","floatingPanels","reactive","find","visible","x","y","z","width","activation","activeFloatingDrag","floatingPanelKeys","viewportWidth","window","innerWidth","mainLayoutRef","editorShellRef","contentTextareaRef","mainPaneWidth","editorSideWidth","paneResizeState","hostResizeWindow","screenWidth","screen","screenHeight","height","isMobile","computed","syncScreenDims","addEventListener","setTimeout","showMobileEditor","mobileTab","bindings","global","charPrimary","charAdditional","chat","activationLogs","persistedState","last_worldbook","history","entry_history","global_presets","last_global_preset_id","role_override_baseline","theme","ai_chat","sessions","activeSessionId","subscriptions","selectedEntry","entry","uid","selectedEntryIndex","findIndex","filteredEntries","keyword","trim","enabled","keysJoined","strategy","keys","stringifyKeyword","includes","enabledEntryCount","totalContentChars","reduce","sum","hasUnsavedChanges","isCompactLayout","mainLayoutStyle","display","overflow","gridTemplateColumns","editorShellStyle","themeStyles","selectableWorldbookNames","globalWorldbookPresets","selectedGlobalPreset","selectedGlobalPresetRoleBindings","role_bindings","isCurrentRoleBoundToSelectedPreset","role","preset","some","roleBindingCandidates","boundSet","Set","avatar","bound","has","filteredSelectableWorldbookNames","globalAddCandidates","filteredGlobalWorldbooks","isGlobalBound","snapshotsForCurrent","entrySnapshotsForSelected","String","entryVersionViews","baselineEntry","current","ts","Date","now","isCurrent","baseline","selectedEntryHistoryLeft","selectedEntryHistoryRight","canRestoreEntryFromLeft","worldbookVersionViews","entries","selectedWorldbookHistoryLeft","selectedWorldbookHistoryRight","canRestoreWorldbookFromLeft","batchExcludeTokensPreview","parseBatchExcludeTokens","activeFindHit","findHitSummaryText","entryHistoryDiff","buildDiffHtml","serializeEntryVersionForDiff","entryHistorySummary","left","right","leftText","rightText","addLines","delLines","lines","split","pop","added","removed","changed","Math","min","max","getEntryVersionDiffSummary","worldbookHistoryDiff","serializeWorldbookVersionForDiff","selectedKeysText","set","parseKeywordsFromText","selectedSecondaryKeysText","keys_secondary","selectedScanDepthText","depth","scan_depth","normalizeScanDepth","selectedRecursionDelayText","nullableNumberToText","recursion","delay_until","parseNullableInteger","selectedStickyText","effect","sticky","selectedCooldownText","cooldown","selectedEffectDelayText","delay","selectedContentChars","selectedTokenEstimate","chars","round","createId","prefix","random","slice","asRecord","Array","isArray","toStringSafe","fallback","toNumberSafe","Number","isFinite","parsed","clampNumber","floor","RegExp","parseKeywordToken","token","trimmed","regexMatch","match","normalizeKeywordList","sourceList","normalized","seen","tokenString","dedupeKey","normalizePresetRoleBindings","rawList","record","updated_at","getSecondaryLogicLabel","logic","and_any","and_all","not_all","not_any","getPositionTypeLabel","before_character_definition","after_character_definition","before_example_messages","after_example_messages","before_author_note","after_author_note","at_depth","getEntryVisualStatus","getEntryStatusLabel","status","getEntryKeyPreview","rendered","numeric","NaN","createDefaultEntry","position","order","probability","prevent_incoming","prevent_outgoing","normalizeEntry","rawInput","fallbackUid","raw","base","strategyRecord","positionRecord","recursionRecord","effectRecord","secondaryRecord","comment","strategyType","directType","constant","vectorized","normalizeStrategyType","secondaryKeys","secondary_keys","keysecondary","filters","secondaryLogic","normalizeSecondaryLogic","selectiveLogic","positionType","normalizePositionType","normalizeRole","insertion_order","preventIncoming","preventRecursion","preventOutgoing","excludeRecursion","disable","delayUntilRecursion","directExtra","extra","extras","known","collectExtraFields","normalizeEntryList","rawEntries","result","uidSet","rawRecord","getNextUid","readPersistedState","input","root","historyRoot","rawSnapshots","entriesRaw","entryHistoryRoot","entryHistory","worldbookName","rawByUid","uidRecord","normalizedByUid","uidKey","rawItems","uidNumber","globalPresets","worldbooksRaw","worldbooks","roleBindings","rawBaseline","roleOverrideBaseline","baselineWorldbooks","preset_id","aiChatRaw","aiChat","s","sr","msgs","messages","m","mr","timestamp","createdAt","normalizePersistedState","getVariables","script_id","getScriptId","syncSelectedGlobalPresetFromState","presets","byId","preferredId","updatePersistedState","mutator","state","vars","replaceVariables","writePersistedState","watch","closeWorldbookPicker","loadWorldbook","syncExtraTextWithSelection","resetFindState","views","ids","immediate","dirty","aiSessions","aiActiveSession","aiActiveMessages","aiCreateSession","session","unshift","setStatus","aiAddMessage","sessionId","aiStreamSubscription","async","aiSendMessage","text","historyPrompts","generationId","eventOn","iframe_events","STREAM_TOKEN_RECEIVED_FULLY","fullText","genId","generateConfig","generation_id","user_input","should_stream","should_silence","overrides","chat_history","prompts","generate","tags","regex","results","exec","tag","selected","aiExtractTags","error","message","toastr","stop","aiStopGeneration","stopGenerationById","aiCreateSelectedEntries","t","warning","targetName","newEntries","createWorldbookEntries","success","aiToggleMode","formatDateTime","toLocaleString","hour12","formatHistoryOptionLabel","getWorldbookVersionDiffSummary","leftMap","Map","rightMap","forEach","rightEntry","leftEntry","escapeHtml","replaceAll","view","payload","sort","leftRendered","rightRendered","leftLineNo","rightLineNo","line","safe","leftHtml","rightHtml","tokens","shouldExcludeEntryForBatch","uidMatch","scoped","scope","needle","plain","getFindFieldLabel","field","resolveBatchRegex","findText","getBatchTargetEntries","getEnabledFindFields","fields","getEntryFieldText","collectMatchIndexes","hits","cursor","start","indexOf","end","matchedText","runtime","source","flags","matched","lastIndex","buildFindPreview","suffix","replace","getFindTargetElement","scrollTextareaToSelection","element","lineHeight","getComputedStyle","parseFloat","fontSize","getTextareaLineHeight","lineIndex","desiredTop","clientHeight","scrollTop","moveToFindHit","hit","total","entryUid","nextTick","maxLen","focus","setSelectionRange","HTMLTextAreaElement","scrollIntoView","block","inline","requestAnimationFrame","revealFindHitInEditor","entryName","preview","runFind","step","excludeTokens","indexes","collectFindHits","info","prevHit","currentIndex","isSameFindHit","nextIndex","findFirstMatch","findNextMatch","findPreviousMatch","ensureSelectedEntryExists","selectEntry","goBackToList","createEntrySnapshotRecord","pushEntrySnapshotsBulk","items","byWorldbook","incoming","pushEntrySnapshot","pushSnapshot","snapshot","createManualSnapshot","openEntryHistoryModal","nonCurrent","openWorldbookHistoryModal","createManualEntrySnapshot","restoreWorldbookFromLeftHistory","confirm","clearCurrentSnapshots","restoreEntryFromLeftHistory","restored","splice","clearCurrentEntrySnapshots","handleSelectedPositionTypeChanged","applyExtraJson","parsedRecord","parse","clearExtra","addEntry","duplicateSelectedEntry","duplicated","removeSelectedEntry","moveSelectedEntry","direction","normalizeAllEntries","sortEntriesByOrderDesc","setEnabledForAll","applyBatchReplace","targetEntries","touched","skipped","next","exportCurrentWorldbook","format","exported_at","toISOString","filename","blob","Blob","url","URL","createObjectURL","anchor","href","download","body","click","revokeObjectURL","downloadJson","parseImportedPayload","fileName","fallbackName","entriesMap","values","dataRoot","dataEntriesMap","collectRawEntries","triggerImport","onImportChange","event","file","files","fileText","suggested","newName","prompt","createOrReplaceWorldbook","render","reloadWorldbookNames","refreshBindings","response","importRawWorldbook","ok","hardRefresh","getGlobalWorldbookNames","charBindings","getCharWorldbookNames","primary","additional","getChatWorldbookName","ensureSelectionForGlobalMode","globals","trySelectWorldbookByContext","preferWhenEmptyOnly","candidate","available","chatBound","resolveContextWorldbookCandidate","force","toggleGlobalMode","applyGlobalWorldbooks","nextGlobal","statusLabel","rebindGlobalWorldbooks","addFirstGlobalCandidate","first","addGlobalWorldbook","removeGlobalWorldbook","clearGlobalWorldbooks","getCurrentGlobalWorldbookSet","normalizeWorldbookSet","refreshRoleBindingCandidates","names","getCharacterNames","console","warn","charName","localeCompare","resolveCurrentRoleContext","getCurrentCharacterName","refreshCurrentRoleContext","applyPresetWorldbooks","missing","silentWhenSame","leftSorted","rightSorted","isSameWorldbookSet","statusPrefix","autoApplyRoleBoundPreset","rolePreset","binding","getRoleBoundPresetForCurrentContext","baselinePreset","onGlobalPresetSelectionChanged","closeRolePicker","applySelectedGlobalPreset","bindRoleToSelectedPreset","nextBindings","bindCurrentRoleToSelectedPreset","bindRoleCandidateToSelectedPreset","removeRoleBindingFromSelectedPreset","bindingKey","unbindCurrentRoleFromSelectedPreset","saveCurrentAsGlobalPreset","defaultName","sameNamePreset","presetId","nextPreset","overwriteSelectedGlobalPreset","deleteSelectedGlobalPreset","toggleWorldbookPicker","toggleRolePicker","toggleTheme","onSetThemeEvent","detail","setTheme","selectWorldbookFromPicker","bindFirstRoleCandidate","onHostPointerDownForWorldbookPicker","worldbookRoot","contains","roleRoot","onHostKeyDownForWorldbookPicker","getWorldbook","preferred","getWorldbookNames","saveCurrentWorldbook","savedEntrySnapshotCount","draftByUid","previous","collectEntrySnapshotsBeforeSave","replaceWorldbook","createNewWorldbook","duplicateWorldbook","deleteCurrentWorldbook","deleteWorldbook","toggleGlobalBinding","delete","clearActivationLogs","resolveHostWindow","ownerDocument","defaultView","clampFloatingPanelToViewport","panel","hostWin","viewportHeight","innerHeight","maxX","maxY","handleFloatingWindowResize","mainRect","getBoundingClientRect","maxLeft","editorRect","maxSide","clampPaneWidths","bringFloatingToFront","closeFloatingPanel","stopFloatingDrag","toggleFloatingPanel","openFloatingPanel","getFloatingPanelStyle","top","zIndex","startFloatingDrag","pointerType","button","currentTarget","hostDoc","rect","dragState","pointerId","offsetX","clientX","offsetY","clientY","doc","win","setPointerCapture","onFloatingDragMove","preventDefault","drag","removeEventListener","startContentResize","e","textarea","startY","startHeight","offsetHeight","pointerEvents","willChange","rafId","pendingHeight","applyHeight","minHeight","onMove","ev","onUp","cancelAnimationFrame","editorContentBlockRef","contentTopDragOffset","startContentTopDrag","startOffset","pendingOffset","apply","marginTop","delta","startPaneResize","onPaneResizeMove","stopPaneResize","side","onPanelRefresh","onPanelSave","onPanelDiscard","discardUnsavedDraft","rootRef","_rootResizeObserver","_mobileResizeHandler","updateHostPanelTheme","getElementById","setProperty","onMounted","parent","el","syncHeight","maxHeight","parentElement","ResizeObserver","observe","tavern_events","WORLD_INFO_ACTIVATED","logs","displayIndex","time","world","contentPreview","pushActivationLogs","WORLDINFO_UPDATED","CHAT_CHANGED","onUnmounted","disconnect","subscription","_ctx","_cache","ref_key","onClick","$event","placeholder","onKeydown","active","disabled","padding","background","color","onChange","opacity","onPointerdown","number","msg","idx","rows","flex","flexDirection","alignItems","justifyContent","border","borderTop","gap","accept","empty","dragging","ver","innerHTML","user","log","MENU_ID","PANEL_ID","FAB_ID","FAB_POS_KEY","PANEL_STYLE_ID","PANEL_BODY_ID","EVENT_NS","app","panelRoot","destroyTeleport","menuObserver","menuRetryTimer","isPanelVisible","getHostWindow","getHostDocument","mountAppIntoPanel","$","attr","appendTo","append_to","$div","append","clone","destroy","teleportStyle","createApp","mount","ensurePanelElement","$panel","textContent","ensurePanelStyle","panelHtml","handle","onMouseMove","maxTop","nextLeft","nextTop","bottom","transform","onMouseUp","closest","enablePanelDrag","off","on","dispatchEvent","Event","evt","stopPropagation","existing","themeBtn","dropdown","className","THEME_ITEMS","btn","dataset","themeKey","CustomEvent","toggleThemeDropdown","closeThemeDropdownOnOutside","hidePanel","centerPanel","setMenuActive","$menuItem","toggleClass","fab","classList","toggle","host","hadUnsavedChanges","removeClass","togglePanel","addClass","panelElement","blur","showPanel","ensureMenuItem","$menu","$existing","menuHtml","init","replaceScriptButtons","setInterval","clearInterval","MutationObserver","childList","subtree","startMenuObserver","savedPos","localStorage","getItem","dragMoved","startX","fabStartX","fabStartY","dx","dy","abs","nx","ny","setItem","createFab","cleanup","unmount","errorCatched"],"sourceRoot":""}